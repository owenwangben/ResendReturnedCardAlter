// document.addEventListener("touchmove", function(event){
// event.preventDefault();
// }, false);


(function($) {
    $.fn.scrollTo = function(target, options, callback) {
        if (typeof options == 'function' && arguments.length == 2) { callback = options; options = target; }
        var settings = $.extend({
            scrollTarget: target,
            offsetTop: 50,
            duration: 500,
            easing: 'swing'
        }, options);
        return this.each(function() {
            var scrollPane = $(this);
            var scrollTarget = (typeof settings.scrollTarget == "number") ? settings.scrollTarget : $(settings.scrollTarget);
            var scrollY = (typeof scrollTarget == "number") ? scrollTarget : scrollTarget.offset().top + scrollPane.scrollTop() - parseInt(settings.offsetTop);
            scrollPane.animate({ scrollTop: scrollY }, parseInt(settings.duration), settings.easing, function() {
                if (typeof callback == 'function') { callback.call(this); }
            });
        });
    }

    $.fn.dropdown = function() {
        return this.each(function(index,element) {
			
            var obj = $(this),
				options = obj.find('.options'),
				selected = obj.find('.selected'),
                _multiLine = obj.hasClass('mLSelect');

            selected.click(function() { //onclick event, 'list' fadein

                if (obj.hasClass('disabled')) {
                    return false;
                }
                $('body').append("<div id='overlay'></div>");
                $('html').css('overflow', 'hidden');
				//$('html').css('position', 'fixed');
				//$('body').css('overflow', 'hidden');
				//$('body').css('position', 'fixed');
                options.css({
                    'opacity': 0,
                    'display': 'block'
                });
				
				var userAgent = navigator.userAgent;
				var panelHeight;
				var winWidth = $(window).width();
				var headerHeight = $('header').outerHeight();
				if(userAgent.indexOf("Sinopac mobilebanking") > -1){
					if(userAgent.indexOf("Sinopac mobilebanking Android") > -1){
						panelHeight = options.outerHeight();
						panelMTop = "-" + panelHeight / 2 + "px";	
					}						
					else if (winWidth >= 768) {
						panelMTop = "-35%";	
					}
					else{
						panelMTop = "-65%";	
					}
				}
				else{				
					if (winWidth >= 768 || userAgent.indexOf("Android") > -1) {
						panelHeight = options.outerHeight();
						panelMTop = "-" + (panelHeight / 2 -30) + "px";
					}
					else if (winWidth < 768 && winWidth >= 480){
						panelMTop = "-15%";	
					}
					else{
						panelMTop = "-50%";		
					}	
				}
				
                var styles = {
                    // marginLeft : panelMLeft,
					
                    marginTop: panelMTop
                };

                // if (winWidth > 960) {
                    // options.width(960).css('marginLeft', '-480px');
                // }
                options.css(styles).animate({
                    opacity: 1
                }, 400, function() {
                    // Animation complete.
                });
				
				//ifresize();
				$(window).resize(function(){
				  ifresize();
				});
				function ifresize() {
					var panelHeight = options.outerHeight(),
					winWidth = $(window).width(),
					headerHeight = $('header').outerHeight(),
					 
					panelMTop = "-" + (panelHeight / 2 -30) + "px";
					var styles = {
						// marginLeft : panelMLeft,
						marginTop: panelMTop
					};
					options.css(styles).animate({
						opacity: 1
						}, 400, function() {
							// Animation complete.
					});
				}
                
            });

            $(document).keyup(function(event) { //keypress event, fadeout on 'escape'
                if (event.keyCode == 27) {
                    options.fadeOut(400, function() {
                        $('html').css('overflow', 'auto');
						//$('html').css('position', '');
						//$('body').css('overflow', 'auto');
						//$('body').css("position", "");
                        $('body').find('#overlay').remove();											
						//options.find('ul').css('height','');
                    });
                }
            });
			
            obj.find('.close').click(function() {
                options.fadeOut(400, function() {
                    $('html').css('overflow', 'auto');
					//$('html').css('position', '');
					//$('body').css('overflow', 'auto');
					//$('body').css("position", "");
                    $('body').find('#overlay').remove();
					//options.find('ul').css('height','');
                });
            });
			
			
            options.find('li').click(function() { //onclick event, change field value with selected 'list' item and fadeout 'list'
                //alert("test");
				var li = $(this);
				//alert($(this).find('li').find('li').length);
				var i = 0;
				while(li.find('li').length != 0){
					li = li.find('li');
					i++;
				}
				if(i == 0){
					selected.html(li.html());
					if (_multiLine) {
						selected.css('padding-top', '0');
					}
				}
                options.fadeOut(400, function() {
					$('html').css('overflow', 'auto');
					//$('body').css('overflow', 'auto');
                    $('body').find('#overlay').remove();
					//$('html').css('position', '');
					//$('body').css('position', '');
					//options.find('ul').css('height','');
                });
            });
			

            // if( obj.find('.others_toggle').length > 0 ){
            // 	obj.find('.others_toggle').click(function(){
            // 		obj.find('.others').fadeIn(400);
            // 		obj.find('.others li').click(function() { //onclick event, change field value with selected 'list' item and fadeout 'list'
            // 			obj.find('.selected')
            // 				.html($(this).html());
            // 			obj.find('.others').fadeOut( "slow", function() {
            // 			    // Animation complete.
            // 			});
            // 		});
            // 		return false;
            // 	});
            // };
        });
    };

    $.fn.popup = function() {
        return this.each(function() {
            var obj = $(this),
				objTarget = $(this).attr('href');

            obj.click(function() { //onclick event, 'list' fadein
                // console.log();
                $('body').append("<div id='overlay'></div>");
                $('html').css('overflow', 'hidden');
                $('#overlay').css({
                    // 'opacity': 0,
                    'z-index': '900'
                });
                $(objTarget).stop(false, true).fadeIn();

            });

            $(document).keyup(function(event) { //keypress event, fadeout on 'escape'
                if (event.keyCode == 27) {
                    $(objTarget).fadeOut(400, function() {
                        $('html').css('overflow', 'auto');
                        $('body').find('#overlay').remove();
                    });
                }
            });

            $(objTarget).find('a').click(function() {
                $(objTarget).fadeOut(400, function() {
                    $('html').css('overflow', 'auto');
                    $('body').find('#overlay').remove();
                });
            });
        });
    };

    //	$.fn.numpad = function(){
    //		return this.each(function(){
    //			var obj = $(this),
    //				objTarget = $('
    //					<div id="numPad">
    //				    	<ul class="clearfix">
    //				    		<li data-number="8">8</li>
    //				    		<li data-number="7">7</li>
    //				    		<li data-number="3">3</li>
    //				    		<li data-number="9">9</li>
    //				    		<li data-number="2">2</li>
    //				    		<li data-number="0">0</li>
    //				    		<li data-number="4">4</li>
    //				    		<li data-number="6">6</li>
    //				    		<li data-number="5">5</li>
    //				    		<li data-number="close">關閉</li>
    //				    		<li data-number="1">1</li>
    //				    		<li class="backspace" data-number="backspace"></li>
    //				    	</ul>
    //				    </div>
    //				');
    //			
    //			obj.focus(function() { //onclick event, 'list' fadein
    //				obj.css({
    //					'border': '1px solid #b9160f'
    //				});

    //				$('body').scrollTo(obj.parent(),{duration:'slow', offsetTop : '0'});

    //				objTarget.appendTo( "body" ).show(0, function(){
    //					objTarget.find('li').mouseup(function(){
    //						var _value = $(this).attr('data-number');
    //						// console.log(_value);
    //						if(_value=='close'){
    //							objTarget.remove();
    //							obj.blur().css({
    //								'border': 'none'
    //							});
    //						}else if(_value=='backspace'){
    //							obj.val(obj.val().substring(0, obj.val().length - 1));
    //						}
    //						else{
    //							obj.val(obj.val() + _value);
    //						}
    //						
    //					});
    //				});
    //					
    //			});





    // obj.blur(function(){
    // 	$(document).mouseup(function (e){
    // 	    if (!objTarget.is(e.target)// if the target of the click isn't the container...
    // 	        && objTarget.has(e.target).length === 0) // ... nor a descendant of the container
    // 	    {
    // 	        objTarget.remove();
    // 	        obj.css({
    // 				'border': 'none'
    // 			});
    // 	    }
    // 	});
    // });

    //});
    //};

})(jQuery);
