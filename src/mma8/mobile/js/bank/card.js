/*! Hammer.JS - v1.0.6dev - 2013-11-05
 * http://eightmedia.github.com/hammer.js
 *
 * Copyright (c) 2013 Jorik Tangelder <j.tangelder@gmail.com>;
 * Licensed under the MIT license */

!function(a,b){"use strict";function c(){if(!d.READY){d.event.determineEventTypes();for(var a in d.gestures)d.gestures.hasOwnProperty(a)&&d.detection.register(d.gestures[a]);d.event.onTouch(d.DOCUMENT,d.EVENT_MOVE,d.detection.detect),d.event.onTouch(d.DOCUMENT,d.EVENT_END,d.detection.detect),d.READY=!0}}var d=function(a,b){return new d.Instance(a,b||{})};d.defaults={stop_browser_behavior:{userSelect:"none",touchAction:"none",touchCallout:"none",contentZooming:"none",userDrag:"none",tapHighlightColor:"rgba(0,0,0,0)"}},d.HAS_POINTEREVENTS=a.navigator.pointerEnabled||a.navigator.msPointerEnabled,d.HAS_TOUCHEVENTS="ontouchstart"in a,d.MOBILE_REGEX=/mobile|tablet|ip(ad|hone|od)|android|silk/i,d.NO_MOUSEEVENTS=d.HAS_TOUCHEVENTS&&a.navigator.userAgent.match(d.MOBILE_REGEX),d.EVENT_TYPES={},d.DIRECTION_DOWN="down",d.DIRECTION_LEFT="left",d.DIRECTION_UP="up",d.DIRECTION_RIGHT="right",d.POINTER_MOUSE="mouse",d.POINTER_TOUCH="touch",d.POINTER_PEN="pen",d.EVENT_START="start",d.EVENT_MOVE="move",d.EVENT_END="end",d.DOCUMENT=a.document,d.plugins=d.plugins||{},d.gestures=d.gestures||{},d.READY=!1,d.Instance=function(a,b){var e=this;return c(),this.element=a,this.enabled=!0,this.options=d.utils.extend(d.utils.extend({},d.defaults),b||{}),this.options.stop_browser_behavior&&d.utils.stopDefaultBrowserBehavior(this.element,this.options.stop_browser_behavior),d.event.onTouch(a,d.EVENT_START,function(a){e.enabled&&d.detection.startDetect(e,a)}),this},d.Instance.prototype={on:function(a,b){for(var c=a.split(" "),d=0;d<c.length;d++)this.element.addEventListener(c[d],b,!1);return this},off:function(a,b){for(var c=a.split(" "),d=0;d<c.length;d++)this.element.removeEventListener(c[d],b,!1);return this},trigger:function(a,b){b||(b={});var c=d.DOCUMENT.createEvent("Event");c.initEvent(a,!0,!0),c.gesture=b;var e=this.element;return d.utils.hasParent(b.target,e)&&(e=b.target),e.dispatchEvent(c),this},enable:function(a){return this.enabled=a,this}};var e=null,f=!1,g=!1;d.event={bindDom:function(a,b,c){for(var d=b.split(" "),e=0;e<d.length;e++)a.addEventListener(d[e],c,!1)},onTouch:function(a,b,c){var h=this;this.bindDom(a,d.EVENT_TYPES[b],function(i){var j=i.type.toLowerCase();if(!j.match(/mouse/)||!g){j.match(/touch/)||j.match(/pointerdown/)||j.match(/mouse/)&&1===i.which?f=!0:j.match(/mouse/)&&1!==i.which&&(f=!1),j.match(/touch|pointer/)&&(g=!0);var k=0;f&&(d.HAS_POINTEREVENTS&&b!=d.EVENT_END?k=d.PointerEvent.updatePointer(b,i):j.match(/touch/)?k=i.touches.length:g||(k=j.match(/up/)?0:1),k>0&&b==d.EVENT_END?b=d.EVENT_MOVE:k||(b=d.EVENT_END),(k||null===e)&&(e=i),c.call(d.detection,h.collectEventData(a,b,h.getTouchList(e,b),i)),d.HAS_POINTEREVENTS&&b==d.EVENT_END&&(k=d.PointerEvent.updatePointer(b,i))),k||(e=null,f=!1,g=!1,d.PointerEvent.reset())}})},determineEventTypes:function(){var a;a=d.HAS_POINTEREVENTS?d.PointerEvent.getEvents():d.NO_MOUSEEVENTS?["touchstart","touchmove","touchend touchcancel"]:["touchstart mousedown","touchmove mousemove","touchend touchcancel mouseup"],d.EVENT_TYPES[d.EVENT_START]=a[0],d.EVENT_TYPES[d.EVENT_MOVE]=a[1],d.EVENT_TYPES[d.EVENT_END]=a[2]},getTouchList:function(a){return d.HAS_POINTEREVENTS?d.PointerEvent.getTouchList():a.touches?a.touches:(a.indentifier=1,[a])},collectEventData:function(a,b,c,e){var f=d.POINTER_TOUCH;return(e.type.match(/mouse/)||d.PointerEvent.matchType(d.POINTER_MOUSE,e))&&(f=d.POINTER_MOUSE),{center:d.utils.getCenter(c),timeStamp:(new Date).getTime(),target:e.target,touches:c,eventType:b,pointerType:f,srcEvent:e,preventDefault:function(){this.srcEvent.preventManipulation&&this.srcEvent.preventManipulation(),this.srcEvent.preventDefault&&this.srcEvent.preventDefault()},stopPropagation:function(){this.srcEvent.stopPropagation()},stopDetect:function(){return d.detection.stopDetect()}}}},d.PointerEvent={pointers:{},getTouchList:function(){var a=this,b=[];return Object.keys(a.pointers).sort().forEach(function(c){b.push(a.pointers[c])}),b},updatePointer:function(a,b){return a==d.EVENT_END?this.pointers={}:(b.identifier=b.pointerId,this.pointers[b.pointerId]=b),Object.keys(this.pointers).length},matchType:function(a,b){if(!b.pointerType)return!1;var c={};return c[d.POINTER_MOUSE]=b.pointerType==b.MSPOINTER_TYPE_MOUSE||b.pointerType==d.POINTER_MOUSE,c[d.POINTER_TOUCH]=b.pointerType==b.MSPOINTER_TYPE_TOUCH||b.pointerType==d.POINTER_TOUCH,c[d.POINTER_PEN]=b.pointerType==b.MSPOINTER_TYPE_PEN||b.pointerType==d.POINTER_PEN,c[a]},getEvents:function(){return["pointerdown MSPointerDown","pointermove MSPointerMove","pointerup pointercancel MSPointerUp MSPointerCancel"]},reset:function(){this.pointers={}}},d.utils={extend:function(a,c,d){for(var e in c)a[e]!==b&&d||(a[e]=c[e]);return a},hasParent:function(a,b){for(;a;){if(a==b)return!0;a=a.parentNode}return!1},getCenter:function(a){for(var b,c=[],d=[],e=0,f=a.length;f>e;e++)b=a[e],c.push("undefined"!=typeof b.clientX?b.clientX:b.pageX),d.push("undefined"!=typeof b.clientY?b.clientY:b.pageY);return{pageX:(Math.min.apply(Math,c)+Math.max.apply(Math,c))/2,pageY:(Math.min.apply(Math,d)+Math.max.apply(Math,d))/2}},getVelocity:function(a,b,c){return{x:Math.abs(b/a)||0,y:Math.abs(c/a)||0}},getAngle:function(a,b){var c=b.pageY-a.pageY,d=b.pageX-a.pageX;return 180*Math.atan2(c,d)/Math.PI},getDirection:function(a,b){var c=Math.abs(a.pageX-b.pageX),e=Math.abs(a.pageY-b.pageY);return c>=e?a.pageX-b.pageX>0?d.DIRECTION_LEFT:d.DIRECTION_RIGHT:a.pageY-b.pageY>0?d.DIRECTION_UP:d.DIRECTION_DOWN},getDistance:function(a,b){var c=b.pageX-a.pageX,d=b.pageY-a.pageY;return Math.sqrt(c*c+d*d)},getScale:function(a,b){return a.length>=2&&b.length>=2?this.getDistance(b[0],b[1])/this.getDistance(a[0],a[1]):1},getRotation:function(a,b){return a.length>=2&&b.length>=2?this.getAngle(b[1],b[0])-this.getAngle(a[1],a[0]):0},isVertical:function(a){return a==d.DIRECTION_UP||a==d.DIRECTION_DOWN},stopDefaultBrowserBehavior:function(a,b){var c,d=["webkit","khtml","moz","Moz","ms","o",""];if(b&&a.style){for(var e=0;e<d.length;e++)for(var f in b)b.hasOwnProperty(f)&&(c=f,d[e]&&(c=d[e]+c.substring(0,1).toUpperCase()+c.substring(1)),a.style[c]=b[f]);"none"==b.userSelect&&(a.onselectstart=function(){return!1}),"none"==b.userDrag&&(a.ondragstart=function(){return!1})}}},d.detection={gestures:[],current:null,previous:null,stopped:!1,startDetect:function(a,b){this.current||(this.stopped=!1,this.current={inst:a,startEvent:d.utils.extend({},b),lastEvent:!1,name:""},this.detect(b))},detect:function(a){if(this.current&&!this.stopped){a=this.extendEventData(a);for(var b=this.current.inst.options,c=0,e=this.gestures.length;e>c;c++){var f=this.gestures[c];if(!this.stopped&&b[f.name]!==!1&&f.handler.call(f,a,this.current.inst)===!1){this.stopDetect();break}}return this.current&&(this.current.lastEvent=a),a.eventType==d.EVENT_END&&!a.touches.length-1&&this.stopDetect(),a}},stopDetect:function(){this.previous=d.utils.extend({},this.current),this.current=null,this.stopped=!0},extendEventData:function(a){var b=this.current.startEvent;if(b&&(a.touches.length!=b.touches.length||a.touches===b.touches)){b.touches=[];for(var c=0,e=a.touches.length;e>c;c++)b.touches.push(d.utils.extend({},a.touches[c]))}var f,g,h=a.timeStamp-b.timeStamp,i=a.center.pageX-b.center.pageX,j=a.center.pageY-b.center.pageY,k=d.utils.getVelocity(h,i,j);return"end"===a.eventType?(f=this.current.lastEvent&&this.current.lastEvent.interimAngle,g=this.current.lastEvent&&this.current.lastEvent.interimDirection):(f=this.current.lastEvent&&d.utils.getAngle(this.current.lastEvent.center,a.center),g=this.current.lastEvent&&d.utils.getDirection(this.current.lastEvent.center,a.center)),d.utils.extend(a,{deltaTime:h,deltaX:i,deltaY:j,velocityX:k.x,velocityY:k.y,distance:d.utils.getDistance(b.center,a.center),angle:d.utils.getAngle(b.center,a.center),interimAngle:f,direction:d.utils.getDirection(b.center,a.center),interimDirection:g,scale:d.utils.getScale(b.touches,a.touches),rotation:d.utils.getRotation(b.touches,a.touches),startEvent:b}),a},register:function(a){var c=a.defaults||{};return c[a.name]===b&&(c[a.name]=!0),d.utils.extend(d.defaults,c,!0),a.index=a.index||1e3,this.gestures.push(a),this.gestures.sort(function(a,b){return a.index<b.index?-1:a.index>b.index?1:0}),this.gestures}},d.gestures.Drag={name:"drag",index:50,defaults:{drag_min_distance:10,correct_for_drag_min_distance:!0,drag_max_touches:1,drag_block_horizontal:!1,drag_block_vertical:!1,drag_lock_to_axis:!1,drag_lock_min_distance:25},triggered:!1,handler:function(a,b){if(d.detection.current.name!=this.name&&this.triggered)return b.trigger(this.name+"end",a),this.triggered=!1,void 0;if(!(b.options.drag_max_touches>0&&a.touches.length>b.options.drag_max_touches))switch(a.eventType){case d.EVENT_START:this.triggered=!1;break;case d.EVENT_MOVE:if(a.distance<b.options.drag_min_distance&&d.detection.current.name!=this.name)return;if(d.detection.current.name!=this.name&&(d.detection.current.name=this.name,b.options.correct_for_drag_min_distance&&a.distance>0)){var c=Math.abs(b.options.drag_min_distance/a.distance);d.detection.current.startEvent.center.pageX+=a.deltaX*c,d.detection.current.startEvent.center.pageY+=a.deltaY*c,a=d.detection.extendEventData(a)}(d.detection.current.lastEvent.drag_locked_to_axis||b.options.drag_lock_to_axis&&b.options.drag_lock_min_distance<=a.distance)&&(a.drag_locked_to_axis=!0);var e=d.detection.current.lastEvent.direction;a.drag_locked_to_axis&&e!==a.direction&&(a.direction=d.utils.isVertical(e)?a.deltaY<0?d.DIRECTION_UP:d.DIRECTION_DOWN:a.deltaX<0?d.DIRECTION_LEFT:d.DIRECTION_RIGHT),this.triggered||(b.trigger(this.name+"start",a),this.triggered=!0),b.trigger(this.name,a),b.trigger(this.name+a.direction,a),(b.options.drag_block_vertical&&d.utils.isVertical(a.direction)||b.options.drag_block_horizontal&&!d.utils.isVertical(a.direction))&&a.preventDefault();break;case d.EVENT_END:this.triggered&&b.trigger(this.name+"end",a),this.triggered=!1}}},d.gestures.Hold={name:"hold",index:10,defaults:{hold_timeout:500,hold_threshold:1},timer:null,handler:function(a,b){switch(a.eventType){case d.EVENT_START:clearTimeout(this.timer),d.detection.current.name=this.name,this.timer=setTimeout(function(){"hold"==d.detection.current.name&&b.trigger("hold",a)},b.options.hold_timeout);break;case d.EVENT_MOVE:a.distance>b.options.hold_threshold&&clearTimeout(this.timer);break;case d.EVENT_END:clearTimeout(this.timer)}}},d.gestures.Release={name:"release",index:1/0,handler:function(a,b){a.eventType==d.EVENT_END&&b.trigger(this.name,a)}},d.gestures.Swipe={name:"swipe",index:40,defaults:{swipe_min_touches:1,swipe_max_touches:1,swipe_velocity:.7},handler:function(a,b){if(a.eventType==d.EVENT_END){if(b.options.swipe_max_touches>0&&a.touches.length<b.options.swipe_min_touches&&a.touches.length>b.options.swipe_max_touches)return;(a.velocityX>b.options.swipe_velocity||a.velocityY>b.options.swipe_velocity)&&(b.trigger(this.name,a),b.trigger(this.name+a.direction,a))}}},d.gestures.Tap={name:"tap",index:100,defaults:{tap_max_touchtime:250,tap_max_distance:10,tap_always:!0,doubletap_distance:20,doubletap_interval:300},handler:function(a,b){if(a.eventType==d.EVENT_END&&"touchcancel"!=a.srcEvent.type){var c=d.detection.previous,e=!1;if(a.deltaTime>b.options.tap_max_touchtime||a.distance>b.options.tap_max_distance)return;c&&"tap"==c.name&&a.timeStamp-c.lastEvent.timeStamp<b.options.doubletap_interval&&a.distance<b.options.doubletap_distance&&(b.trigger("doubletap",a),e=!0),(!e||b.options.tap_always)&&(d.detection.current.name="tap",b.trigger(d.detection.current.name,a))}}},d.gestures.Touch={name:"touch",index:-1/0,defaults:{prevent_default:!1,prevent_mouseevents:!1},handler:function(a,b){return b.options.prevent_mouseevents&&a.pointerType==d.POINTER_MOUSE?(a.stopDetect(),void 0):(b.options.prevent_default&&a.preventDefault(),a.eventType==d.EVENT_START&&b.trigger(this.name,a),void 0)}},d.gestures.Transform={name:"transform",index:45,defaults:{transform_min_scale:.01,transform_min_rotation:1,transform_always_block:!1},triggered:!1,handler:function(a,b){if(d.detection.current.name!=this.name&&this.triggered)return b.trigger(this.name+"end",a),this.triggered=!1,void 0;if(!(a.touches.length<2))switch(b.options.transform_always_block&&a.preventDefault(),a.eventType){case d.EVENT_START:this.triggered=!1;break;case d.EVENT_MOVE:var c=Math.abs(1-a.scale),e=Math.abs(a.rotation);if(c<b.options.transform_min_scale&&e<b.options.transform_min_rotation)return;d.detection.current.name=this.name,this.triggered||(b.trigger(this.name+"start",a),this.triggered=!0),b.trigger(this.name,a),e>b.options.transform_min_rotation&&b.trigger("rotate",a),c>b.options.transform_min_scale&&(b.trigger("pinch",a),b.trigger("pinch"+(a.scale<1?"in":"out"),a));break;case d.EVENT_END:this.triggered&&b.trigger(this.name+"end",a),this.triggered=!1}}},"function"==typeof define&&"object"==typeof define.amd&&define.amd?define(function(){return d}):"object"==typeof module&&"object"==typeof module.exports?module.exports=d:a.Hammer=d}(this);
//# sourceMappingURL=hammer.min.map

/*  ContentFlow, version 1.0.2 
 *  (c) 2007 - 2010 Sebastian Kutsch
 *  <http://www.jacksasylum.eu/ContentFlow/>
 *  ContentFlow is distributed under the terms of the MIT license.
 *  revised by Dunn 2014.02.24
 *--------------------------------------------------------------------------*/
var ContentFlowGlobal={Flows:new Array,AddOns:{},scriptName:"card.js",scriptElement:null,Browser:new function(){this.Opera=window.opera?true:false;this.IE=document.all&&!this.Opera?true:false;this.IE6=this.IE&&typeof window.XMLHttpRequest=="undefined"?true:false;this.IE8=this.IE&&typeof document.querySelectorAll!="undefined"?true:false;this.IE7=this.IE&&!this.IE6&&!this.IE8?true:false;this.WebKit=/WebKit/i.test(navigator.userAgent)?true:false,this.iPhone=/iPhone|iPad|Android|iPod|windows phone/i.test(navigator.userAgent)?true:false;this.Chrome=/Chrome/i.test(navigator.userAgent)?true:false;this.Safari=/Safari/i.test(navigator.userAgent)&&!this.Chrome?true:false;this.Konqueror=navigator.vendor=="KDE"?true:false;this.Konqueror4=this.Konqueror&&/native code/.test(document.getElementsByClassName)?true:false;this.Gecko=!this.WebKit&&navigator.product=="Gecko"?true:false;this.Gecko19=this.Gecko&&Array.reduce?true:false},getAddOnConf:function(e){if(this.AddOns[e])return this.AddOns[e].conf;else return{}},setAddOnConf:function(e,t){this.AddOns[e].setConfig(t)},getScriptElement:function(e){var t=new RegExp(e);var n=document.getElementsByTagName("script");for(var r=0;r<n.length;r++){if(n[r].src&&t.test(n[r].src))return n[r]}return""},getScriptPath:function(e,t){var n=new RegExp(t+".*");return e.src.replace(n,"")},addScript:function(e){if(this.Browser.IE||this.Browser.WebKit||this.Browser.Konqueror){document.write('<script type="text/javascript" src="'+e+'"></script>')}else{var t=document.createElement("script");t.src=e;t.setAttribute("type","text/javascript");document.getElementsByTagName("head")[0].appendChild(t)}},addScripts:function(e,t){for(var n=0;n<filename.length;n++)this.addScript(basepath+t[n])},addStylesheet:function(e){if(this.Browser.Gecko19){var t=document.createElement("link");t.setAttribute("rel","stylesheet");t.setAttribute("href",e);t.setAttribute("type","text/css");t.setAttribute("media","screen");document.getElementsByTagName("head")[0].appendChild(t)}},addStylesheets:function(e,t){for(var n=0;n<filename.length;n++)this.addStylesheet(basepath+t[n])},initPath:function(){this.scriptElement=this.getScriptElement(this.scriptName);this.BaseDir=this.getScriptPath(this.scriptElement,this.scriptName);if(!this.AddOnBaseDir)this.AddOnBaseDir=this.BaseDir;if(!this.CSSBaseDir)this.CSSBaseDir=this.BaseDir},init:function(){this.loadAddOns=new Array;if(this.scriptElement.getAttribute("load")){var e=this.loadAddOns=this.scriptElement.getAttribute("load").replace(/\ +/g," ").split(" ");for(var t=0;t<e.length;t++){if(e[t]=="")continue;this.addScript(this.AddOnBaseDir+"ContentFlowAddOn_"+e[t]+".js")}}var n=this;if(document.addEventListener){if(this.Browser.WebKit){var r=setInterval(function(){if(/loaded|complete/.test(document.readyState)){clearInterval(r);n.onloadInit()}},10)}else{document.addEventListener("DOMContentLoaded",n.onloadInit,false)}}else if(this.Browser.IE){document.write("<script id=__ie_cf_onload defer src=javascript:void(0)></script>");var i=document.getElementById("__ie_cf_onload");i.onreadystatechange=function(){if(this.readyState=="complete"){n.onloadInit()}}}window.addEvent("load",n.onloadInit,false)},onloadInit:function(){if(arguments.callee.done)return;for(var e=0;e<ContentFlowGlobal.loadAddOns.length;e++){var t=ContentFlowGlobal.loadAddOns[e];if(!ContentFlowGlobal.AddOns[t]){var n=ContentFlowGlobal;window.setTimeout(n.onloadInit,10);return}}arguments.callee.done=true;if(window.Element&&Element.implement&&document.all&&!window.opera){for(var r in window.CFElement.prototype){if(!window.Element.prototype[r]){var i={};i[r]=window.CFElement.prototype[r];Element.implement(i)}}}for(var e=0;e<ContentFlowGlobal.Flows.length;e++){ContentFlowGlobal.Flows[e].init()}var s=document.getElementsByTagName("div");e:for(var e=0;e<s.length;e++){if(s[e].className.match(/\bContentFlow\b/)){for(var o=0;o<ContentFlowGlobal.Flows.length;o++){if(s[e]==ContentFlowGlobal.Flows[o].Container)continue e}var u=new ContentFlow(s[e],{},false);u.init()}}}};ContentFlowGlobal.initPath();var ContentFlowAddOn=function(e,t,n){if(typeof n=="undefined"||n!=false)ContentFlowGlobal.AddOns[e]=this;this.name=e;if(!t)t={};this.methods=t;this.conf={};if(this.methods.conf){this.setConfig(this.methods.conf);delete this.methods.conf}this.scriptpath=ContentFlowGlobal.AddOnBaseDir;if(t.init){var r=t.init.bind(this);r(this)}};ContentFlowAddOn.prototype={Browser:ContentFlowGlobal.Browser,addScript:ContentFlowGlobal.addScript,addScripts:ContentFlowGlobal.addScripts,addStylesheet:function(e){if(!e)e=this.scriptpath+"ContentFlowAddOn_"+this.name+".css";ContentFlowGlobal.addStylesheet(e)},addStylesheets:ContentFlowGlobal.addStylesheets,setConfig:function(e){for(var t in e){this.conf[t]=e[t]}},_init:function(e){if(this.methods.ContentFlowConf){e.setConfig(this.methods.ContentFlowConf)}}};var ContentFlowGUIElement=function(e,t){t.setDimensions=function(){this.dimensions=this.getDimensions();this.center={x:this.dimensions.width/2,y:this.dimensions.height/2};this.position=this.findPos()};t.addObserver=function(t,n){var r=this.eventMethod=n.bind(e);this.observedEvent=t;this.addEvent(t,r,false)};t.makeDraggable=function(e,t,n){this.stopDrag=function(t){if(!t)var t=window.event;if(this.Browser.iPhone||this.Browser.WebKit){window.removeEvent("touchemove",e,false)}else{window.removeEvent("mousemove",e,false)}n(t)}.bind(this);this.initDrag=function(e){if(!e)var e=window.event;var n=e;if(e.touches)n=e.touches[0];this.mouseX=n.clientX;this.mouseY=n.clientY;t(e)}.bind(this);this.startDrag=function(t){if(!t)var t=window.event;var n=this.stopDrag;if(this.Browser.iPhone||this.Browser.WebKit){var r=this;r.ontouchmove=false;window.addEvent("touchmove",function(t){r.ontouchmove=true;e(t)},false);window.addEvent("touchend",n,false)}else{window.addEvent("mousemove",e,false);window.addEvent("mouseup",n,false)}}.bind(this);var r=this.startDrag;if(this.Browser.iPhone||this.Browser.WebKit){this.addEventListener("touchstart",r,false)}else{this.addEvent("mousedown",r,false)}};t.Browser=ContentFlowGlobal.Browser;$CF(t).setDimensions();return t};var ContentFlowItem=function(e,t,n){this.CFobj=e;this._activeElement=e.conf.activeElement;this.pre=null;this.next=null;this.clickItem=function(e){if(!e)var e=window.event;var t=e.target?e.target:e.srcElement;var n=t.itemIndex?t.itemIndex:t.parentNode.itemIndex;var r=this.items[n];if(this._activeItem==r){this.conf.onclickActiveItem(r)}}.bind(e),this.setIndex=function(e){this.index=e;this.element.itemIndex=e};this.getIndex=function(){return this.index};if($CF(t).nodeName=="IMG"){var r=document.createElement("div");r.className="item";var i=t.parentNode.replaceChild(r,t);i.className="content";r.appendChild(i);if(t.title){var s=document.createElement("div");s.className="caption";s.innerHTML=t.title;r.appendChild(s)}t=r}this.element=$CF(t);this.item=t;if(typeof n!="undefined")this.setIndex(n);this.content=this.element.getChildrenByClassName("content")[0];this.caption=this.element.getChildrenByClassName("caption")[0];this.label=this.element.getChildrenByClassName("label")[0];if(this.content.nodeName=="IMG"){e._imagesToLoad++;var o=function(){e._imagesToLoad--;this.image=this.content;this.setImageFormat(this.image);if(e.conf.reflectionHeight>0){this.addReflection()}this.initClick();e._addItemCueProcess(true)}.bind(this);if(this.content.complete&&this.content.width>0){window.setTimeout(o,100)}else if(this.content.addEventListener){this.content.addEventListener("load",o,false)}else if(this.content.attachEvent){this.content.attachEvent("onload",o)}else{this.content.ready(function(){o()})}}};ContentFlowItem.prototype={Browser:ContentFlowGlobal.Browser,makeActive:function(){this.element.addClassName("active");this.CFobj.conf.onMakeActive(this)},makeInactive:function(){this.element.removeClassName("active");this.CFobj.conf.onMakeInactive(this)},initClick:function(){var e=this.clickItem;this[this._activeElement].addEvent("click",e,false)},setImageFormat:function(e){if(this.Browser.IE6||this.Browser.IE7)e.style.width="auto";e.origProportion=e.width/e.height;e.setAttribute("origProportion",e.width/e.height);if(this.Browser.IE6||this.Browser.IE7)e.style.width="";if(e.origProportion<=1)e.addClassName("portray");else e.addClassName("landscape")},addReflection:function(){var e=this.CFobj;var t;var n=this.content;if(this.Browser.IE){var r="progid:DXImageTransform.Microsoft.BasicImage(rotation=2, mirror=1)";if(e._reflectionColorRGB){if(e.conf.reflectionColor=="transparent"){var i=t=this.reflection=document.createElement("img");t.src=n.src}else{t=this.reflection=document.createElement("div");var i=document.createElement("img");i.src=n.src;t.width=i.width;t.height=i.height;i.style.width="100%";i.style.height="100%";var s=e._reflectionColorRGB;t.style.backgroundColor="#"+s.hR+s.hG+s.hB;t.appendChild(i)}r+=" progid:DXImageTransform.Microsoft.Alpha(opacity=0, finishOpacity=50, style=1, finishX=0, startY="+e.conf.reflectionHeight*100+" finishY=0)"}else{var i=t=this.reflection=document.createElement("img");t.src=n.src}r+=" progid:DXImageTransform.Microsoft.Matrix(M11=1, M12=0, M21=0, M22="+1/e.conf.reflectionHeight+")";t.filterString=r;i.style.filter=r}else{if(e._reflectionWithinImage)var o=this.canvas=$CF(document.createElement("canvas"));else var o=t=this.reflection=document.createElement("canvas");if(o.getContext){if(e._reflectionWithinImage){for(var u=0;u<n.attributes.length;u++){o.setAttributeNode(n.attributes[u].cloneNode(true))}}var a=o.getContext("2d");var f=e.maxHeight;var l=e._scaleImageSize(this,{width:f,height:f},f);var c=l.width;var h=l.height;if(e._reflectionWithinImage){o.width=c;o.height=h;this.setImageFormat(o);o.height=h*(1+e.conf.reflectionHeight+e.conf.reflectionGap)}else{o.width=c;o.height=h*e.conf.reflectionHeight}a.save();if(e._reflectionWithinImage){a.drawImage(n,0,0,c,h)}if(e._reflectionWithinImage){var p=h*(1+e.conf.reflectionGap/2)*2}else{var p=n.height}p-=1;a.translate(0,p);a.scale(1,-1);a.drawImage(n,0,0,c,h);a.restore();if(e._reflectionColorRGB){var d=a.createLinearGradient(0,0,0,o.height);var v=[0,.5,1];if(e._reflectionColor=="transparent"){a.globalCompositeOperation="destination-in";v=[1,.5,0]}var m=e._reflectionColorRGB.iR;var g=e._reflectionColorRGB.iG;var y=e._reflectionColorRGB.iB;if(e._reflectionWithinImage){d.addColorStop(0,"rgba("+m+","+g+","+y+","+v[0]+")");d.addColorStop(h/o.height,"rgba("+m+","+g+","+y+","+v[0]+")");d.addColorStop(h/o.height,"rgba("+m+","+g+","+y+","+v[1]+")")}else{d.addColorStop(0,"rgba("+m+","+g+","+y+","+v[1]+")")}d.addColorStop(1,"rgba("+m+","+g+","+y+","+v[2]+")");a.fillStyle=d;a.fillRect(0,0,o.width,o.height)}if(e._reflectionWithinImage){n.parentNode.replaceChild(o,n);this.content=o;this.origContent=o;delete this.image}}else{e._reflectionWithinImage=false;delete this.reflection}}if(t){t.className="reflection";this.element.appendChild(t);if(this.caption)this.element.appendChild(this.caption)}}};var ContentFlow=function(e,t){if(e){ContentFlowGlobal.Flows.push(this);this.Container=e;this._userConf=t?t:{};this.conf={};this._loadedAddOns=new Array}else{throw"ERROR: No flow container node or id given"}};ContentFlow.prototype={_imagesToLoad:0,_activeItem:0,_currentPosition:0,_targetPosition:0,_stepLock:false,_millisecondsPerStep:0,_reflectionWithinImage:true,Browser:ContentFlowGlobal.Browser,_defaultConf:{useAddOns:"all",biggestItemPos:0,loadingTimeout:3e4,activeElement:"content",maxItemHeight:0,scaleFactor:1,scaleFactorLandscape:1.33,scaleFactorPortrait:1,fixItemSize:false,relativeItemPosition:"top center",circularFlow:true,verticalFlow:false,visibleItems:-1,endOpacity:1,startItem:"center",scrollInFrom:"pre",flowSpeedFactor:1,flowDragFriction:1,scrollWheelSpeed:1,keys:{13:function(){this.conf.onclickActiveItem(this._activeItem)},37:function(){this.moveTo("pre")},38:function(){this.moveTo("visibleNext")},39:function(){this.moveTo("next")},40:function(){this.moveTo("visiblePre")}},reflectionColor:"transparent",reflectionHeight:.5,reflectionGap:0,onInit:function(){},onclickInactiveItem:function(e){},onclickActiveItem:function(e){var t,n;if(t=e.content.getAttribute("href")){n=e.content.getAttribute("target")}else if(t=e.element.getAttribute("href")){n=e.element.getAttribute("target")}else if(t=e.content.getAttribute("src")){n=e.content.getAttribute("target")}if(t){if(n)window.open(t,n).focus();else window.location.href=t}},onMakeInactive:function(e){},onMakeActive:function(e){},onReachTarget:function(e){},onMoveTo:function(e){},onDrawItem:function(e){},onclickPreButton:function(e){this.moveToIndex("pre");return Event.stop(e)},onclickNextButton:function(e){this.moveToIndex("next");return Event.stop(e)},calcStepWidth:function(e){var t=this.conf.visibleItems;var n=this.items.length;n=n==0?1:n;if(Math.abs(e)>t){if(e>0){var r=e-t}else{var r=e+t}}else if(t>=this.items.length){var r=e/n}else{var r=e*(t/n)}return r},calcSize:function(e){var t=e.relativePosition;var n=1/(Math.abs(t)+2);var r=n;return{width:r,height:n}},calcCoordinates:function(e){var t=e.relativePosition;var n=this.conf.visibleItems;var r=1-1/Math.exp(Math.abs(t)*.75);var i=e.side*n/(n+.05)*r;var s=-.5;return{x:i,y:s}},calcZIndex:function(e){return-Math.abs(e.relativePositionNormed)},calcFontSize:function(e){return e.size.height},calcOpacity:function(e){return Math.max(1-(1-this.conf.endOpacity)*Math.sqrt(Math.abs(e.relativePositionNormed)),this.conf.endOpacity)}},_checkIndex:function(e){e=Math.max(e,0);e=Math.min(e,this.itemsLastIndex);return e},_setLastIndex:function(){this.itemsLastIndex=this.items.length-1},_getItemByIndex:function(e){return this.items[this._checkIndex(e)]},_getItemByPosition:function(e){return this._getItemByIndex(this._getIndexByPosition(e))},_getPositionByIndex:function(e){if(!this.conf.circularFlow)return this._checkIndex(e);var t=this._getIndexByPosition(this._currentPosition);var n=e-t;if(Math.abs(n)>n+this.items.length)n+=this.items.length;else if(Math.abs(n)>Math.abs(n-this.items.length))n-=this.items.length;return this._currentPosition+n},_getIndexByPosition:function(e){if(e<0)var t=0;else var t=1;var n=(Math.round(e)+t)%this.items.length;if(n>0)n-=t;else if(n<0)n+=this.items.length-t;else if(e<0)n=0;else n=this.items.length-1;return n},_getIndexByKeyWord:function(e,t,n){if(t)var r=t;else if(this._activeItem)var r=this._activeItem.index;else var r=0;if(isNaN(e)){switch(e){case"first":case"start":r=0;break;case"last":case"end":r=this.itemsLastIndex;break;case"middle":case"center":r=Math.round(this.itemsLastIndex/2);break;case"right":case"next":r+=1;break;case"left":case"pre":case"previous":r-=1;break;case"visible":case"visiblePre":case"visibleLeft":r-=this.conf.visibleItems;break;case"visibleNext":case"visibleRight":r+=this.conf.visibleItems;break;default:r=r}}else{r=e}if(n!=false)r=this._checkIndex(r);return r},_setCaptionLabel:function(e){if(this.Position&&!this.Slider.locked)this.Position.setLabel(e);this._setGlobalCaption()},getAddOnConf:function(e){return ContentFlowGlobal.getAddOnConf(e)},setAddOnConf:function(e,t){ContentFlowGlobal.setAddOnConf(e,t)},init:function(){if(this.isInit)return;this._init()},setConfig:function(e){if(!e)return;var t=this._defaultConf;for(var n in e){if(t[n]=="undefined")continue;switch(n){case"scrollInFrom":case"startItem":if(typeof e[n]=="number"||typeof e[n]=="string"){this.conf[n]=e[n]}break;default:if(typeof (t[n]==e[n])){if(typeof e[n]=="function"){this.conf[n]=e[n].bind(this)}else{this.conf[n]=e[n]}}}}switch(this.conf.reflectionColor){case this.conf.reflectionColor.search(/#[0-9a-fA-F]{6}/)>=0?this.conf.reflectionColor:this.conf.reflectionColor+"x":this._reflectionColorRGB={hR:this.conf.reflectionColor.slice(1,3),hG:this.conf.reflectionColor.slice(3,5),hB:this.conf.reflectionColor.slice(5,7),iR:parseInt(this.conf.reflectionColor.slice(1,3),16),iG:parseInt(this.conf.reflectionColor.slice(3,5),16),iB:parseInt(this.conf.reflectionColor.slice(5,7),16)};break;case"none":case"transparent":default:this._reflectionColor="transparent";this._reflectionColorRGB={hR:0,hG:0,hB:0,iR:0,iG:0,iB:0};break}if(this.items){if(this.conf.visibleItems<0)this.conf.visibleItems=Math.round(Math.sqrt(this.items.length));this.conf.visibleItems=Math.min(this.conf.visibleItems,this.items.length-1)}if(this.conf.relativeItemPosition){var r={x:{left:function(e){return-1},center:function(e){return 0},right:function(e){return 1}},y:{top:function(e){return-1},center:function(e){return 0},bottom:function(e){return 1}}};var i=this.conf.relativeItemPosition;i=i.replace(/above/,"top").replace(/below/,"bottom");var s,o=null;s=i.match(/left|right/);o=i.match(/top|bottom/);c=i.match(/center/);if(!s){if(c)s="center";else s="center"}if(!o){if(c)o="center";else o="top"}var u=r.x[s];var a=r.y[o];this.conf.calcRelativeItemPosition=function(e){var t=u(e.size);var n=a(e.size);return{x:t,y:n}};this.conf.relativeItemPosition=null}if(this._reflectionType&&this._reflectionType!="clientside"){this.conf.reflectionHeight=0}},getItem:function(e){return this.items[this._checkIndex(Math.round(e))]},getActiveItem:function(){return this._activeItem},getNumberOfItems:function(){return this.items.length},resize:function(){this._initSizes();this._initStep()},moveToPosition:function(e,t){if(!this.conf.circularFlow)e=this._checkIndex(e);this._targetPosition=e;this.conf.onMoveTo(this._getItemByPosition(e));this._initStep(false,t)},moveToIndex:function(e){this._targetPosition=Math.round(this._getPositionByIndex(this._getIndexByKeyWord(e,this._activeItem.index,!this.conf.circularFlow)));this.conf.onMoveTo(this._getItemByPosition(this._targetPosition));this._initStep()},moveToItem:function(e){var t;if(e.itemIndex)t=e.itemIndex;else t=e.index;this.moveToIndex(t)},moveTo:function(e){if(typeof e=="object")this.moveToItem(e);else if(isNaN(e)||e==Math.floor(e)&&e<this.items.length)this.moveToIndex(e);else this.moveToPosition(e)},_addItemCue:[],_addItemCueProcess:function(e){var t=this._addItemCue;if(e==true)t.shift();if(t.length>0&&!t[0].p){t[0].p=true;var n=this;var r=t.length>5?1:40;window.setTimeout(function(){n._addItem(t[0].el,t[0].i)},r)}},addItem:function(e,t){this._addItemCue.push({el:e,i:t,p:false});if(this._addItemCue.length==1)this._addItemCueProcess()},_addItem:function(e,t){if(typeof t=="string"){switch(t){case"first":case"start":t=0;break;case"last":case"end":t=isNaN(this.itemsLastIndex)?0:this.itemsLastIndex;t+=1;break;default:t=this._getIndexByKeyWord(t)}}t=Math.max(t,0);t=Math.min(t,this.itemsLastIndex+1);t=isNaN(t)?0:t;this.Flow.appendChild(e);var n=new ContentFlowItem(this,e,t);if(this.items.length==0){this.resize();if(this.conf.circularFlow){n.pre=n;n.next=n}}else{if(t==this.itemsLastIndex+1){n.pre=this.items[this.itemsLastIndex];n.next=n.pre.next}else{n.next=this.items[t];n.pre=n.next.pre}if(n.pre)n.pre.next=n;if(n.next)n.next.pre=n}this.items.splice(t,0,n);for(var r=t;r<this.items.length;r++){this.items[r].setIndex(r)}this._setLastIndex();if(this.conf.origVisibleItems<0){this.conf.visibleItems=Math.round(Math.sqrt(this.items.length))}this.conf.visibleItems=Math.min(this.conf.visibleItems,this.items.length-1);if(Math.round(this._getPositionByIndex(t))<=Math.round(this._targetPosition)){this._targetPosition++;if(!this.conf.circularFlow)this._targetPosition=Math.min(this._targetPosition,this.itemsLastIndex)}if(this._getPositionByIndex(t)<=this._currentPosition){this._currentPosition++;if(!this.conf.circularFlow)this._currentPosition=Math.min(this._currentPosition,this.itemsLastIndex)}var i=this;window.setTimeout(function(){if(i.items.length==1){i._currentPosition=-.01;i._targetPosition=0;i.resize()}else{i._initStep()}},100);return t},rmItem:function(e){if(e=="undefined")e=this._activeItem.index;e=this._getIndexByKeyWord(e);if(!this.items[e])return null;var t=this.items[e];if(t.pre)t.pre.next=t.next;if(t.next)t.next.pre=t.pre;this.items.splice(e,1);for(var n=e;n<this.items.length;n++){this.items[n].setIndex(n)}this._setLastIndex();if(Math.round(this._getPositionByIndex(e))<Math.round(this._targetPosition)){this._targetPosition--;if(!this.conf.circularFlow)this._targetPosition=this._checkIndex(this._targetPosition)}if(this._getPositionByIndex(e)<this._currentPosition){this._currentPosition--;if(!this.conf.circularFlow)this._currentPosition=this._checkIndex(this._currentPosition)}this._activeItem=this._getItemByPosition(this._currentPosition);var r=t.element.parentNode.removeChild(t.element);var i=this;window.setTimeout(function(){i._initStep()},10);return r},_init:function(){if(typeof this.Container=="string"){var e=document.getElementById(this.Container);if(e){this.Container=e}else{throw"ContentFlow ERROR: No element with id '"+this.Container+"' found!";return}}$CF(this.Container).addClassName("ContentFlow");var t=$CF(this.Container).getChildrenByClassName("flow")[0];if(!t){throw"ContentFlow ERROR: No element with class'flow' found!";return}this.Flow=new ContentFlowGUIElement(this,t);var n=this.Container.getChildrenByClassName("scrollbar")[0];if(n){this.Scrollbar=new ContentFlowGUIElement(this,n);var r=this.Scrollbar.getChildrenByClassName("slider")[0];if(r){this.Slider=new ContentFlowGUIElement(this,r);var i=this.Slider.getChildrenByClassName("position")[0];if(i){this.Position=new ContentFlowGUIElement(this,i)}}}this.setConfig(this._defaultConf);this._initAddOns();this.setConfig(this._userConf);this._initSizes();var s=this.Flow.getChildrenByClassName("item");this.items=new Array;for(var o=0;o<s.length;o++){var u=this.items[o]=new ContentFlowItem(this,s[o],o);if(o>0){u.pre=this.items[o-1];u.pre.next=u}}this._setLastIndex();if(this.conf.circularFlow&&this.items.length>0){var a=this.items[0];a.pre=this.items[this.items.length-1];a.pre.next=a}this._initGUI();if(this._activeElement!="content")this._activeElement="element";this.conf.origVisibleItems=this.conf.visibleItems;if(this.conf.visibleItems<0){this.conf.visibleItems=Math.round(Math.sqrt(this.items.length))}this.conf.visibleItems=Math.min(this.conf.visibleItems,this.items.length-1);this._targetPosition=this._getIndexByKeyWord(this.conf.startItem,0);var f=this._getIndexByKeyWord(this.conf.scrollInFrom,this._targetPosition);switch(this.conf.scrollInFrom){case"next":case"right":f-=.5;break;case"pre":case"previous":case"left":f+=.5;break}this._currentPosition=f;var l=new Date;var c=this;var h=window.setInterval(function(){if(c._imagesToLoad==0||new Date-l>c._loadingTimeout){clearInterval(h);c._activeItem=c.getItem(c._currentPosition);if(c._activeItem){c._activeItem.makeActive();c._setCaptionLabel(c._activeItem.index)}c.Flow.style.visibility="visible";if(c.loadIndicator)c.loadIndicator.style.display="none";if(c.Scrollbar)c.Scrollbar.style.visibility="visible";c.resize();for(var e=0;e<c._loadedAddOns.length;e++){var t=ContentFlowGlobal.AddOns[c._loadedAddOns[e]];if(t.methods.afterContentFlowInit)t.methods.afterContentFlowInit(c)}c.conf.onInit()}},10);this.isInit=true},_initAddOns:function(){var e=[];if(this._userConf.useAddOns){if(typeof this._userConf.useAddOns=="string"){e=this._userConf.useAddOns.split(" ")}else if(typeof this._userConf.useAddOns=="array"){e=this._userConf.useAddOns}}else if(this.Container.getAttribute("useAddOns")){e=this.Container.getAttribute("useAddOns").split(" ")}else{e=this.conf.useAddOns.split(" ")}for(var t=0;t<e.length;t++){if(e[t]=="none"){e=new Array;break}else if(e[t]=="all"){e=new Array;for(var n in ContentFlowGlobal.AddOns)e.push(n);break}}for(var t=0;t<e.length;t++){var n=ContentFlowGlobal.AddOns[e[t]];if(n){this._loadedAddOns.push(e[t]);n._init(this);this.Container.addClassName("ContentFlowAddOn_"+n.name);if(n.methods.onloadInit)n.methods.onloadInit(this)}}},_initGUI:function(){var e=this.resize.bind(this);window.addEvent("resize",e,false);var t=this.Container.getElementsByTagName("div");for(var n=0;n<t.length;n++){if($CF(t[n]).hasClassName("preButton")){var r=t[n];var i=this.conf.onclickPreButton;r.addEvent("click",i,false)}else if(t[n].hasClassName("nextButton")){var s=t[n];var i=this.conf.onclickNextButton;s.addEvent("click",i,false)}}if(this.conf.scrollWheelSpeed!=0){var o=this._wheel.bind(this);if(window.addEventListener)this.Container.addEventListener("DOMMouseScroll",o,false);this.Container.onmousewheel=o}var u=this._keyStroke.bind(this);if(this.conf.keys&&!this.Browser.iPhone){if(document.addEventListener){if(!this.Browser.Opera){var a=document.createElement("div");a.addClassName("mouseoverCheckElement");this.Container.appendChild(a);if(this.Browser.WebKit){document.body.addEvent("keydown",function(e){if(a.offsetLeft>0)u(e)})}else{window.addEvent("keydown",function(e){if(a.offsetLeft>0)u(e)})}}else{this.Container.addEvent("keydown",u)}}else{this.Container.onkeydown=u}}if(this.conf.flowDragFriction>0){var f=new Hammer(document.getElementById("contentFlow"));f.on("dragleft dragright swipeleft swiperight",function(e){e.gesture.preventDefault()});var l=function(e){var t=e;if(e.touches)t=e.touches[0];var n=t.clientX;var r=t.clientY;if(this.conf.verticalFlow){var i=r-this.Flow.mouseY;var s=this.Flow.dimensions.height}else{var i=n-this.Flow.mouseX;var s=this.Flow.dimensions.width}var o=i/s;var u=this._currentPosition-o*this.conf.visibleItems/this.conf.flowDragFriction;if(this.conf.verticalFlow){this.Flow.mouseY=r}else{this.Flow.mouseX=n}this.moveToPosition(u,true)}.bind(this);var c=function(){};var h=function(e){var t=Math.round(this._targetPosition);if(Math.abs(t-this._currentPosition)>0)this.moveToPosition(t)}.bind(this);this.Flow.makeDraggable(l,c,h)}if(this.Scrollbar){var p=function(e){if(!e)var e=window.event;if(!this.Scrollbar.clickLocked){var t=e.clientX;var n=t-this.Scrollbar.position.left;var r=Math.round(n/this.Scrollbar.dimensions.width*this.itemsLastIndex);this.moveToIndex(r)}else this.Scrollbar.clickLocked=false}.bind(this);this.Scrollbar.addObserver("click",p)}if(this.Slider){if(this.Browser.IE6){var d=document.createElement("div");d.className="virtualSlider";this.Slider.appendChild(d)}this.Slider.setPosition=function(e){e=e-Math.floor(e)+this._getIndexByPosition(Math.floor(e));if(Math.round(e)<0)e=this.itemsLastIndex;else if(e<=0)e=0;else if(Math.round(e)>this.itemsLastIndex)e=0;else if(e>=this.itemsLastIndex)e=this.itemsLastIndex;if(this.items.length>1){var t=e/this.itemsLastIndex*this.Scrollbar.dimensions.width}else{var t=.5*this.Scrollbar.dimensions.width}this.Slider.style.left=t-this.Slider.center.x+"px";this.Slider.style.top=this.Scrollbar.center.y-this.Slider.center.y+"px"}.bind(this);var c=function(e){this.Scrollbar.clickLocked=true}.bind(this);var l=function(e){var t=e;if(e.touches)t=e.touches[0];var n=this._checkIndex((t.clientX-this.Scrollbar.position.left)/this.Scrollbar.dimensions.width*this.itemsLastIndex);this._targetPosition=this._getPositionByIndex(n);this.Slider.setPosition(n);if(this.Position)this.Position.setLabel(n);this._initStep(true,true)}.bind(this);var h=function(e){this._targetPosition=Math.round(this._targetPosition);this.conf.onMoveTo(this._getItemByPosition(this._targetPosition));this._initStep(true)}.bind(this);this.Slider.makeDraggable(l,c,h)}if(this.Position){this.Position.setLabel=function(e){e=this._checkIndex(Math.round(e));if(this.items&&this.items[e].label)this.Position.innerHTML=this.items[e].label.innerHTML;else this.Position.innerHTML=e+1}.bind(this)}this.globalCaption=this.Container.getChildrenByClassName("globalCaption")[0];this.loadIndicator=this.Container.getChildrenByClassName("loadIndicator")[0]},_initSizes:function(e){this._initMaxHeight();var t=this._initScrollbarSize();if(!this.conf.verticalFlow&&this.Container.style.height&&this.Container.style.height!="auto")this.maxHeight-=t;if(!this._activeItem)return;var n=this._findBiggestItem();var r=this.Flow.findPos();if(this.conf.verticalFlow){this.Flow.style.width=n.width.width+"px";this.Flow.style.height=3*n.width.width*(1+this.conf.reflectionHeight+this.conf.reflectionGap)+"px"}else{this.Flow.style.height=n.height.height+(n.height.top-r.top)+"px"}var i=this.conf.verticalFlow?n.width.width:n.height.height;var s=i/(1+this.conf.reflectionHeight+this.conf.reflectionGap);this.Flow.style.marginBottom=-(i-s)+"px";this.Flow.dimensions=this.Flow.getDimensions();if(!this.Browser.IE6){if(this.conf.verticalFlow&&this.Container.clientWidth<this.Flow.dimensions.width){}else if(this.Container.clientHeight<this.Flow.dimensions.height){this.Container.style.height=this.Flow.dimensions.height+"px"}}if(this.conf.verticalFlow){this.Flow.center={x:this.Flow.dimensions.height/2,y:n.width.width/2}}else{this.Flow.center={x:this.Flow.dimensions.width/2,y:n.height.height/2}}},_initScrollbarSize:function(){var e;var t;var n;if(e=this.Scrollbar){e.setDimensions();var r=e.dimensions.height;if(t=this.Slider){t.setDimensions();r+=t.dimensions.height;if(n=this.Position){var i=n.innerHTML;var s=maxW=0;n.style.width="auto";if(this.items){for(var o=0;o<this.items.length;o++){var u=this.items[o];if(u.label){n.innerHTML=u.label.innerHTML}else{n.innerHTML=u.index}var a=n.clientHeight;var f=n.clientWidth;if(a>s)s=a;if(f>maxW)maxW=f}}else{n.innerHTML="&nbsp;";s=n.clientHeight;maxW=n.clientWidth}n.innerHTML=i;n.setDimensions();n.style.width=maxW+"px";n.style.left=(t.dimensions.width-maxW)/2+"px";var l=n.position.top-t.position.top;if(l>0){l+=-e.dimensions.height+s;e.style.marginBottom=l+"px"}else{l*=-1;e.style.marginTop=l+"px"}r+=l}}}else{r=0}return r},_initMaxHeight:function(){if(this.conf.verticalFlow){var e=screen.width/screen.height;var t=this.Container.style.width;var n=this.Container.clientWidth;var r=this.Flow.style.width;var i=this.Flow.clientWidth;var s=this.Flow.clientHeight}else{var e=screen.height/screen.width;var t=this.Container.style.height;var n=this.Container.clientHeight;var r=this.Flow.style.height;var i=this.Flow.clientHeight;var s=this.Flow.clientWidth}if(this.ContainerOldDim)t=this.ContainerOldDim;if(this.FlowOldDim)r=this.FlowOldDim;this.ContainerOldDim="auto";this.FlowOldDim="auto";if(this.conf.maxItemHeight<=0){this.maxHeight=s/3*e/1*this.conf.scaleFactor;if(this.conf.verticalFlow&&(this.maxHeight==0||this.maxHeight>i)){this.maxHeight=i}if(t&&t!="auto"){var o=this.conf.verticalFlow?0:this.conf.reflectionGap;var u=this.conf.verticalFlow?0:this.conf.reflectionHeight;this.maxHeight=n/(this.conf.scaleFactor*(1+u+o));this.ContainerOldDim=t}else if(r&&r!="auto"){var o=this.conf.verticalFlow?0:this.conf.reflectionGap;this.maxHeight=i/(this.conf.scaleFactor*(1+this.conf.reflectionHeight+o));this.FlowOldDim=r}}else{this.maxHeight=this.conf.maxItemHeight}},_findBiggestItem:function(){var e=this._activeItem;var t=e.pre;var n=e.next;var r=maxFlowSize={width:{width:0,left:0,height:0,top:0,item:null,rI:0},height:{width:0,left:0,height:0,top:0,item:null,rI:0}};var i=function(e,t){var n=e.element;n.style.display="block";var i=n.findPos();var s=n.clientHeight;var o=n.clientWidth;if(s+i.top>=r.height.height+r.height.top){r.height.height=s;r.height.top=i.top;r.height.item=e;r.height.rI=t}if(o+i.left>=r.width.width+r.width.left){r.width.width=o;r.width.left=i.left;r.width.item=e;r.width.rI=t}n.style.display="none"};var s=this._currentPosition;this._currentPosition=this.conf.visibleItems+1;for(var o=-this.conf.visibleItems;o<=this.conf.visibleItems;o++){e.element.style.display="none";this._positionItem(e,o);i(e,o)}var u=r.height.rI;for(var o=0;o<this.items.length;o++){var a=this.items[o];a.element.style.display="none";this._positionItem(a,u);i(a,u)}this._currentPosition=s;return r},_keyStroke:function(e){if(!e)var e=window.event;if(e.which){var t=e.which}else if(e.keyCode){var t=e.keyCode}if(this.conf.keys[t]){this.conf.keys[t].bind(this)();return Event.stop(e)}else{return true}},_wheel:function(e){if(!e)var e=window.event;var t=0;if(e.wheelDelta){t=e.wheelDelta/120}else if(e.detail){t=-e.detail/3}if(t){var n=this._targetPosition;if(t<0){n+=1*this.conf.scrollWheelSpeed}else{n-=1*this.conf.scrollWheelSpeed}this.moveToPosition(Math.round(n))}return Event.stop(e)},_setGlobalCaption:function(){if(this.globalCaption){this.globalCaption.innerHTML="";if(this._activeItem&&this._activeItem.caption)this.globalCaption.appendChild(this._activeItem.caption.cloneNode(true))}},_initStep:function(e,t){if(this.Slider){if(e){this.Slider.locked=true}else{this.Slider.locked=false}}this._holdPos=t==true?true:false;if(!this._stepLock){this._stepLock=true;this._step()}},_step:function(){var e=this._targetPosition-this._currentPosition;var t=Math.abs(e);if(t>0){if(t>.005){this._currentPosition+=this.conf.flowSpeedFactor*this.conf.calcStepWidth(e,t,this.items.length,this.conf.visibleItems)}var n=this.items[this._getIndexByPosition(this._currentPosition)];if(n&&n!=this._activeItem){if(this._activeItem)this._activeItem.makeInactive();this._activeItem=n;this._activeItem.makeActive();this._setCaptionLabel(this._activeItem.index);if(Math.abs(this._targetPosition-this._currentPosition)<=.1)this.conf.onReachTarget(this._activeItem)}this._positionItems();var r=this._step.bind(this);window.setTimeout(r,this._millisecondsPerStep)}else if(!this._holdPos){if(this.Slider)this.Slider.locked=false;this._currentPosition=Math.round(this._currentPosition);if(this.Position&&!this.Slider.locked&&this._activeItem){this._setCaptionLabel(this._activeItem.index)}this._positionItems();this._stepLock=false}else{this._stepLock=false}if(this.Slider&&!this.Slider.locked){this.Slider.setPosition(this._currentPosition)}},_positionItems:function(){if(this._lastStart){var e=this._lastStart;while(e){e.element.style.display="none";e=e.next;if(e==this._lastStart)break;if(e&&e.pre==this._lastEnd)break}}else{this._lastStart=this._activeItem}if(!this._activeItem)return;var t=this._activeItem;var n=t.pre;var r=t.next;this._positionItem(t,0);for(var i=1;i<=this.conf.visibleItems&&2*i<this.items.length;i++){if(n){this._positionItem(n,-i);this._lastStart=n;n=n.pre}if(r){this._positionItem(r,i);this._lastEnd=r;r=r.next}}},_positionItem:function(e,t){var n=this.conf;var r=n.verticalFlow;var i=e.element.style;var s=e.position=this._currentPosition+t;var o=e.relativePosition=Math.round(s)-this._currentPosition;var u=e.relativePositionNormed=n.visibleItems>0?o/n.visibleItems:0;var a=o<0?-1:1;a*=o==0?0:1;e.side=a;var f=n.calcSize(e);f.height=Math.max(f.height,0);f.width=Math.max(f.width,0);if(e.content.origProportion)f=this._scaleImageSize(e,f);e.size=f;var l=e.coordinates=n.calcCoordinates(e);var c=e.relativeItemPosition=n.calcRelativeItemPosition(e);var h=e.zIndex=n.calcZIndex(e);var p=e.fontSize=n.calcFontSize(e);var d=e.opacity=n.calcOpacity(e);f.height*=this.maxHeight;f.width*=this.maxHeight;var v=r?f.height:f.width;var m=r?f.width:f.height;var g=this.Flow.center.x*(1+l.x)+(c.x-1)*v/2;var y=this.maxHeight/2*(1+l.y)+(c.y-1)*m/2;i.left=(r?y:g)+"px";i.top=(r?g:y)+"px";this._setItemSize(e,f);if(n.endOpacity!=1){this._setItemOpacity(e)}if(!this.Browser.IE)i.fontSize=p*100+"%";i.zIndex=32768+Math.round(h*this.items.length);n.onDrawItem(e);i.visibility="visible";i.display="block"},_scaleImageSize:function(e,t,n){var r=this.conf.scaleFactorLandscape;var i=this.conf.scaleFactorPortrait;var s=this.conf.verticalFlow;var o=e.content.origProportion;var u=t.width;var a=t.height;var f=e.content;if(s){if(o<=1){if(r!="max"&&r!=1){a*=r;u=Math.min(a*o,n?n:1)}a=u/o}else if(o>1){if(i=="max"){a=n?n:1}else if(i!=1){u*=i;a=Math.min(u/o,n?n:1)}else{a=u/o}u=a*o}}else{if(o>1){if(r!="max"&&r!=1){u*=r;a=Math.min(u/o,n?n:1)}u=a*o}else if(o<=1){if(i=="max"){u=n?n:1}else if(i!=1){a*=i;u=Math.min(a*o,n?n:1)}else{u=a*o}a=u/o}}a=isNaN(a)?0:a;u=isNaN(u)?0:u;if(!n&&this.conf.fixItemSize){var l=t.width/t.height;var n=Math.max(t.width,t.height);var c=this._scaleImageSize(e,{width:n,height:n},n);if(l<1){a=c.height/t.height;u=a*o/l}else{u=c.width/t.width;a=u/o*l}var h=a*100;var p=u*100;var d=(1-u)/2*100;var v=(1-a)/l*100*(s?.5:1);f.style.height=h+"%";if(e.reflection)e.reflection.style.height=h*this.conf.reflectionHeight+"%";f.style.width=p+"%";if(e.reflection)e.reflection.style.width=p+"%";f.style.marginLeft=d+"%";if(e.reflection)e.reflection.style.marginLeft=d+"%";f.style.marginTop=v+"%";e.element.style.overflow="hidden";return t}else{return{width:u,height:a}}},_setItemSize:function(){if(ContentFlowGlobal.Browser.IE){var e=function(e,t){if(!this.conf.fixItemSize){e.content.style.height=t.height+"px"}else if(ContentFlowGlobal.Browser.IE6){var n=parseInt(e.content.style.height)/100;e.content.style.height=t.height*n+"px";var r=parseInt(e.content.style.marginTop)/100;e.content.style.marginTop=t.height*r+"px"}if(e.reflection){var n=parseInt(e.content.style.height);e.reflection.style.height=n*this.conf.reflectionHeight+"px";e.reflection.style.marginTop=n*this.conf.reflectionGap+"px"}e.element.style.width=t.width+"px";e.element.style.height=t.height*(1+this.conf.reflectionHeight+this.conf.reflectionGap)+"px"}}else{var e=function(e,t){if(e.reflection){e.element.style.height=t.height*(1+this.conf.reflectionHeight+this.conf.reflectionGap)+"px";e.reflection.style.marginTop=t.height*this.conf.reflectionGap+"px"}else if(this._reflectionWithinImage){e.element.style.height=t.height*(1+this.conf.reflectionHeight+this.conf.reflectionGap)+"px"}else{e.element.style.height=t.height+"px"}e.element.style.width=t.width+"px"}}return e}(),_setItemOpacity:function(){if(ContentFlowGlobal.Browser.IE6){var e=function(e){if(e.content.origSrc&&e.content.origSrc.match(/\.png$/)){var t=e.content.src;e.content.src=e.content.origSrc;e.content.style.filter=e.content.filterString+" progid:DXImageTransform.Microsoft.BasicImage(opacity="+e.opacity+")";e.content.src=t}else{e.content.style.filter="progid:DXImageTransform.Microsoft.BasicImage(opacity="+e.opacity+")"}if(e.reflection)e.reflection.style.filter=e.reflection.filterString+"progid:DXImageTransform.Microsoft.BasicImage(opacity="+e.opacity+")"}}else if(ContentFlowGlobal.Browser.IE){var e=function(e){e.element.style.filter="progid:DXImageTransform.Microsoft.BasicImage(opacity="+e.opacity+")"}}else{var e=function(e){e.element.style.opacity=e.opacity}}return e}()};if(!Function.bind){Function.prototype.bind=function(e){var t=this;return function(){return t.apply(e,arguments)}}}if(!Math.erf2){Math.erf2=function(e){var t=-(8*(Math.PI-3)/(3*Math.PI*(Math.PI-4)));var n=e*e;var r=1-Math.pow(Math.E,-n*(4/Math.PI+t*n)/(1+t*n));return r}}if(!Math._2PI05){Math._2PI05=Math.sqrt(2*Math.PI)}if(!Math.normDist){Math.normDist=function(e,t,n){if(!t)var t=1;if(!n)var n=0;if(!e)var e=-n;return 1/(t*Math._2PI05)*Math.pow(Math.E,-(e-n)*(e-n)/(2*t*t))}}if(!Math.normedNormDist){Math.normedNormDist=function(e,t,n){return this.normDist(e,t,n)/this.normDist(n,t,n)}}if(!Math.exp){Math.exp=function(e){return Math.pow(Math.E,e)}}if(!Math.ln){Math.ln=Math.log}if(!Math.log2){Math.log2=function(e){return Math.log(e)/Math.LN2}}if(!Math.log10){Math.log10=function(e){return Math.log(e)/Math.LN10}}if(!Math.logerithm){Math.logerithm=function(e,t){if(!t||t==Math.E)return Math.log(e);else if(t==2)return Math.log2(e);else if(t==10)return Math.log10(e);else return Math.log(e)/Math.log(t)}}if(!Event)var Event={};if(!Event.stop){Event.stop=function(e){e.cancelBubble=true;if(e.preventDefault)e.preventDefault();if(e.stopPropagation)e.stopPropagation();return false}}if(document.all&&!window.opera){window.$CF=function(e){if(typeof e=="string"){return window.$CF(document.getElementById(e))}else{if(CFElement.prototype.extend&&e&&!e.extend)CFElement.prototype.extend(e)}return e}}else{window.$CF=function(e){return e}}if(!window.HTMLElement){CFElement={};CFElement.prototype={};CFElement.prototype.extend=function(e){for(var t in this){if(!e[t])e[t]=this[t]}}}else{CFElement=window.HTMLElement}if(!CFElement.findPos){CFElement.prototype.findPos=function(){var e=this;var t=curtop=0;try{if(e.offsetParent){t=e.offsetLeft;curtop=e.offsetTop;while(e=e.offsetParent){t+=e.offsetLeft;curtop+=e.offsetTop}}}catch(n){}return{left:t,top:curtop}}}if(!CFElement.getDimensions){CFElement.prototype.getDimensions=function(){return{width:this.clientWidth,height:this.clientHeight}}}if(!CFElement.hasClassName){CFElement.prototype.hasClassName=function(e){return(new RegExp("\\b"+e+"\\b")).test(this.className)}}if(!CFElement.addClassName){CFElement.prototype.addClassName=function(e){if(!this.hasClassName(e)){this.className+=(this.className?" ":"")+e}}}if(!CFElement.removeClassName){CFElement.prototype.removeClassName=function(e){this.className=this.className.replace(new RegExp("\\b"+e+"\\b"),"").replace(/\s\s/g," ")}}if(!CFElement.toggleClassName){CFElement.prototype.toggleClassName=function(e){if(this.hasClassName(e)){this.removeClassName(e)}else{this.addClassName(e)}}}if(!CFElement.getChildrenByClassName){CFElement.prototype.getChildrenByClassName=function(e){var t=new Array;for(var n=0;n<this.childNodes.length;n++){var r=this.childNodes[n];if(r.nodeType==1&&$CF(r).hasClassName(e)){t.push(r)}}return t}}if(!CFElement.addEvent){CFElement.prototype.addEvent=function(e,t,n){if(this.addEventListener)this.addEventListener(e,t,n);else this.attachEvent("on"+e,t)}}if(!CFElement.removeEvent){CFElement.prototype.removeEvent=function(e,t,n){if(this.removeEventListener)this.removeEventListener(e,t,n);else this.detachEvent("on"+e,t)}}if(!window.addEvent){window.addEvent=function(e,t,n){if(this.addEventListener){this.addEventListener(e,t,n)}else{if(e!="load"&&e!="resize")document.attachEvent("on"+e,t);else this.attachEvent("on"+e,t)}}}if(!window.removeEvent){window.removeEvent=function(e,t,n){if(this.removeEventListener){this.removeEventListener(e,t,n)}else{if(e!="load"&&e!="resize")document.detachEvent("on"+e,t);else this.detachEvent("on"+e,t)}}}ContentFlowGlobal.init()

$(function() {
	
	// set image size
	var cimgWidth =256,
		cimgHeight= 360; 

	// identify device
	if( /iPad/i.test(navigator.userAgent) ) {
		var mh = cimgHeight * 2	;
		$('.ContentFlow .flow').css( 'max-width', cimgWidth * 3);
	}else{
		var mh = cimgHeight;
		$('.ContentFlow .flow').css( 'max-width', cimgWidth/2 * 3);
	};
	
	// call contentFlow
	var cf = new ContentFlow('contentFlow', {
		startItem:0							// 起始item
		,visibleItems : 2					// 後方各顯示item數(-1 = auto)
		,endOpacity:1						// 後方item透明度
		,circularFlow: true					// 是否循環
		,flowSpeedFactor: 1.5			    // 捲動速度 (0 to 2)
		,flowDragFriction :0.1
		,reflectionColor: "transparent"		// 倒影方式(none, transparent or hex RGB CSS style #RRGGBB)
        ,reflectionHeight: 0.15				// 倒影高度
        ,reflectionGap: 0.005				// 倒影與主體距離
		,relativeItemPosition:"center"		// item 對齊 (top/above, bottom/below, left, right, center)
		,maxItemHeight : mh
		,onInit : function(){				
			cfValign($cf.height());
			$('.ContentFlow .title').css('visibility','visible');
		}	
	});
	
    var $cf = $('#contentFlow');
	
	// contentFlowt vertically centered
	
	function cfValign(objh){
		var wh = $(window).height(),
	    	ph = Math.abs((wh - objh) / 2 - 15);
			// 為了視覺平衡感修正，px往上移15px，若要完全居中，拿掉-15 即可。
		if(wh>=500){
			$('#contentFlow').css('padding-top',ph);
		}else{
			$('#contentFlow').css('padding-top',0);
		};
	};
	$(window).resize(
		function(){cfValign($cf.height());}
	);

});
