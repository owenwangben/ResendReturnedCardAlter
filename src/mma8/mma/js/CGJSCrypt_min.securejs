!function(){function a(e){var c=e.util=e.util||{};function a(e){if(this.data="",this.read=0,"string"==typeof e)this.data=e;else if(c.isArrayBuffer(e)||c.isArrayBufferView(e)){var t=new Uint8Array(e);try{this.data=String.fromCharCode.apply(null,t)}catch(n){for(var r=0;r<t.length;++r)this.putByte(t[r])}}else(e instanceof a||"object"==typeof e&&"string"==typeof e.data&&"number"==typeof e.read)&&(this.data=e.data,this.read=e.read);this._constructedStringLength=0}!function(){if("undefined"!=typeof process&&process.nextTick)return c.nextTick=process.nextTick,"function"==typeof setImmediate?c.setImmediate=setImmediate:c.setImmediate=c.nextTick;if("function"==typeof setImmediate)return c.setImmediate=function(){return setImmediate.apply(undefined,arguments)},c.nextTick=function(e){return setImmediate(e)};if(c.setImmediate=function(e){setTimeout(e,0)},"undefined"!=typeof window&&"function"==typeof window.postMessage){var r="forge.setImmediate",n=[];c.setImmediate=function(e){n.push(e),1===n.length&&window.postMessage(r,"*")},window.addEventListener("message",function o(e){if(e.source===window&&e.data===r){e.stopPropagation();var t=n.slice();n.length=0,t.forEach(function(e){e()})}},!0)}if("undefined"!=typeof MutationObserver){var t=Date.now(),a=!0,i=document.createElement("div");n=[];new MutationObserver(function(){var e=n.slice();n.length=0,e.forEach(function(e){e()})}).observe(i,{attributes:!0});var s=c.setImmediate;c.setImmediate=function(e){15<Date.now()-t?(t=Date.now(),s(e)):(n.push(e),1===n.length&&i.setAttribute("a",a=!a))}}c.nextTick=c.setImmediate}(),c.isArray=Array.isArray||function(e){return"[object Array]"===Object.prototype.toString.call(e)},c.isArrayBuffer=function(e){return"undefined"!=typeof ArrayBuffer&&e instanceof ArrayBuffer},c.isArrayBufferView=function(e){return e&&c.isArrayBuffer(e.buffer)&&e.byteLength!==undefined},c.ByteBuffer=a,c.ByteStringBuffer=a;c.ByteStringBuffer.prototype._optimizeConstructedString=function(e){this._constructedStringLength+=e,4096<this._constructedStringLength&&(this.data.substr(0,1),this._constructedStringLength=0)},c.ByteStringBuffer.prototype.length=function(){return this.data.length-this.read},c.ByteStringBuffer.prototype.isEmpty=function(){return this.length()<=0},c.ByteStringBuffer.prototype.putByte=function(e){return this.putBytes(String.fromCharCode(e))},c.ByteStringBuffer.prototype.fillWithByte=function(e,t){e=String.fromCharCode(e);for(var r=this.data;0<t;)1&t&&(r+=e),0<(t>>>=1)&&(e+=e);return this.data=r,this._optimizeConstructedString(t),this},c.ByteStringBuffer.prototype.putBytes=function(e){return this.data+=e,this._optimizeConstructedString(e.length),this},c.ByteStringBuffer.prototype.putString=function(e){return this.putBytes(c.encodeUtf8(e))},c.ByteStringBuffer.prototype.putInt16=function(e){return this.putBytes(String.fromCharCode(e>>8&255)+String.fromCharCode(255&e))},c.ByteStringBuffer.prototype.putInt24=function(e){return this.putBytes(String.fromCharCode(e>>16&255)+String.fromCharCode(e>>8&255)+String.fromCharCode(255&e))},c.ByteStringBuffer.prototype.putInt32=function(e){return this.putBytes(String.fromCharCode(e>>24&255)+String.fromCharCode(e>>16&255)+String.fromCharCode(e>>8&255)+String.fromCharCode(255&e))},c.ByteStringBuffer.prototype.putInt16Le=function(e){return this.putBytes(String.fromCharCode(255&e)+String.fromCharCode(e>>8&255))},c.ByteStringBuffer.prototype.putInt24Le=function(e){return this.putBytes(String.fromCharCode(255&e)+String.fromCharCode(e>>8&255)+String.fromCharCode(e>>16&255))},c.ByteStringBuffer.prototype.putInt32Le=function(e){return this.putBytes(String.fromCharCode(255&e)+String.fromCharCode(e>>8&255)+String.fromCharCode(e>>16&255)+String.fromCharCode(e>>24&255))},c.ByteStringBuffer.prototype.putInt=function(e,t){for(var r="";t-=8,r+=String.fromCharCode(e>>t&255),0<t;);return this.putBytes(r)},c.ByteStringBuffer.prototype.putSignedInt=function(e,t){return e<0&&(e+=2<<t-1),this.putInt(e,t)},c.ByteStringBuffer.prototype.putBuffer=function(e){return this.putBytes(e.getBytes())},c.ByteStringBuffer.prototype.getByte=function(){return this.data.charCodeAt(this.read++)},c.ByteStringBuffer.prototype.getInt16=function(){var e=this.data.charCodeAt(this.read)<<8^this.data.charCodeAt(this.read+1);return this.read+=2,e},c.ByteStringBuffer.prototype.getInt24=function(){var e=this.data.charCodeAt(this.read)<<16^this.data.charCodeAt(this.read+1)<<8^this.data.charCodeAt(this.read+2);return this.read+=3,e},c.ByteStringBuffer.prototype.getInt32=function(){var e=this.data.charCodeAt(this.read)<<24^this.data.charCodeAt(this.read+1)<<16^this.data.charCodeAt(this.read+2)<<8^this.data.charCodeAt(this.read+3);return this.read+=4,e},c.ByteStringBuffer.prototype.getInt16Le=function(){var e=this.data.charCodeAt(this.read)^this.data.charCodeAt(this.read+1)<<8;return this.read+=2,e},c.ByteStringBuffer.prototype.getInt24Le=function(){var e=this.data.charCodeAt(this.read)^this.data.charCodeAt(this.read+1)<<8^this.data.charCodeAt(this.read+2)<<16;return this.read+=3,e},c.ByteStringBuffer.prototype.getInt32Le=function(){var e=this.data.charCodeAt(this.read)^this.data.charCodeAt(this.read+1)<<8^this.data.charCodeAt(this.read+2)<<16^this.data.charCodeAt(this.read+3)<<24;return this.read+=4,e},c.ByteStringBuffer.prototype.getInt=function(e){for(var t=0;t=(t<<8)+this.data.charCodeAt(this.read++),0<(e-=8););return t},c.ByteStringBuffer.prototype.getSignedInt=function(e){var t=this.getInt(e),r=2<<e-2;return r<=t&&(t-=r<<1),t},c.ByteStringBuffer.prototype.getBytes=function(e){var t;return e?(e=Math.min(this.length(),e),t=this.data.slice(this.read,this.read+e),this.read+=e):0===e?t="":(t=0===this.read?this.data:this.data.slice(this.read),this.clear()),t},c.ByteStringBuffer.prototype.bytes=function(e){return void 0===e?this.data.slice(this.read):this.data.slice(this.read,this.read+e)},c.ByteStringBuffer.prototype.at=function(e){return this.data.charCodeAt(this.read+e)},c.ByteStringBuffer.prototype.setAt=function(e,t){return this.data=this.data.substr(0,this.read+e)+String.fromCharCode(t)+this.data.substr(this.read+e+1),this},c.ByteStringBuffer.prototype.last=function(){return this.data.charCodeAt(this.data.length-1)},c.ByteStringBuffer.prototype.copy=function(){var e=c.createBuffer(this.data);return e.read=this.read,e},c.ByteStringBuffer.prototype.compact=function(){return 0<this.read&&(this.data=this.data.slice(this.read),this.read=0),this},c.ByteStringBuffer.prototype.clear=function(){return this.data="",this.read=0,this},c.ByteStringBuffer.prototype.truncate=function(e){var t=Math.max(0,this.length()-e);return this.data=this.data.substr(this.read,t),this.read=0,this},c.ByteStringBuffer.prototype.toHex=function(){for(var e="",t=this.read;t<this.data.length;++t){var r=this.data.charCodeAt(t);r<16&&(e+="0"),e+=r.toString(16)}return e},c.ByteStringBuffer.prototype.toString=function(){return c.decodeUtf8(this.bytes())},c.DataBuffer=function y(e,t){t=t||{},this.read=t.readOffset||0,this.growSize=t.growSize||1024;var r=c.isArrayBuffer(e),n=c.isArrayBufferView(e);if(r||n)return this.data=r?new DataView(e):new DataView(e.buffer,e.byteOffset,e.byteLength),void(this.write="writeOffset"in t?t.writeOffset:this.data.byteLength);this.data=new DataView(new ArrayBuffer(0)),this.write=0,null!==e&&e!==undefined&&this.putBytes(e),"writeOffset"in t&&(this.write=t.writeOffset)},c.DataBuffer.prototype.length=function(){return this.write-this.read},c.DataBuffer.prototype.isEmpty=function(){return this.length()<=0},c.DataBuffer.prototype.accommodate=function(e,t){if(this.length()>=e)return this;t=Math.max(t||this.growSize,e);var r=new Uint8Array(this.data.buffer,this.data.byteOffset,this.data.byteLength),n=new Uint8Array(this.length()+t);return n.set(r),this.data=new DataView(n.buffer),this},c.DataBuffer.prototype.putByte=function(e){return this.accommodate(1),this.data.setUint8(this.write++,e),this},c.DataBuffer.prototype.fillWithByte=function(e,t){this.accommodate(t);for(var r=0;r<t;++r)this.data.setUint8(e);return this},c.DataBuffer.prototype.putBytes=function(e,t){if(c.isArrayBufferView(e)){var r=(n=new Uint8Array(e.buffer,e.byteOffset,e.byteLength)).byteLength-n.byteOffset;return this.accommodate(r),new Uint8Array(this.data.buffer,this.write).set(n),this.write+=r,this}if(c.isArrayBuffer(e)){var n=new Uint8Array(e);return this.accommodate(n.byteLength),new Uint8Array(this.data.buffer).set(n,this.write),this.write+=n.byteLength,this}if(e instanceof c.DataBuffer||"object"==typeof e&&"number"==typeof e.read&&"number"==typeof e.write&&c.isArrayBufferView(e.data)){n=new Uint8Array(e.data.byteLength,e.read,e.length());return this.accommodate(n.byteLength),new Uint8Array(e.data.byteLength,this.write).set(n),this.write+=n.byteLength,this}if(e instanceof c.ByteStringBuffer&&(e=e.data,t="binary"),t=t||"binary","string"==typeof e){var a;if("hex"===t)return this.accommodate(Math.ceil(e.length/2)),a=new Uint8Array(this.data.buffer,this.write),this.write+=c.binary.hex.decode(e,a,this.write),this;if("base64"===t)return this.accommodate(3*Math.ceil(e.length/4)),a=new Uint8Array(this.data.buffer,this.write),this.write+=c.binary.base64.decode(e,a,this.write),this;if("utf8"===t&&(e=c.encodeUtf8(e),t="binary"),"binary"===t||"raw"===t)return this.accommodate(e.length),a=new Uint8Array(this.data.buffer,this.write),this.write+=c.binary.raw.decode(a),this;if("utf16"===t)return this.accommodate(2*e.length),a=new Uint16Array(this.data.buffer,this.write),this.write+=c.text.utf16.encode(a),this;throw new Error("Invalid encoding: "+t)}throw Error("Invalid parameter: "+e)},c.DataBuffer.prototype.putBuffer=function(e){return this.putBytes(e),e.clear(),this},c.DataBuffer.prototype.putString=function(e){return this.putBytes(e,"utf16")},c.DataBuffer.prototype.putInt16=function(e){return this.accommodate(2),this.data.setInt16(this.write,e),this.write+=2,this},c.DataBuffer.prototype.putInt24=function(e){return this.accommodate(3),this.data.setInt16(this.write,e>>8&65535),this.data.setInt8(this.write,e>>16&255),this.write+=3,this},c.DataBuffer.prototype.putInt32=function(e){return this.accommodate(4),this.data.setInt32(this.write,e),this.write+=4,this},c.DataBuffer.prototype.putInt16Le=function(e){return this.accommodate(2),this.data.setInt16(this.write,e,!0),this.write+=2,this},c.DataBuffer.prototype.putInt24Le=function(e){return this.accommodate(3),this.data.setInt8(this.write,e>>16&255),this.data.setInt16(this.write,e>>8&65535,!0),this.write+=3,this},c.DataBuffer.prototype.putInt32Le=function(e){return this.accommodate(4),this.data.setInt32(this.write,e,!0),this.write+=4,this},c.DataBuffer.prototype.putInt=function(e,t){for(this.accommodate(t/8);t-=8,this.data.setInt8(this.write++,e>>t&255),0<t;);return this},c.DataBuffer.prototype.putSignedInt=function(e,t){return this.accommodate(t/8),e<0&&(e+=2<<t-1),this.putInt(e,t)},c.DataBuffer.prototype.getByte=function(){return this.data.getInt8(this.read++)},c.DataBuffer.prototype.getInt16=function(){var e=this.data.getInt16(this.read);return this.read+=2,e},c.DataBuffer.prototype.getInt24=function(){var e=this.data.getInt16(this.read)<<8^this.data.getInt8(this.read+2);return this.read+=3,e},c.DataBuffer.prototype.getInt32=function(){var e=this.data.getInt32(this.read);return this.read+=4,e},c.DataBuffer.prototype.getInt16Le=function(){var e=this.data.getInt16(this.read,!0);return this.read+=2,e},c.DataBuffer.prototype.getInt24Le=function(){var e=this.data.getInt8(this.read)^this.data.getInt16(this.read+1,!0)<<8;return this.read+=3,e},c.DataBuffer.prototype.getInt32Le=function(){var e=this.data.getInt32(this.read,!0);return this.read+=4,e},c.DataBuffer.prototype.getInt=function(e){for(var t=0;t=(t<<8)+this.data.getInt8(this.read++),0<(e-=8););return t},c.DataBuffer.prototype.getSignedInt=function(e){var t=this.getInt(e),r=2<<e-2;return r<=t&&(t-=r<<1),t},c.DataBuffer.prototype.getBytes=function(e){var t;return e?(e=Math.min(this.length(),e),t=this.data.slice(this.read,this.read+e),this.read+=e):0===e?t="":(t=0===this.read?this.data:this.data.slice(this.read),this.clear()),t},c.DataBuffer.prototype.bytes=function(e){return void 0===e?this.data.slice(this.read):this.data.slice(this.read,this.read+e)},c.DataBuffer.prototype.at=function(e){return this.data.getUint8(this.read+e)},c.DataBuffer.prototype.setAt=function(e,t){return this.data.setUint8(e,t),this},c.DataBuffer.prototype.last=function(){return this.data.getUint8(this.write-1)},c.DataBuffer.prototype.copy=function(){return new c.DataBuffer(this)},c.DataBuffer.prototype.compact=function(){if(0<this.read){var e=new Uint8Array(this.data.buffer,this.read),t=new Uint8Array(e.byteLength);t.set(e),this.data=new DataView(t),this.write-=this.read,this.read=0}return this},c.DataBuffer.prototype.clear=function(){return this.data=new DataView(new ArrayBuffer(0)),this.read=this.write=0,this},c.DataBuffer.prototype.truncate=function(e){return this.write=Math.max(0,this.length()-e),this.read=Math.min(this.read,this.write),this},c.DataBuffer.prototype.toHex=function(){for(var e="",t=this.read;t<this.data.byteLength;++t){var r=this.data.getUint8(t);r<16&&(e+="0"),e+=r.toString(16)}return e},c.DataBuffer.prototype.toString=function(e){var t=new Uint8Array(this.data,this.read,this.length());if("binary"===(e=e||"utf8")||"raw"===e)return c.binary.raw.encode(t);if("hex"===e)return c.binary.hex.encode(t);if("base64"===e)return c.binary.base64.encode(t);if("utf8"===e)return c.text.utf8.decode(t);if("utf16"===e)return c.text.utf16.decode(t);throw new Error("Invalid encoding: "+e)},c.createBuffer=function(e,t){return t=t||"raw",e!==undefined&&"utf8"===t&&(e=c.encodeUtf8(e)),new c.ByteBuffer(e)},c.fillString=function(e,t){for(var r="";0<t;)1&t&&(r+=e),0<(t>>>=1)&&(e+=e);return r},c.xorBytes=function(e,t,r){for(var n="",a="",i="",s=0,o=0;0<r;--r,++s)a=e.charCodeAt(s)^t.charCodeAt(s),10<=o&&(n+=i,i="",o=0),i+=String.fromCharCode(a),++o;return n+=i},c.hexToBytes=function(e){var t="",r=0;for(!0&e.length&&(r=1,t+=String.fromCharCode(parseInt(e[0],16)));r<e.length;r+=2)t+=String.fromCharCode(parseInt(e.substr(r,2),16));return t},c.bytesToHex=function(e){return c.createBuffer(e).toHex()},c.int32ToBytes=function(e){return String.fromCharCode(e>>24&255)+String.fromCharCode(e>>16&255)+String.fromCharCode(e>>8&255)+String.fromCharCode(255&e)};var u="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",l=[62,-1,-1,-1,63,52,53,54,55,56,57,58,59,60,61,-1,-1,-1,64,-1,-1,-1,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,-1,-1,-1,-1,-1,-1,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51];c.encode64=function(e,t){for(var r,n,a,i="",s="",o=0;o<e.length;)r=e.charCodeAt(o++),n=e.charCodeAt(o++),a=e.charCodeAt(o++),i+=u.charAt(r>>2),i+=u.charAt((3&r)<<4|n>>4),isNaN(n)?i+="==":(i+=u.charAt((15&n)<<2|a>>6),i+=isNaN(a)?"=":u.charAt(63&a)),t&&i.length>t&&(s+=i.substr(0,t)+"\r\n",i=i.substr(t));return s+=i},c.decode64=function(e){e=e.replace(/[^A-Za-z0-9\+\/\=]/g,"");for(var t,r,n,a,i="",s=0;s<e.length;)t=l[e.charCodeAt(s++)-43],r=l[e.charCodeAt(s++)-43],n=l[e.charCodeAt(s++)-43],a=l[e.charCodeAt(s++)-43],i+=String.fromCharCode(t<<2|r>>4),64!==n&&(i+=String.fromCharCode((15&r)<<4|n>>2),64!==a&&(i+=String.fromCharCode((3&n)<<6|a)));return i},c.encodeUtf8=function(e){return unescape(encodeURIComponent(e))},c.decodeUtf8=function(e){return decodeURIComponent(escape(e))},c.binary={raw:{},hex:{},base64:{}},c.binary.raw.encode=function(e){return String.fromCharCode.apply(null,e)},c.binary.raw.decode=function(e,t,r){var n=t;n||(n=new Uint8Array(e.length));for(var a=r=r||0,i=0;i<e.length;++i)n[a++]=e.charCodeAt(i);return t?a-r:n},c.binary.hex.encode=c.bytesToHex,c.binary.hex.decode=function(e,t,r){var n=t;n||(n=new Uint8Array(Math.ceil(e.length/2)));var a=0,i=r=r||0;for(1&e.length&&(a=1,n[i++]=parseInt(e[0],16));a<e.length;a+=2)n[i++]=parseInt(e.substr(a,2),16);return t?i-r:n},c.binary.base64.encode=function(e,t){for(var r,n,a,i="",s="",o=0;o<e.byteLength;)r=e[o++],n=e[o++],a=e[o++],i+=u.charAt(r>>2),i+=u.charAt((3&r)<<4|n>>4),isNaN(n)?i+="==":(i+=u.charAt((15&n)<<2|a>>6),i+=isNaN(a)?"=":u.charAt(63&a)),t&&i.length>t&&(s+=i.substr(0,t)+"\r\n",i=i.substr(t));return s+=i},c.binary.base64.decode=function(e,t,r){var n,a,i,s,o=t;o||(o=new Uint8Array(3*Math.ceil(e.length/4))),e=e.replace(/[^A-Za-z0-9\+\/\=]/g,"");for(var u=0,c=r=r||0;u<e.length;)n=l[e.charCodeAt(u++)-43],a=l[e.charCodeAt(u++)-43],i=l[e.charCodeAt(u++)-43],s=l[e.charCodeAt(u++)-43],o[c++]=n<<2|a>>4,64!==i&&(o[c++]=(15&a)<<4|i>>2,64!==s&&(o[c++]=(3&i)<<6|s));return t?c-r:o.subarray(0,c)},c.text={utf8:{},utf16:{}},c.text.utf8.encode=function(e,t,r){e=c.encodeUtf8(e);var n=t;n||(n=new Uint8Array(e.length));for(var a=r=r||0,i=0;i<e.length;++i)n[a++]=e.charCodeAt(i);return t?a-r:n},c.text.utf8.decode=function(e){return c.decodeUtf8(String.fromCharCode.apply(null,e))},c.text.utf16.encode=function(e,t,r){var n=t;n||(n=new Uint8Array(2*e.length));for(var a=new Uint16Array(n.buffer),i=r=r||0,s=r,o=0;o<e.length;++o)a[s++]=e.charCodeAt(o),i+=2;return t?i-r:n},c.text.utf16.decode=function(e){return String.fromCharCode.apply(null,new Uint16Array(e.buffer))},c.deflate=function(e,t,r){if(t=c.decode64(e.deflate(c.encode64(t)).rval),r){var n=2;32&t.charCodeAt(1)&&(n=6),t=t.substring(n,t.length-4)}return t},c.inflate=function(e,t,r){var n=e.inflate(c.encode64(t)).rval;return null===n?null:c.decode64(n)};var s=function(e,t,r){if(!e)throw new Error("WebStorage not available.");var n;if(null===r?n=e.removeItem(t):(r=c.encode64(JSON.stringify(r)),n=e.setItem(t,r)),void 0!==n&&!0!==n.rval){var a=new Error(n.error.message);throw a.id=n.error.id,a.name=n.error.name,a}},o=function(e,t){if(!e)throw new Error("WebStorage not available.");var r=e.getItem(t);if(e.init)if(null===r.rval){if(r.error){var n=new Error(r.error.message);throw n.id=r.error.id,n.name=r.error.name,n}r=null}else r=r.rval;return null!==r&&(r=JSON.parse(c.decode64(r))),r},i=function(e,t,r,n){var a=o(e,t);null===a&&(a={}),a[r]=n,s(e,t,a)},p=function(e,t,r){var n=o(e,t);return null!==n&&(n=r in n?n[r]:null),n},f=function(e,t,r){var n=o(e,t);if(null!==n&&r in n){delete n[r];var a=!0;for(var i in n){a=!1;break}a&&(n=null),s(e,t,n)}},n=function(e,t){s(e,t,null)},d=function(e,t,r){var n,a=null;void 0===r&&(r=["web","flash"]);var i=!1,s=null;for(var o in r){n=r[o];try{if("flash"===n||"both"===n){if(null===t[0])throw new Error("Flash local storage not available.");a=e.apply(this,t),i="flash"===n}"web"!==n&&"both"!==n||(t[0]=localStorage,a=e.apply(this,t),i=!0)}catch(u){s=u}if(i)break}if(!i)throw s;return a};c.setItem=function(e,t,r,n,a){d(i,arguments,a)},c.getItem=function(e,t,r,n){return d(p,arguments,n)},c.removeItem=function(e,t,r,n){d(f,arguments,n)},c.clearItems=function(e,t,r){d(n,arguments,r)},c.parseUrl=function(e){var t=/^(https?):\/\/([^:&^\/]*):?(\d*)(.*)$/g;t.lastIndex=0;var r=t.exec(e),n=null===r?null:{full:e,scheme:r[1],host:r[2],port:r[3],path:r[4]};return n&&(n.fullHost=n.host,n.port?80!==n.port&&"http"===n.scheme?n.fullHost+=":"+n.port:443!==n.port&&"https"===n.scheme&&(n.fullHost+=":"+n.port):"http"===n.scheme?n.port=80:"https"===n.scheme&&(n.port=443),n.full=n.scheme+"://"+n.fullHost),n};var h=null;c.getQueryVariables=function(e){var t,r=function(e){for(var t={},r=e.split("&"),n=0;n<r.length;n++){var a,i,s=r[n].indexOf("=");0<s?(a=r[n].substring(0,s),i=r[n].substring(s+1)):(a=r[n],i=null),a in t||(t[a]=[]),a in Object.prototype||null===i||t[a].push(unescape(i))}return t};return void 0===e?(null===h&&(h="undefined"!=typeof window&&window.location&&window.location.search?r(window.location.search.substring(1)):{}),t=h):t=r(e),t},c.parseFragment=function(e){var t=e,r="",n=e.indexOf("?");0<n&&(t=e.substring(0,n),r=e.substring(n+1));var a=t.split("/");return 0<a.length&&""===a[0]&&a.shift(),{pathString:t,queryString:r,path:a,query:""===r?{}:c.getQueryVariables(r)}},c.makeRequest=function(e){var n=c.parseFragment(e),a={path:n.pathString,query:n.queryString,getPath:function(e){return void 0===e?n.path:n.path[e]},getQuery:function(e,t){var r;return void 0===e?r=n.query:(r=n.query[e])&&void 0!==t&&(r=r[t]),r},getQueryLast:function(e,t){var r=a.getQuery(e);return r?r[r.length-1]:t}};return a},c.makeLink=function(e,t,r){e=jQuery.isArray(e)?e.join("/"):e;var n=jQuery.param(t||{});return r=r||"",e+(0<n.length?"?"+n:"")+(0<r.length?"#"+r:"")},c.setPath=function(e,t,r){if("object"==typeof e&&null!==e)for(var n=0,a=t.length;n<a;){var i=t[n++];if(n==a)e[i]=r;else{var s=i in e;(!s||s&&"object"!=typeof e[i]||s&&null===e[i])&&(e[i]={}),e=e[i]}}},c.getPath=function(e,t,r){for(var n=0,a=t.length,i=!0;i&&n<a&&"object"==typeof e&&null!==e;){var s=t[n++];(i=s in e)&&(e=e[s])}return i?e:r},c.deletePath=function(e,t){if("object"==typeof e&&null!==e)for(var r=0,n=t.length;r<n;){var a=t[r++];if(r==n)delete e[a];else{if(!(a in e)||"object"!=typeof e[a]||null===e[a])break;e=e[a]}}},c.isEmpty=function(e){for(var t in e)if(e.hasOwnProperty(t))return!1;return!0},c.format=function(e){for(var t,r,n=/%./g,a=0,i=[],s=0;t=n.exec(e);){0<(r=e.substring(s,n.lastIndex-2)).length&&i.push(r),s=n.lastIndex;var o=t[0][1];switch(o){case"s":case"o":a<arguments.length?i.push(arguments[1+a++]):i.push("<?>");break;case"%":i.push("%");break;default:i.push("<%"+o+"?>")}}return i.push(e.substring(s)),i.join("")},c.formatNumber=function(e,t,r,n){var a=e,i=isNaN(t=Math.abs(t))?2:t,s=r===undefined?",":r,o=n===undefined?".":n,u=a<0?"-":"",c=parseInt(a=Math.abs(+a||0).toFixed(i),10)+"",l=3<c.length?c.length%3:0;return u+(l?c.substr(0,l)+o:"")+c.substr(l).replace(/(\d{3})(?=\d)/g,"$1"+o)+(i?s+Math.abs(a-c).toFixed(i).slice(2):"")},c.formatSize=function(e){return e=1073741824<=e?c.formatNumber(e/1073741824,2,".","")+" GiB":1048576<=e?c.formatNumber(e/1048576,2,".","")+" MiB":1024<=e?c.formatNumber(e/1024,0)+" KiB":c.formatNumber(e,0)+" bytes"},c.bytesFromIP=function(e){return-1!==e.indexOf(".")?c.bytesFromIPv4(e):-1!==e.indexOf(":")?c.bytesFromIPv6(e):null},c.bytesFromIPv4=function(e){if(4!==(e=e.split(".")).length)return null;for(var t=c.createBuffer(),r=0;r<e.length;++r){var n=parseInt(e[r],10);if(isNaN(n))return null;t.putByte(n)}return t.getBytes()},c.bytesFromIPv6=function(e){for(var t=0,r=2*(8-(e=e.split(":").filter(function(e){return 0===e.length&&++t,!0})).length+t),n=c.createBuffer(),a=0;a<8;++a)if(e[a]&&0!==e[a].length){var i=c.hexToBytes(e[a]);i.length<2&&n.putByte(0),n.putBytes(i)}else n.fillWithByte(0,r),r=0;return n.getBytes()},c.bytesToIP=function(e){return 4===e.length?c.bytesToIPv4(e):16===e.length?c.bytesToIPv6(e):null},c.bytesToIPv4=function(e){if(4!==e.length)return null;for(var t=[],r=0;r<e.length;++r)t.push(e.charCodeAt(r));return t.join(".")},c.bytesToIPv6=function(e){if(16!==e.length)return null;for(var t=[],r=[],n=0,a=0;a<e.length;a+=2){for(var i=c.bytesToHex(e[a]+e[a+1]);"0"===i[0]&&"0"!==i;)i=i.substr(1);if("0"===i){var s=r[r.length-1],o=t.length;s&&o===s.end+1?(s.end=o,s.end-s.start>r[n].end-r[n].start&&(n=r.length-1)):r.push({start:o,end:o})}t.push(i)}if(0<r.length){var u=r[n];0<u.end-u.start&&(t.splice(u.start,u.end-u.start+1,""),0===u.start&&t.unshift(""),7===u.end&&t.push(""))}return t.join(":")},c.estimateCores=function(e,t){if("function"==typeof e&&(t=e,e={}),e=e||{},"cores"in c&&!e.update)return t(null,c.cores);if("undefined"!=typeof navigator&&"hardwareConcurrency"in navigator&&0<navigator.hardwareConcurrency)return c.cores=navigator.hardwareConcurrency,t(null,c.cores);if("undefined"==typeof Worker)return c.cores=1,t(null,c.cores);if("undefined"==typeof Blob)return c.cores=2,t(null,c.cores);var o=URL.createObjectURL(new Blob(["(",function(){self.addEventListener("message",function(e){for(var t=Date.now(),r=t+4;Date.now()<r;);self.postMessage({st:t,et:r})})}.toString(),")()"],{type:"application/javascript"}));!function i(r,n,a){if(0===n){var e=Math.floor(r.reduce(function(e,t){return e+t},0)/r.length);return c.cores=Math.max(1,e),URL.revokeObjectURL(o),t(null,c.cores)}!function s(r,n){for(var a=[],i=[],e=0;e<r;++e){var t=new Worker(o);t.addEventListener("message",function(e){if(i.push(e.data),i.length===r){for(var t=0;t<r;++t)a[t].terminate();n(null,i)}}),a.push(t)}for(var e=0;e<r;++e)a[e].postMessage(e)}(a,function(e,t){r.push(function u(e,t){for(var r=[],n=0;n<e;++n)for(var a=t[n],i=r[n]=[],s=0;s<e;++s)if(n!==s){var o=t[s];(a.st>o.st&&a.st<o.et||o.st>a.st&&o.st<a.et)&&i.push(s)}return r.reduce(function(e,t){return Math.max(e,t.length)},0)}(a,t)),i(r,n-1,a)})}([],5,16)}}var i,s="util";if("function"!=typeof define){if("object"!=typeof module||!module.exports)return"undefined"==typeof forge&&(forge={}),a(forge);var r=!0;define=function(e,t){t(require,module)}}var n=define;define=function(e,t){return i="string"==typeof e?t.slice(2):e.slice(2),r?(delete define,n.apply(null,Array.prototype.slice.call(arguments,0))):(define=n,define.apply(null,Array.prototype.slice.call(arguments,0)))},define(["require","module"],function(){(function(n,e){e.exports=function(e){var t=i.map(function(e){return n(e)}).concat(a);if((e=e||{}).defined=e.defined||{},e.defined[s])return e[s];e.defined[s]=!0;for(var r=0;r<t.length;++r)t[r](e);return e[s]}}).apply(null,Array.prototype.slice.call(arguments,0))})}(),function(){function a(p){var e=p.md5=p.md5||{};p.md=p.md||{},p.md.algorithms=p.md.algorithms||{},p.md.md5=p.md.algorithms.md5=e,e.create=function(){r||function t(){f=String.fromCharCode(128),f+=p.util.fillString(String.fromCharCode(0),64),d=[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,1,6,11,0,5,10,15,4,9,14,3,8,13,2,7,12,5,8,11,14,1,4,7,10,13,0,3,6,9,12,15,2,0,7,14,5,12,3,10,1,8,15,6,13,4,11,2,9],h=[7,12,17,22,7,12,17,22,7,12,17,22,7,12,17,22,5,9,14,20,5,9,14,20,5,9,14,20,5,9,14,20,4,11,16,23,4,11,16,23,4,11,16,23,4,11,16,23,6,10,15,21,6,10,15,21,6,10,15,21,6,10,15,21],y=new Array(64);for(var e=0;e<64;++e)y[e]=Math.floor(4294967296*Math.abs(Math.sin(e+1)));r=!0}();var o=null,u=p.util.createBuffer(),c=new Array(16),l={algorithm:"md5",blockLength:64,digestLength:16,messageLength:0,fullMessageLength:null,messageLengthSize:8,start:function(){l.messageLength=0,l.fullMessageLength=l.messageLength64=[];for(var e=l.messageLengthSize/4,t=0;t<e;++t)l.fullMessageLength.push(0);return u=p.util.createBuffer(),o={h0:1732584193,h1:4023233417,h2:2562383102,h3:271733878},l}};return l.start(),l.update=function(e,t){"utf8"===t&&(e=p.util.encodeUtf8(e));var r=e.length;l.messageLength+=r,r=[r/4294967296>>>0,r>>>0];for(var n=l.fullMessageLength.length-1;0<=n;--n)l.fullMessageLength[n]+=r[1],r[1]=r[0]+(l.fullMessageLength[n]/4294967296>>>0),l.fullMessageLength[n]=l.fullMessageLength[n]>>>0,r[0]=r[1]/4294967296>>>0;return u.putBytes(e),g(o,c,u),(2048<u.read||0===u.length())&&u.compact(),l},l.digest=function(){var e=p.util.createBuffer();e.putBytes(u.bytes());var t=l.fullMessageLength[l.fullMessageLength.length-1]+l.messageLengthSize&l.blockLength-1;e.putBytes(f.substr(0,l.blockLength-t));for(var r,n=0,a=l.fullMessageLength.length-1;0<=a;--a)n=(r=8*l.fullMessageLength[a]+n)/4294967296>>>0,e.putInt32Le(r>>>0);var i={h0:o.h0,h1:o.h1,h2:o.h2,h3:o.h3};g(i,c,e);var s=p.util.createBuffer();return s.putInt32Le(i.h0),s.putInt32Le(i.h1),s.putInt32Le(i.h2),s.putInt32Le(i.h3),s},l};var f=null,d=null,h=null,y=null,r=!1;function g(e,t,r){for(var n,a,i,s,o,u,c,l=r.length();64<=l;){for(a=e.h0,i=e.h1,s=e.h2,o=e.h3,c=0;c<16;++c)t[c]=r.getInt32Le(),n=a+(o^i&(s^o))+y[c]+t[c],a=o,o=s,s=i,i+=n<<(u=h[c])|n>>>32-u;for(;c<32;++c)n=a+(s^o&(i^s))+y[c]+t[d[c]],a=o,o=s,s=i,i+=n<<(u=h[c])|n>>>32-u;for(;c<48;++c)n=a+(i^s^o)+y[c]+t[d[c]],a=o,o=s,s=i,i+=n<<(u=h[c])|n>>>32-u;for(;c<64;++c)n=a+(s^(i|~o))+y[c]+t[d[c]],a=o,o=s,s=i,i+=n<<(u=h[c])|n>>>32-u;e.h0=e.h0+a|0,e.h1=e.h1+i|0,e.h2=e.h2+s|0,e.h3=e.h3+o|0,l-=64}}}var i;if("function"!=typeof define){if("object"!=typeof module||!module.exports)return"undefined"==typeof forge&&(forge={}),a(forge);var r=!0;define=function(e,t){t(require,module)}}var n=define;define=function(e,t){return i="string"==typeof e?t.slice(2):e.slice(2),r?(delete define,n.apply(null,Array.prototype.slice.call(arguments,0))):(define=n,define.apply(null,Array.prototype.slice.call(arguments,0)))},define(["require","module","./util"],function(){(function(n,e){e.exports=function(e){var t=i.map(function(e){return n(e)}).concat(a);if((e=e||{}).defined=e.defined||{},e.defined.md5)return e.md5;e.defined.md5=!0;for(var r=0;r<t.length;++r)t[r](e);return e.md5}}).apply(null,Array.prototype.slice.call(arguments,0))})}(),function(){function a(p){var e=p.sha1=p.sha1||{};p.md=p.md||{},p.md.algorithms=p.md.algorithms||{},p.md.sha1=p.md.algorithms.sha1=e,e.create=function(){t||function e(){f=String.fromCharCode(128),f+=p.util.fillString(String.fromCharCode(0),64),t=!0}();var o=null,u=p.util.createBuffer(),c=new Array(80),l={algorithm:"sha1",blockLength:64,digestLength:20,messageLength:0,fullMessageLength:null,messageLengthSize:8,start:function(){l.messageLength=0,l.fullMessageLength=l.messageLength64=[];for(var e=l.messageLengthSize/4,t=0;t<e;++t)l.fullMessageLength.push(0);return u=p.util.createBuffer(),o={h0:1732584193,h1:4023233417,h2:2562383102,h3:271733878,h4:3285377520},l}};return l.start(),l.update=function(e,t){"utf8"===t&&(e=p.util.encodeUtf8(e));var r=e.length;l.messageLength+=r,r=[r/4294967296>>>0,r>>>0];for(var n=l.fullMessageLength.length-1;0<=n;--n)l.fullMessageLength[n]+=r[1],r[1]=r[0]+(l.fullMessageLength[n]/4294967296>>>0),l.fullMessageLength[n]=l.fullMessageLength[n]>>>0,r[0]=r[1]/4294967296>>>0;return u.putBytes(e),d(o,c,u),(2048<u.read||0===u.length())&&u.compact(),l},l.digest=function(){var e=p.util.createBuffer();e.putBytes(u.bytes());var t,r=l.fullMessageLength[l.fullMessageLength.length-1]+l.messageLengthSize&l.blockLength-1;e.putBytes(f.substr(0,l.blockLength-r));for(var n=8*l.fullMessageLength[0],a=0;a<l.fullMessageLength.length-1;++a)n+=(t=8*l.fullMessageLength[a+1])/4294967296>>>0,e.putInt32(n>>>0),n=t>>>0;e.putInt32(n);var i={h0:o.h0,h1:o.h1,h2:o.h2,h3:o.h3,h4:o.h4};d(i,c,e);var s=p.util.createBuffer();return s.putInt32(i.h0),s.putInt32(i.h1),s.putInt32(i.h2),s.putInt32(i.h3),s.putInt32(i.h4),s},l};var f=null,t=!1;function d(e,t,r){for(var n,a,i,s,o,u,c,l=r.length();64<=l;){for(a=e.h0,i=e.h1,s=e.h2,o=e.h3,u=e.h4,c=0;c<16;++c)n=r.getInt32(),n=(a<<5|a>>>27)+(o^i&(s^o))+u+1518500249+(t[c]=n),u=o,o=s,s=(i<<30|i>>>2)>>>0,i=a,a=n;for(;c<20;++c)n=(n=t[c-3]^t[c-8]^t[c-14]^t[c-16])<<1|n>>>31,n=(a<<5|a>>>27)+(o^i&(s^o))+u+1518500249+(t[c]=n),u=o,o=s,s=(i<<30|i>>>2)>>>0,i=a,a=n;for(;c<32;++c)n=(n=t[c-3]^t[c-8]^t[c-14]^t[c-16])<<1|n>>>31,n=(a<<5|a>>>27)+(i^s^o)+u+1859775393+(t[c]=n),u=o,o=s,s=(i<<30|i>>>2)>>>0,i=a,a=n;for(;c<40;++c)n=(n=t[c-6]^t[c-16]^t[c-28]^t[c-32])<<2|n>>>30,n=(a<<5|a>>>27)+(i^s^o)+u+1859775393+(t[c]=n),u=o,o=s,s=(i<<30|i>>>2)>>>0,i=a,a=n;for(;c<60;++c)n=(n=t[c-6]^t[c-16]^t[c-28]^t[c-32])<<2|n>>>30,n=(a<<5|a>>>27)+(i&s|o&(i^s))+u+2400959708+(t[c]=n),u=o,o=s,s=(i<<30|i>>>2)>>>0,i=a,a=n;for(;c<80;++c)n=(n=t[c-6]^t[c-16]^t[c-28]^t[c-32])<<2|n>>>30,n=(a<<5|a>>>27)+(i^s^o)+u+3395469782+(t[c]=n),u=o,o=s,s=(i<<30|i>>>2)>>>0,i=a,a=n;e.h0=e.h0+a|0,e.h1=e.h1+i|0,e.h2=e.h2+s|0,e.h3=e.h3+o|0,e.h4=e.h4+u|0,l-=64}}}var i,s="sha1";if("function"!=typeof define){if("object"!=typeof module||!module.exports)return"undefined"==typeof forge&&(forge={}),a(forge);var r=!0;define=function(e,t){t(require,module)}}var n=define;define=function(e,t){return i="string"==typeof e?t.slice(2):e.slice(2),r?(delete define,n.apply(null,Array.prototype.slice.call(arguments,0))):(define=n,define.apply(null,Array.prototype.slice.call(arguments,0)))},define(["require","module","./util"],function(){(function(n,e){e.exports=function(e){var t=i.map(function(e){return n(e)}).concat(a);if((e=e||{}).defined=e.defined||{},e.defined[s])return e[s];e.defined[s]=!0;for(var r=0;r<t.length;++r)t[r](e);return e[s]}}).apply(null,Array.prototype.slice.call(arguments,0))})}(),function(){function a(p){var e=p.sha256=p.sha256||{};p.md=p.md||{},p.md.algorithms=p.md.algorithms||{},p.md.sha256=p.md.algorithms.sha256=e,e.create=function(){t||function e(){f=String.fromCharCode(128),f+=p.util.fillString(String.fromCharCode(0),64),C=[1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298],t=!0}();var o=null,u=p.util.createBuffer(),c=new Array(64),l={algorithm:"sha256",blockLength:64,digestLength:32,messageLength:0,fullMessageLength:null,messageLengthSize:8,start:function(){l.messageLength=0,l.fullMessageLength=l.messageLength64=[];for(var e=l.messageLengthSize/4,t=0;t<e;++t)l.fullMessageLength.push(0);return u=p.util.createBuffer(),o={h0:1779033703,h1:3144134277,h2:1013904242,h3:2773480762,h4:1359893119,h5:2600822924,h6:528734635,h7:1541459225},l}};return l.start(),l.update=function(e,t){"utf8"===t&&(e=p.util.encodeUtf8(e));var r=e.length;l.messageLength+=r,r=[r/4294967296>>>0,r>>>0];for(var n=l.fullMessageLength.length-1;0<=n;--n)l.fullMessageLength[n]+=r[1],r[1]=r[0]+(l.fullMessageLength[n]/4294967296>>>0),l.fullMessageLength[n]=l.fullMessageLength[n]>>>0,r[0]=r[1]/4294967296>>>0;return u.putBytes(e),d(o,c,u),(2048<u.read||0===u.length())&&u.compact(),l},l.digest=function(){var e=p.util.createBuffer();e.putBytes(u.bytes());var t,r=l.fullMessageLength[l.fullMessageLength.length-1]+l.messageLengthSize&l.blockLength-1;e.putBytes(f.substr(0,l.blockLength-r));for(var n=8*l.fullMessageLength[0],a=0;a<l.fullMessageLength.length-1;++a)n+=(t=8*l.fullMessageLength[a+1])/4294967296>>>0,e.putInt32(n>>>0),n=t>>>0;e.putInt32(n);var i={h0:o.h0,h1:o.h1,h2:o.h2,h3:o.h3,h4:o.h4,h5:o.h5,h6:o.h6,h7:o.h7};d(i,c,e);var s=p.util.createBuffer();return s.putInt32(i.h0),s.putInt32(i.h1),s.putInt32(i.h2),s.putInt32(i.h3),s.putInt32(i.h4),s.putInt32(i.h5),s.putInt32(i.h6),s.putInt32(i.h7),s},l};var f=null,t=!1,C=null;function d(e,t,r){for(var n,a,i,s,o,u,c,l,p,f,d,h,y,g=r.length();64<=g;){for(o=0;o<16;++o)t[o]=r.getInt32();for(;o<64;++o)n=((n=t[o-2])>>>17|n<<15)^(n>>>19|n<<13)^n>>>10,a=((a=t[o-15])>>>7|a<<25)^(a>>>18|a<<14)^a>>>3,t[o]=n+t[o-7]+a+t[o-16]|0;for(u=e.h0,c=e.h1,l=e.h2,p=e.h3,f=e.h4,d=e.h5,h=e.h6,y=e.h7,o=0;o<64;++o)i=(u>>>2|u<<30)^(u>>>13|u<<19)^(u>>>22|u<<10),s=u&c|l&(u^c),n=y+((f>>>6|f<<26)^(f>>>11|f<<21)^(f>>>25|f<<7))+(h^f&(d^h))+C[o]+t[o],y=h,h=d,d=f,f=p+n>>>0,p=l,l=c,c=u,u=n+(a=i+s)>>>0;e.h0=e.h0+u|0,e.h1=e.h1+c|0,e.h2=e.h2+l|0,e.h3=e.h3+p|0,e.h4=e.h4+f|0,e.h5=e.h5+d|0,e.h6=e.h6+h|0,e.h7=e.h7+y|0,g-=64}}}var i,s="sha256";if("function"!=typeof define){if("object"!=typeof module||!module.exports)return"undefined"==typeof forge&&(forge={}),a(forge);var r=!0;define=function(e,t){t(require,module)}}var n=define;define=function(e,t){return i="string"==typeof e?t.slice(2):e.slice(2),r?(delete define,n.apply(null,Array.prototype.slice.call(arguments,0))):(define=n,define.apply(null,Array.prototype.slice.call(arguments,0)))},define(["require","module","./util"],function(){(function(n,e){e.exports=function(e){var t=i.map(function(e){return n(e)}).concat(a);if((e=e||{}).defined=e.defined||{},e.defined[s])return e[s];e.defined[s]=!0;for(var r=0;r<t.length;++r)t[r](e);return e[s]}}).apply(null,Array.prototype.slice.call(arguments,0))})}(),function(){function a(n){n.cipher=n.cipher||{},n.cipher.algorithms=n.cipher.algorithms||{},n.cipher.createCipher=function(e,t){var r=e;if("string"==typeof r&&(r=n.cipher.getAlgorithm(r))&&(r=r()),!r)throw new Error("Unsupported algorithm: "+e);return new n.cipher.BlockCipher({algorithm:r,key:t,decrypt:!1})},n.cipher.createDecipher=function(e,t){var r=e;if("string"==typeof r&&(r=n.cipher.getAlgorithm(r))&&(r=r()),!r)throw new Error("Unsupported algorithm: "+e);return new n.cipher.BlockCipher({algorithm:r,key:t,decrypt:!0})},n.cipher.registerAlgorithm=function(e,t){e=e.toUpperCase(),n.cipher.algorithms[e]=t},n.cipher.getAlgorithm=function(e){return(e=e.toUpperCase())in n.cipher.algorithms?n.cipher.algorithms[e]:null};var e=n.cipher.BlockCipher=function(e){this.algorithm=e.algorithm,this.mode=this.algorithm.mode,this.blockSize=this.mode.blockSize,this._finish=!1,this._input=null,this.output=null,this._op=e.decrypt?this.mode.decrypt:this.mode.encrypt,this._decrypt=e.decrypt,this.algorithm.initialize(e)};e.prototype.start=function(e){e=e||{};var t={};for(var r in e)t[r]=e[r];t.decrypt=this._decrypt,this._finish=!1,this._input=n.util.createBuffer(),this.output=e.output||n.util.createBuffer(),this.mode.start(t)},e.prototype.update=function(e){for(e&&this._input.putBuffer(e);!this._op.call(this.mode,this._input,this.output,this._finish)&&!this._finish;);this._input.compact()},e.prototype.finish=function(t){!t||"ECB"!==this.mode.name&&"CBC"!==this.mode.name||(this.mode.pad=function(e){return t(this.blockSize,e,!1)},this.mode.unpad=function(e){return t(this.blockSize,e,!0)});var e={};return e.decrypt=this._decrypt,e.overflow=this._input.length()%this.blockSize,!(!this._decrypt&&this.mode.pad&&!this.mode.pad(this._input,e))&&(this._finish=!0,this.update(),!(this._decrypt&&this.mode.unpad&&!this.mode.unpad(this.output,e))&&!(this.mode.afterFinish&&!this.mode.afterFinish(this.output,e)))}}var i,s="cipher";if("function"!=typeof define){if("object"!=typeof module||!module.exports)return"undefined"==typeof forge&&(forge={}),a(forge);var r=!0;define=function(e,t){t(require,module)}}var n=define;define=function(e,t){return i="string"==typeof e?t.slice(2):e.slice(2),r?(delete define,n.apply(null,Array.prototype.slice.call(arguments,0))):(define=n,define.apply(null,Array.prototype.slice.call(arguments,0)))},define(["require","module","./util"],function(){(function(n,e){e.exports=function(e){var t=i.map(function(e){return n(e)}).concat(a);if((e=e||{}).defined=e.defined||{},e.defined[s])return e[s];e.defined[s]=!0;for(var r=0;r<t.length;++r)t[r](e);return e[s]}}).apply(null,Array.prototype.slice.call(arguments,0))})}(),function(){function a(s){s.cipher=s.cipher||{};var e=s.cipher.modes=s.cipher.modes||{};function t(e){if("string"==typeof e&&(e=s.util.createBuffer(e)),s.util.isArray(e)&&4<e.length){var t=e;e=s.util.createBuffer();for(var r=0;r<t.length;++r)e.putByte(t[r])}return s.util.isArray(e)||(e=[e.getInt32(),e.getInt32(),e.getInt32(),e.getInt32()]),e}function o(e){e[e.length-1]=e[e.length-1]+1&4294967295}function u(e){return[e/4294967296|0,4294967295&e]}e.ecb=function(e){e=e||{},this.name="ECB",this.cipher=e.cipher,this.blockSize=e.blockSize||16,this._ints=this.blockSize/4,this._inBlock=new Array(this._ints),this._outBlock=new Array(this._ints)},e.ecb.prototype.start=function(e){},e.ecb.prototype.encrypt=function(e,t,r){if(e.length()<this.blockSize&&!(r&&0<e.length()))return!0;for(var n=0;n<this._ints;++n)this._inBlock[n]=e.getInt32();this.cipher.encrypt(this._inBlock,this._outBlock);for(n=0;n<this._ints;++n)t.putInt32(this._outBlock[n])},e.ecb.prototype.decrypt=function(e,t,r){if(e.length()<this.blockSize&&!(r&&0<e.length()))return!0;for(var n=0;n<this._ints;++n)this._inBlock[n]=e.getInt32();this.cipher.decrypt(this._inBlock,this._outBlock);for(n=0;n<this._ints;++n)t.putInt32(this._outBlock[n])},e.ecb.prototype.pad=function(e,t){var r=e.length()===this.blockSize?this.blockSize:this.blockSize-e.length();return e.fillWithByte(r,r),!0},e.ecb.prototype.unpad=function(e,t){if(0<t.overflow)return!1;var r=e.length(),n=e.at(r-1);return!(n>this.blockSize<<2)&&(e.truncate(n),!0)},e.cbc=function(e){e=e||{},this.name="CBC",this.cipher=e.cipher,this.blockSize=e.blockSize||16,this._ints=this.blockSize/4,this._inBlock=new Array(this._ints),this._outBlock=new Array(this._ints)},e.cbc.prototype.start=function(e){if(null===e.iv){if(!this._prev)throw new Error("Invalid IV parameter.");this._iv=this._prev.slice(0)}else{if(!("iv"in e))throw new Error("Invalid IV parameter.");this._iv=t(e.iv),this._prev=this._iv.slice(0)}},e.cbc.prototype.encrypt=function(e,t,r){if(e.length()<this.blockSize&&!(r&&0<e.length()))return!0;for(var n=0;n<this._ints;++n)this._inBlock[n]=this._prev[n]^e.getInt32();this.cipher.encrypt(this._inBlock,this._outBlock);for(n=0;n<this._ints;++n)t.putInt32(this._outBlock[n]);this._prev=this._outBlock},e.cbc.prototype.decrypt=function(e,t,r){if(e.length()<this.blockSize&&!(r&&0<e.length()))return!0;for(var n=0;n<this._ints;++n)this._inBlock[n]=e.getInt32();this.cipher.decrypt(this._inBlock,this._outBlock);for(n=0;n<this._ints;++n)t.putInt32(this._prev[n]^this._outBlock[n]);this._prev=this._inBlock.slice(0)},e.cbc.prototype.pad=function(e,t){var r=e.length()===this.blockSize?this.blockSize:this.blockSize-e.length();return e.fillWithByte(r,r),!0},e.cbc.prototype.unpad=function(e,t){if(0<t.overflow)return!1;var r=e.length(),n=e.at(r-1);return!(n>this.blockSize<<2)&&(e.truncate(n),!0)},e.cfb=function(e){e=e||{},this.name="CFB",this.cipher=e.cipher,this.blockSize=e.blockSize||16,this._ints=this.blockSize/4,this._inBlock=null,this._outBlock=new Array(this._ints),this._partialBlock=new Array(this._ints),this._partialOutput=s.util.createBuffer(),this._partialBytes=0},e.cfb.prototype.start=function(e){if(!("iv"in e))throw new Error("Invalid IV parameter.");this._iv=t(e.iv),this._inBlock=this._iv.slice(0),this._partialBytes=0},e.cfb.prototype.encrypt=function(e,t,r){var n=e.length();if(0===n)return!0;if(this.cipher.encrypt(this._inBlock,this._outBlock),0===this._partialBytes&&n>=this.blockSize)for(var a=0;a<this._ints;++a)this._inBlock[a]=e.getInt32()^this._outBlock[a],t.putInt32(this._inBlock[a]);else{var i=(this.blockSize-n)%this.blockSize;0<i&&(i=this.blockSize-i),this._partialOutput.clear();for(a=0;a<this._ints;++a)this._partialBlock[a]=e.getInt32()^this._outBlock[a],this._partialOutput.putInt32(this._partialBlock[a]);if(0<i)e.read-=this.blockSize;else for(a=0;a<this._ints;++a)this._inBlock[a]=this._partialBlock[a];if(0<this._partialBytes&&this._partialOutput.getBytes(this._partialBytes),0<i&&!r)return t.putBytes(this._partialOutput.getBytes(i-this._partialBytes)),this._partialBytes=i,!0;t.putBytes(this._partialOutput.getBytes(n-this._partialBytes)),this._partialBytes=0}},e.cfb.prototype.decrypt=function(e,t,r){var n=e.length();if(0===n)return!0;if(this.cipher.encrypt(this._inBlock,this._outBlock),0===this._partialBytes&&n>=this.blockSize)for(var a=0;a<this._ints;++a)this._inBlock[a]=e.getInt32(),t.putInt32(this._inBlock[a]^this._outBlock[a]);else{var i=(this.blockSize-n)%this.blockSize;0<i&&(i=this.blockSize-i),this._partialOutput.clear();for(a=0;a<this._ints;++a)this._partialBlock[a]=e.getInt32(),this._partialOutput.putInt32(this._partialBlock[a]^this._outBlock[a]);if(0<i)e.read-=this.blockSize;else for(a=0;a<this._ints;++a)this._inBlock[a]=this._partialBlock[a];if(0<this._partialBytes&&this._partialOutput.getBytes(this._partialBytes),0<i&&!r)return t.putBytes(this._partialOutput.getBytes(i-this._partialBytes)),this._partialBytes=i,!0;t.putBytes(this._partialOutput.getBytes(n-this._partialBytes)),this._partialBytes=0}},e.ofb=function(e){e=e||{},this.name="OFB",this.cipher=e.cipher,this.blockSize=e.blockSize||16,this._ints=this.blockSize/4,this._inBlock=null,this._outBlock=new Array(this._ints),this._partialOutput=s.util.createBuffer(),this._partialBytes=0},e.ofb.prototype.start=function(e){if(!("iv"in e))throw new Error("Invalid IV parameter.");this._iv=t(e.iv),this._inBlock=this._iv.slice(0),this._partialBytes=0},e.ofb.prototype.encrypt=function(e,t,r){var n=e.length();if(0===e.length())return!0;if(this.cipher.encrypt(this._inBlock,this._outBlock),0===this._partialBytes&&n>=this.blockSize)for(var a=0;a<this._ints;++a)t.putInt32(e.getInt32()^this._outBlock[a]),this._inBlock[a]=this._outBlock[a];else{var i=(this.blockSize-n)%this.blockSize;0<i&&(i=this.blockSize-i),this._partialOutput.clear();for(a=0;a<this._ints;++a)this._partialOutput.putInt32(e.getInt32()^this._outBlock[a]);if(0<i)e.read-=this.blockSize;else for(a=0;a<this._ints;++a)this._inBlock[a]=this._outBlock[a];if(0<this._partialBytes&&this._partialOutput.getBytes(this._partialBytes),0<i&&!r)return t.putBytes(this._partialOutput.getBytes(i-this._partialBytes)),this._partialBytes=i,!0;t.putBytes(this._partialOutput.getBytes(n-this._partialBytes)),this._partialBytes=0}},e.ofb.prototype.decrypt=e.ofb.prototype.encrypt,e.ctr=function(e){e=e||{},this.name="CTR",this.cipher=e.cipher,this.blockSize=e.blockSize||16,this._ints=this.blockSize/4,this._inBlock=null,this._outBlock=new Array(this._ints),this._partialOutput=s.util.createBuffer(),this._partialBytes=0},e.ctr.prototype.start=function(e){if(!("iv"in e))throw new Error("Invalid IV parameter.");this._iv=t(e.iv),this._inBlock=this._iv.slice(0),this._partialBytes=0},e.ctr.prototype.encrypt=function(e,t,r){var n=e.length();if(0===n)return!0;if(this.cipher.encrypt(this._inBlock,this._outBlock),0===this._partialBytes&&n>=this.blockSize)for(var a=0;a<this._ints;++a)t.putInt32(e.getInt32()^this._outBlock[a]);else{var i=(this.blockSize-n)%this.blockSize;0<i&&(i=this.blockSize-i),this._partialOutput.clear();for(a=0;a<this._ints;++a)this._partialOutput.putInt32(e.getInt32()^this._outBlock[a]);if(0<i&&(e.read-=this.blockSize),0<this._partialBytes&&this._partialOutput.getBytes(this._partialBytes),0<i&&!r)return t.putBytes(this._partialOutput.getBytes(i-this._partialBytes)),this._partialBytes=i,!0;t.putBytes(this._partialOutput.getBytes(n-this._partialBytes)),this._partialBytes=0}o(this._inBlock)},e.ctr.prototype.decrypt=e.ctr.prototype.encrypt,e.gcm=function(e){e=e||{},this.name="GCM",this.cipher=e.cipher,this.blockSize=e.blockSize||16,this._ints=this.blockSize/4,this._inBlock=new Array(this._ints),this._outBlock=new Array(this._ints),this._partialOutput=s.util.createBuffer(),this._partialBytes=0,this._R=3774873600},e.gcm.prototype.start=function(e){if(!("iv"in e))throw new Error("Invalid IV parameter.");var t,r=s.util.createBuffer(e.iv);if(this._cipherLength=0,t="additionalData"in e?s.util.createBuffer(e.additionalData):s.util.createBuffer(),this._tagLength="tagLength"in e?e.tagLength:128,this._tag=null,e.decrypt&&(this._tag=s.util.createBuffer(e.tag).getBytes(),this._tag.length!==this._tagLength/8))throw new Error("Authentication tag does not match tag length.");this._hashBlock=new Array(this._ints),this.tag=null,this._hashSubkey=new Array(this._ints),this.cipher.encrypt([0,0,0,0],this._hashSubkey),this.componentBits=4,this._m=this.generateHashTable(this._hashSubkey,this.componentBits);var n=r.length();if(12===n)this._j0=[r.getInt32(),r.getInt32(),r.getInt32(),1];else{for(this._j0=[0,0,0,0];0<r.length();)this._j0=this.ghash(this._hashSubkey,this._j0,[r.getInt32(),r.getInt32(),r.getInt32(),r.getInt32()]);this._j0=this.ghash(this._hashSubkey,this._j0,[0,0].concat(u(8*n)))}this._inBlock=this._j0.slice(0),o(this._inBlock),this._partialBytes=0,t=s.util.createBuffer(t),this._aDataLength=u(8*t.length());var a=t.length()%this.blockSize;for(a&&t.fillWithByte(0,this.blockSize-a),this._s=[0,0,0,0];0<t.length();)this._s=this.ghash(this._hashSubkey,this._s,[t.getInt32(),t.getInt32(),t.getInt32(),t.getInt32()])},e.gcm.prototype.encrypt=function(e,t,r){var n=e.length();if(0===n)return!0;if(this.cipher.encrypt(this._inBlock,this._outBlock),0===this._partialBytes&&n>=this.blockSize){for(var a=0;a<this._ints;++a)t.putInt32(this._outBlock[a]^=e.getInt32());this._cipherLength+=this.blockSize}else{var i=(this.blockSize-n)%this.blockSize;0<i&&(i=this.blockSize-i),this._partialOutput.clear();for(a=0;a<this._ints;++a)this._partialOutput.putInt32(e.getInt32()^this._outBlock[a]);if(0===i||r){if(r){var s=n%this.blockSize;this._cipherLength+=s,this._partialOutput.truncate(this.blockSize-s)}else this._cipherLength+=this.blockSize;for(a=0;a<this._ints;++a)this._outBlock[a]=this._partialOutput.getInt32();this._partialOutput.read-=this.blockSize}if(0<this._partialBytes&&this._partialOutput.getBytes(this._partialBytes),0<i&&!r)return e.read-=this.blockSize,t.putBytes(this._partialOutput.getBytes(i-this._partialBytes)),this._partialBytes=i,!0;t.putBytes(this._partialOutput.getBytes(n-this._partialBytes)),this._partialBytes=0}this._s=this.ghash(this._hashSubkey,this._s,this._outBlock),o(this._inBlock)},e.gcm.prototype.decrypt=function(e,t,r){var n=e.length();if(n<this.blockSize&&!(r&&0<n))return!0;this.cipher.encrypt(this._inBlock,this._outBlock),o(this._inBlock),this._hashBlock[0]=e.getInt32(),this._hashBlock[1]=e.getInt32(),this._hashBlock[2]=e.getInt32(),this._hashBlock[3]=e.getInt32(),this._s=this.ghash(this._hashSubkey,this._s,this._hashBlock);for(var a=0;a<this._ints;++a)t.putInt32(this._outBlock[a]^this._hashBlock[a]);n<this.blockSize?this._cipherLength+=n%this.blockSize:this._cipherLength+=this.blockSize},e.gcm.prototype.afterFinish=function(e,t){var r=!0;t.decrypt&&t.overflow&&e.truncate(this.blockSize-t.overflow),this.tag=s.util.createBuffer();var n=this._aDataLength.concat(u(8*this._cipherLength));this._s=this.ghash(this._hashSubkey,this._s,n);var a=[];this.cipher.encrypt(this._j0,a);for(var i=0;i<this._ints;++i)this.tag.putInt32(this._s[i]^a[i]);return this.tag.truncate(this.tag.length()%(this._tagLength/8)),t.decrypt&&this.tag.bytes()!==this._tag&&(r=!1),r},e.gcm.prototype.multiply=function(e,t){for(var r=[0,0,0,0],n=t.slice(0),a=0;a<128;++a){e[a/32|0]&1<<31-a%32&&(r[0]^=n[0],r[1]^=n[1],r[2]^=n[2],r[3]^=n[3]),this.pow(n,n)}return r},e.gcm.prototype.pow=function(e,t){for(var r=1&e[3],n=3;0<n;--n)t[n]=e[n]>>>1|(1&e[n-1])<<31;t[0]=e[0]>>>1,r&&(t[0]^=this._R)},e.gcm.prototype.tableMultiply=function(e){for(var t=[0,0,0,0],r=0;r<32;++r){var n=e[r/8|0]>>>4*(7-r%8)&15,a=this._m[r][n];t[0]^=a[0],t[1]^=a[1],t[2]^=a[2],t[3]^=a[3]}return t},e.gcm.prototype.ghash=function(e,t,r){return t[0]^=r[0],t[1]^=r[1],t[2]^=r[2],t[3]^=r[3],this.tableMultiply(t)},e.gcm.prototype.generateHashTable=function(e,t){for(var r=8/t,n=4*r,a=16*r,i=new Array(a),s=0;s<a;++s){var o=[0,0,0,0],u=(n-1-s%n)*t;o[s/n|0]=1<<t-1<<u,i[s]=this.generateSubHashTable(this.multiply(o,e),t)}return i},e.gcm.prototype.generateSubHashTable=function(e,t){var r=1<<t,n=r>>>1,a=new Array(r);a[n]=e.slice(0);for(var i=n>>>1;0<i;)this.pow(a[2*i],a[i]=[]),i>>=1;for(i=2;i<n;){for(var s=1;s<i;++s){var o=a[i],u=a[s];a[i+s]=[o[0]^u[0],o[1]^u[1],o[2]^u[2],o[3]^u[3]]}i*=2}for(a[0]=[0,0,0,0],i=n+1;i<r;++i){var c=a[i^n];a[i]=[e[0]^c[0],e[1]^c[1],e[2]^c[2],e[3]^c[3]]}return a}}var i,s="cipherModes";if("function"!=typeof define){if("object"!=typeof module||!module.exports)return"undefined"==typeof forge&&(forge={}),a(forge);var r=!0;define=function(e,t){t(require,module)}}var n=define;define=function(e,t){return i="string"==typeof e?t.slice(2):e.slice(2),r?(delete define,n.apply(null,Array.prototype.slice.call(arguments,0))):(define=n,define.apply(null,Array.prototype.slice.call(arguments,0)))},define(["require","module","./util"],function(){(function(n,e){e.exports=function(e){var t=i.map(function(e){return n(e)}).concat(a);if((e=e||{}).defined=e.defined||{},e.defined[s])return e[s];e.defined[s]=!0;for(var r=0;r<t.length;++r)t[r](e);return e[s]}}).apply(null,Array.prototype.slice.call(arguments,0))})}(),function(){function a(h){var u=[217,120,249,196,25,221,181,237,40,233,253,121,74,160,216,157,198,126,55,131,43,118,83,142,98,76,100,136,68,139,251,162,23,154,89,245,135,179,79,19,97,69,109,141,9,129,125,50,189,143,64,235,134,183,123,11,240,149,33,34,92,107,78,130,84,214,101,147,206,96,178,28,115,86,192,20,167,140,241,220,18,117,202,31,59,190,228,209,66,61,212,48,163,60,182,38,111,191,14,218,70,105,7,87,39,242,29,155,188,148,67,3,248,17,199,246,144,239,62,231,6,195,213,47,200,102,30,215,8,232,234,222,128,82,238,247,132,170,114,172,53,77,106,42,150,26,210,113,90,21,73,116,75,159,208,94,4,24,164,236,194,224,65,110,15,81,203,204,36,145,175,80,161,244,112,57,153,124,58,133,35,184,180,122,252,2,54,91,37,85,151,49,45,93,250,152,227,138,146,174,5,223,41,16,103,108,186,201,211,0,230,207,225,158,168,44,99,22,1,63,88,226,137,169,13,56,52,27,171,51,255,176,187,72,12,95,185,177,205,46,197,243,219,71,229,165,156,119,10,166,32,104,254,127,193,173],y=[1,2,3,5];h.rc2=h.rc2||{},h.rc2.expandKey=function(e,t){"string"==typeof e&&(e=h.util.createBuffer(e)),t=t||128;var r,n=e,a=e.length(),i=t,s=Math.ceil(i/8),o=255>>(7&i);for(r=a;r<128;r++)n.putByte(u[n.at(r-1)+n.at(r-a)&255]);for(n.setAt(128-s,u[n.at(128-s)&o]),r=127-s;0<=r;r--)n.setAt(r,u[n.at(r+1)^n.at(r+s)]);return n};var r=function(e,t,i){var r,n,s,o,u=!1,c=null,l=null,p=null,a=[];for(e=h.rc2.expandKey(e,t),s=0;s<64;s++)a.push(e.getInt16Le());i?(r=function(e){for(s=0;s<4;s++)e[s]+=a[o]+(e[(s+3)%4]&e[(s+2)%4])+(~e[(s+3)%4]&e[(s+1)%4]),e[s]=(t=e[s])<<(r=y[s])&65535|(65535&t)>>16-r,o++;var t,r},n=function(e){for(s=0;s<4;s++)e[s]+=a[63&e[(s+3)%4]]}):(r=function(e){for(s=3;0<=s;s--)e[s]=(65535&(t=e[s]))>>(r=y[s])|t<<16-r&65535,e[s]-=a[o]+(e[(s+3)%4]&e[(s+2)%4])+(~e[(s+3)%4]&e[(s+1)%4]),o--;var t,r},n=function(e){for(s=3;0<=s;s--)e[s]-=a[63&e[(s+3)%4]]});var f=function(e){var t=[];for(s=0;s<4;s++){var r=c.getInt16Le();null!==p&&(i?r^=p.getInt16Le():p.putInt16Le(r)),t.push(65535&r)}o=i?0:63;for(var n=0;n<e.length;n++)for(var a=0;a<e[n][0];a++)e[n][1](t);for(s=0;s<4;s++)null!==p&&(i?p.putInt16Le(t[s]):t[s]^=p.getInt16Le()),l.putInt16Le(t[s])},d=null;return d={start:function(e,t){e&&"string"==typeof e&&(e=h.util.createBuffer(e)),u=!1,c=h.util.createBuffer(),l=t||new h.util.createBuffer,p=e,d.output=l},update:function(e){for(u||c.putBuffer(e);8<=c.length();)f([[5,r],[1,n],[6,r],[1,n],[5,r]])},finish:function(e){var t=!0;if(i)if(e)t=e(8,c,!i);else{var r=8===c.length()?8:8-c.length();c.fillWithByte(r,r)}if(t&&(u=!0,d.update()),!i&&(t=0===c.length()))if(e)t=e(8,l,!i);else{var n=l.length(),a=l.at(n-1);n<a?t=!1:l.truncate(a)}return t}}};h.rc2.startEncrypting=function(e,t,r){var n=h.rc2.createEncryptionCipher(e,128);return n.start(t,r),n},h.rc2.createEncryptionCipher=function(e,t){return r(e,t,!0)},h.rc2.startDecrypting=function(e,t,r){var n=h.rc2.createDecryptionCipher(e,128);return n.start(t,r),n},h.rc2.createDecryptionCipher=function(e,t){return r(e,t,!1)}}var i;if("function"!=typeof define){if("object"!=typeof module||!module.exports)return"undefined"==typeof forge&&(forge={}),a(forge);var r=!0;define=function(e,t){t(require,module)}}var n=define;define=function(e,t){return i="string"==typeof e?t.slice(2):e.slice(2),r?(delete define,n.apply(null,Array.prototype.slice.call(arguments,0))):(define=n,define.apply(null,Array.prototype.slice.call(arguments,0)))},define(["require","module","./util"],function(){(function(n,e){e.exports=function(e){var t=i.map(function(e){return n(e)}).concat(a);if((e=e||{}).defined=e.defined||{},e.defined.rc2)return e.rc2;e.defined.rc2=!0;for(var r=0;r<t.length;++r)t[r](e);return e.rc2}}).apply(null,Array.prototype.slice.call(arguments,0))})}(),function(){function a(i){function e(e,t){i.cipher.registerAlgorithm(e,function(){return new i.des.Algorithm(e,t)})}i.des=i.des||{},i.des.startEncrypting=function(e,t,r,n){var a=s({key:e,output:r,decrypt:!1,mode:n||(null===t?"ECB":"CBC")});return a.start(t),a},i.des.createEncryptionCipher=function(e,t){return s({key:e,output:null,decrypt:!1,mode:t})},i.des.startDecrypting=function(e,t,r,n){var a=s({key:e,output:r,decrypt:!0,mode:n||(null===t?"ECB":"CBC")});return a.start(t),a},i.des.createDecryptionCipher=function(e,t){return s({key:e,output:null,decrypt:!0,mode:t})},i.des.Algorithm=function(e,t){var r=this;r.name=e,r.mode=new t({blockSize:8,cipher:{encrypt:function(e,t){return n(r._keys,e,t,!1)},decrypt:function(e,t){return n(r._keys,e,t,!0)}}}),r._init=!1},i.des.Algorithm.prototype.initialize=function(e){if(!this._init){var t=i.util.createBuffer(e.key);if(0===this.name.indexOf("3DES")&&24!==t.length())throw new Error("Invalid Triple-DES key size: "+8*t.length());this._keys=function b(e){for(var t,r=[0,4,536870912,536870916,65536,65540,536936448,536936452,512,516,536871424,536871428,66048,66052,536936960,536936964],n=[0,1,1048576,1048577,67108864,67108865,68157440,68157441,256,257,1048832,1048833,67109120,67109121,68157696,68157697],a=[0,8,2048,2056,16777216,16777224,16779264,16779272,0,8,2048,2056,16777216,16777224,16779264,16779272],i=[0,2097152,134217728,136314880,8192,2105344,134225920,136323072,131072,2228224,134348800,136445952,139264,2236416,134356992,136454144],s=[0,262144,16,262160,0,262144,16,262160,4096,266240,4112,266256,4096,266240,4112,266256],o=[0,1024,32,1056,0,1024,32,1056,33554432,33555456,33554464,33555488,33554432,33555456,33554464,33555488],u=[0,268435456,524288,268959744,2,268435458,524290,268959746,0,268435456,524288,268959744,2,268435458,524290,268959746],c=[0,65536,2048,67584,536870912,536936448,536872960,536938496,131072,196608,133120,198656,537001984,537067520,537004032,537069568],l=[0,262144,0,262144,2,262146,2,262146,33554432,33816576,33554432,33816576,33554434,33816578,33554434,33816578],p=[0,268435456,8,268435464,0,268435456,8,268435464,1024,268436480,1032,268436488,1024,268436480,1032,268436488],f=[0,32,0,32,1048576,1048608,1048576,1048608,8192,8224,8192,8224,1056768,1056800,1056768,1056800],d=[0,16777216,512,16777728,2097152,18874368,2097664,18874880,67108864,83886080,67109376,83886592,69206016,85983232,69206528,85983744],h=[0,4096,134217728,134221824,524288,528384,134742016,134746112,16,4112,134217744,134221840,524304,528400,134742032,134746128],y=[0,4,256,260,0,4,256,260,1,5,257,261,1,5,257,261],g=8<e.length()?3:1,C=[],m=[0,0,1,1,1,1,1,1,0,1,1,1,1,1,1,0],E=0,S=0;S<g;S++){var v=e.getInt32(),I=e.getInt32();v^=(t=252645135&(v>>>4^I))<<4,v^=t=65535&((I^=t)>>>-16^v),v^=(t=858993459&(v>>>2^(I^=t<<-16)))<<2,v^=t=65535&((I^=t)>>>-16^v),v^=(t=1431655765&(v>>>1^(I^=t<<-16)))<<1,v^=t=16711935&((I^=t)>>>8^v),t=(v^=(t=1431655765&(v>>>1^(I^=t<<8)))<<1)<<8|(I^=t)>>>20&240,v=I<<24|I<<8&16711680|I>>>8&65280|I>>>24&240,I=t;for(var T=0;T<m.length;++T){m[T]?(v=v<<2|v>>>26,I=I<<2|I>>>26):(v=v<<1|v>>>27,I=I<<1|I>>>27);var A=r[(v&=-15)>>>28]|n[v>>>24&15]|a[v>>>20&15]|i[v>>>16&15]|s[v>>>12&15]|o[v>>>8&15]|u[v>>>4&15],N=c[(I&=-15)>>>28]|l[I>>>24&15]|p[I>>>20&15]|f[I>>>16&15]|d[I>>>12&15]|h[I>>>8&15]|y[I>>>4&15];t=65535&(N>>>16^A),C[E++]=A^t,C[E++]=N^t<<16}}return C}(t),this._init=!0}},e("DES-ECB",i.cipher.modes.ecb),e("DES-CBC",i.cipher.modes.cbc),e("DES-CFB",i.cipher.modes.cfb),e("DES-OFB",i.cipher.modes.ofb),e("DES-CTR",i.cipher.modes.ctr),e("3DES-ECB",i.cipher.modes.ecb),e("3DES-CBC",i.cipher.modes.cbc),e("3DES-CFB",i.cipher.modes.cfb),e("3DES-OFB",i.cipher.modes.ofb),e("3DES-CTR",i.cipher.modes.ctr);var y=[16843776,0,65536,16843780,16842756,66564,4,65536,1024,16843776,16843780,1024,16778244,16842756,16777216,4,1028,16778240,16778240,66560,66560,16842752,16842752,16778244,65540,16777220,16777220,65540,0,1028,66564,16777216,65536,16843780,4,16842752,16843776,16777216,16777216,1024,16842756,65536,66560,16777220,1024,4,16778244,66564,16843780,65540,16842752,16778244,16777220,1028,66564,16843776,1028,16778240,16778240,0,65540,66560,0,16842756],g=[-2146402272,-2147450880,32768,1081376,1048576,32,-2146435040,-2147450848,-2147483616,-2146402272,-2146402304,-2147483648,-2147450880,1048576,32,-2146435040,1081344,1048608,-2147450848,0,-2147483648,32768,1081376,-2146435072,1048608,-2147483616,0,1081344,32800,-2146402304,-2146435072,32800,0,1081376,-2146435040,1048576,-2147450848,-2146435072,-2146402304,32768,-2146435072,-2147450880,32,-2146402272,1081376,32,32768,-2147483648,32800,-2146402304,1048576,-2147483616,1048608,-2147450848,-2147483616,1048608,1081344,0,-2147450880,32800,-2147483648,-2146435040,-2146402272,1081344],C=[520,134349312,0,134348808,134218240,0,131592,134218240,131080,134217736,134217736,131072,134349320,131080,134348800,520,134217728,8,134349312,512,131584,134348800,134348808,131592,134218248,131584,131072,134218248,8,134349320,512,134217728,134349312,134217728,131080,520,131072,134349312,134218240,0,512,131080,134349320,134218240,134217736,512,0,134348808,134218248,131072,134217728,134349320,8,131592,131584,134217736,134348800,134218248,520,134348800,131592,8,134348808,131584],m=[8396801,8321,8321,128,8396928,8388737,8388609,8193,0,8396800,8396800,8396929,129,0,8388736,8388609,1,8192,8388608,8396801,128,8388608,8193,8320,8388737,1,8320,8388736,8192,8396928,8396929,129,8388736,8388609,8396800,8396929,129,0,0,8396800,8320,8388736,8388737,1,8396801,8321,8321,128,8396929,129,1,8192,8388609,8193,8396928,8388737,8193,8320,8388608,8396801,128,8388608,8192,8396928],E=[256,34078976,34078720,1107296512,524288,256,1073741824,34078720,1074266368,524288,33554688,1074266368,1107296512,1107820544,524544,1073741824,33554432,1074266112,1074266112,0,1073742080,1107820800,1107820800,33554688,1107820544,1073742080,0,1107296256,34078976,33554432,1107296256,524544,524288,1107296512,256,33554432,1073741824,34078720,1107296512,1074266368,33554688,1073741824,1107820544,34078976,1074266368,256,33554432,1107820544,1107820800,524544,1107296256,1107820800,34078720,0,1074266112,1107296256,524544,33554688,1073742080,524288,0,1074266112,34078976,1073742080],S=[536870928,541065216,16384,541081616,541065216,16,541081616,4194304,536887296,4210704,4194304,536870928,4194320,536887296,536870912,16400,0,4194320,536887312,16384,4210688,536887312,16,541065232,541065232,0,4210704,541081600,16400,4210688,541081600,536870912,536887296,16,541065232,4210688,541081616,4194304,16400,536870928,4194304,536887296,536870912,16400,536870928,541081616,4210688,541065216,4210704,541081600,0,541065232,16,16384,541065216,4210704,16384,4194320,536887312,0,541081600,536870912,4194320,536887312],v=[2097152,69206018,67110914,0,2048,67110914,2099202,69208064,69208066,2097152,0,67108866,2,67108864,69206018,2050,67110912,2099202,2097154,67110912,67108866,69206016,69208064,2097154,69206016,2048,2050,69208066,2099200,2,67108864,2099200,67108864,2099200,2097152,67110914,67110914,69206018,69206018,2,2097154,67108864,67110912,2097152,69208064,2050,2099202,69208064,2050,67108866,69208066,69206016,2099200,0,2,69208066,0,2099202,69206016,2048,67108866,67110912,2048,2097154],I=[268439616,4096,262144,268701760,268435456,268439616,64,268435456,262208,268697600,268701760,266240,268701696,266304,4096,64,268697600,268435520,268439552,4160,266240,262208,268697664,268701696,4160,0,0,268697664,268435520,268439552,266304,262144,266304,262144,268701696,4096,64,268697664,4096,266304,268439552,64,268435520,268697600,268697664,268435456,262144,268439616,0,268701760,262208,268435520,268697600,268439552,268439616,0,268701760,266240,266240,4160,4160,262208,268435456,268701696];function n(e,t,r,n){var a,i,s=32===e.length?3:9;a=3===s?n?[30,-2,-2]:[0,32,2]:n?[94,62,-2,32,64,2,30,-2,-2]:[0,32,2,62,30,-2,64,96,2];var o=t[0],u=t[1];o^=(i=252645135&(o>>>4^u))<<4,o^=(i=65535&(o>>>16^(u^=i)))<<16,o^=i=858993459&((u^=i)>>>2^o),o^=i=16711935&((u^=i<<2)>>>8^o),o=(o^=(i=1431655765&(o>>>1^(u^=i<<8)))<<1)<<1|o>>>31,u=(u^=i)<<1|u>>>31;for(var c=0;c<s;c+=3){for(var l=a[c+1],p=a[c+2],f=a[c];f!=l;f+=p){var d=u^e[f],h=(u>>>4|u<<28)^e[f+1];i=o,o=u,u=i^(g[d>>>24&63]|m[d>>>16&63]|S[d>>>8&63]|I[63&d]|y[h>>>24&63]|C[h>>>16&63]|E[h>>>8&63]|v[63&h])}i=o,o=u,u=i}u=u>>>1|u<<31,u^=i=1431655765&((o=o>>>1|o<<31)>>>1^u),u^=(i=16711935&(u>>>8^(o^=i<<1)))<<8,u^=(i=858993459&(u>>>2^(o^=i)))<<2,u^=i=65535&((o^=i)>>>16^u),u^=i=252645135&((o^=i<<16)>>>4^u),o^=i<<4,r[0]=o,r[1]=u}function s(e){var n,t="DES-"+((e=e||{}).mode||"CBC").toUpperCase(),a=(n=e.decrypt?i.cipher.createDecipher(t,e.key):i.cipher.createCipher(t,e.key)).start;return n.start=function(e,t){var r=null;t instanceof i.util.ByteBuffer&&(r=t,t={}),(t=t||{}).output=r,t.iv=e,a.call(n,t)},n}}var i;if("function"!=typeof define){if("object"!=typeof module||!module.exports)return"undefined"==typeof forge&&(forge={}),a(forge);var r=!0;define=function(e,t){t(require,module)}}var n=define;define=function(e,t){return i="string"==typeof e?t.slice(2):e.slice(2),r?(delete define,n.apply(null,Array.prototype.slice.call(arguments,0))):(define=n,define.apply(null,Array.prototype.slice.call(arguments,0)))},define(["require","module","./cipher","./cipherModes","./util"],function(){(function(n,e){e.exports=function(e){var t=i.map(function(e){return n(e)}).concat(a);if((e=e||{}).defined=e.defined||{},e.defined.des)return e.des;e.defined.des=!0;for(var r=0;r<t.length;++r)t[r](e);return e.des}}).apply(null,Array.prototype.slice.call(arguments,0))})}(),function(){function a(o){function e(e,t){o.cipher.registerAlgorithm(e,function(){return new o.aes.Algorithm(e,t)})}o.aes=o.aes||{},o.aes.startEncrypting=function(e,t,r,n){var a=i({key:e,output:r,decrypt:!1,mode:n});return a.start(t),a},o.aes.createEncryptionCipher=function(e,t){return i({key:e,output:null,decrypt:!1,mode:t})},o.aes.startDecrypting=function(e,t,r,n){var a=i({key:e,output:r,decrypt:!0,mode:n});return a.start(t),a},o.aes.createDecryptionCipher=function(e,t){return i({key:e,output:null,decrypt:!0,mode:t})},o.aes.Algorithm=function(e,t){f||n();var r=this;r.name=e,r.mode=new t({blockSize:16,cipher:{encrypt:function(e,t){return a(r._w,e,t,!1)},decrypt:function(e,t){return a(r._w,e,t,!0)}}}),r._init=!1},o.aes.Algorithm.prototype.initialize=function(e){if(!this._init){var t,r=e.key;if("string"!=typeof r||16!==r.length&&24!==r.length&&32!==r.length){if(o.util.isArray(r)&&(16===r.length||24===r.length||32===r.length)){t=r,r=o.util.createBuffer();for(var n=0;n<t.length;++n)r.putByte(t[n])}}else r=o.util.createBuffer(r);if(!o.util.isArray(r)){t=r,r=[];var a=t.length();if(16===a||24===a||32===a){a>>>=2;for(n=0;n<a;++n)r.push(t.getInt32())}}if(!o.util.isArray(r)||4!==r.length&&6!==r.length&&8!==r.length)throw new Error("Invalid key parameter.");var i=this.mode.name,s=-1!==["CFB","OFB","CTR","GCM"].indexOf(i);this._w=u(r,e.decrypt&&!s),this._init=!0}},o.aes._expandKey=function(e,t){return f||n(),u(e,t)},o.aes._updateBlock=a,e("AES-ECB",o.cipher.modes.ecb),e("AES-CBC",o.cipher.modes.cbc),e("AES-CFB",o.cipher.modes.cfb),e("AES-OFB",o.cipher.modes.ofb),e("AES-CTR",o.cipher.modes.ctr),e("AES-GCM",o.cipher.modes.gcm);var E,S,g,v,I,f=!1,C=4;function n(){f=!0,g=[0,1,2,4,8,16,32,64,128,27,54];for(var e=new Array(256),t=0;t<128;++t)e[t]=t<<1,e[t+128]=t+128<<1^283;E=new Array(256),S=new Array(256),v=new Array(4),I=new Array(4);for(t=0;t<4;++t)v[t]=new Array(256),I[t]=new Array(256);var r,n,a,i,s,o,u,c=0,l=0;for(t=0;t<256;++t){i=(i=l^l<<1^l<<2^l<<3^l<<4)>>8^255&i^99,E[c]=i,S[i]=c,o=(s=e[i])<<24^i<<16^i<<8^i^s,u=((r=e[c])^(n=e[r])^(a=e[n]))<<24^(c^a)<<16^(c^n^a)<<8^c^r^a;for(var p=0;p<4;++p)o=(v[p][c]=o)<<24|o>>>8,u=(I[p][i]=u)<<24|u>>>8;0===c?c=l=1:(c=r^e[e[e[r^a]]],l^=e[e[l]])}}function u(e,t){for(var r,n=e.slice(0),a=1,i=n.length,s=C*(i+6+1),o=i;o<s;++o)r=n[o-1],o%i==0?(r=E[r>>>16&255]<<24^E[r>>>8&255]<<16^E[255&r]<<8^E[r>>>24]^g[a]<<24,a++):6<i&&o%i==4&&(r=E[r>>>24]<<24^E[r>>>16&255]<<16^E[r>>>8&255]<<8^E[255&r]),n[o]=n[o-i]^r;if(t){for(var u,c=I[0],l=I[1],p=I[2],f=I[3],d=n.slice(0),h=(o=0,(s=n.length)-C);o<s;o+=C,h-=C)if(0===o||o===s-C)d[o]=n[h],d[o+1]=n[h+3],d[o+2]=n[h+2],d[o+3]=n[h+1];else for(var y=0;y<C;++y)u=n[h+y],d[o+(3&-y)]=c[E[u>>>24]]^l[E[u>>>16&255]]^p[E[u>>>8&255]]^f[E[255&u]];n=d}return n}function a(e,t,r,n){var a,i,s,o,u,c,l,p,f,d,h,y,g=e.length/4-1;n?(a=I[0],i=I[1],s=I[2],o=I[3],u=S):(a=v[0],i=v[1],s=v[2],o=v[3],u=E),c=t[0]^e[0],l=t[n?3:1]^e[1],p=t[2]^e[2],f=t[n?1:3]^e[3];for(var C=3,m=1;m<g;++m)d=a[c>>>24]^i[l>>>16&255]^s[p>>>8&255]^o[255&f]^e[++C],h=a[l>>>24]^i[p>>>16&255]^s[f>>>8&255]^o[255&c]^e[++C],y=a[p>>>24]^i[f>>>16&255]^s[c>>>8&255]^o[255&l]^e[++C],f=a[f>>>24]^i[c>>>16&255]^s[l>>>8&255]^o[255&p]^e[++C],c=d,l=h,p=y;r[0]=u[c>>>24]<<24^u[l>>>16&255]<<16^u[p>>>8&255]<<8^u[255&f]^e[++C],r[n?3:1]=u[l>>>24]<<24^u[p>>>16&255]<<16^u[f>>>8&255]<<8^u[255&c]^e[++C],r[2]=u[p>>>24]<<24^u[f>>>16&255]<<16^u[c>>>8&255]<<8^u[255&l]^e[++C],r[n?1:3]=u[f>>>24]<<24^u[c>>>16&255]<<16^u[l>>>8&255]<<8^u[255&p]^e[++C]}function i(e){var n,t="AES-"+((e=e||{}).mode||"CBC").toUpperCase(),a=(n=e.decrypt?o.cipher.createDecipher(t,e.key):o.cipher.createCipher(t,e.key)).start;return n.start=function(e,t){var r=null;t instanceof o.util.ByteBuffer&&(r=t,t={}),(t=t||{}).output=r,t.iv=e,a.call(n,t)},n}}var i;if("function"!=typeof define){if("object"!=typeof module||!module.exports)return"undefined"==typeof forge&&(forge={}),a(forge);var r=!0;define=function(e,t){t(require,module)}}var n=define;define=function(e,t){return i="string"==typeof e?t.slice(2):e.slice(2),r?(delete define,n.apply(null,Array.prototype.slice.call(arguments,0))):(define=n,define.apply(null,Array.prototype.slice.call(arguments,0)))},define(["require","module","./cipher","./cipherModes","./util"],function(){(function(n,e){e.exports=function(e){var t=i.map(function(e){return n(e)}).concat(a);if((e=e||{}).defined=e.defined||{},e.defined.aes)return e.aes;e.defined.aes=!0;for(var r=0;r<t.length;++r)t[r](e);return e.aes}}).apply(null,Array.prototype.slice.call(arguments,0))})}(),function(){function a(f){var e="undefined"!=typeof process&&process.versions&&process.versions.node,i=null;f.disableNativeCode||!e||process.versions["node-webkit"]||(i=require("crypto")),(f.prng=f.prng||{}).create=function(e){for(var l={plugin:e,key:null,seed:null,time:null,reseeds:0,generated:0},t=e.md,r=new Array(32),n=0;n<32;++n)r[n]=t.create();function o(){if(32<=l.pools[0].messageLength)return p();var e=32-l.pools[0].messageLength<<5;l.collect(l.seedFileSync(e)),p()}function p(){var e=l.plugin.md.create();e.update(l.pools[0].digest().getBytes()),l.pools[0].start();for(var t=1,r=1;r<32;++r)(t=31===t?2147483648:t<<2)%l.reseeds==0&&(e.update(l.pools[r].digest().getBytes()),l.pools[r].start());var n=e.digest().getBytes();e.start(),e.update(n);var a=e.digest().getBytes();l.key=l.plugin.formatKey(n),l.seed=l.plugin.formatSeed(a),l.reseeds=4294967295===l.reseeds?0:l.reseeds+1,l.generated=0}function a(e){var t=null;if("undefined"!=typeof window){var r=window.crypto||window.msCrypto;r&&r.getRandomValues&&(t=function(e){return r.getRandomValues(e)})}var n=f.util.createBuffer();if(t)for(;n.length()<e;){var a=Math.max(1,Math.min(e-n.length(),65536)/4),i=new Uint32Array(Math.floor(a));try{t(i);for(var s=0;s<i.length;++s)n.putInt32(i[s])}catch(p){if(!("undefined"!=typeof QuotaExceededError&&p instanceof QuotaExceededError))throw p}}if(n.length()<e)for(var o,u,c,l=Math.floor(65536*Math.random());n.length()<e;){u=16807*(65535&l),u+=(32767&(o=16807*(l>>16)))<<16,l=4294967295&(u=(2147483647&(u+=o>>15))+(u>>31));for(s=0;s<3;++s)c=l>>>(s<<3),c^=Math.floor(256*Math.random()),n.putByte(String.fromCharCode(255&c))}return n.getBytes(e)}return l.pools=r,l.pool=0,l.generate=function(r,n){if(!n)return l.generateSync(r);var a=l.plugin.cipher,i=l.plugin.increment,s=l.plugin.formatKey,o=l.plugin.formatSeed,u=f.util.createBuffer();l.key=null,function c(e){if(e)return n(e);if(u.length()>=r)return n(null,u.getBytes(r));1048575<l.generated&&(l.key=null);if(null===l.key)return f.util.nextTick(function(){!function t(r){if(32<=l.pools[0].messageLength)return p(),r();var e=32-l.pools[0].messageLength<<5;l.seedFile(e,function(e,t){if(e)return r(e);l.collect(t),p(),r()})}(c)});var t=a(l.key,l.seed);l.generated+=t.length;u.putBytes(t);l.key=s(a(l.key,i(l.seed)));l.seed=o(a(l.key,l.seed));f.util.setImmediate(c)}()},l.generateSync=function(e){var t=l.plugin.cipher,r=l.plugin.increment,n=l.plugin.formatKey,a=l.plugin.formatSeed;l.key=null;for(var i=f.util.createBuffer();i.length()<e;){1048575<l.generated&&(l.key=null),null===l.key&&o();var s=t(l.key,l.seed);l.generated+=s.length,i.putBytes(s),l.key=n(t(l.key,r(l.seed))),l.seed=a(t(l.key,l.seed))}return i.getBytes(e)},i?(l.seedFile=function(e,r){i.randomBytes(e,function(e,t){if(e)return r(e);r(null,t.toString())})},l.seedFileSync=function(e){return i.randomBytes(e).toString()}):(l.seedFile=function(e,t){try{t(null,a(e))}catch(r){t(r)}},l.seedFileSync=a),l.collect=function(e){for(var t=e.length,r=0;r<t;++r)l.pools[l.pool].update(e.substr(r,1)),l.pool=31===l.pool?0:l.pool+1},l.collectInt=function(e,t){for(var r="",n=0;n<t;n+=8)r+=String.fromCharCode(e>>n&255);l.collect(r)},l.registerWorker=function(r){if(r===self)l.seedFile=function(e,r){self.addEventListener("message",function n(e){var t=e.data;t.forge&&t.forge.prng&&(self.removeEventListener("message",n),r(t.forge.prng.err,t.forge.prng.bytes))}),self.postMessage({forge:{prng:{needed:e}}})};else{r.addEventListener("message",function(e){var t=e.data;t.forge&&t.forge.prng&&l.seedFile(t.forge.prng.needed,function(e,t){r.postMessage({forge:{prng:{err:e,bytes:t}}})})})}},l}}var i,s="prng";if("function"!=typeof define){if("object"!=typeof module||!module.exports)return"undefined"==typeof forge&&(forge={}),a(forge);var r=!0;define=function(e,t){t(require,module)}}var n=define;define=function(e,t){return i="string"==typeof e?t.slice(2):e.slice(2),r?(delete define,n.apply(null,Array.prototype.slice.call(arguments,0))):(define=n,define.apply(null,Array.prototype.slice.call(arguments,0)))},define(["require","module","./md","./util"],function(){(function(n,e){e.exports=function(e){var t=i.map(function(e){return n(e)}).concat(a);if((e=e||{}).defined=e.defined||{},e.defined[s])return e[s];e.defined[s]=!0;for(var r=0;r<t.length;++r)t[r](e);return e[s]}}).apply(null,Array.prototype.slice.call(arguments,0))})}(),function(){function a(f){f.random&&f.random.getBytes||function(e){var t={},r=new Array(4),n=f.util.createBuffer();function a(){var r=f.prng.create(t);return r.getBytes=function(e,t){return r.generate(e,t)},r.getBytesSync=function(e){return r.generate(e)},r}t.formatKey=function(e){var t=f.util.createBuffer(e);return(e=new Array(4))[0]=t.getInt32(),e[1]=t.getInt32(),e[2]=t.getInt32(),e[3]=t.getInt32(),f.aes._expandKey(e,!1)},t.formatSeed=function(e){var t=f.util.createBuffer(e);return(e=new Array(4))[0]=t.getInt32(),e[1]=t.getInt32(),e[2]=t.getInt32(),e[3]=t.getInt32(),e},t.cipher=function(e,t){return f.aes._updateBlock(e,t,r,!1),n.putInt32(r[0]),n.putInt32(r[1]),n.putInt32(r[2]),n.putInt32(r[3]),n.getBytes()},t.increment=function(e){return++e[3],e},t.md=f.md.sha256;var i=a(),s="undefined"!=typeof process&&process.versions&&process.versions.node,o=null;if("undefined"!=typeof window){var u=window.crypto||window.msCrypto;u&&u.getRandomValues&&(o=function(e){return u.getRandomValues(e)})}if(f.disableNativeCode||!s&&!o){if("undefined"==typeof window||(window.document,undefined),i.collectInt(+new Date,32),"undefined"!=typeof navigator){var c="";for(var l in navigator)try{"string"==typeof navigator[l]&&(c+=navigator[l])}catch(p){}i.collect(c),c=null}e&&(e().mousemove(function(e){i.collectInt(e.clientX,16),i.collectInt(e.clientY,16)}),e().keypress(function(e){i.collectInt(e.charCode,8)}))}if(f.random)for(var l in i)f.random[l]=i[l];else f.random=i;f.random.createInstance=a}("undefined"!=typeof jQuery?jQuery:null)}var i,s="random";if("function"!=typeof define){if("object"!=typeof module||!module.exports)return"undefined"==typeof forge&&(forge={}),a(forge);var r=!0;define=function(e,t){t(require,module)}}var n=define;define=function(e,t){return i="string"==typeof e?t.slice(2):e.slice(2),r?(delete define,n.apply(null,Array.prototype.slice.call(arguments,0))):(define=n,define.apply(null,Array.prototype.slice.call(arguments,0)))},define(["require","module","./aes","./md","./prng","./util"],function(){(function(n,e){e.exports=function(e){var t=i.map(function(e){return n(e)}).concat(a);if((e=e||{}).defined=e.defined||{},e.defined[s])return e[s];e.defined[s]=!0;for(var r=0;r<t.length;++r)t[r](e);return e[s]}}).apply(null,Array.prototype.slice.call(arguments,0))})}(),function(){function a(e){var t;function E(e,t,r){this.data=[],null!=e&&("number"==typeof e?this.fromNumber(e,t,r):null==t&&"string"!=typeof e?this.fromString(e,256):this.fromString(e,t))}function S(){return new E(null)}function r(e,t,r,n,a,i){for(var s=16383&t,o=t>>14;0<=--i;){var u=16383&this.data[e],c=this.data[e++]>>14,l=o*u+c*s;a=((u=s*u+((16383&l)<<14)+r.data[n]+a)>>28)+(l>>14)+o*c,r.data[n++]=268435455&u}return a}"undefined"==typeof navigator?(E.prototype.am=r,t=28):"Microsoft Internet Explorer"==navigator.appName?(E.prototype.am=function b(e,t,r,n,a,i){for(var s=32767&t,o=t>>15;0<=--i;){var u=32767&this.data[e],c=this.data[e++]>>15,l=o*u+c*s;a=((u=s*u+((32767&l)<<15)+r.data[n]+(1073741823&a))>>>30)+(l>>>15)+o*c+(a>>>30),r.data[n++]=1073741823&u}return a},t=30):"Netscape"!=navigator.appName?(E.prototype.am=function B(e,t,r,n,a,i){for(;0<=--i;){var s=t*this.data[e++]+r.data[n]+a;a=Math.floor(s/67108864),r.data[n++]=67108863&s}return a},t=26):(E.prototype.am=r,t=28),E.prototype.DB=t,E.prototype.DM=(1<<t)-1,E.prototype.DV=1<<t;E.prototype.FV=Math.pow(2,52),E.prototype.F1=52-t,E.prototype.F2=2*t-52;var n,a,i="0123456789abcdefghijklmnopqrstuvwxyz",s=new Array;for(n="0".charCodeAt(0),a=0;a<=9;++a)s[n++]=a;for(n="a".charCodeAt(0),a=10;a<36;++a)s[n++]=a;for(n="A".charCodeAt(0),a=10;a<36;++a)s[n++]=a;function u(e){return i.charAt(e)}function c(e,t){var r=s[e.charCodeAt(t)];return null==r?-1:r}function g(e){var t=S();return t.fromInt(e),t}function v(e){var t,r=1;return 0!=(t=e>>>16)&&(e=t,r+=16),0!=(t=e>>8)&&(e=t,r+=8),0!=(t=e>>4)&&(e=t,r+=4),0!=(t=e>>2)&&(e=t,r+=2),0!=(t=e>>1)&&(e=t,r+=1),r}function C(e){this.m=e}function m(e){this.m=e,this.mp=e.invDigit(),this.mpl=32767&this.mp,this.mph=this.mp>>15,this.um=(1<<e.DB-15)-1,this.mt2=2*e.t}function o(e,t){return e&t}function l(e,t){return e|t}function p(e,t){return e^t}function f(e,t){return e&~t}function d(e){if(0==e)return-1;var t=0;return 0==(65535&e)&&(e>>=16,t+=16),0==(255&e)&&(e>>=8,t+=8),0==(15&e)&&(e>>=4,t+=4),0==(3&e)&&(e>>=2,t+=2),0==(1&e)&&++t,t}function h(e){for(var t=0;0!=e;)e&=e-1,++t;return t}function y(){}function I(e){return e}function T(e){this.r2=S(),this.q3=S(),E.ONE.dlShiftTo(2*e.t,this.r2),this.mu=this.r2.divide(e),this.m=e}C.prototype.convert=function R(e){return e.s<0||0<=e.compareTo(this.m)?e.mod(this.m):e},C.prototype.revert=function U(e){return e},C.prototype.reduce=function L(e){e.divRemTo(this.m,null,e)},C.prototype.mulTo=function w(e,t,r){e.multiplyTo(t,r),this.reduce(r)},C.prototype.sqrTo=function P(e,t){e.squareTo(t),this.reduce(t)},m.prototype.convert=function D(e){var t=S();return e.abs().dlShiftTo(this.m.t,t),t.divRemTo(this.m,null,t),e.s<0&&0<t.compareTo(E.ZERO)&&this.m.subTo(t,t),t},m.prototype.revert=function k(e){var t=S();return e.copyTo(t),this.reduce(t),t},m.prototype.reduce=function O(e){for(;e.t<=this.mt2;)e.data[e.t++]=0;for(var t=0;t<this.m.t;++t){var r=32767&e.data[t],n=r*this.mpl+((r*this.mph+(e.data[t]>>15)*this.mpl&this.um)<<15)&e.DM;for(r=t+this.m.t,e.data[r]+=this.m.am(0,n,e,t,0,this.m.t);e.data[r]>=e.DV;)e.data[r]-=e.DV,e.data[++r]++}e.clamp(),e.drShiftTo(this.m.t,e),0<=e.compareTo(this.m)&&e.subTo(this.m,e)},m.prototype.mulTo=function V(e,t,r){e.multiplyTo(t,r),this.reduce(r)},m.prototype.sqrTo=function K(e,t){e.squareTo(t),this.reduce(t)},E.prototype.copyTo=function _(e){for(var t=this.t-1;0<=t;--t)e.data[t]=this.data[t];e.t=this.t,e.s=this.s},E.prototype.fromInt=function x(e){this.t=1,this.s=e<0?-1:0,0<e?this.data[0]=e:e<-1?this.data[0]=e+this.DV:this.t=0},E.prototype.fromString=function G(e,t){var r;if(16==t)r=4;else if(8==t)r=3;else if(256==t)r=8;else if(2==t)r=1;else if(32==t)r=5;else{if(4!=t)return void this.fromRadix(e,t);r=2}this.t=0,this.s=0;for(var n=e.length,a=!1,i=0;0<=--n;){var s=8==r?255&e[n]:c(e,n);s<0?"-"==e.charAt(n)&&(a=!0):(a=!1,0==i?this.data[this.t++]=s:i+r>this.DB?(this.data[this.t-1]|=(s&(1<<this.DB-i)-1)<<i,this.data[this.t++]=s>>this.DB-i):this.data[this.t-1]|=s<<i,(i+=r)>=this.DB&&(i-=this.DB))}8==r&&0!=(128&e[0])&&(this.s=-1,0<i&&(this.data[this.t-1]|=(1<<this.DB-i)-1<<i)),this.clamp(),a&&E.ZERO.subTo(this,this)},E.prototype.clamp=function M(){for(var e=this.s&this.DM;0<this.t&&this.data[this.t-1]==e;)--this.t},E.prototype.dlShiftTo=function F(e,t){var r;for(r=this.t-1;0<=r;--r)t.data[r+e]=this.data[r];for(r=e-1;0<=r;--r)t.data[r]=0;t.t=this.t+e,t.s=this.s},E.prototype.drShiftTo=function q(e,t){for(var r=e;r<this.t;++r)t.data[r-e]=this.data[r];t.t=Math.max(this.t-e,0),t.s=this.s},E.prototype.lShiftTo=function j(e,t){var r,n=e%this.DB,a=this.DB-n,i=(1<<a)-1,s=Math.floor(e/this.DB),o=this.s<<n&this.DM;for(r=this.t-1;0<=r;--r)t.data[r+s+1]=this.data[r]>>a|o,o=(this.data[r]&i)<<n;for(r=s-1;0<=r;--r)t.data[r]=0;t.data[s]=o,t.t=this.t+s+1,t.s=this.s,t.clamp()},E.prototype.rShiftTo=function Q(e,t){t.s=this.s;var r=Math.floor(e/this.DB);if(r>=this.t)t.t=0;else{var n=e%this.DB,a=this.DB-n,i=(1<<n)-1;t.data[0]=this.data[r]>>n;for(var s=r+1;s<this.t;++s)t.data[s-r-1]|=(this.data[s]&i)<<a,t.data[s-r]=this.data[s]>>n;0<n&&(t.data[this.t-r-1]|=(this.s&i)<<a),t.t=this.t-r,t.clamp()}},E.prototype.subTo=function z(e,t){for(var r=0,n=0,a=Math.min(e.t,this.t);r<a;)n+=this.data[r]-e.data[r],t.data[r++]=n&this.DM,n>>=this.DB;if(e.t<this.t){for(n-=e.s;r<this.t;)n+=this.data[r],t.data[r++]=n&this.DM,n>>=this.DB;n+=this.s}else{for(n+=this.s;r<e.t;)n-=e.data[r],t.data[r++]=n&this.DM,n>>=this.DB;n-=e.s}t.s=n<0?-1:0,n<-1?t.data[r++]=this.DV+n:0<n&&(t.data[r++]=n),t.t=r,t.clamp()},E.prototype.multiplyTo=function H(e,t){var r=this.abs(),n=e.abs(),a=r.t;for(t.t=a+n.t;0<=--a;)t.data[a]=0;for(a=0;a<n.t;++a)t.data[a+r.t]=r.am(0,n.data[a],t,a,0,r.t);t.s=0,t.clamp(),this.s!=e.s&&E.ZERO.subTo(t,t)},E.prototype.squareTo=function W(e){for(var t=this.abs(),r=e.t=2*t.t;0<=--r;)e.data[r]=0;for(r=0;r<t.t-1;++r){var n=t.am(r,t.data[r],e,2*r,0,1);(e.data[r+t.t]+=t.am(r+1,2*t.data[r],e,2*r+1,n,t.t-r-1))>=t.DV&&(e.data[r+t.t]-=t.DV,e.data[r+t.t+1]=1)}0<e.t&&(e.data[e.t-1]+=t.am(r,t.data[r],e,2*r,0,1)),e.s=0,e.clamp()},E.prototype.divRemTo=function J(e,t,r){var n=e.abs();if(!(n.t<=0)){var a=this.abs();if(a.t<n.t)return null!=t&&t.fromInt(0),void(null!=r&&this.copyTo(r));null==r&&(r=S());var i=S(),s=this.s,o=e.s,u=this.DB-v(n.data[n.t-1]);0<u?(n.lShiftTo(u,i),a.lShiftTo(u,r)):(n.copyTo(i),a.copyTo(r));var c=i.t,l=i.data[c-1];if(0!=l){var p=l*(1<<this.F1)+(1<c?i.data[c-2]>>this.F2:0),f=this.FV/p,d=(1<<this.F1)/p,h=1<<this.F2,y=r.t,g=y-c,C=null==t?S():t;for(i.dlShiftTo(g,C),0<=r.compareTo(C)&&(r.data[r.t++]=1,r.subTo(C,r)),E.ONE.dlShiftTo(c,C),C.subTo(i,i);i.t<c;)i.data[i.t++]=0;for(;0<=--g;){var m=r.data[--y]==l?this.DM:Math.floor(r.data[y]*f+(r.data[y-1]+h)*d);if((r.data[y]+=i.am(0,m,r,g,0,c))<m)for(i.dlShiftTo(g,C),r.subTo(C,r);r.data[y]<--m;)r.subTo(C,r)}null!=t&&(r.drShiftTo(c,t),s!=o&&E.ZERO.subTo(t,t)),r.t=c,r.clamp(),0<u&&r.rShiftTo(u,r),s<0&&E.ZERO.subTo(r,r)}}},E.prototype.invDigit=function X(){if(this.t<1)return 0;var e=this.data[0];if(0==(1&e))return 0;var t=3&e;return 0<(t=(t=(t=(t=t*(2-(15&e)*t)&15)*(2-(255&e)*t)&255)*(2-((65535&e)*t&65535))&65535)*(2-e*t%this.DV)%this.DV)?this.DV-t:-t},E.prototype.isEven=function Y(){return 0==(0<this.t?1&this.data[0]:this.s)},E.prototype.exp=function Z(e,t){if(4294967295<e||e<1)return E.ONE;var r=S(),n=S(),a=t.convert(this),i=v(e)-1;for(a.copyTo(r);0<=--i;)if(t.sqrTo(r,n),0<(e&1<<i))t.mulTo(n,a,r);else{var s=r;r=n,n=s}return t.revert(r)},E.prototype.toString=function $(e){if(this.s<0)return"-"+this.negate().toString(e);var t;if(16==e)t=4;else if(8==e)t=3;else if(2==e)t=1;else if(32==e)t=5;else{if(4!=e)return this.toRadix(e);t=2}var r,n=(1<<t)-1,a=!1,i="",s=this.t,o=this.DB-s*this.DB%t;if(0<s--)for(o<this.DB&&0<(r=this.data[s]>>o)&&(a=!0,i=u(r));0<=s;)o<t?(r=(this.data[s]&(1<<o)-1)<<t-o,r|=this.data[--s]>>(o+=this.DB-t)):(r=this.data[s]>>(o-=t)&n,o<=0&&(o+=this.DB,--s)),0<r&&(a=!0),a&&(i+=u(r));return a?i:"0"},E.prototype.negate=function ee(){var e=S();return E.ZERO.subTo(this,e),e},E.prototype.abs=function te(){return this.s<0?this.negate():this},E.prototype.compareTo=function re(e){var t=this.s-e.s;if(0!=t)return t;var r=this.t;if(0!=(t=r-e.t))return this.s<0?-t:t;for(;0<=--r;)if(0!=(t=this.data[r]-e.data[r]))return t;return 0},E.prototype.bitLength=function ne(){return this.t<=0?0:this.DB*(this.t-1)+v(this.data[this.t-1]^this.s&this.DM)},E.prototype.mod=function ae(e){var t=S();return this.abs().divRemTo(e,null,t),this.s<0&&0<t.compareTo(E.ZERO)&&e.subTo(t,t),t},E.prototype.modPowInt=function ie(e,t){var r;return r=e<256||t.isEven()?new C(t):new m(t),this.exp(e,r)},E.ZERO=g(0),E.ONE=g(1),y.prototype.convert=I,y.prototype.revert=I,y.prototype.mulTo=function se(e,t,r){e.multiplyTo(t,r)},y.prototype.sqrTo=function oe(e,t){e.squareTo(t)},T.prototype.convert=function ue(e){if(e.s<0||e.t>2*this.m.t)return e.mod(this.m);if(e.compareTo(this.m)<0)return e;var t=S();return e.copyTo(t),this.reduce(t),t},T.prototype.revert=function ce(e){return e},T.prototype.reduce=function le(e){for(e.drShiftTo(this.m.t-1,this.r2),e.t>this.m.t+1&&(e.t=this.m.t+1,e.clamp()),this.mu.multiplyUpperTo(this.r2,this.m.t+1,this.q3),this.m.multiplyLowerTo(this.q3,this.m.t+1,this.r2);e.compareTo(this.r2)<0;)e.dAddOffset(1,this.m.t+1);for(e.subTo(this.r2,e);0<=e.compareTo(this.m);)e.subTo(this.m,e)},T.prototype.mulTo=function pe(e,t,r){e.multiplyTo(t,r),this.reduce(r)},T.prototype.sqrTo=function fe(e,t){e.squareTo(t),this.reduce(t)};var A=[2,3,5,7,11,13,17,19,23,29,31,37,41,43,47,53,59,61,67,71,73,79,83,89,97,101,103,107,109,113,127,131,137,139,149,151,157,163,167,173,179,181,191,193,197,199,211,223,227,229,233,239,241,251,257,263,269,271,277,281,283,293,307,311,313,317,331,337,347,349,353,359,367,373,379,383,389,397,401,409,419,421,431,433,439,443,449,457,461,463,467,479,487,491,499,503,509],N=(1<<26)/A[A.length-1];E.prototype.chunkSize=function de(e){return Math.floor(Math.LN2*this.DB/Math.log(e))},E.prototype.toRadix=function he(e){if(null==e&&(e=10),0==this.signum()||e<2||36<e)return"0";var t=this.chunkSize(e),r=Math.pow(e,t),n=g(r),a=S(),i=S(),s="";for(this.divRemTo(n,a,i);0<a.signum();)s=(r+i.intValue()).toString(e).substr(1)+s,a.divRemTo(n,a,i);return i.intValue().toString(e)+s},E.prototype.fromRadix=function ye(e,t){this.fromInt(0),null==t&&(t=10);for(var r=this.chunkSize(t),n=Math.pow(t,r),a=!1,i=0,s=0,o=0;o<e.length;++o){var u=c(e,o);u<0?"-"==e.charAt(o)&&0==this.signum()&&(a=!0):(s=t*s+u,++i>=r&&(this.dMultiply(n),this.dAddOffset(s,0),s=i=0))}0<i&&(this.dMultiply(Math.pow(t,i)),this.dAddOffset(s,0)),a&&E.ZERO.subTo(this,this)},E.prototype.fromNumber=function ge(e,t,r){if("number"==typeof t)if(e<2)this.fromInt(1);else for(this.fromNumber(e,r),this.testBit(e-1)||this.bitwiseTo(E.ONE.shiftLeft(e-1),l,this),this.isEven()&&this.dAddOffset(1,0);!this.isProbablePrime(t);)this.dAddOffset(2,0),this.bitLength()>e&&this.subTo(E.ONE.shiftLeft(e-1),this);else{var n=new Array,a=7&e;n.length=1+(e>>3),t.nextBytes(n),0<a?n[0]&=(1<<a)-1:n[0]=0,this.fromString(n,256)}},E.prototype.bitwiseTo=function Ce(e,t,r){var n,a,i=Math.min(e.t,this.t);for(n=0;n<i;++n)r.data[n]=t(this.data[n],e.data[n]);if(e.t<this.t){for(a=e.s&this.DM,n=i;n<this.t;++n)r.data[n]=t(this.data[n],a);r.t=this.t}else{for(a=this.s&this.DM,n=i;n<e.t;++n)r.data[n]=t(a,e.data[n]);r.t=e.t}r.s=t(this.s,e.s),r.clamp()},E.prototype.changeBit=function me(e,t){var r=E.ONE.shiftLeft(e);return this.bitwiseTo(r,t,r),r},E.prototype.addTo=function Ee(e,t){for(var r=0,n=0,a=Math.min(e.t,this.t);r<a;)n+=this.data[r]+e.data[r],t.data[r++]=n&this.DM,n>>=this.DB;if(e.t<this.t){for(n+=e.s;r<this.t;)n+=this.data[r],t.data[r++]=n&this.DM,n>>=this.DB;n+=this.s}else{for(n+=this.s;r<e.t;)n+=e.data[r],t.data[r++]=n&this.DM,n>>=this.DB;n+=e.s}t.s=n<0?-1:0,0<n?t.data[r++]=n:n<-1&&(t.data[r++]=this.DV+n),t.t=r,t.clamp()},E.prototype.dMultiply=function Se(e){this.data[this.t]=this.am(0,e-1,this,0,0,this.t),++this.t,this.clamp()},E.prototype.dAddOffset=function ve(e,t){if(0!=e){for(;this.t<=t;)this.data[this.t++]=0;for(this.data[t]+=e;this.data[t]>=this.DV;)this.data[t]-=this.DV,++t>=this.t&&(this.data[this.t++]=0),++this.data[t]}},E.prototype.multiplyLowerTo=function Ie(e,t,r){var n,a=Math.min(this.t+e.t,t);for(r.s=0,r.t=a;0<a;)r.data[--a]=0;for(n=r.t-this.t;a<n;++a)r.data[a+this.t]=this.am(0,e.data[a],r,a,0,this.t);for(n=Math.min(e.t,t);a<n;++a)this.am(0,e.data[a],r,a,0,t-a);r.clamp()},E.prototype.multiplyUpperTo=function Te(e,t,r){--t;var n=r.t=this.t+e.t-t;for(r.s=0;0<=--n;)r.data[n]=0;for(n=Math.max(t-this.t,0);n<e.t;++n)r.data[this.t+n-t]=this.am(t-n,e.data[n],r,0,0,this.t+n-t);r.clamp(),r.drShiftTo(1,r)},E.prototype.modInt=function Ae(e){if(e<=0)return 0;var t=this.DV%e,r=this.s<0?e-1:0;if(0<this.t)if(0==t)r=this.data[0]%e;else for(var n=this.t-1;0<=n;--n)r=(t*r+this.data[n])%e;return r},E.prototype.millerRabin=function Ne(e){var t=this.subtract(E.ONE),r=t.getLowestSetBit();if(r<=0)return!1;for(var n,a=t.shiftRight(r),i=function c(){return{nextBytes:function(e){var t=!1;if("undefined"!=typeof window){var r=window.crypto||window.msCrypto;if(r&&r.getRandomValues){var n=new Uint8Array(e.length);r.getRandomValues(n);for(var a=0;a<e.length;++a)e[a]=n[a];t=!0}}if(!t)for(var a=0;a<e.length;++a)e[a]=Math.floor(256*Math.random())}}}(),s=0;s<e;++s){for(;(n=new E(this.bitLength(),i)).compareTo(E.ONE)<=0||0<=n.compareTo(t););var o=n.modPow(a,this);if(0!=o.compareTo(E.ONE)&&0!=o.compareTo(t)){for(var u=1;u++<r&&0!=o.compareTo(t);)if(0==(o=o.modPowInt(2,this)).compareTo(E.ONE))return!1;if(0!=o.compareTo(t))return!1}}return!0},E.prototype.clone=function be(){var e=S();return this.copyTo(e),e},E.prototype.intValue=function Be(){if(this.s<0){if(1==this.t)return this.data[0]-this.DV;if(0==this.t)return-1}else{if(1==this.t)return this.data[0];if(0==this.t)return 0}return(this.data[1]&(1<<32-this.DB)-1)<<this.DB|this.data[0]},E.prototype.byteValue=function Re(){return 0==this.t?this.s:this.data[0]<<24>>24},E.prototype.shortValue=function Ue(){return 0==this.t?this.s:this.data[0]<<16>>16},E.prototype.signum=function Le(){return this.s<0?-1:this.t<=0||1==this.t&&this.data[0]<=0?0:1},E.prototype.toByteArray=function we(){var e=this.t,t=new Array;t[0]=this.s;var r,n=this.DB-e*this.DB%8,a=0;if(0<e--)for(n<this.DB&&(r=this.data[e]>>n)!=(this.s&this.DM)>>n&&(t[a++]=r|this.s<<this.DB-n);0<=e;)n<8?(r=(this.data[e]&(1<<n)-1)<<8-n,r|=this.data[--e]>>(n+=this.DB-8)):(r=this.data[e]>>(n-=8)&255,n<=0&&(n+=this.DB,--e)),0!=(128&r)&&(r|=-256),0==a&&(128&this.s)!=(128&r)&&++a,(0<a||r!=this.s)&&(t[a++]=r);return t},E.prototype.equals=function Pe(e){return 0==this.compareTo(e)},E.prototype.min=function De(e){return this.compareTo(e)<0?this:e},E.prototype.max=function ke(e){return 0<this.compareTo(e)?this:e},E.prototype.and=function Oe(e){var t=S();return this.bitwiseTo(e,o,t),t},E.prototype.or=function Ve(e){var t=S();return this.bitwiseTo(e,l,t),t},E.prototype.xor=function Ke(e){var t=S();return this.bitwiseTo(e,p,t),t},E.prototype.andNot=function _e(e){var t=S();return this.bitwiseTo(e,f,t),t},E.prototype.not=function xe(){for(var e=S(),t=0;t<this.t;++t)e.data[t]=this.DM&~this.data[t];return e.t=this.t,e.s=~this.s,e},E.prototype.shiftLeft=function Ge(e){var t=S();return e<0?this.rShiftTo(-e,t):this.lShiftTo(e,t),t},E.prototype.shiftRight=function Me(e){var t=S();return e<0?this.lShiftTo(-e,t):this.rShiftTo(e,t),t},E.prototype.getLowestSetBit=function Fe(){for(var e=0;e<this.t;++e)if(0!=this.data[e])return e*this.DB+d(this.data[e]);return this.s<0?this.t*this.DB:-1},E.prototype.bitCount=function qe(){for(var e=0,t=this.s&this.DM,r=0;r<this.t;++r)e+=h(this.data[r]^t);return e},E.prototype.testBit=function je(e){var t=Math.floor(e/this.DB);return t>=this.t?0!=this.s:0!=(this.data[t]&1<<e%this.DB)},E.prototype.setBit=function Qe(e){return this.changeBit(e,l)},E.prototype.clearBit=function ze(e){return this.changeBit(e,f)},E.prototype.flipBit=function He(e){return this.changeBit(e,p)},E.prototype.add=function We(e){var t=S();return this.addTo(e,t),t},E.prototype.subtract=function Je(e){var t=S();return this.subTo(e,t),t},E.prototype.multiply=function Xe(e){var t=S();return this.multiplyTo(e,t),t},E.prototype.divide=function Ye(e){var t=S();return this.divRemTo(e,t,null),t},E.prototype.remainder=function Ze(e){var t=S();return this.divRemTo(e,null,t),t},E.prototype.divideAndRemainder=function $e(e){var t=S(),r=S();return this.divRemTo(e,t,r),new Array(t,r)},E.prototype.modPow=function et(e,t){var r,n,a=e.bitLength(),i=g(1);if(a<=0)return i;r=a<18?1:a<48?3:a<144?4:a<768?5:6,n=a<8?new C(t):t.isEven()?new T(t):new m(t);var s=new Array,o=3,u=r-1,c=(1<<r)-1;if(s[1]=n.convert(this),1<r){var l=S();for(n.sqrTo(s[1],l);o<=c;)s[o]=S(),n.mulTo(l,s[o-2],s[o]),o+=2}var p,f,d=e.t-1,h=!0,y=S();for(a=v(e.data[d])-1;0<=d;){for(u<=a?p=e.data[d]>>a-u&c:(p=(e.data[d]&(1<<a+1)-1)<<u-a,0<d&&(p|=e.data[d-1]>>this.DB+a-u)),o=r;0==(1&p);)p>>=1,--o;if((a-=o)<0&&(a+=this.DB,--d),h)s[p].copyTo(i),h=!1;else{for(;1<o;)n.sqrTo(i,y),n.sqrTo(y,i),o-=2;0<o?n.sqrTo(i,y):(f=i,i=y,y=f),n.mulTo(y,s[p],i)}for(;0<=d&&0==(e.data[d]&1<<a);)n.sqrTo(i,y),f=i,i=y,y=f,--a<0&&(a=this.DB-1,--d)}return n.revert(i)},E.prototype.modInverse=function tt(e){var t=e.isEven();if(this.isEven()&&t||0==e.signum())return E.ZERO;for(var r=e.clone(),n=this.clone(),a=g(1),i=g(0),s=g(0),o=g(1);0!=r.signum();){for(;r.isEven();)r.rShiftTo(1,r),t?(a.isEven()&&i.isEven()||(a.addTo(this,a),i.subTo(e,i)),a.rShiftTo(1,a)):i.isEven()||i.subTo(e,i),i.rShiftTo(1,i);for(;n.isEven();)n.rShiftTo(1,n),t?(s.isEven()&&o.isEven()||(s.addTo(this,s),o.subTo(e,o)),s.rShiftTo(1,s)):o.isEven()||o.subTo(e,o),o.rShiftTo(1,o);0<=r.compareTo(n)?(r.subTo(n,r),t&&a.subTo(s,a),i.subTo(o,i)):(n.subTo(r,n),t&&s.subTo(a,s),o.subTo(i,o))}return 0!=n.compareTo(E.ONE)?E.ZERO:0<=o.compareTo(e)?o.subtract(e):o.signum()<0?(o.addTo(e,o),o.signum()<0?o.add(e):o):o},E.prototype.pow=function rt(e){return this.exp(e,new y)},E.prototype.gcd=function nt(e){var t=this.s<0?this.negate():this.clone(),r=e.s<0?e.negate():e.clone();if(t.compareTo(r)<0){var n=t;t=r,r=n}var a=t.getLowestSetBit(),i=r.getLowestSetBit();if(i<0)return t;for(a<i&&(i=a),0<i&&(t.rShiftTo(i,t),r.rShiftTo(i,r));0<t.signum();)0<(a=t.getLowestSetBit())&&t.rShiftTo(a,t),0<(a=r.getLowestSetBit())&&r.rShiftTo(a,r),0<=t.compareTo(r)?(t.subTo(r,t),t.rShiftTo(1,t)):(r.subTo(t,r),r.rShiftTo(1,r));return 0<i&&r.lShiftTo(i,r),r},E.prototype.isProbablePrime=function at(e){var t,r=this.abs();if(1==r.t&&r.data[0]<=A[A.length-1]){for(t=0;t<A.length;++t)if(r.data[0]==A[t])return!0;return!1}if(r.isEven())return!1;for(t=1;t<A.length;){for(var n=A[t],a=t+1;a<A.length&&n<N;)n*=A[a++];for(n=r.modInt(n);t<a;)if(n%A[t++]==0)return!1}return r.millerRabin(e)},e.jsbn=e.jsbn||{},e.jsbn.BigInteger=E}var i,s="jsbn";if("function"!=typeof define){if("object"!=typeof module||!module.exports)return"undefined"==typeof forge&&(forge={}),a(forge);var r=!0;define=function(e,t){t(require,module)}}var n=define;define=function(e,t){return i="string"==typeof e?t.slice(2):e.slice(2),r?(delete define,n.apply(null,Array.prototype.slice.call(arguments,0))):(define=n,define.apply(null,Array.prototype.slice.call(arguments,0)))},define(["require","module"],function(){(function(n,e){e.exports=function(e){var t=i.map(function(e){return n(e)}).concat(a);if((e=e||{}).defined=e.defined||{},e.defined[s])return e[s];e.defined[s]=!0;for(var r=0;r<t.length;++r)t[r](e);return e[s]}}).apply(null,Array.prototype.slice.call(arguments,0))})}(),function(){function a(y){var g=y.asn1=y.asn1||{};g.Class={UNIVERSAL:0,APPLICATION:64,CONTEXT_SPECIFIC:128,PRIVATE:192},g.Type={NONE:0,BOOLEAN:1,INTEGER:2,BITSTRING:3,OCTETSTRING:4,NULL:5,OID:6,ODESC:7,EXTERNAL:8,REAL:9,ENUMERATED:10,EMBEDDED:11,UTF8:12,ROID:13,SEQUENCE:16,SET:17,PRINTABLESTRING:19,IA5STRING:22,UTCTIME:23,GENERALIZEDTIME:24,BMPSTRING:30},g.create=function(e,t,r,n){if(y.util.isArray(n)){for(var a=[],i=0;i<n.length;++i)n[i]!==undefined&&a.push(n[i]);n=a}return{tagClass:e,type:t,constructed:r,composed:r||y.util.isArray(n),value:n}};var C=g.getBerValueLength=function(e){var t=e.getByte();return 128===t?undefined:128&t?e.getInt((127&t)<<3):t};g.fromDer=function(e,t){if(t===undefined&&(t=!0),"string"==typeof e&&(e=y.util.createBuffer(e)),e.length()<2)throw(o=new Error("Too few bytes to parse DER.")).bytes=e.length(),o;var r,n=e.getByte(),a=192&n,i=31&n,s=C(e);if(e.length()<s){var o;if(t)throw(o=new Error("Too few bytes to read ASN.1 value.")).detail=e.length()+" < "+s,o;s=e.length()}var u=32==(32&n),c=u;if(!c&&a===g.Class.UNIVERSAL&&i===g.Type.BITSTRING&&1<s){var l=e.read;if(0===e.getByte()){var p=192&(n=e.getByte());if(p===g.Class.UNIVERSAL||p===g.Class.CONTEXT_SPECIFIC)try{(c=C(e)===s-(e.read-l))&&(++l,--s)}catch(h){}}e.read=l}if(c)if(r=[],s===undefined)for(;;){if(e.bytes(2)===String.fromCharCode(0,0)){e.getBytes(2);break}r.push(g.fromDer(e,t))}else for(var f=e.length();0<s;)r.push(g.fromDer(e,t)),s-=f-e.length(),f=e.length();else{if(s===undefined){if(t)throw new Error("Non-constructed ASN.1 object of indefinite length.");s=e.length()}if(i===g.Type.BMPSTRING){r="";for(var d=0;d<s;d+=2)r+=String.fromCharCode(e.getInt16())}else r=e.getBytes(s)}return g.create(a,i,u,r)},g.toDer=function(e){var t=y.util.createBuffer(),r=e.tagClass|e.type,n=y.util.createBuffer();if(e.composed){e.constructed?r|=32:n.putByte(0);for(var a=0;a<e.value.length;++a)e.value[a]!==undefined&&n.putBuffer(g.toDer(e.value[a]))}else if(e.type===g.Type.BMPSTRING)for(a=0;a<e.value.length;++a)n.putInt16(e.value.charCodeAt(a));else e.type===g.Type.INTEGER&&1<e.value.length&&(0===e.value.charCodeAt(0)&&0==(128&e.value.charCodeAt(1))||255===e.value.charCodeAt(0)&&128==(128&e.value.charCodeAt(1)))?n.putBytes(e.value.substr(1)):n.putBytes(e.value);if(t.putByte(r),n.length()<=127)t.putByte(127&n.length());else{for(var i=n.length(),s="";s+=String.fromCharCode(255&i),0<(i>>>=8););t.putByte(128|s.length);for(a=s.length-1;0<=a;--a)t.putByte(s.charCodeAt(a))}return t.putBuffer(n),t},g.oidToDer=function(e){var t,r,n,a,i=e.split("."),s=y.util.createBuffer();s.putByte(40*parseInt(i[0],10)+parseInt(i[1],10));for(var o=2;o<i.length;++o){for(t=!0,r=[],n=parseInt(i[o],10);a=127&n,n>>>=7,t||(a|=128),r.push(a),t=!1,0<n;);for(var u=r.length-1;0<=u;--u)s.putByte(r[u])}return s},g.derToOid=function(e){var t;"string"==typeof e&&(e=y.util.createBuffer(e));var r=e.getByte();t=Math.floor(r/40)+"."+r%40;for(var n=0;0<e.length();)n<<=7,128&(r=e.getByte())?n+=127&r:(t+="."+(n+r),n=0);return t},g.utcTimeToDate=function(e){var t=new Date,r=parseInt(e.substr(0,2),10);r=50<=r?1900+r:2e3+r;var n=parseInt(e.substr(2,2),10)-1,a=parseInt(e.substr(4,2),10),i=parseInt(e.substr(6,2),10),s=parseInt(e.substr(8,2),10),o=0;if(11<e.length){var u=e.charAt(10),c=10;"+"!==u&&"-"!==u&&(o=parseInt(e.substr(10,2),10),c+=2)}if(t.setUTCFullYear(r,n,a),t.setUTCHours(i,s,o,0),c&&("+"===(u=e.charAt(c))||"-"===u)){var l=60*parseInt(e.substr(c+1,2),10)+parseInt(e.substr(c+4,2),10);l*=6e4,"+"===u?t.setTime(+t-l):t.setTime(+t+l)}return t},g.generalizedTimeToDate=function(e){var t=new Date,r=parseInt(e.substr(0,4),10),n=parseInt(e.substr(4,2),10)-1,a=parseInt(e.substr(6,2),10),i=parseInt(e.substr(8,2),10),s=parseInt(e.substr(10,2),10),o=parseInt(e.substr(12,2),10),u=0,c=0,l=!1;"Z"===e.charAt(e.length-1)&&(l=!0);var p=e.length-5,f=e.charAt(p);"+"!==f&&"-"!==f||(c=60*parseInt(e.substr(p+1,2),10)+parseInt(e.substr(p+4,2),10),c*=6e4,"+"===f&&(c*=-1),l=!0);return"."===e.charAt(14)&&(u=1e3*parseFloat(e.substr(14),10)),l?(t.setUTCFullYear(r,n,a),t.setUTCHours(i,s,o,u),t.setTime(+t+c)):(t.setFullYear(r,n,a),t.setHours(i,s,o,u)),t},g.dateToUtcTime=function(e){if("string"==typeof e)return e;var t="",r=[];r.push((""+e.getUTCFullYear()).substr(2)),r.push(""+(e.getUTCMonth()+1)),r.push(""+e.getUTCDate()),r.push(""+e.getUTCHours()),r.push(""+e.getUTCMinutes()),r.push(""+e.getUTCSeconds());for(var n=0;n<r.length;++n)r[n].length<2&&(t+="0"),t+=r[n];return t+="Z"},g.dateToGeneralizedTime=function(e){if("string"==typeof e)return e;var t="",r=[];r.push(""+e.getUTCFullYear()),r.push(""+(e.getUTCMonth()+1)),r.push(""+e.getUTCDate()),r.push(""+e.getUTCHours()),r.push(""+e.getUTCMinutes()),r.push(""+e.getUTCSeconds());for(var n=0;n<r.length;++n)r[n].length<2&&(t+="0"),t+=r[n];return t+="Z"},g.integerToDer=function(e){var t=y.util.createBuffer();if(-128<=e&&e<128)return t.putSignedInt(e,8);if(-32768<=e&&e<32768)return t.putSignedInt(e,16);if(-8388608<=e&&e<8388608)return t.putSignedInt(e,24);if(-2147483648<=e&&e<2147483648)return t.putSignedInt(e,32);var r=new Error("Integer too large; max is 32-bits.");throw r.integer=e,r},g.derToInteger=function(e){"string"==typeof e&&(e=y.util.createBuffer(e));var t=8*e.length();if(32<t)throw new Error("Integer too large; max is 32-bits.");return e.getSignedInt(t)},g.validate=function(e,t,r,n){var a=!1;if(e.tagClass!==t.tagClass&&"undefined"!=typeof t.tagClass||e.type!==t.type&&"undefined"!=typeof t.type)n&&(e.tagClass!==t.tagClass&&n.push("["+t.name+'] Expected tag class "'+t.tagClass+'", got "'+e.tagClass+'"'),e.type!==t.type&&n.push("["+t.name+'] Expected type "'+t.type+'", got "'+e.type+'"'));else if(e.constructed===t.constructed||"undefined"==typeof t.constructed){if(a=!0,t.value&&y.util.isArray(t.value))for(var i=0,s=0;a&&s<t.value.length;++s)a=t.value[s].optional||!1,e.value[i]&&((a=g.validate(e.value[i],t.value[s],r,n))?++i:t.value[s].optional&&(a=!0)),!a&&n&&n.push("["+t.name+'] Tag class "'+t.tagClass+'", type "'+t.type+'" expected value length "'+t.value.length+'", got "'+e.value.length+'"');a&&r&&(t.capture&&(r[t.capture]=e.value),t.captureAsn1&&(r[t.captureAsn1]=e))}else n&&n.push("["+t.name+'] Expected constructed "'+t.constructed+'", got "'+e.constructed+'"');return a};var l=/[^\\u0000-\\u00ff]/;g.prettyPrint=function(e,t,r){var n="";r=r||2,0<(t=t||0)&&(n+="\n");for(var a="",i=0;i<t*r;++i)a+=" ";switch(n+=a+"Tag: ",e.tagClass){case g.Class.UNIVERSAL:n+="Universal:";break;case g.Class.APPLICATION:n+="Application:";break;case g.Class.CONTEXT_SPECIFIC:n+="Context-Specific:";break;case g.Class.PRIVATE:n+="Private:"}if(e.tagClass===g.Class.UNIVERSAL)switch(n+=e.type,e.type){case g.Type.NONE:n+=" (None)";break;case g.Type.BOOLEAN:n+=" (Boolean)";break;case g.Type.BITSTRING:n+=" (Bit string)";break;case g.Type.INTEGER:n+=" (Integer)";break;case g.Type.OCTETSTRING:n+=" (Octet string)";break;case g.Type.NULL:n+=" (Null)";break;case g.Type.OID:n+=" (Object Identifier)";break;case g.Type.ODESC:n+=" (Object Descriptor)";break;case g.Type.EXTERNAL:n+=" (External or Instance of)";break;case g.Type.REAL:n+=" (Real)";break;case g.Type.ENUMERATED:n+=" (Enumerated)";break;case g.Type.EMBEDDED:n+=" (Embedded PDV)";break;case g.Type.UTF8:n+=" (UTF8)";break;case g.Type.ROID:n+=" (Relative Object Identifier)";break;case g.Type.SEQUENCE:n+=" (Sequence)";break;case g.Type.SET:n+=" (Set)";break;case g.Type.PRINTABLESTRING:n+=" (Printable String)";break;case g.Type.IA5String:n+=" (IA5String (ASCII))";break;case g.Type.UTCTIME:n+=" (UTC time)";break;case g.Type.GENERALIZEDTIME:n+=" (Generalized time)";break;case g.Type.BMPSTRING:n+=" (BMP String)"}else n+=e.type;if(n+="\n",n+=a+"Constructed: "+e.constructed+"\n",e.composed){var s=0,o="";for(i=0;i<e.value.length;++i)e.value[i]!==undefined&&(s+=1,o+=g.prettyPrint(e.value[i],t+1,r),i+1<e.value.length&&(o+=","));n+=a+"Sub values: "+s+o}else{if(n+=a+"Value: ",e.type===g.Type.OID){var u=g.derToOid(e.value);n+=u,y.pki&&y.pki.oids&&u in y.pki.oids&&(n+=" ("+y.pki.oids[u]+") ")}if(e.type===g.Type.INTEGER)try{n+=g.derToInteger(e.value)}catch(c){n+="0x"+y.util.bytesToHex(e.value)}else e.type===g.Type.OCTETSTRING?(l.test(e.value)||(n+="("+e.value+") "),n+="0x"+y.util.bytesToHex(e.value)):e.type===g.Type.UTF8?n+=y.util.decodeUtf8(e.value):e.type===g.Type.PRINTABLESTRING||e.type===g.Type.IA5String?n+=e.value:l.test(e.value)?n+="0x"+y.util.bytesToHex(e.value):0===e.value.length?n+="[null]":n+=e.value}return n}}var i,s="asn1";if("function"!=typeof define){if("object"!=typeof module||!module.exports)return"undefined"==typeof forge&&(forge={}),a(forge);var r=!0;define=function(e,t){t(require,module)}}var n=define;define=function(e,t){return i="string"==typeof e?t.slice(2):e.slice(2),r?(delete define,n.apply(null,Array.prototype.slice.call(arguments,0))):(define=n,define.apply(null,Array.prototype.slice.call(arguments,0)))},define(["require","module","./util","./oids"],function(){(function(n,e){e.exports=function(e){var t=i.map(function(e){return n(e)}).concat(a);if((e=e||{}).defined=e.defined||{},e.defined[s])return e[s];e.defined[s]=!0;for(var r=0;r<t.length;++r)t[r](e);return e[s]}}).apply(null,Array.prototype.slice.call(arguments,0))})}(),function(){function a(y){var e=y.pem=y.pem||{};function i(e){for(var t=e.name+": ",r=[],n=function(e,t){return" "+t},a=0;a<e.values.length;++a)r.push(e.values[a].replace(/^(\S+\r\n)/,n));t+=r.join(",")+"\r\n";var i=0,s=-1;for(a=0;a<t.length;++a,++i)if(65<i&&-1!==s){var o=t[s];","===o?(++s,t=t.substr(0,s)+"\r\n "+t.substr(s)):t=t.substr(0,s)+"\r\n"+o+t.substr(s+1),i=a-s-1,s=-1,++a}else" "!==t[a]&&"\t"!==t[a]&&","!==t[a]||(s=a);return t}e.encode=function(e,t){t=t||{};var r,n="-----BEGIN "+e.type+"-----\r\n";if(e.procType&&(n+=i(r={name:"Proc-Type",values:[String(e.procType.version),e.procType.type]})),e.contentDomain&&(n+=i(r={name:"Content-Domain",values:[e.contentDomain]})),e.dekInfo&&(r={name:"DEK-Info",values:[e.dekInfo.algorithm]},e.dekInfo.parameters&&r.values.push(e.dekInfo.parameters),n+=i(r)),e.headers)for(var a=0;a<e.headers.length;++a)n+=i(e.headers[a]);return e.procType&&(n+="\r\n"),n+=y.util.encode64(e.body,t.maxline||64)+"\r\n",n+="-----END "+e.type+"-----\r\n"},e.decode=function(e){for(var t,r=[],n=/\s*-----BEGIN ([A-Z0-9- ]+)-----\r?\n?([\x21-\x7e\s]+?(?:\r?\n\r?\n))?([:A-Za-z0-9+\/=\s]+?)-----END \1-----/g,a=/([\x21-\x7e]+):\s*([\x21-\x7e\s^:]+)/,i=/\r?\n/;t=n.exec(e);){var s={type:t[1],procType:null,contentDomain:null,dekInfo:null,headers:[],body:y.util.decode64(t[3])};if(r.push(s),t[2]){for(var o=t[2].split(i),u=0;t&&u<o.length;){for(var c=o[u].replace(/\s+$/,""),l=u+1;l<o.length;++l){var p=o[l];if(!/\s/.test(p[0]))break;c+=p,u=l}if(t=c.match(a)){for(var f={name:t[1],values:[]},d=t[2].split(","),h=0;h<d.length;++h)f.values.push(d[h].replace(/^\s+/,""));if(s.procType)if(s.contentDomain||"Content-Domain"!==f.name)if(s.dekInfo||"DEK-Info"!==f.name)s.headers.push(f);else{if(0===f.values.length)throw new Error('Invalid PEM formatted message. The "DEK-Info" header must have at least one subfield.');s.dekInfo={algorithm:d[0],parameters:d[1]||null}}else s.contentDomain=d[0]||"";else{if("Proc-Type"!==f.name)throw new Error('Invalid PEM formatted message. The first encapsulated header must be "Proc-Type".');if(2!==f.values.length)throw new Error('Invalid PEM formatted message. The "Proc-Type" header must have two subfields.');s.procType={version:d[0],type:d[1]}}}++u}if("ENCRYPTED"===s.procType&&!s.dekInfo)throw new Error('Invalid PEM formatted message. The "DEK-Info" header must be present if "Proc-Type" is "ENCRYPTED".')}}if(0===r.length)throw new Error("Invalid PEM formatted message.");return r}}var i;if("function"!=typeof define){if("object"!=typeof module||!module.exports)return"undefined"==typeof forge&&(forge={}),a(forge);var r=!0;define=function(e,t){t(require,module)}}var n=define;define=function(e,t){return i="string"==typeof e?t.slice(2):e.slice(2),r?(delete define,n.apply(null,Array.prototype.slice.call(arguments,0))):(define=n,define.apply(null,Array.prototype.slice.call(arguments,0)))},define(["require","module","./util"],function(){(function(n,e){e.exports=function(e){var t=i.map(function(e){return n(e)}).concat(a);if((e=e||{}).defined=e.defined||{},e.defined.pem)return e.pem;e.defined.pem=!0;for(var r=0;r<t.length;++r)t[r](e);return e.pem}}).apply(null,Array.prototype.slice.call(arguments,0))})}(),function(){function a(f){if(void 0===d)var d=f.jsbn.BigInteger;var h=f.asn1;f.pki=f.pki||{},f.pki.rsa=f.rsa=f.rsa||{};var y=f.pki,p=[6,4,2,4,2,4,6,2],g={name:"PrivateKeyInfo",tagClass:h.Class.UNIVERSAL,type:h.Type.SEQUENCE,constructed:!0,value:[{name:"PrivateKeyInfo.version",tagClass:h.Class.UNIVERSAL,type:h.Type.INTEGER,constructed:!1,capture:"privateKeyVersion"},{name:"PrivateKeyInfo.privateKeyAlgorithm",tagClass:h.Class.UNIVERSAL,type:h.Type.SEQUENCE,constructed:!0,value:[{name:"AlgorithmIdentifier.algorithm",tagClass:h.Class.UNIVERSAL,type:h.Type.OID,constructed:!1,capture:"privateKeyOid"}]},{name:"PrivateKeyInfo",tagClass:h.Class.UNIVERSAL,type:h.Type.OCTETSTRING,constructed:!1,capture:"privateKey"}]},C={name:"RSAPrivateKey",tagClass:h.Class.UNIVERSAL,type:h.Type.SEQUENCE,constructed:!0,value:[{name:"RSAPrivateKey.version",tagClass:h.Class.UNIVERSAL,type:h.Type.INTEGER,constructed:!1,capture:"privateKeyVersion"},{name:"RSAPrivateKey.modulus",tagClass:h.Class.UNIVERSAL,type:h.Type.INTEGER,constructed:!1,capture:"privateKeyModulus"},{name:"RSAPrivateKey.publicExponent",tagClass:h.Class.UNIVERSAL,type:h.Type.INTEGER,constructed:!1,capture:"privateKeyPublicExponent"},{name:"RSAPrivateKey.privateExponent",tagClass:h.Class.UNIVERSAL,type:h.Type.INTEGER,constructed:!1,capture:"privateKeyPrivateExponent"},{name:"RSAPrivateKey.prime1",tagClass:h.Class.UNIVERSAL,type:h.Type.INTEGER,constructed:!1,capture:"privateKeyPrime1"},{name:"RSAPrivateKey.prime2",tagClass:h.Class.UNIVERSAL,type:h.Type.INTEGER,constructed:!1,capture:"privateKeyPrime2"},{name:"RSAPrivateKey.exponent1",tagClass:h.Class.UNIVERSAL,type:h.Type.INTEGER,constructed:!1,capture:"privateKeyExponent1"},{name:"RSAPrivateKey.exponent2",tagClass:h.Class.UNIVERSAL,type:h.Type.INTEGER,constructed:!1,capture:"privateKeyExponent2"},{name:"RSAPrivateKey.coefficient",tagClass:h.Class.UNIVERSAL,type:h.Type.INTEGER,constructed:!1,capture:"privateKeyCoefficient"}]},o={name:"RSAPublicKey",tagClass:h.Class.UNIVERSAL,type:h.Type.SEQUENCE,constructed:!0,value:[{name:"RSAPublicKey.modulus",tagClass:h.Class.UNIVERSAL,type:h.Type.INTEGER,constructed:!1,capture:"publicKeyModulus"},{name:"RSAPublicKey.exponent",tagClass:h.Class.UNIVERSAL,type:h.Type.INTEGER,constructed:!1,capture:"publicKeyExponent"}]},u=f.pki.rsa.publicKeyValidator={name:"SubjectPublicKeyInfo",tagClass:h.Class.UNIVERSAL,type:h.Type.SEQUENCE,constructed:!0,captureAsn1:"subjectPublicKeyInfo",value:[{name:"SubjectPublicKeyInfo.AlgorithmIdentifier",tagClass:h.Class.UNIVERSAL,type:h.Type.SEQUENCE,constructed:!0,value:[{name:"AlgorithmIdentifier.algorithm",tagClass:h.Class.UNIVERSAL,type:h.Type.OID,constructed:!1,capture:"publicKeyOid"}]},{name:"SubjectPublicKeyInfo.subjectPublicKey",tagClass:h.Class.UNIVERSAL,type:h.Type.BITSTRING,constructed:!1,value:[{name:"SubjectPublicKeyInfo.subjectPublicKey.RSAPublicKey",tagClass:h.Class.UNIVERSAL,type:h.Type.SEQUENCE,constructed:!0,optional:!0,captureAsn1:"rsaPublicKey"}]}]},c=function(e){var t;if(!(e.algorithm in y.oids)){var r=new Error("Unknown message digest algorithm.");throw r.algorithm=e.algorithm,r}t=y.oids[e.algorithm];var n=h.oidToDer(t).getBytes(),a=h.create(h.Class.UNIVERSAL,h.Type.SEQUENCE,!0,[]),i=h.create(h.Class.UNIVERSAL,h.Type.SEQUENCE,!0,[]);i.value.push(h.create(h.Class.UNIVERSAL,h.Type.OID,!1,n)),i.value.push(h.create(h.Class.UNIVERSAL,h.Type.NULL,!1,""));var s=h.create(h.Class.UNIVERSAL,h.Type.OCTETSTRING,!1,e.digest().getBytes());return a.value.push(i),a.value.push(s),h.toDer(a).getBytes()},l=function(e,t,r){if(r)return e.modPow(t.e,t.n);if(!t.p||!t.q)return e.modPow(t.d,t.n);var n;for(t.dP||(t.dP=t.d.mod(t.p.subtract(d.ONE))),t.dQ||(t.dQ=t.d.mod(t.q.subtract(d.ONE))),t.qInv||(t.qInv=t.q.modInverse(t.p));0<=(n=new d(f.util.bytesToHex(f.random.getBytes(t.n.bitLength()/8)),16)).compareTo(t.n)||!n.gcd(t.n).equals(d.ONE););for(var a=(e=e.multiply(n.modPow(t.e,t.n)).mod(t.n)).mod(t.p).modPow(t.dP,t.p),i=e.mod(t.q).modPow(t.dQ,t.q);a.compareTo(i)<0;)a=a.add(t.p);var s=a.subtract(i).multiply(t.qInv).mod(t.p).multiply(t.q).add(i);return s=s.multiply(n.modInverse(t.n)).mod(t.n)};function m(e,t,r){var n=f.util.createBuffer(),a=Math.ceil(t.n.bitLength()/8);if(e.length>a-11){var i=new Error("Message is too long for PKCS#1 v1.5 padding.");throw i.length=e.length,i.max=a-11,i}n.putByte(0),n.putByte(r);var s,o=a-3-e.length;if(0===r||1===r){s=0===r?0:255;for(var u=0;u<o;++u)n.putByte(s)}else for(;0<o;){var c=0,l=f.random.getBytes(o);for(u=0;u<o;++u)0===(s=l.charCodeAt(u))?++c:n.putByte(s);o=c}return n.putByte(0),n.putBytes(e),n}function E(e,t,r,n){var a=Math.ceil(t.n.bitLength()/8),i=f.util.createBuffer(e),s=i.getByte(),o=i.getByte();if(0!==s||r&&0!==o&&1!==o||!r&&2!=o||r&&0===o&&void 0===n)throw new Error("Encryption block is invalid.");var u=0;if(0===o){u=a-3-n;for(var c=0;c<u;++c)if(0!==i.getByte())throw new Error("Encryption block is invalid.")}else if(1===o)for(u=0;1<i.length();){if(255!==i.getByte()){--i.read;break}++u}else if(2===o)for(u=0;1<i.length();){if(0===i.getByte()){--i.read;break}++u}if(0!==i.getByte()||u!==a-3-i.length())throw new Error("Encryption block is invalid.");return i.getBytes()}function t(e){var t=e.toString(16);"8"<=t[0]&&(t="00"+t);var r=f.util.hexToBytes(t);return 1<r.length&&(0===r.charCodeAt(0)&&0==(128&r.charCodeAt(1))||255===r.charCodeAt(0)&&128==(128&r.charCodeAt(1)))?r.substr(1):r}function S(e){return e<=100?27:e<=150?18:e<=200?15:e<=250?12:e<=300?9:e<=350?8:e<=400?7:e<=500?6:e<=600?5:e<=800?4:e<=1250?3:2}function s(e){return"undefined"!=typeof window&&"object"==typeof window.crypto&&"object"==typeof window.crypto.subtle&&"function"==typeof window.crypto.subtle[e]}function v(e){return"undefined"!=typeof window&&"object"==typeof window.msCrypto&&"object"==typeof window.msCrypto.subtle&&"function"==typeof window.msCrypto.subtle[e]}function I(e){for(var t=f.util.hexToBytes(e.toString(16)),r=new Uint8Array(t.length),n=0;n<t.length;++n)r[n]=t.charCodeAt(n);return r}y.rsa.encrypt=function(e,t,r){var n,a=r,i=Math.ceil(t.n.bitLength()/8);!1!==r&&!0!==r?(a=2===r,n=m(e,t,r)):(n=f.util.createBuffer()).putBytes(e);for(var s=new d(n.toHex(),16),o=l(s,t,a).toString(16),u=f.util.createBuffer(),c=i-Math.ceil(o.length/2);0<c;)u.putByte(0),--c;return u.putBytes(f.util.hexToBytes(o)),u.getBytes()},y.rsa.decrypt=function(e,t,r,n){var a=Math.ceil(t.n.bitLength()/8);if(e.length!==a){var i=new Error("Encrypted message length is invalid.");throw i.length=e.length,i.expected=a,i}var s=new d(f.util.createBuffer(e).toHex(),16);if(0<=s.compareTo(t.n))throw new Error("Encrypted message is invalid.");for(var o=l(s,t,r).toString(16),u=f.util.createBuffer(),c=a-Math.ceil(o.length/2);0<c;)u.putByte(0),--c;return u.putBytes(f.util.hexToBytes(o)),!1!==n?E(u.getBytes(),t,r):u.getBytes()},y.rsa.createKeyPairGenerationState=function(e,t,r){"string"==typeof e&&(e=parseInt(e,10)),e=e||2048;var n,a=(r=r||{}).prng||f.random,i={nextBytes:function(e){for(var t=a.getBytesSync(e.length),r=0;r<e.length;++r)e[r]=t.charCodeAt(r)}},s=r.algorithm||"PRIMEINC";if("PRIMEINC"!==s)throw new Error("Invalid key generation algorithm: "+s);return(n={algorithm:s,state:0,bits:e,rng:i,eInt:t||65537,e:new d(null),p:null,q:null,qBits:e>>1,pBits:e-(e>>1),pqState:0,num:null,keys:null}).e.fromInt(n.eInt),n},y.rsa.stepKeyPairGenerationState=function(e,t){"algorithm"in e||(e.algorithm="PRIMEINC");var r=new d(null);r.fromInt(30);for(var n,a=0,i=function(e,t){return e|t},s=+new Date,o=0;null===e.keys&&(t<=0||o<t);){if(0===e.state){var u=null===e.p?e.pBits:e.qBits,c=u-1;0===e.pqState?(e.num=new d(u,e.rng),e.num.testBit(c)||e.num.bitwiseTo(d.ONE.shiftLeft(c),i,e.num),e.num.dAddOffset(31-e.num.mod(r).byteValue(),0),a=0,++e.pqState):1===e.pqState?e.num.bitLength()>u?e.pqState=0:e.num.isProbablePrime(S(e.num.bitLength()))?++e.pqState:e.num.dAddOffset(p[a++%8],0):2===e.pqState?e.pqState=0===e.num.subtract(d.ONE).gcd(e.e).compareTo(d.ONE)?3:0:3===e.pqState&&(e.pqState=0,null===e.p?e.p=e.num:e.q=e.num,null!==e.p&&null!==e.q&&++e.state,e.num=null)}else if(1===e.state)e.p.compareTo(e.q)<0&&(e.num=e.p,e.p=e.q,e.q=e.num),++e.state;else if(2===e.state)e.p1=e.p.subtract(d.ONE),e.q1=e.q.subtract(d.ONE),e.phi=e.p1.multiply(e.q1),++e.state;else if(3===e.state)0===e.phi.gcd(e.e).compareTo(d.ONE)?++e.state:(e.p=null,e.q=null,e.state=0);else if(4===e.state)e.n=e.p.multiply(e.q),e.n.bitLength()===e.bits?++e.state:(e.q=null,e.state=0);else if(5===e.state){var l=e.e.modInverse(e.phi);e.keys={privateKey:y.rsa.setPrivateKey(e.n,e.e,l,e.p,e.q,l.mod(e.p1),l.mod(e.q1),e.q.modInverse(e.p)),publicKey:y.rsa.setPublicKey(e.n,e.e)}}o+=(n=+new Date)-s,s=n}return null!==e.keys},y.rsa.generateKeyPair=function(e,t,r,n){if(1===arguments.length?"object"==typeof e?(r=e,e=undefined):"function"==typeof e&&(n=e,e=undefined):2===arguments.length?"number"==typeof e?"function"==typeof t?(n=t,t=undefined):"number"!=typeof t&&(r=t,t=undefined):(r=e,n=t,e=undefined,t=undefined):3===arguments.length&&("number"==typeof t?"function"==typeof r&&(n=r,r=undefined):(n=r,r=t,t=undefined)),r=r||{},e===undefined&&(e=r.bits||2048),t===undefined&&(t=r.e||65537),!f.disableNativeCode&&n&&256<=e&&e<=16384&&(65537===t||3===t)){if(s("generateKey")&&s("exportKey"))return window.crypto.subtle.generateKey({name:"RSASSA-PKCS1-v1_5",modulusLength:e,publicExponent:I(t),hash:{name:"SHA-256"}},!0,["sign","verify"]).then(function(e){return window.crypto.subtle.exportKey("pkcs8",e.privateKey)})["catch"](function(e){n(e)}).then(function(e){if(e){var t=y.privateKeyFromAsn1(h.fromDer(f.util.createBuffer(e)));n(null,{privateKey:t,publicKey:y.setRsaPublicKey(t.n,t.e)})}});if(v("generateKey")&&v("exportKey")){var a=window.msCrypto.subtle.generateKey({name:"RSASSA-PKCS1-v1_5",modulusLength:e,publicExponent:I(t),hash:{name:"SHA-256"}},!0,["sign","verify"]);return a.oncomplete=function(e){var t=e.target.result,r=window.msCrypto.subtle.exportKey("pkcs8",t.privateKey);r.oncomplete=function(e){var t=e.target.result,r=y.privateKeyFromAsn1(h.fromDer(f.util.createBuffer(t)));n(null,{privateKey:r,publicKey:y.setRsaPublicKey(r.n,r.e)})},r.onerror=function(e){n(e)}},void(a.onerror=function(e){n(e)})}}var i=y.rsa.createKeyPairGenerationState(e,t,r);if(!n)return y.rsa.stepKeyPairGenerationState(i,0),i.keys;!function c(a,e,i){"function"==typeof e&&(i=e,e={});var r={algorithm:{name:(e=e||{}).algorithm||"PRIMEINC",options:{workers:e.workers||2,workLoad:e.workLoad||100,workerScript:e.workerScript}}};"prng"in e&&(r.prng=e.prng);function s(){o(a.pBits,function(e,t){return e?i(e):(a.p=t,null!==a.q?u(e,a.q):void o(a.qBits,u))})}function o(e,t){f.prime.generateProbablePrime(e,r,t)}function u(e,t){if(e)return i(e);if(a.q=t,a.p.compareTo(a.q)<0){var r=a.p;a.p=a.q,a.q=r}if(0!==a.p.subtract(d.ONE).gcd(a.e).compareTo(d.ONE))return a.p=null,void s();if(0!==a.q.subtract(d.ONE).gcd(a.e).compareTo(d.ONE))return a.q=null,void o(a.qBits,u);if(a.p1=a.p.subtract(d.ONE),a.q1=a.q.subtract(d.ONE),a.phi=a.p1.multiply(a.q1),0!==a.phi.gcd(a.e).compareTo(d.ONE))return a.p=a.q=null,void s();if(a.n=a.p.multiply(a.q),a.n.bitLength()!==a.bits)return a.q=null,void o(a.qBits,u);var n=a.e.modInverse(a.phi);a.keys={privateKey:y.rsa.setPrivateKey(a.n,a.e,n,a.p,a.q,n.mod(a.p1),n.mod(a.q1),a.q.modInverse(a.p)),publicKey:y.rsa.setPublicKey(a.n,a.e)},i(null,a.keys)}s()}(i,r,n)},y.setRsaPublicKey=y.rsa.setPublicKey=function(e,t){var a={n:e,e:t,encrypt:function(e,t,r){if("string"==typeof t?t=t.toUpperCase():t===undefined&&(t="RSAES-PKCS1-V1_5"),"RSAES-PKCS1-V1_5"===t)t={encode:function(e,t,r){return m(e,t,2).getBytes()}};else if("RSA-OAEP"===t||"RSAES-OAEP"===t)t={encode:function(e,t){return f.pkcs1.encode_rsa_oaep(t,e,r)}};else if(-1!==["RAW","NONE","NULL",null].indexOf(t))t={encode:function(e){return e}};else if("string"==typeof t)throw new Error('Unsupported encryption scheme: "'+t+'".');var n=t.encode(e,a,!0);return y.rsa.encrypt(n,a,!0)},verify:function(e,t,r){"string"==typeof r?r=r.toUpperCase():r===undefined&&(r="RSASSA-PKCS1-V1_5"),"RSASSA-PKCS1-V1_5"===r?r={verify:function(e,t){return t=E(t,a,!0),e===h.fromDer(t).value[1].value}}:"NONE"!==r&&"NULL"!==r&&null!==r||(r={verify:function(e,t){return e===(t=E(t,a,!0))}});var n=y.rsa.decrypt(t,a,!0,!1);return r.verify(e,n,a.n.bitLength())}};return a},y.setRsaPrivateKey=y.rsa.setPrivateKey=function(e,t,r,n,a,i,s,o){var u={n:e,e:t,d:r,p:n,q:a,dP:i,dQ:s,qInv:o,decrypt:function(e,t,r){"string"==typeof t?t=t.toUpperCase():t===undefined&&(t="RSAES-PKCS1-V1_5");var n=y.rsa.decrypt(e,u,!1,!1);if("RSAES-PKCS1-V1_5"===t)t={decode:E};else if("RSA-OAEP"===t||"RSAES-OAEP"===t)t={decode:function(e,t){return f.pkcs1.decode_rsa_oaep(t,e,r)}};else{if(-1===["RAW","NONE","NULL",null].indexOf(t))throw new Error('Unsupported encryption scheme: "'+t+'".');t={decode:function(e){return e}}}return t.decode(n,u,!1)},sign:function(e,t){var r=!1;"string"==typeof t&&(t=t.toUpperCase()),t===undefined||"RSASSA-PKCS1-V1_5"===t?(t={encode:c},r=1):"NONE"!==t&&"NULL"!==t&&null!==t||(t={encode:function(){return e}},r=1);var n=t.encode(e,u.n.bitLength());return y.rsa.encrypt(n,u,r)}};return u},y.wrapRsaPrivateKey=function(e){return h.create(h.Class.UNIVERSAL,h.Type.SEQUENCE,!0,[h.create(h.Class.UNIVERSAL,h.Type.INTEGER,!1,h.integerToDer(0).getBytes()),h.create(h.Class.UNIVERSAL,h.Type.SEQUENCE,!0,[h.create(h.Class.UNIVERSAL,h.Type.OID,!1,h.oidToDer(y.oids.rsaEncryption).getBytes()),h.create(h.Class.UNIVERSAL,h.Type.NULL,!1,"")]),h.create(h.Class.UNIVERSAL,h.Type.OCTETSTRING,!1,h.toDer(e).getBytes())])},y.privateKeyFromAsn1=function(e){var t,r,n,a,i,s,o,u,c={},l=[];if(h.validate(e,g,c,l)&&(e=h.fromDer(f.util.createBuffer(c.privateKey))),c={},l=[],!h.validate(e,C,c,l)){var p=new Error("Cannot read private key. ASN.1 object does not contain an RSAPrivateKey.");throw p.errors=l,p}return t=f.util.createBuffer(c.privateKeyModulus).toHex(),r=f.util.createBuffer(c.privateKeyPublicExponent).toHex(),n=f.util.createBuffer(c.privateKeyPrivateExponent).toHex(),a=f.util.createBuffer(c.privateKeyPrime1).toHex(),i=f.util.createBuffer(c.privateKeyPrime2).toHex(),s=f.util.createBuffer(c.privateKeyExponent1).toHex(),o=f.util.createBuffer(c.privateKeyExponent2).toHex(),u=f.util.createBuffer(c.privateKeyCoefficient).toHex(),y.setRsaPrivateKey(new d(t,16),new d(r,16),new d(n,16),new d(a,16),new d(i,16),new d(s,16),new d(o,16),new d(u,16))},y.privateKeyToAsn1=y.privateKeyToRSAPrivateKey=function(e){return h.create(h.Class.UNIVERSAL,h.Type.SEQUENCE,!0,[h.create(h.Class.UNIVERSAL,h.Type.INTEGER,!1,h.integerToDer(0).getBytes()),h.create(h.Class.UNIVERSAL,h.Type.INTEGER,!1,t(e.n)),h.create(h.Class.UNIVERSAL,h.Type.INTEGER,!1,t(e.e)),h.create(h.Class.UNIVERSAL,h.Type.INTEGER,!1,t(e.d)),h.create(h.Class.UNIVERSAL,h.Type.INTEGER,!1,t(e.p)),h.create(h.Class.UNIVERSAL,h.Type.INTEGER,!1,t(e.q)),h.create(h.Class.UNIVERSAL,h.Type.INTEGER,!1,t(e.dP)),h.create(h.Class.UNIVERSAL,h.Type.INTEGER,!1,t(e.dQ)),h.create(h.Class.UNIVERSAL,h.Type.INTEGER,!1,t(e.qInv))])},y.publicKeyFromAsn1=function(e){var t={},r=[];if(h.validate(e,u,t,r)){var n,a=h.derToOid(t.publicKeyOid);if(a!==y.oids.rsaEncryption)throw(n=new Error("Cannot read public key. Unknown OID.")).oid=a,n;e=t.rsaPublicKey}if(r=[],!h.validate(e,o,t,r))throw(n=new Error("Cannot read public key. ASN.1 object does not contain an RSAPublicKey.")).errors=r,n;var i=f.util.createBuffer(t.publicKeyModulus).toHex(),s=f.util.createBuffer(t.publicKeyExponent).toHex();return y.setRsaPublicKey(new d(i,16),new d(s,16))},y.publicKeyToAsn1=y.publicKeyToSubjectPublicKeyInfo=function(e){return h.create(h.Class.UNIVERSAL,h.Type.SEQUENCE,!0,[h.create(h.Class.UNIVERSAL,h.Type.SEQUENCE,!0,[h.create(h.Class.UNIVERSAL,h.Type.OID,!1,h.oidToDer(y.oids.rsaEncryption).getBytes()),h.create(h.Class.UNIVERSAL,h.Type.NULL,!1,"")]),h.create(h.Class.UNIVERSAL,h.Type.BITSTRING,!1,[y.publicKeyToRSAPublicKey(e)])])},y.publicKeyToRSAPublicKey=function(e){return h.create(h.Class.UNIVERSAL,h.Type.SEQUENCE,!0,[h.create(h.Class.UNIVERSAL,h.Type.INTEGER,!1,t(e.n)),h.create(h.Class.UNIVERSAL,h.Type.INTEGER,!1,t(e.e))])}}var i;if("function"!=typeof define){if("object"!=typeof module||!module.exports)return"undefined"==typeof forge&&(forge={}),a(forge);var r=!0;define=function(e,t){t(require,module)}}var n=define;define=function(e,t){return i="string"==typeof e?t.slice(2):e.slice(2),r?(delete define,n.apply(null,Array.prototype.slice.call(arguments,0))):(define=n,define.apply(null,Array.prototype.slice.call(arguments,0)))},define(["require","module","./asn1","./jsbn","./oids","./pkcs1","./prime","./random","./util"],function(){(function(n,e){e.exports=function(e){var t=i.map(function(e){return n(e)}).concat(a);if((e=e||{}).defined=e.defined||{},e.defined.rsa)return e.rsa;e.defined.rsa=!0;for(var r=0;r<t.length;++r)t[r](e);return e.rsa}}).apply(null,Array.prototype.slice.call(arguments,0))})}(),function(){function a(a){var i=a.asn1,s=a.pki=a.pki||{};s.pemToDer=function(e){var t=a.pem.decode(e)[0];if(t.procType&&"ENCRYPTED"===t.procType.type)throw new Error("Could not convert PEM to DER; PEM is encrypted.");return a.util.createBuffer(t.body)},s.privateKeyFromPem=function(e){var t=a.pem.decode(e)[0];if("PRIVATE KEY"!==t.type&&"RSA PRIVATE KEY"!==t.type){var r=new Error('Could not convert private key from PEM; PEM header type is not "PRIVATE KEY" or "RSA PRIVATE KEY".');throw r.headerType=t.type,r}if(t.procType&&"ENCRYPTED"===t.procType.type)throw new Error("Could not convert private key from PEM; PEM is encrypted.");var n=i.fromDer(t.body);return s.privateKeyFromAsn1(n)},s.privateKeyToPem=function(e,t){var r={type:"RSA PRIVATE KEY",body:i.toDer(s.privateKeyToAsn1(e)).getBytes()};return a.pem.encode(r,{maxline:t})},s.privateKeyInfoToPem=function(e,t){var r={type:"PRIVATE KEY",body:i.toDer(e).getBytes()};return a.pem.encode(r,{maxline:t})}}var i;if("function"!=typeof define){if("object"!=typeof module||!module.exports)return"undefined"==typeof forge&&(forge={}),a(forge);var r=!0;define=function(e,t){t(require,module)}}var n=define;define=function(e,t){return i="string"==typeof e?t.slice(2):e.slice(2),r?(delete define,n.apply(null,Array.prototype.slice.call(arguments,0))):(define=n,define.apply(null,Array.prototype.slice.call(arguments,0)))},define(["require","module","./asn1","./oids","./pbe","./pem","./pbkdf2","./pkcs12","./pss","./rsa","./util","./x509"],function(){(function(n,e){e.exports=function(e){var t=i.map(function(e){return n(e)}).concat(a);if((e=e||{}).defined=e.defined||{},e.defined.pki)return e.pki;e.defined.pki=!0;for(var r=0;r<t.length;++r)t[r](e);return e.pki}}).apply(null,Array.prototype.slice.call(arguments,0))})}(),function(){function a(e){e.pki=e.pki||{};var t=e.pki.oids=e.oids=e.oids||{};t["1.2.840.113549.1.1.1"]="rsaEncryption",t.rsaEncryption="1.2.840.113549.1.1.1",t["1.2.840.113549.1.1.4"]="md5WithRSAEncryption",t.md5WithRSAEncryption="1.2.840.113549.1.1.4",t["1.2.840.113549.1.1.5"]="sha1WithRSAEncryption",t.sha1WithRSAEncryption="1.2.840.113549.1.1.5",t["1.2.840.113549.1.1.7"]="RSAES-OAEP",t["RSAES-OAEP"]="1.2.840.113549.1.1.7",t["1.2.840.113549.1.1.8"]="mgf1",t.mgf1="1.2.840.113549.1.1.8",t["1.2.840.113549.1.1.9"]="pSpecified",t.pSpecified="1.2.840.113549.1.1.9",t["1.2.840.113549.1.1.10"]="RSASSA-PSS",t["RSASSA-PSS"]="1.2.840.113549.1.1.10",t["1.2.840.113549.1.1.11"]="sha256WithRSAEncryption",t.sha256WithRSAEncryption="1.2.840.113549.1.1.11",t["1.2.840.113549.1.1.12"]="sha384WithRSAEncryption",t.sha384WithRSAEncryption="1.2.840.113549.1.1.12",t["1.2.840.113549.1.1.13"]="sha512WithRSAEncryption",t.sha512WithRSAEncryption="1.2.840.113549.1.1.13",t["1.3.14.3.2.7"]="desCBC",t.desCBC="1.3.14.3.2.7",t["1.3.14.3.2.26"]="sha1",t.sha1="1.3.14.3.2.26",t["2.16.840.1.101.3.4.2.1"]="sha256",t.sha256="2.16.840.1.101.3.4.2.1",t["2.16.840.1.101.3.4.2.2"]="sha384",t.sha384="2.16.840.1.101.3.4.2.2",t["2.16.840.1.101.3.4.2.3"]="sha512",t.sha512="2.16.840.1.101.3.4.2.3",t["1.2.840.113549.2.5"]="md5",t.md5="1.2.840.113549.2.5",t["1.2.840.113549.1.7.1"]="data",t.data="1.2.840.113549.1.7.1",t["1.2.840.113549.1.7.2"]="signedData",t.signedData="1.2.840.113549.1.7.2",t["1.2.840.113549.1.7.3"]="envelopedData",t.envelopedData="1.2.840.113549.1.7.3",t["1.2.840.113549.1.7.4"]="signedAndEnvelopedData",t.signedAndEnvelopedData="1.2.840.113549.1.7.4",t["1.2.840.113549.1.7.5"]="digestedData",t.digestedData="1.2.840.113549.1.7.5",t["1.2.840.113549.1.7.6"]="encryptedData",t.encryptedData="1.2.840.113549.1.7.6",t["1.2.840.113549.1.9.1"]="emailAddress",t.emailAddress="1.2.840.113549.1.9.1",t["1.2.840.113549.1.9.2"]="unstructuredName",t.unstructuredName="1.2.840.113549.1.9.2",t["1.2.840.113549.1.9.3"]="contentType",t.contentType="1.2.840.113549.1.9.3",t["1.2.840.113549.1.9.4"]="messageDigest",t.messageDigest="1.2.840.113549.1.9.4",t["1.2.840.113549.1.9.5"]="signingTime",t.signingTime="1.2.840.113549.1.9.5",t["1.2.840.113549.1.9.6"]="counterSignature",t.counterSignature="1.2.840.113549.1.9.6",t["1.2.840.113549.1.9.7"]="challengePassword",t.challengePassword="1.2.840.113549.1.9.7",t["1.2.840.113549.1.9.8"]="unstructuredAddress",t.unstructuredAddress="1.2.840.113549.1.9.8",t["1.2.840.113549.1.9.14"]="extensionRequest",t.extensionRequest="1.2.840.113549.1.9.14",t["1.2.840.113549.1.9.20"]="friendlyName",t.friendlyName="1.2.840.113549.1.9.20",t["1.2.840.113549.1.9.21"]="localKeyId",t.localKeyId="1.2.840.113549.1.9.21",t["1.2.840.113549.1.9.22.1"]="x509Certificate",t.x509Certificate="1.2.840.113549.1.9.22.1",t["1.2.840.113549.1.12.10.1.1"]="keyBag",t.keyBag="1.2.840.113549.1.12.10.1.1",t["1.2.840.113549.1.12.10.1.2"]="pkcs8ShroudedKeyBag",t.pkcs8ShroudedKeyBag="1.2.840.113549.1.12.10.1.2",t["1.2.840.113549.1.12.10.1.3"]="certBag",t.certBag="1.2.840.113549.1.12.10.1.3",t["1.2.840.113549.1.12.10.1.4"]="crlBag",t.crlBag="1.2.840.113549.1.12.10.1.4",t["1.2.840.113549.1.12.10.1.5"]="secretBag",t.secretBag="1.2.840.113549.1.12.10.1.5",t["1.2.840.113549.1.12.10.1.6"]="safeContentsBag",t.safeContentsBag="1.2.840.113549.1.12.10.1.6",t["1.2.840.113549.1.5.13"]="pkcs5PBES2",t.pkcs5PBES2="1.2.840.113549.1.5.13",t["1.2.840.113549.1.5.12"]="pkcs5PBKDF2",t.pkcs5PBKDF2="1.2.840.113549.1.5.12",t["1.2.840.113549.1.12.1.1"]="pbeWithSHAAnd128BitRC4",t.pbeWithSHAAnd128BitRC4="1.2.840.113549.1.12.1.1",t["1.2.840.113549.1.12.1.2"]="pbeWithSHAAnd40BitRC4",t.pbeWithSHAAnd40BitRC4="1.2.840.113549.1.12.1.2",t["1.2.840.113549.1.12.1.3"]="pbeWithSHAAnd3-KeyTripleDES-CBC",t["pbeWithSHAAnd3-KeyTripleDES-CBC"]="1.2.840.113549.1.12.1.3",t["1.2.840.113549.1.12.1.4"]="pbeWithSHAAnd2-KeyTripleDES-CBC",t["pbeWithSHAAnd2-KeyTripleDES-CBC"]="1.2.840.113549.1.12.1.4",t["1.2.840.113549.1.12.1.5"]="pbeWithSHAAnd128BitRC2-CBC",t["pbeWithSHAAnd128BitRC2-CBC"]="1.2.840.113549.1.12.1.5",t["1.2.840.113549.1.12.1.6"]="pbewithSHAAnd40BitRC2-CBC",t["pbewithSHAAnd40BitRC2-CBC"]="1.2.840.113549.1.12.1.6",t["1.2.840.113549.2.7"]="hmacWithSHA1",t.hmacWithSHA1="1.2.840.113549.2.7",t["1.2.840.113549.2.8"]="hmacWithSHA224",t.hmacWithSHA224="1.2.840.113549.2.8",t["1.2.840.113549.2.9"]="hmacWithSHA256",t.hmacWithSHA256="1.2.840.113549.2.9",t["1.2.840.113549.2.10"]="hmacWithSHA384",t.hmacWithSHA384="1.2.840.113549.2.10",t["1.2.840.113549.2.11"]="hmacWithSHA512",t.hmacWithSHA512="1.2.840.113549.2.11",t["1.2.840.113549.3.7"]="des-EDE3-CBC",t["des-EDE3-CBC"]="1.2.840.113549.3.7",t["2.16.840.1.101.3.4.1.2"]="aes128-CBC",t["aes128-CBC"]="2.16.840.1.101.3.4.1.2",t["2.16.840.1.101.3.4.1.22"]="aes192-CBC",t["aes192-CBC"]="2.16.840.1.101.3.4.1.22",t["2.16.840.1.101.3.4.1.42"]="aes256-CBC",t["aes256-CBC"]="2.16.840.1.101.3.4.1.42",t["2.5.4.3"]="commonName",t.commonName="2.5.4.3",t["2.5.4.5"]="serialName",t.serialName="2.5.4.5",t["2.5.4.6"]="countryName",t.countryName="2.5.4.6",t["2.5.4.7"]="localityName",t.localityName="2.5.4.7",t["2.5.4.8"]="stateOrProvinceName",t.stateOrProvinceName="2.5.4.8",t["2.5.4.10"]="organizationName",t.organizationName="2.5.4.10",t["2.5.4.11"]="organizationalUnitName",t.organizationalUnitName="2.5.4.11",t["2.16.840.1.113730.1.1"]="nsCertType",t.nsCertType="2.16.840.1.113730.1.1",t["2.5.29.1"]="authorityKeyIdentifier",t["2.5.29.2"]="keyAttributes",t["2.5.29.3"]="certificatePolicies",t["2.5.29.4"]="keyUsageRestriction",t["2.5.29.5"]="policyMapping",t["2.5.29.6"]="subtreesConstraint",t["2.5.29.7"]="subjectAltName",t["2.5.29.8"]="issuerAltName",t["2.5.29.9"]="subjectDirectoryAttributes",t["2.5.29.10"]="basicConstraints",t["2.5.29.11"]="nameConstraints",t["2.5.29.12"]="policyConstraints",t["2.5.29.13"]="basicConstraints",t["2.5.29.14"]="subjectKeyIdentifier",t.subjectKeyIdentifier="2.5.29.14",t["2.5.29.15"]="keyUsage",t.keyUsage="2.5.29.15",t["2.5.29.16"]="privateKeyUsagePeriod",t["2.5.29.17"]="subjectAltName",t.subjectAltName="2.5.29.17",t["2.5.29.18"]="issuerAltName",t.issuerAltName="2.5.29.18",t["2.5.29.19"]="basicConstraints",t.basicConstraints="2.5.29.19",t["2.5.29.20"]="cRLNumber",t["2.5.29.21"]="cRLReason",t["2.5.29.22"]="expirationDate",t["2.5.29.23"]="instructionCode",t["2.5.29.24"]="invalidityDate",t["2.5.29.25"]="cRLDistributionPoints",t["2.5.29.26"]="issuingDistributionPoint",t["2.5.29.27"]="deltaCRLIndicator",t["2.5.29.28"]="issuingDistributionPoint",t["2.5.29.29"]="certificateIssuer",t["2.5.29.30"]="nameConstraints",t["2.5.29.31"]="cRLDistributionPoints",t.cRLDistributionPoints="2.5.29.31",t["2.5.29.32"]="certificatePolicies",t.certificatePolicies="2.5.29.32",t["2.5.29.33"]="policyMappings",t["2.5.29.34"]="policyConstraints",t["2.5.29.35"]="authorityKeyIdentifier",t.authorityKeyIdentifier="2.5.29.35",t["2.5.29.36"]="policyConstraints",t["2.5.29.37"]="extKeyUsage",t.extKeyUsage="2.5.29.37",t["2.5.29.46"]="freshestCRL",t["2.5.29.54"]="inhibitAnyPolicy",t["1.3.6.1.4.1.11129.2.4.2"]="timestampList",t.timestampList="1.3.6.1.4.1.11129.2.4.2",t["1.3.6.1.5.5.7.1.1"]="authorityInfoAccess",t.authorityInfoAccess="1.3.6.1.5.5.7.1.1",t["1.3.6.1.5.5.7.3.1"]="serverAuth",t.serverAuth="1.3.6.1.5.5.7.3.1",t["1.3.6.1.5.5.7.3.2"]="clientAuth",t.clientAuth="1.3.6.1.5.5.7.3.2",t["1.3.6.1.5.5.7.3.3"]="codeSigning",t.codeSigning="1.3.6.1.5.5.7.3.3",t["1.3.6.1.5.5.7.3.4"]="emailProtection",t.emailProtection="1.3.6.1.5.5.7.3.4",t["1.3.6.1.5.5.7.3.8"]="timeStamping",t.timeStamping="1.3.6.1.5.5.7.3.8"}var i,s="oids";if("function"!=typeof define){if("object"!=typeof module||!module.exports)return"undefined"==typeof forge&&(forge={}),a(forge);var r=!0;define=function(e,t){t(require,module)}}var n=define;define=function(e,t){return i="string"==typeof e?t.slice(2):e.slice(2),r?(delete define,n.apply(null,Array.prototype.slice.call(arguments,0))):(define=n,define.apply(null,Array.prototype.slice.call(arguments,0)))},define(["require","module"],function(){(function(n,e){e.exports=function(e){var t=i.map(function(e){return n(e)}).concat(a);if((e=e||{}).defined=e.defined||{},e.defined[s])return e[s];e.defined[s]=!0;for(var r=0;r<t.length;++r)t[r](e);return e[s]}}).apply(null,Array.prototype.slice.call(arguments,0))})}(),function(){function a(v){var C=v.asn1,I=v.pki=v.pki||{},m=I.oids,c={};c.CN=m.commonName,c.commonName="CN",c.C=m.countryName,c.countryName="C",c.L=m.localityName,c.localityName="L",c.ST=m.stateOrProvinceName,c.stateOrProvinceName="ST",c.O=m.organizationName,c.organizationName="O",c.OU=m.organizationalUnitName,c.organizationalUnitName="OU",c.E=m.emailAddress,c.emailAddress="E";var e=v.pki.rsa.publicKeyValidator,h={name:"Certificate",tagClass:C.Class.UNIVERSAL,type:C.Type.SEQUENCE,constructed:!0,value:[{name:"Certificate.TBSCertificate",tagClass:C.Class.UNIVERSAL,type:C.Type.SEQUENCE,constructed:!0,captureAsn1:"tbsCertificate",value:[{name:"Certificate.TBSCertificate.version",tagClass:C.Class.CONTEXT_SPECIFIC,type:0,constructed:!0,optional:!0,value:[{name:"Certificate.TBSCertificate.version.integer",tagClass:C.Class.UNIVERSAL,type:C.Type.INTEGER,constructed:!1,capture:"certVersion"}]},{name:"Certificate.TBSCertificate.serialNumber",tagClass:C.Class.UNIVERSAL,type:C.Type.INTEGER,constructed:!1,capture:"certSerialNumber"},{name:"Certificate.TBSCertificate.signature",tagClass:C.Class.UNIVERSAL,type:C.Type.SEQUENCE,constructed:!0,value:[{name:"Certificate.TBSCertificate.signature.algorithm",tagClass:C.Class.UNIVERSAL,type:C.Type.OID,constructed:!1,capture:"certinfoSignatureOid"},{name:"Certificate.TBSCertificate.signature.parameters",tagClass:C.Class.UNIVERSAL,optional:!0,captureAsn1:"certinfoSignatureParams"}]},{name:"Certificate.TBSCertificate.issuer",tagClass:C.Class.UNIVERSAL,type:C.Type.SEQUENCE,constructed:!0,captureAsn1:"certIssuer"},{name:"Certificate.TBSCertificate.validity",tagClass:C.Class.UNIVERSAL,type:C.Type.SEQUENCE,constructed:!0,value:[{name:"Certificate.TBSCertificate.validity.notBefore (utc)",tagClass:C.Class.UNIVERSAL,type:C.Type.UTCTIME,constructed:!1,optional:!0,capture:"certValidity1UTCTime"},{name:"Certificate.TBSCertificate.validity.notBefore (generalized)",tagClass:C.Class.UNIVERSAL,type:C.Type.GENERALIZEDTIME,constructed:!1,optional:!0,capture:"certValidity2GeneralizedTime"},{name:"Certificate.TBSCertificate.validity.notAfter (utc)",tagClass:C.Class.UNIVERSAL,type:C.Type.UTCTIME,constructed:!1,optional:!0,capture:"certValidity3UTCTime"},{name:"Certificate.TBSCertificate.validity.notAfter (generalized)",tagClass:C.Class.UNIVERSAL,type:C.Type.GENERALIZEDTIME,constructed:!1,optional:!0,capture:"certValidity4GeneralizedTime"}]},{name:"Certificate.TBSCertificate.subject",tagClass:C.Class.UNIVERSAL,type:C.Type.SEQUENCE,constructed:!0,captureAsn1:"certSubject"},e,{name:"Certificate.TBSCertificate.issuerUniqueID",tagClass:C.Class.CONTEXT_SPECIFIC,type:1,constructed:!0,optional:!0,value:[{name:"Certificate.TBSCertificate.issuerUniqueID.id",tagClass:C.Class.UNIVERSAL,type:C.Type.BITSTRING,constructed:!1,capture:"certIssuerUniqueId"}]},{name:"Certificate.TBSCertificate.subjectUniqueID",tagClass:C.Class.CONTEXT_SPECIFIC,type:2,constructed:!0,optional:!0,value:[{name:"Certificate.TBSCertificate.subjectUniqueID.id",tagClass:C.Class.UNIVERSAL,type:C.Type.BITSTRING,constructed:!1,capture:"certSubjectUniqueId"}]},{name:"Certificate.TBSCertificate.extensions",tagClass:C.Class.CONTEXT_SPECIFIC,type:3,constructed:!0,captureAsn1:"certExtensions",optional:!0}]},{name:"Certificate.signatureAlgorithm",tagClass:C.Class.UNIVERSAL,type:C.Type.SEQUENCE,constructed:!0,value:[{name:"Certificate.signatureAlgorithm.algorithm",tagClass:C.Class.UNIVERSAL,type:C.Type.OID,constructed:!1,capture:"certSignatureOid"},{name:"Certificate.TBSCertificate.signature.parameters",tagClass:C.Class.UNIVERSAL,optional:!0,captureAsn1:"certSignatureParams"}]},{name:"Certificate.signatureValue",tagClass:C.Class.UNIVERSAL,type:C.Type.BITSTRING,constructed:!1,capture:"certSignature"}]},o={name:"rsapss",tagClass:C.Class.UNIVERSAL,type:C.Type.SEQUENCE,constructed:!0,value:[{name:"rsapss.hashAlgorithm",tagClass:C.Class.CONTEXT_SPECIFIC,type:0,constructed:!0,value:[{name:"rsapss.hashAlgorithm.AlgorithmIdentifier",tagClass:C.Class.UNIVERSAL,type:C.Class.SEQUENCE,constructed:!0,optional:!0,value:[{name:"rsapss.hashAlgorithm.AlgorithmIdentifier.algorithm",tagClass:C.Class.UNIVERSAL,type:C.Type.OID,constructed:!1,capture:"hashOid"}]}]},{name:"rsapss.maskGenAlgorithm",tagClass:C.Class.CONTEXT_SPECIFIC,type:1,constructed:!0,value:[{name:"rsapss.maskGenAlgorithm.AlgorithmIdentifier",tagClass:C.Class.UNIVERSAL,type:C.Class.SEQUENCE,constructed:!0,optional:!0,value:[{name:"rsapss.maskGenAlgorithm.AlgorithmIdentifier.algorithm",tagClass:C.Class.UNIVERSAL,type:C.Type.OID,constructed:!1,capture:"maskGenOid"},{name:"rsapss.maskGenAlgorithm.AlgorithmIdentifier.params",tagClass:C.Class.UNIVERSAL,type:C.Type.SEQUENCE,constructed:!0,value:[{name:"rsapss.maskGenAlgorithm.AlgorithmIdentifier.params.algorithm",tagClass:C.Class.UNIVERSAL,type:C.Type.OID,constructed:!1,capture:"maskGenHashOid"}]}]}]},{name:"rsapss.saltLength",tagClass:C.Class.CONTEXT_SPECIFIC,type:2,optional:!0,value:[{name:"rsapss.saltLength.saltLength",tagClass:C.Class.UNIVERSAL,type:C.Class.INTEGER,constructed:!1,capture:"saltLength"}]},{name:"rsapss.trailerField",tagClass:C.Class.CONTEXT_SPECIFIC,type:3,optional:!0,value:[{name:"rsapss.trailer.trailer",tagClass:C.Class.UNIVERSAL,type:C.Class.INTEGER,constructed:!1,capture:"trailer"}]}]},t={name:"CertificationRequestInfo",tagClass:C.Class.UNIVERSAL,type:C.Type.SEQUENCE,constructed:!0,captureAsn1:"certificationRequestInfo",value:[{name:"CertificationRequestInfo.integer",tagClass:C.Class.UNIVERSAL,type:C.Type.INTEGER,constructed:!1,capture:"certificationRequestInfoVersion"},{name:"CertificationRequestInfo.subject",tagClass:C.Class.UNIVERSAL,type:C.Type.SEQUENCE,constructed:!0,captureAsn1:"certificationRequestInfoSubject"},e,{name:"CertificationRequestInfo.attributes",tagClass:C.Class.CONTEXT_SPECIFIC,type:0,constructed:!0,optional:!0,capture:"certificationRequestInfoAttributes",value:[{name:"CertificationRequestInfo.attributes",tagClass:C.Class.UNIVERSAL,type:C.Type.SEQUENCE,constructed:!0,value:[{name:"CertificationRequestInfo.attributes.type",tagClass:C.Class.UNIVERSAL,type:C.Type.OID,constructed:!1},{name:"CertificationRequestInfo.attributes.value",tagClass:C.Class.UNIVERSAL,type:C.Type.SET,constructed:!0}]}]}]},p={name:"CertificationRequest",tagClass:C.Class.UNIVERSAL,type:C.Type.SEQUENCE,constructed:!0,captureAsn1:"csr",value:[t,{name:"CertificationRequest.signatureAlgorithm",tagClass:C.Class.UNIVERSAL,type:C.Type.SEQUENCE,constructed:!0,value:[{name:"CertificationRequest.signatureAlgorithm.algorithm",tagClass:C.Class.UNIVERSAL,type:C.Type.OID,constructed:!1,capture:"csrSignatureOid"},{name:"CertificationRequest.signatureAlgorithm.parameters",tagClass:C.Class.UNIVERSAL,optional:!0,captureAsn1:"csrSignatureParams"}]},{name:"CertificationRequest.signature",tagClass:C.Class.UNIVERSAL,type:C.Type.BITSTRING,constructed:!1,capture:"csrSignature"}]};function y(e,t){"string"==typeof t&&(t={shortName:t});for(var r,n=null,a=0;null===n&&a<e.attributes.length;++a)r=e.attributes[a],t.type&&t.type===r.type?n=r:t.name&&t.name===r.name?n=r:t.shortName&&t.shortName===r.shortName&&(n=r);return n}I.RDNAttributesAsArray=function(e,t){for(var r,n,a,i=[],s=0;s<e.value.length;++s){r=e.value[s];for(var o=0;o<r.value.length;++o)a={},n=r.value[o],a.type=C.derToOid(n.value[0].value),a.value=n.value[1].value,a.valueTagClass=n.value[1].type,a.type in m&&(a.name=m[a.type],a.name in c&&(a.shortName=c[a.name])),t&&(t.update(a.type),t.update(a.value)),i.push(a)}return i},I.CRIAttributesAsArray=function(e){for(var t=[],r=0;r<e.length;++r)for(var n=e[r],a=C.derToOid(n.value[0].value),i=n.value[1].value,s=0;s<i.length;++s){var o={};if(o.type=a,o.value=i[s].value,o.valueTagClass=i[s].type,o.type in m&&(o.name=m[o.type],o.name in c&&(o.shortName=c[o.name])),o.type===m.extensionRequest){o.extensions=[];for(var u=0;u<o.value.length;++u)o.extensions.push(I.certificateExtensionFromAsn1(o.value[u]))}t.push(o)}return t};var g=function(e,t,r){var n={};if(e!==m["RSASSA-PSS"])return n;r&&(n={hash:{algorithmOid:m.sha1},mgf:{algorithmOid:m.mgf1,hash:{algorithmOid:m.sha1}},saltLength:20});var a={},i=[];if(!C.validate(t,o,a,i)){var s=new Error("Cannot read RSASSA-PSS parameter block.");throw s.errors=i,s}return a.hashOid!==undefined&&(n.hash=n.hash||{},n.hash.algorithmOid=C.derToOid(a.hashOid)),a.maskGenOid!==undefined&&(n.mgf=n.mgf||{},n.mgf.algorithmOid=C.derToOid(a.maskGenOid),n.mgf.hash=n.mgf.hash||{},n.mgf.hash.algorithmOid=C.derToOid(a.maskGenHashOid)),a.saltLength!==undefined&&(n.saltLength=a.saltLength.charCodeAt(0)),n};function E(e){for(var t,r,n=C.create(C.Class.UNIVERSAL,C.Type.SEQUENCE,!0,[]),a=e.attributes,i=0;i<a.length;++i){var s=(t=a[i]).value,o=C.Type.PRINTABLESTRING;"valueTagClass"in t&&(o=t.valueTagClass)===C.Type.UTF8&&(s=v.util.encodeUtf8(s)),r=C.create(C.Class.UNIVERSAL,C.Type.SET,!0,[C.create(C.Class.UNIVERSAL,C.Type.SEQUENCE,!0,[C.create(C.Class.UNIVERSAL,C.Type.OID,!1,C.oidToDer(t.type).getBytes()),C.create(C.Class.UNIVERSAL,o,!1,s)])]),n.value.push(r)}return n}function S(e){for(var t,r=0;r<e.length;++r){if("undefined"==typeof(t=e[r]).name&&(t.type&&t.type in I.oids?t.name=I.oids[t.type]:t.shortName&&t.shortName in c&&(t.name=I.oids[c[t.shortName]])),"undefined"==typeof t.type){if(!(t.name&&t.name in I.oids))throw(a=new Error("Attribute type not specified.")).attribute=t,a;t.type=I.oids[t.name]}if("undefined"==typeof t.shortName&&t.name&&t.name in c&&(t.shortName=c[t.name]),t.type===m.extensionRequest&&(t.valueConstructed=!0,t.valueTagClass=C.Type.SEQUENCE,!t.value&&t.extensions)){t.value=[];for(var n=0;n<t.extensions.length;++n)t.value.push(I.certificateExtensionToAsn1(i(t.extensions[n])))}var a;if("undefined"==typeof t.value)throw(a=new Error("Attribute value not specified.")).attribute=t,a}}function i(e,t){if(t=t||{},"undefined"==typeof e.name&&e.id&&e.id in I.oids&&(e.name=I.oids[e.id]),"undefined"==typeof e.id){if(!(e.name&&e.name in I.oids))throw(g=new Error("Extension ID not specified.")).extension=e,g;e.id=I.oids[e.name]}if("undefined"!=typeof e.value)return e;if("keyUsage"===e.name){var r=0,n=0,a=0;e.digitalSignature&&(n|=128,r=7),e.nonRepudiation&&(n|=64,r=6),e.keyEncipherment&&(n|=32,r=5),e.dataEncipherment&&(n|=16,r=4),e.keyAgreement&&(n|=8,r=3),e.keyCertSign&&(n|=4,r=2),e.cRLSign&&(n|=2,r=1),e.encipherOnly&&(n|=1,r=0),e.decipherOnly&&(a|=128,r=7);var i=String.fromCharCode(r);0!==a?i+=String.fromCharCode(n)+String.fromCharCode(a):0!==n&&(i+=String.fromCharCode(n)),e.value=C.create(C.Class.UNIVERSAL,C.Type.BITSTRING,!1,i)}else if("basicConstraints"===e.name)e.value=C.create(C.Class.UNIVERSAL,C.Type.SEQUENCE,!0,[]),e.cA&&e.value.value.push(C.create(C.Class.UNIVERSAL,C.Type.BOOLEAN,!1,String.fromCharCode(255))),"pathLenConstraint"in e&&e.value.value.push(C.create(C.Class.UNIVERSAL,C.Type.INTEGER,!1,C.integerToDer(e.pathLenConstraint).getBytes()));else if("extKeyUsage"===e.name){e.value=C.create(C.Class.UNIVERSAL,C.Type.SEQUENCE,!0,[]);var s=e.value.value;for(var o in e)!0===e[o]&&(o in m?s.push(C.create(C.Class.UNIVERSAL,C.Type.OID,!1,C.oidToDer(m[o]).getBytes())):-1!==o.indexOf(".")&&s.push(C.create(C.Class.UNIVERSAL,C.Type.OID,!1,C.oidToDer(o).getBytes())))}else if("nsCertType"===e.name){r=0,n=0;e.client&&(n|=128,r=7),e.server&&(n|=64,r=6),e.email&&(n|=32,r=5),e.objsign&&(n|=16,r=4),e.reserved&&(n|=8,r=3),e.sslCA&&(n|=4,r=2),e.emailCA&&(n|=2,r=1),e.objCA&&(n|=1,r=0);i=String.fromCharCode(r);0!==n&&(i+=String.fromCharCode(n)),e.value=C.create(C.Class.UNIVERSAL,C.Type.BITSTRING,!1,i)}else if("subjectAltName"===e.name||"issuerAltName"===e.name){e.value=C.create(C.Class.UNIVERSAL,C.Type.SEQUENCE,!0,[]);for(var u=0;u<e.altNames.length;++u){i=(d=e.altNames[u]).value;if(7===d.type&&d.ip){if(null===(i=v.util.bytesFromIP(d.ip)))throw(g=new Error('Extension "ip" value is not a valid IPv4 or IPv6 address.')).extension=e,g}else 8===d.type&&(i=d.oid?C.oidToDer(C.oidToDer(d.oid)):C.oidToDer(i));e.value.value.push(C.create(C.Class.CONTEXT_SPECIFIC,d.type,!1,i))}}else if("subjectKeyIdentifier"===e.name&&t.cert){var c=t.cert.generateSubjectKeyIdentifier();e.subjectKeyIdentifier=c.toHex(),e.value=C.create(C.Class.UNIVERSAL,C.Type.OCTETSTRING,!1,c.getBytes())}else if("authorityKeyIdentifier"===e.name&&t.cert){e.value=C.create(C.Class.UNIVERSAL,C.Type.SEQUENCE,!0,[]);s=e.value.value;if(e.keyIdentifier){var l=!0===e.keyIdentifier?t.cert.generateSubjectKeyIdentifier().getBytes():e.keyIdentifier;s.push(C.create(C.Class.CONTEXT_SPECIFIC,0,!1,l))}if(e.authorityCertIssuer){var p=[C.create(C.Class.CONTEXT_SPECIFIC,4,!0,[E(!0===e.authorityCertIssuer?t.cert.issuer:e.authorityCertIssuer)])];s.push(C.create(C.Class.CONTEXT_SPECIFIC,1,!0,p))}if(e.serialNumber){var f=v.util.hexToBytes(!0===e.serialNumber?t.cert.serialNumber:e.serialNumber);s.push(C.create(C.Class.CONTEXT_SPECIFIC,2,!1,f))}}else if("cRLDistributionPoints"===e.name){e.value=C.create(C.Class.UNIVERSAL,C.Type.SEQUENCE,!0,[]);s=e.value.value;var d,h=C.create(C.Class.UNIVERSAL,C.Type.SEQUENCE,!0,[]),y=C.create(C.Class.CONTEXT_SPECIFIC,0,!0,[]);for(u=0;u<e.altNames.length;++u){i=(d=e.altNames[u]).value;if(7===d.type&&d.ip){if(null===(i=v.util.bytesFromIP(d.ip)))throw(g=new Error('Extension "ip" value is not a valid IPv4 or IPv6 address.')).extension=e,g}else 8===d.type&&(i=d.oid?C.oidToDer(C.oidToDer(d.oid)):C.oidToDer(i));y.value.push(C.create(C.Class.CONTEXT_SPECIFIC,d.type,!1,i))}h.value.push(C.create(C.Class.CONTEXT_SPECIFIC,0,!0,[y])),s.push(h)}var g;if("undefined"==typeof e.value)throw(g=new Error("Extension value not specified.")).extension=e,g;return e}function r(e,t){switch(e){case m["RSASSA-PSS"]:var r=[];return t.hash.algorithmOid!==undefined&&r.push(C.create(C.Class.CONTEXT_SPECIFIC,0,!0,[C.create(C.Class.UNIVERSAL,C.Type.SEQUENCE,!0,[C.create(C.Class.UNIVERSAL,C.Type.OID,!1,C.oidToDer(t.hash.algorithmOid).getBytes()),C.create(C.Class.UNIVERSAL,C.Type.NULL,!1,"")])])),t.mgf.algorithmOid!==undefined&&r.push(C.create(C.Class.CONTEXT_SPECIFIC,1,!0,[C.create(C.Class.UNIVERSAL,C.Type.SEQUENCE,!0,[C.create(C.Class.UNIVERSAL,C.Type.OID,!1,C.oidToDer(t.mgf.algorithmOid).getBytes()),C.create(C.Class.UNIVERSAL,C.Type.SEQUENCE,!0,[C.create(C.Class.UNIVERSAL,C.Type.OID,!1,C.oidToDer(t.mgf.hash.algorithmOid).getBytes()),C.create(C.Class.UNIVERSAL,C.Type.NULL,!1,"")])])])),t.saltLength!==undefined&&r.push(C.create(C.Class.CONTEXT_SPECIFIC,2,!0,[C.create(C.Class.UNIVERSAL,C.Type.INTEGER,!1,C.integerToDer(t.saltLength).getBytes())])),C.create(C.Class.UNIVERSAL,C.Type.SEQUENCE,!0,r);default:return C.create(C.Class.UNIVERSAL,C.Type.NULL,!1,"")}}I.certificateFromPem=function(e,t,r){var n=v.pem.decode(e)[0];if("CERTIFICATE"!==n.type&&"X509 CERTIFICATE"!==n.type&&"TRUSTED CERTIFICATE"!==n.type){var a=new Error('Could not convert certificate from PEM; PEM header type is not "CERTIFICATE", "X509 CERTIFICATE", or "TRUSTED CERTIFICATE".');throw a.headerType=n.type,a}if(n.procType&&"ENCRYPTED"===n.procType.type)throw new Error("Could not convert certificate from PEM; PEM is encrypted.");var i=C.fromDer(n.body,r);return I.certificateFromAsn1(i,t)},I.certificateToPem=function(e,t){var r={type:"CERTIFICATE",body:C.toDer(I.certificateToAsn1(e)).getBytes()};return v.pem.encode(r,{maxline:t})},I.publicKeyFromPem=function(e){var t=v.pem.decode(e)[0];if("PUBLIC KEY"!==t.type&&"RSA PUBLIC KEY"!==t.type){var r=new Error('Could not convert public key from PEM; PEM header type is not "PUBLIC KEY" or "RSA PUBLIC KEY".');throw r.headerType=t.type,r}if(t.procType&&"ENCRYPTED"===t.procType.type)throw new Error("Could not convert public key from PEM; PEM is encrypted.");var n=C.fromDer(t.body);return I.publicKeyFromAsn1(n)},I.publicKeyToPem=function(e,t){var r={type:"PUBLIC KEY",body:C.toDer(I.publicKeyToAsn1(e)).getBytes()};return v.pem.encode(r,{maxline:t})},I.publicKeyToRSAPublicKeyPem=function(e,t){var r={type:"RSA PUBLIC KEY",body:C.toDer(I.publicKeyToRSAPublicKey(e)).getBytes()};return v.pem.encode(r,{maxline:t})},I.getPublicKeyFingerprint=function(e,t){var r,n=(t=t||{}).md||v.md.sha1.create();switch(t.type||"RSAPublicKey"){case"RSAPublicKey":r=C.toDer(I.publicKeyToRSAPublicKey(e)).getBytes();break;case"SubjectPublicKeyInfo":r=C.toDer(I.publicKeyToAsn1(e)).getBytes();break;default:throw new Error('Unknown fingerprint type "'+t.type+'".')}n.start(),n.update(r);var a=n.digest();if("hex"===t.encoding){var i=a.toHex();return t.delimiter?i.match(/.{2}/g).join(t.delimiter):i}if("binary"===t.encoding)return a.getBytes();if(t.encoding)throw new Error('Unknown encoding "'+t.encoding+'".');return a},I.certificationRequestFromPem=function(e,t,r){var n=v.pem.decode(e)[0];if("CERTIFICATE REQUEST"!==n.type){var a=new Error('Could not convert certification request from PEM; PEM header type is not "CERTIFICATE REQUEST".');throw a.headerType=n.type,a}if(n.procType&&"ENCRYPTED"===n.procType.type)throw new Error("Could not convert certification request from PEM; PEM is encrypted.");var i=C.fromDer(n.body,r);return I.certificationRequestFromAsn1(i,t)},I.certificationRequestToPem=function(e,t){var r={type:"CERTIFICATE REQUEST",body:C.toDer(I.certificationRequestToAsn1(e)).getBytes()};return v.pem.encode(r,{maxline:t})},I.createCertificate=function(){var p={version:2,serialNumber:"00",signatureOid:null,signature:null,siginfo:{}};return p.siginfo.algorithmOid=null,p.validity={},p.validity.notBefore=new Date,p.validity.notAfter=new Date,p.issuer={},p.issuer.getField=function(e){return y(p.issuer,e)},p.issuer.addField=function(e){S([e]),p.issuer.attributes.push(e)},p.issuer.attributes=[],p.issuer.hash=null,p.subject={},p.subject.getField=function(e){return y(p.subject,e)},p.subject.addField=function(e){S([e]),p.subject.attributes.push(e)},p.subject.attributes=[],p.subject.hash=null,p.extensions=[],p.publicKey=null,p.md=null,p.setSubject=function(e,t){S(e),p.subject.attributes=e,delete p.subject.uniqueId,t&&(p.subject.uniqueId=t),p.subject.hash=null},p.setIssuer=function(e,t){S(e),p.issuer.attributes=e,delete p.issuer.uniqueId,t&&(p.issuer.uniqueId=t),p.issuer.hash=null},p.setExtensions=function(e){for(var t=0;t<e.length;++t)i(e[t],{cert:p});p.extensions=e},p.getExtension=function(e){"string"==typeof e&&(e={name:e});for(var t,r=null,n=0;null===r&&n<p.extensions.length;++n)t=p.extensions[n],e.id&&t.id===e.id?r=t:e.name&&t.name===e.name&&(r=t);return r},p.sign=function(e,t){p.md=t||v.md.sha1.create();var r=m[p.md.algorithm+"WithRSAEncryption"];if(!r){var n=new Error("Could not compute certificate digest. Unknown message digest algorithm OID.");throw n.algorithm=p.md.algorithm,n}p.signatureOid=p.siginfo.algorithmOid=r,p.tbsCertificate=I.getTBSCertificate(p);var a=C.toDer(p.tbsCertificate);p.md.update(a.getBytes()),p.signature=e.sign(p.md)},p.verify=function(e){var t=!1;if(!p.issued(e)){var r=e.issuer,n=p.subject;throw(l=new Error("The parent certificate did not issue the given child certificate; the child certificate's issuer does not match the parent's subject.")).expectedIssuer=r.attributes,l.actualIssuer=n.attributes,l}var a=e.md;if(null===a){if(e.signatureOid in m)switch(m[e.signatureOid]){case"sha1WithRSAEncryption":a=v.md.sha1.create();break;case"md5WithRSAEncryption":a=v.md.md5.create();break;case"sha256WithRSAEncryption":a=v.md.sha256.create();break;case"sha512WithRSAEncryption":a=v.md.sha512.create();break;case"RSASSA-PSS":a=v.md.sha256.create()}if(null===a)throw(l=new Error("Could not compute certificate digest. Unknown signature OID.")).signatureOid=e.signatureOid,l;var i=e.tbsCertificate||I.getTBSCertificate(e),s=C.toDer(i);a.update(s.getBytes())}if(null!==a){var o;switch(e.signatureOid){case m.sha1WithRSAEncryption:o=undefined;break;case m["RSASSA-PSS"]:var u,c,l;if((u=m[e.signatureParameters.mgf.hash.algorithmOid])===undefined||v.md[u]===undefined)throw(l=new Error("Unsupported MGF hash function.")).oid=e.signatureParameters.mgf.hash.algorithmOid,l.name=u,l;if((c=m[e.signatureParameters.mgf.algorithmOid])===undefined||v.mgf[c]===undefined)throw(l=new Error("Unsupported MGF function.")).oid=e.signatureParameters.mgf.algorithmOid,l.name=c,l;if(c=v.mgf[c].create(v.md[u].create()),(u=m[e.signatureParameters.hash.algorithmOid])===undefined||v.md[u]===undefined)throw{message:"Unsupported RSASSA-PSS hash function.",oid:e.signatureParameters.hash.algorithmOid,name:u};o=v.pss.create(v.md[u].create(),c,e.signatureParameters.saltLength)}t=p.publicKey.verify(a.digest().getBytes(),e.signature,o)}return t},p.isIssuer=function(e){var t=!1,r=p.issuer,n=e.subject;if(r.hash&&n.hash)t=r.hash===n.hash;else if(r.attributes.length===n.attributes.length){var a,i;t=!0;for(var s=0;t&&s<r.attributes.length;++s)a=r.attributes[s],i=n.attributes[s],a.type===i.type&&a.value===i.value||(t=!1)}return t},p.issued=function(e){return e.isIssuer(p)},p.generateSubjectKeyIdentifier=function(){return I.getPublicKeyFingerprint(p.publicKey,{type:"RSAPublicKey"})},p.verifySubjectKeyIdentifier=function(){for(var e=m.subjectKeyIdentifier,t=0;t<p.extensions.length;++t){var r=p.extensions[t];if(r.id===e){var n=p.generateSubjectKeyIdentifier().getBytes();return v.util.hexToBytes(r.subjectKeyIdentifier)===n}}return!1},p},I.certificateFromAsn1=function(e,t){var r={},n=[];if(!C.validate(e,h,r,n))throw(l=new Error("Cannot read X.509 certificate. ASN.1 object is not an X509v3 Certificate.")).errors=n,l;if("string"!=typeof r.certSignature){for(var a="\0",i=0;i<r.certSignature.length;++i)a+=C.toDer(r.certSignature[i]).getBytes();r.certSignature=a}if(C.derToOid(r.publicKeyOid)!==I.oids.rsaEncryption)throw new Error("Cannot read public key. OID is not RSA.");var s=I.createCertificate();s.version=r.certVersion?r.certVersion.charCodeAt(0):0;var o=v.util.createBuffer(r.certSerialNumber);s.serialNumber=o.toHex(),s.signatureOid=v.asn1.derToOid(r.certSignatureOid),s.signatureParameters=g(s.signatureOid,r.certSignatureParams,!0),s.siginfo.algorithmOid=v.asn1.derToOid(r.certinfoSignatureOid),s.siginfo.parameters=g(s.siginfo.algorithmOid,r.certinfoSignatureParams,!1);var u=v.util.createBuffer(r.certSignature);++u.read,s.signature=u.getBytes();var c=[];if(r.certValidity1UTCTime!==undefined&&c.push(C.utcTimeToDate(r.certValidity1UTCTime)),r.certValidity2GeneralizedTime!==undefined&&c.push(C.generalizedTimeToDate(r.certValidity2GeneralizedTime)),r.certValidity3UTCTime!==undefined&&c.push(C.utcTimeToDate(r.certValidity3UTCTime)),r.certValidity4GeneralizedTime!==undefined&&c.push(C.generalizedTimeToDate(r.certValidity4GeneralizedTime)),2<c.length)throw new Error("Cannot read notBefore/notAfter validity times; more than two times were provided in the certificate.");if(c.length<2)throw new Error("Cannot read notBefore/notAfter validity times; they were not provided as either UTCTime or GeneralizedTime.");if(s.validity.notBefore=c[0],s.validity.notAfter=c[1],s.tbsCertificate=r.tbsCertificate,t){var l;if(s.md=null,s.signatureOid in m)switch(m[s.signatureOid]){case"sha1WithRSAEncryption":s.md=v.md.sha1.create();break;case"md5WithRSAEncryption":s.md=v.md.md5.create();break;case"sha256WithRSAEncryption":s.md=v.md.sha256.create();break;case"sha512WithRSAEncryption":s.md=v.md.sha512.create();break;case"RSASSA-PSS":s.md=v.md.sha256.create()}if(null===s.md)throw(l=new Error("Could not compute certificate digest. Unknown signature OID.")).signatureOid=s.signatureOid,l;var p=C.toDer(s.tbsCertificate);s.md.update(p.getBytes())}var f=v.md.sha1.create();s.issuer.getField=function(e){return y(s.issuer,e)},s.issuer.addField=function(e){S([e]),s.issuer.attributes.push(e)},s.issuer.attributes=I.RDNAttributesAsArray(r.certIssuer,f),r.certIssuerUniqueId&&(s.issuer.uniqueId=r.certIssuerUniqueId),s.issuer.hash=f.digest().toHex();var d=v.md.sha1.create();return s.subject.getField=function(e){return y(s.subject,e)},s.subject.addField=function(e){S([e]),s.subject.attributes.push(e)},s.subject.attributes=I.RDNAttributesAsArray(r.certSubject,d),r.certSubjectUniqueId&&(s.subject.uniqueId=r.certSubjectUniqueId),s.subject.hash=d.digest().toHex(),r.certExtensions?s.extensions=I.certificateExtensionsFromAsn1(r.certExtensions):s.extensions=[],s.publicKey=I.publicKeyFromAsn1(r.subjectPublicKeyInfo),s},I.certificateExtensionsFromAsn1=function(e){for(var t=[],r=0;r<e.value.length;++r)for(var n=e.value[r],a=0;a<n.value.length;++a)t.push(I.certificateExtensionFromAsn1(n.value[a]));return t},I.certificateExtensionFromAsn1=function(e){var t={};if(t.id=C.derToOid(e.value[0].value),t.critical=!1,e.value[1].type===C.Type.BOOLEAN?(t.critical=0!==e.value[1].value.charCodeAt(0),t.value=e.value[2].value):t.value=e.value[1].value,t.id in m)if(t.name=m[t.id],"keyUsage"===t.name){var r=0,n=0;1<(i=C.fromDer(t.value)).value.length&&(r=i.value.charCodeAt(1),n=2<i.value.length?i.value.charCodeAt(2):0),t.digitalSignature=128==(128&r),t.nonRepudiation=64==(64&r),t.keyEncipherment=32==(32&r),t.dataEncipherment=16==(16&r),t.keyAgreement=8==(8&r),t.keyCertSign=4==(4&r),t.cRLSign=2==(2&r),t.encipherOnly=1==(1&r),t.decipherOnly=128==(128&n)}else if("basicConstraints"===t.name){0<(i=C.fromDer(t.value)).value.length&&i.value[0].type===C.Type.BOOLEAN?t.cA=0!==i.value[0].value.charCodeAt(0):t.cA=!1;var a=null;0<i.value.length&&i.value[0].type===C.Type.INTEGER?a=i.value[0].value:1<i.value.length&&(a=i.value[1].value),null!==a&&(t.pathLenConstraint=C.derToInteger(a))}else if("extKeyUsage"===t.name)for(var i=C.fromDer(t.value),s=0;s<i.value.length;++s){var o=C.derToOid(i.value[s].value);o in m?t[m[o]]=!0:t[o]=!0}else if("nsCertType"===t.name){r=0;1<(i=C.fromDer(t.value)).value.length&&(r=i.value.charCodeAt(1)),t.client=128==(128&r),t.server=64==(64&r),t.email=32==(32&r),t.objsign=16==(16&r),t.reserved=8==(8&r),t.sslCA=4==(4&r),t.emailCA=2==(2&r),t.objCA=1==(1&r)}else if("subjectAltName"===t.name||"issuerAltName"===t.name){var u;t.altNames=[];i=C.fromDer(t.value);for(var c=0;c<i.value.length;++c){var l={type:(u=i.value[c]).type,value:u.value};switch(t.altNames.push(l),u.type){case 1:case 2:case 6:break;case 7:l.ip=v.util.bytesToIP(u.value);break;case 8:l.oid=C.derToOid(u.value)}}}else if("subjectKeyIdentifier"===t.name){i=C.fromDer(t.value);t.subjectKeyIdentifier=v.util.bytesToHex(i.value)}return t},I.certificationRequestFromAsn1=function(e,t){var r={},n=[];if(!C.validate(e,p,r,n))throw(u=new Error("Cannot read PKCS#10 certificate request. ASN.1 object is not a PKCS#10 CertificationRequest.")).errors=n,u;if("string"!=typeof r.csrSignature){for(var a="\0",i=0;i<r.csrSignature.length;++i)a+=C.toDer(r.csrSignature[i]).getBytes();r.csrSignature=a}if(C.derToOid(r.publicKeyOid)!==I.oids.rsaEncryption)throw new Error("Cannot read public key. OID is not RSA.");var s=I.createCertificationRequest();s.version=r.csrVersion?r.csrVersion.charCodeAt(0):0,s.signatureOid=v.asn1.derToOid(r.csrSignatureOid),s.signatureParameters=g(s.signatureOid,r.csrSignatureParams,!0),s.siginfo.algorithmOid=v.asn1.derToOid(r.csrSignatureOid),s.siginfo.parameters=g(s.siginfo.algorithmOid,r.csrSignatureParams,!1);var o=v.util.createBuffer(r.csrSignature);if(++o.read,s.signature=o.getBytes(),s.certificationRequestInfo=r.certificationRequestInfo,t){var u;if(s.md=null,s.signatureOid in m)switch(m[s.signatureOid]){case"sha1WithRSAEncryption":s.md=v.md.sha1.create();break;case"md5WithRSAEncryption":s.md=v.md.md5.create();break;case"sha256WithRSAEncryption":s.md=v.md.sha256.create();break;case"sha512WithRSAEncryption":s.md=v.md.sha512.create();break;case"RSASSA-PSS":s.md=v.md.sha256.create()}if(null===s.md)throw(u=new Error("Could not compute certification request digest. Unknown signature OID.")).signatureOid=s.signatureOid,u;var c=C.toDer(s.certificationRequestInfo);s.md.update(c.getBytes())}var l=v.md.sha1.create();return s.subject.getField=function(e){return y(s.subject,e)},s.subject.addField=function(e){S([e]),s.subject.attributes.push(e)},s.subject.attributes=I.RDNAttributesAsArray(r.certificationRequestInfoSubject,l),s.subject.hash=l.digest().toHex(),s.publicKey=I.publicKeyFromAsn1(r.subjectPublicKeyInfo),s.getAttribute=function(e){return y(s,e)},s.addAttribute=function(e){S([e]),s.attributes.push(e)},s.attributes=I.CRIAttributesAsArray(r.certificationRequestInfoAttributes||[]),s},I.createCertificationRequest=function(){var u={version:0,signatureOid:null,signature:null,siginfo:{}};return u.siginfo.algorithmOid=null,u.subject={},u.subject.getField=function(e){return y(u.subject,e)},u.subject.addField=function(e){S([e]),u.subject.attributes.push(e)},u.subject.attributes=[],u.subject.hash=null,u.publicKey=null,u.attributes=[],u.getAttribute=function(e){return y(u,e)},u.addAttribute=function(e){S([e]),u.attributes.push(e)},u.md=null,u.setSubject=function(e){S(e),u.subject.attributes=e,u.subject.hash=null},u.setAttributes=function(e){S(e),u.attributes=e},u.sign=function(e,t){u.md=t||v.md.sha1.create();var r=m[u.md.algorithm+"WithRSAEncryption"];if(!r){var n=new Error("Could not compute certification request digest. Unknown message digest algorithm OID.");throw n.algorithm=u.md.algorithm,n}u.signatureOid=u.siginfo.algorithmOid=r,u.certificationRequestInfo=I.getCertificationRequestInfo(u);var a=C.toDer(u.certificationRequestInfo);u.md.update(a.getBytes()),u.signature=e.sign(u.md)},u.verify=function(){var e=!1,t=u.md;if(null===t){if(u.signatureOid in m)switch(m[u.signatureOid]){case"sha1WithRSAEncryption":t=v.md.sha1.create();break;case"md5WithRSAEncryption":t=v.md.md5.create();break;case"sha256WithRSAEncryption":t=v.md.sha256.create();break;case"sha512WithRSAEncryption":t=v.md.sha512.create();break;case"RSASSA-PSS":t=v.md.sha256.create()}if(null===t)throw(o=new Error("Could not compute certification request digest. Unknown signature OID.")).signatureOid=u.signatureOid,o;var r=u.certificationRequestInfo||I.getCertificationRequestInfo(u),n=C.toDer(r);t.update(n.getBytes())}if(null!==t){var a;switch(u.signatureOid){case m.sha1WithRSAEncryption:break;case m["RSASSA-PSS"]:var i,s,o;if((i=m[u.signatureParameters.mgf.hash.algorithmOid])===undefined||v.md[i]===undefined)throw(o=new Error("Unsupported MGF hash function.")).oid=u.signatureParameters.mgf.hash.algorithmOid,o.name=i,o;if((s=m[u.signatureParameters.mgf.algorithmOid])===undefined||v.mgf[s]===undefined)throw(o=new Error("Unsupported MGF function.")).oid=u.signatureParameters.mgf.algorithmOid,o.name=s,o;if(s=v.mgf[s].create(v.md[i].create()),(i=m[u.signatureParameters.hash.algorithmOid])===undefined||v.md[i]===undefined)throw(o=new Error("Unsupported RSASSA-PSS hash function.")).oid=u.signatureParameters.hash.algorithmOid,o.name=i,o;a=v.pss.create(v.md[i].create(),s,u.signatureParameters.saltLength)}e=u.publicKey.verify(t.digest().getBytes(),u.signature,a)}return e},u},I.getTBSCertificate=function(e){var t=C.create(C.Class.UNIVERSAL,C.Type.SEQUENCE,!0,[C.create(C.Class.CONTEXT_SPECIFIC,0,!0,[C.create(C.Class.UNIVERSAL,C.Type.INTEGER,!1,C.integerToDer(e.version).getBytes())]),C.create(C.Class.UNIVERSAL,C.Type.INTEGER,!1,v.util.hexToBytes(e.serialNumber)),C.create(C.Class.UNIVERSAL,C.Type.SEQUENCE,!0,[C.create(C.Class.UNIVERSAL,C.Type.OID,!1,C.oidToDer(e.siginfo.algorithmOid).getBytes()),r(e.siginfo.algorithmOid,e.siginfo.parameters)]),E(e.issuer),C.create(C.Class.UNIVERSAL,C.Type.SEQUENCE,!0,[C.create(C.Class.UNIVERSAL,C.Type.UTCTIME,!1,C.dateToUtcTime(e.validity.notBefore)),C.create(C.Class.UNIVERSAL,C.Type.UTCTIME,!1,C.dateToUtcTime(e.validity.notAfter))]),E(e.subject),I.publicKeyToAsn1(e.publicKey)]);return e.issuer.uniqueId&&t.value.push(C.create(C.Class.CONTEXT_SPECIFIC,1,!0,[C.create(C.Class.UNIVERSAL,C.Type.BITSTRING,!1,String.fromCharCode(0)+e.issuer.uniqueId)])),e.subject.uniqueId&&t.value.push(C.create(C.Class.CONTEXT_SPECIFIC,2,!0,[C.create(C.Class.UNIVERSAL,C.Type.BITSTRING,!1,String.fromCharCode(0)+e.subject.uniqueId)])),0<e.extensions.length&&t.value.push(I.certificateExtensionsToAsn1(e.extensions)),t},I.getCertificationRequestInfo=function(e){return C.create(C.Class.UNIVERSAL,C.Type.SEQUENCE,!0,[C.create(C.Class.UNIVERSAL,C.Type.INTEGER,!1,C.integerToDer(e.version).getBytes()),E(e.subject),I.publicKeyToAsn1(e.publicKey),function c(e){var t=C.create(C.Class.CONTEXT_SPECIFIC,0,!0,[]);if(0===e.attributes.length)return t;for(var r=e.attributes,n=0;n<r.length;++n){var a=r[n],i=a.value,s=C.Type.UTF8;"valueTagClass"in a&&(s=a.valueTagClass),s===C.Type.UTF8&&(i=v.util.encodeUtf8(i));var o=!1;"valueConstructed"in a&&(o=a.valueConstructed);var u=C.create(C.Class.UNIVERSAL,C.Type.SEQUENCE,!0,[C.create(C.Class.UNIVERSAL,C.Type.OID,!1,C.oidToDer(a.type).getBytes()),C.create(C.Class.UNIVERSAL,C.Type.SET,!0,[C.create(C.Class.UNIVERSAL,s,o,i)])]);t.value.push(u)}return t}(e)])},I.distinguishedNameToAsn1=function(e){return E(e)},I.certificateToAsn1=function(e){var t=e.tbsCertificate||I.getTBSCertificate(e);return C.create(C.Class.UNIVERSAL,C.Type.SEQUENCE,!0,[t,C.create(C.Class.UNIVERSAL,C.Type.SEQUENCE,!0,[C.create(C.Class.UNIVERSAL,C.Type.OID,!1,C.oidToDer(e.signatureOid).getBytes()),r(e.signatureOid,e.signatureParameters)]),C.create(C.Class.UNIVERSAL,C.Type.BITSTRING,!1,String.fromCharCode(0)+e.signature)])},I.certificateExtensionsToAsn1=function(e){var t=C.create(C.Class.CONTEXT_SPECIFIC,3,!0,[]),r=C.create(C.Class.UNIVERSAL,C.Type.SEQUENCE,!0,[]);t.value.push(r);for(var n=0;n<e.length;++n)r.value.push(I.certificateExtensionToAsn1(e[n]));return t},I.certificateExtensionToAsn1=function(e){var t=C.create(C.Class.UNIVERSAL,C.Type.SEQUENCE,!0,[]);t.value.push(C.create(C.Class.UNIVERSAL,C.Type.OID,!1,C.oidToDer(e.id).getBytes())),e.critical&&t.value.push(C.create(C.Class.UNIVERSAL,C.Type.BOOLEAN,!1,String.fromCharCode(255)));var r=e.value;return"string"!=typeof e.value&&(r=C.toDer(r).getBytes()),t.value.push(C.create(C.Class.UNIVERSAL,C.Type.OCTETSTRING,!1,r)),t},I.certificationRequestToAsn1=function(e){var t=e.certificationRequestInfo||I.getCertificationRequestInfo(e);return C.create(C.Class.UNIVERSAL,C.Type.SEQUENCE,!0,[t,C.create(C.Class.UNIVERSAL,C.Type.SEQUENCE,!0,[C.create(C.Class.UNIVERSAL,C.Type.OID,!1,C.oidToDer(e.signatureOid).getBytes()),r(e.signatureOid,e.signatureParameters)]),C.create(C.Class.UNIVERSAL,C.Type.BITSTRING,!1,String.fromCharCode(0)+e.signature)])},I.createCaStore=function(e){var i={certs:{}};function s(e){return o(e),i.certs[e.hash]||null}function o(e){if(!e.hash){var t=v.md.sha1.create();e.attributes=I.RDNAttributesAsArray(E(e),t),e.hash=t.digest().toHex()}}if(i.getIssuer=function(e){return s(e.issuer)},i.addCertificate=function(e){if("string"==typeof e&&(e=v.pki.certificateFromPem(e)),o(e.subject),!i.hasCertificate(e))if(e.subject.hash in i.certs){var t=i.certs[e.subject.hash];v.util.isArray(t)||(t=[t]),t.push(e),i.certs[e.subject.hash]=t}else i.certs[e.subject.hash]=e},i.hasCertificate=function(e){"string"==typeof e&&(e=v.pki.certificateFromPem(e));var t=s(e.subject);if(!t)return!1;v.util.isArray(t)||(t=[t]);for(var r=C.toDer(I.certificateToAsn1(e)).getBytes(),n=0;n<t.length;++n){if(r===C.toDer(I.certificateToAsn1(t[n])).getBytes())return!0}return!1},i.listAllCertificates=function(){var e=[];for(var t in i.certs)if(i.certs.hasOwnProperty(t)){var r=i.certs[t];if(v.util.isArray(r))for(var n=0;n<r.length;++n)e.push(r[n]);else e.push(r)}return e},i.removeCertificate=function(e){var t;if("string"==typeof e&&(e=v.pki.certificateFromPem(e)),o(e.subject),!i.hasCertificate(e))return null;var r=s(e.subject);if(!v.util.isArray(r))return t=i.certs[e.subject.hash],delete i.certs[e.subject.hash],t;for(var n=C.toDer(I.certificateToAsn1(e)).getBytes(),a=0;a<r.length;++a){n===C.toDer(I.certificateToAsn1(r[a])).getBytes()&&(t=r[a],r.splice(a,1))}return 0===r.length&&delete i.certs[e.subject.hash],t},e)for(var t=0;t<e.length;++t){var r=e[t];i.addCertificate(r)}return i},I.certificateError={bad_certificate:"forge.pki.BadCertificate",unsupported_certificate:"forge.pki.UnsupportedCertificate",certificate_revoked:"forge.pki.CertificateRevoked",certificate_expired:"forge.pki.CertificateExpired",certificate_unknown:"forge.pki.CertificateUnknown",unknown_ca:"forge.pki.UnknownCertificateAuthority"},I.verifyCertificateChain=function(e,t,r){var n=(t=t.slice(0)).slice(0),a=new Date,i=!0,s=null,o=0;do{var u=t.shift(),c=null,l=!1;if((a<u.validity.notBefore||a>u.validity.notAfter)&&(s={message:"Certificate is not valid yet or has expired.",error:I.certificateError.certificate_expired,notBefore:u.validity.notBefore,notAfter:u.validity.notAfter,now:a}),null===s){if(null===(c=t[0]||e.getIssuer(u))&&u.isIssuer(u)&&(l=!0,c=u),c){var p=c;v.util.isArray(p)||(p=[p]);for(var f=!1;!f&&0<p.length;){c=p.shift();try{f=c.verify(u)}catch(S){}}f||(s={message:"Certificate signature is invalid.",error:I.certificateError.bad_certificate})}null!==s||c&&!l||e.hasCertificate(u)||(s={message:"Certificate is not trusted.",error:I.certificateError.unknown_ca})}if(null===s&&c&&!u.isIssuer(c)&&(s={message:"Certificate issuer is invalid.",error:I.certificateError.bad_certificate}),null===s)for(var d={keyUsage:!0,basicConstraints:!0},h=0;null===s&&h<u.extensions.length;++h){var y=u.extensions[h];!y.critical||y.name in d||(s={message:"Certificate has an unsupported critical extension.",error:I.certificateError.unsupported_certificate})}if(null===s&&(!i||0===t.length&&(!c||l))){var g=u.getExtension("basicConstraints"),C=u.getExtension("keyUsage");if(null!==C&&(C.keyCertSign&&null!==g||(s={message:"Certificate keyUsage or basicConstraints conflict or indicate that the certificate is not a CA. If the certificate is the only one in the chain or isn't the first then the certificate must be a valid CA.",error:I.certificateError.bad_certificate})),null!==s||null===g||g.cA||(s={message:"Certificate basicConstraints indicates the certificate is not a CA.",error:I.certificateError.bad_certificate}),null===s&&null!==C&&"pathLenConstraint"in g)o-1>g.pathLenConstraint&&(s={message:"Certificate basicConstraints pathLenConstraint violated.",error:I.certificateError.bad_certificate})}var m=null===s||s.error,E=r?r(m,o,n):m;if(!0!==E)throw!0===m&&(s={message:"The application rejected the certificate.",error:I.certificateError.bad_certificate}),(E||0===E)&&("object"!=typeof E||v.util.isArray(E)?"string"==typeof E&&(s.error=E):(E.message&&(s.message=E.message),E.error&&(s.error=E.error))),s;s=null,i=!1,++o}while(0<t.length);return!0}}var i,s="x509";if("function"!=typeof define){if("object"!=typeof module||!module.exports)return"undefined"==typeof forge&&(forge={}),a(forge);var r=!0;define=function(e,t){t(require,module)}}var n=define;define=function(e,t){return i="string"==typeof e?t.slice(2):e.slice(2),r?(delete define,n.apply(null,Array.prototype.slice.call(arguments,0))):(define=n,define.apply(null,Array.prototype.slice.call(arguments,0)))},define(["require","module","./aes","./asn1","./des","./md","./mgf","./oids","./pem","./pss","./rsa","./util"],function(){(function(n,e){e.exports=function(e){var t=i.map(function(e){return n(e)}).concat(a);if((e=e||{}).defined=e.defined||{},e.defined[s])return e[s];e.defined[s]=!0;for(var r=0;r<t.length;++r)t[r](e);return e.pki}}).apply(null,Array.prototype.slice.call(arguments,0))})}(),function(){function a(e){e.md=e.md||{},e.md.algorithms={md5:e.md5,sha1:e.sha1,sha256:e.sha256},e.md.md5=e.md5,e.md.sha1=e.sha1,e.md.sha256=e.sha256}var i;if("function"!=typeof define){if("object"!=typeof module||!module.exports)return"undefined"==typeof forge&&(forge={}),a(forge);var r=!0;define=function(e,t){t(require,module)}}var n=define;define=function(e,t){return i="string"==typeof e?t.slice(2):e.slice(2),r?(delete define,n.apply(null,Array.prototype.slice.call(arguments,0))):(define=n,define.apply(null,Array.prototype.slice.call(arguments,0)))},define(["require","module","./md5","./sha1","./sha256","./sha512"],function(){(function(n,e){e.exports=function(e){var t=i.map(function(e){return n(e)}).concat(a);if((e=e||{}).defined=e.defined||{},e.defined.md)return e.md;e.defined.md=!0;for(var r=0;r<t.length;++r)t[r](e);return e.md}}).apply(null,Array.prototype.slice.call(arguments,0))})}(),function(){function a(U){if(void 0===e)var e=U.jsbn.BigInteger;var v=U.asn1,I=U.pki=U.pki||{};I.pbe=U.pbe=U.pbe||{};var T=I.oids,c={name:"EncryptedPrivateKeyInfo",tagClass:v.Class.UNIVERSAL,type:v.Type.SEQUENCE,constructed:!0,value:[{name:"EncryptedPrivateKeyInfo.encryptionAlgorithm",tagClass:v.Class.UNIVERSAL,type:v.Type.SEQUENCE,constructed:!0,value:[{name:"AlgorithmIdentifier.algorithm",tagClass:v.Class.UNIVERSAL,type:v.Type.OID,constructed:!1,capture:"encryptionOid"},{name:"AlgorithmIdentifier.parameters",tagClass:v.Class.UNIVERSAL,type:v.Type.SEQUENCE,constructed:!0,captureAsn1:"encryptionParams"}]},{name:"EncryptedPrivateKeyInfo.encryptedData",tagClass:v.Class.UNIVERSAL,type:v.Type.OCTETSTRING,constructed:!1,capture:"encryptedData"}]},h={name:"PBES2Algorithms",tagClass:v.Class.UNIVERSAL,type:v.Type.SEQUENCE,constructed:!0,value:[{name:"PBES2Algorithms.keyDerivationFunc",tagClass:v.Class.UNIVERSAL,type:v.Type.SEQUENCE,constructed:!0,value:[{name:"PBES2Algorithms.keyDerivationFunc.oid",tagClass:v.Class.UNIVERSAL,type:v.Type.OID,constructed:!1,capture:"kdfOid"},{name:"PBES2Algorithms.params",tagClass:v.Class.UNIVERSAL,type:v.Type.SEQUENCE,constructed:!0,value:[{name:"PBES2Algorithms.params.salt",tagClass:v.Class.UNIVERSAL,type:v.Type.OCTETSTRING,constructed:!1,capture:"kdfSalt"},{name:"PBES2Algorithms.params.iterationCount",tagClass:v.Class.UNIVERSAL,type:v.Type.INTEGER,constructed:!1,capture:"kdfIterationCount"},{name:"PBES2Algorithms.params.keyLength",tagClass:v.Class.UNIVERSAL,type:v.Type.INTEGER,constructed:!1,optional:!0,capture:"keyLength"},{name:"PBES2Algorithms.params.prf",tagClass:v.Class.UNIVERSAL,type:v.Type.SEQUENCE,constructed:!0,optional:!0,value:[{name:"PBES2Algorithms.params.prf.algorithm",tagClass:v.Class.UNIVERSAL,type:v.Type.OID,constructed:!1,capture:"prfOid"}]}]}]},{name:"PBES2Algorithms.encryptionScheme",tagClass:v.Class.UNIVERSAL,type:v.Type.SEQUENCE,constructed:!0,value:[{name:"PBES2Algorithms.encryptionScheme.oid",tagClass:v.Class.UNIVERSAL,type:v.Type.OID,constructed:!1,capture:"encOid"},{name:"PBES2Algorithms.encryptionScheme.iv",tagClass:v.Class.UNIVERSAL,type:v.Type.OCTETSTRING,constructed:!1,capture:"encIv"}]}]},d={name:"pkcs-12PbeParams",tagClass:v.Class.UNIVERSAL,type:v.Type.SEQUENCE,constructed:!0,value:[{name:"pkcs-12PbeParams.salt",tagClass:v.Class.UNIVERSAL,type:v.Type.OCTETSTRING,constructed:!1,capture:"salt"},{name:"pkcs-12PbeParams.iterations",tagClass:v.Class.UNIVERSAL,type:v.Type.INTEGER,constructed:!1,capture:"iterations"}]};function o(e,t){return e.start().update(t).digest().getBytes()}function y(e){var t;if(e){if(!(t=I.oids[v.derToOid(e)])){var r=new Error("Unsupported PRF OID.");throw r.oid=e,r.supported=["hmacWithSHA1","hmacWithSHA224","hmacWithSHA256","hmacWithSHA384","hmacWithSHA512"],r}}else t="hmacWithSHA1";return A(t)}function A(e){var t=U.md;switch(e){case"hmacWithSHA224":t=U.md.sha512;case"hmacWithSHA1":case"hmacWithSHA256":case"hmacWithSHA384":case"hmacWithSHA512":e=e.substr(8).toLowerCase();break;default:var r=new Error("Unsupported PRF algorithm.");throw r.algorithm=e,r.supported=["hmacWithSHA1","hmacWithSHA224","hmacWithSHA256","hmacWithSHA384","hmacWithSHA512"],r}return t[e].create()}I.encryptPrivateKeyInfo=function(e,t,r){(r=r||{}).saltSize=r.saltSize||8,r.count=r.count||2048,r.algorithm=r.algorithm||"aes128",r.prfAlgorithm=r.prfAlgorithm||"sha1";var n,a,i,s=U.random.getBytesSync(r.saltSize),o=r.count,u=v.integerToDer(o);if(0===r.algorithm.indexOf("aes")||"des"===r.algorithm){var c,l,p;switch(r.algorithm){case"aes128":c=n=16,l=T["aes128-CBC"],p=U.aes.createEncryptionCipher;break;case"aes192":n=24,c=16,l=T["aes192-CBC"],p=U.aes.createEncryptionCipher;break;case"aes256":n=32,c=16,l=T["aes256-CBC"],p=U.aes.createEncryptionCipher;break;case"des":c=n=8,l=T.desCBC,p=U.des.createEncryptionCipher;break;default:throw(C=new Error("Cannot encrypt private key. Unknown encryption algorithm.")).algorithm=r.algorithm,C}var f="hmacWith"+r.prfAlgorithm.toUpperCase(),d=A(f),h=U.pkcs5.pbkdf2(t,s,o,n,d),y=U.random.getBytesSync(c);(m=p(h)).start(y),m.update(v.toDer(e)),m.finish(),i=m.output.getBytes();var g=function S(e,t,r,n){var a=v.create(v.Class.UNIVERSAL,v.Type.SEQUENCE,!0,[v.create(v.Class.UNIVERSAL,v.Type.OCTETSTRING,!1,e),v.create(v.Class.UNIVERSAL,v.Type.INTEGER,!1,t.getBytes())]);"hmacWithSHA1"!==n&&a.value.push(v.create(v.Class.UNIVERSAL,v.Type.INTEGER,!1,U.util.hexToBytes(r.toString(16))),v.create(v.Class.UNIVERSAL,v.Type.SEQUENCE,!0,[v.create(v.Class.UNIVERSAL,v.Type.OID,!1,v.oidToDer(I.oids[n]).getBytes()),v.create(v.Class.UNIVERSAL,v.Type.NULL,!1,"")]));return a}(s,u,n,f);a=v.create(v.Class.UNIVERSAL,v.Type.SEQUENCE,!0,[v.create(v.Class.UNIVERSAL,v.Type.OID,!1,v.oidToDer(T.pkcs5PBES2).getBytes()),v.create(v.Class.UNIVERSAL,v.Type.SEQUENCE,!0,[v.create(v.Class.UNIVERSAL,v.Type.SEQUENCE,!0,[v.create(v.Class.UNIVERSAL,v.Type.OID,!1,v.oidToDer(T.pkcs5PBKDF2).getBytes()),g]),v.create(v.Class.UNIVERSAL,v.Type.SEQUENCE,!0,[v.create(v.Class.UNIVERSAL,v.Type.OID,!1,v.oidToDer(l).getBytes()),v.create(v.Class.UNIVERSAL,v.Type.OCTETSTRING,!1,y)])])])}else{var C;if("3des"!==r.algorithm)throw(C=new Error("Cannot encrypt private key. Unknown encryption algorithm.")).algorithm=r.algorithm,C;n=24;var m,E=new U.util.ByteBuffer(s);h=I.pbe.generatePkcs12Key(t,E,1,o,n),y=I.pbe.generatePkcs12Key(t,E,2,o,n);(m=U.des.createEncryptionCipher(h)).start(y),m.update(v.toDer(e)),m.finish(),i=m.output.getBytes(),a=v.create(v.Class.UNIVERSAL,v.Type.SEQUENCE,!0,[v.create(v.Class.UNIVERSAL,v.Type.OID,!1,v.oidToDer(T["pbeWithSHAAnd3-KeyTripleDES-CBC"]).getBytes()),v.create(v.Class.UNIVERSAL,v.Type.SEQUENCE,!0,[v.create(v.Class.UNIVERSAL,v.Type.OCTETSTRING,!1,s),v.create(v.Class.UNIVERSAL,v.Type.INTEGER,!1,u.getBytes())])])}return v.create(v.Class.UNIVERSAL,v.Type.SEQUENCE,!0,[a,v.create(v.Class.UNIVERSAL,v.Type.OCTETSTRING,!1,i)])},I.decryptPrivateKeyInfo=function(e,t){var r=null,n={},a=[];if(!v.validate(e,c,n,a)){var i=new Error("Cannot read encrypted private key. ASN.1 object is not a supported EncryptedPrivateKeyInfo.");throw i.errors=a,i}var s=v.derToOid(n.encryptionOid),o=I.pbe.getCipher(s,n.encryptionParams,t),u=U.util.createBuffer(n.encryptedData);return o.update(u),o.finish()&&(r=v.fromDer(o.output)),r},I.encryptedPrivateKeyToPem=function(e,t){var r={type:"ENCRYPTED PRIVATE KEY",body:v.toDer(e).getBytes()};return U.pem.encode(r,{maxline:t})},I.encryptedPrivateKeyFromPem=function(e){var t=U.pem.decode(e)[0];if("ENCRYPTED PRIVATE KEY"!==t.type){var r=new Error('Could not convert encrypted private key from PEM; PEM header type is "ENCRYPTED PRIVATE KEY".');throw r.headerType=t.type,r}if(t.procType&&"ENCRYPTED"===t.procType.type)throw new Error("Could not convert encrypted private key from PEM; PEM is encrypted.");return v.fromDer(t.body)},I.encryptRsaPrivateKey=function(e,t,r){if(!(r=r||{}).legacy){var n=I.wrapRsaPrivateKey(I.privateKeyToAsn1(e));return n=I.encryptPrivateKeyInfo(n,t,r),I.encryptedPrivateKeyToPem(n)}var a,i,s,o;switch(r.algorithm){case"aes128":a="AES-128-CBC",s=16,i=U.random.getBytesSync(16),o=U.aes.createEncryptionCipher;break;case"aes192":a="AES-192-CBC",s=24,i=U.random.getBytesSync(16),o=U.aes.createEncryptionCipher;break;case"aes256":a="AES-256-CBC",s=32,i=U.random.getBytesSync(16),o=U.aes.createEncryptionCipher;break;case"3des":a="DES-EDE3-CBC",s=24,i=U.random.getBytesSync(8),o=U.des.createEncryptionCipher;break;case"des":a="DES-CBC",s=8,i=U.random.getBytesSync(8),o=U.des.createEncryptionCipher;break;default:var u=new Error('Could not encrypt RSA private key; unsupported encryption algorithm "'+r.algorithm+'".');throw u.algorithm=r.algorithm,u}var c=o(U.pbe.opensslDeriveBytes(t,i.substr(0,8),s));c.start(i),c.update(v.toDer(I.privateKeyToAsn1(e))),c.finish();var l={type:"RSA PRIVATE KEY",procType:{version:"4",type:"ENCRYPTED"},dekInfo:{algorithm:a,parameters:U.util.bytesToHex(i).toUpperCase()},body:c.output.getBytes()};return U.pem.encode(l)},I.decryptRsaPrivateKey=function(e,t){var r=null,n=U.pem.decode(e)[0];if("ENCRYPTED PRIVATE KEY"!==n.type&&"PRIVATE KEY"!==n.type&&"RSA PRIVATE KEY"!==n.type)throw(s=new Error('Could not convert private key from PEM; PEM header type is not "ENCRYPTED PRIVATE KEY", "PRIVATE KEY", or "RSA PRIVATE KEY".')).headerType=s;if(n.procType&&"ENCRYPTED"===n.procType.type){var a,i;switch(n.dekInfo.algorithm){case"DES-CBC":a=8,i=U.des.createDecryptionCipher;break;case"DES-EDE3-CBC":a=24,i=U.des.createDecryptionCipher;break;case"AES-128-CBC":a=16,i=U.aes.createDecryptionCipher;break;case"AES-192-CBC":a=24,i=U.aes.createDecryptionCipher;break;case"AES-256-CBC":a=32,i=U.aes.createDecryptionCipher;break;case"RC2-40-CBC":a=5,i=function(e){return U.rc2.createDecryptionCipher(e,40)};break;case"RC2-64-CBC":a=8,i=function(e){return U.rc2.createDecryptionCipher(e,64)};break;case"RC2-128-CBC":a=16,i=function(e){return U.rc2.createDecryptionCipher(e,128)};break;default:var s;throw(s=new Error('Could not decrypt private key; unsupported encryption algorithm "'+n.dekInfo.algorithm+'".')).algorithm=n.dekInfo.algorithm,s}var o=U.util.hexToBytes(n.dekInfo.parameters),u=i(U.pbe.opensslDeriveBytes(t,o.substr(0,8),a));if(u.start(o),u.update(U.util.createBuffer(n.body)),!u.finish())return r;r=u.output.getBytes()}else r=n.body;return null!==(r="ENCRYPTED PRIVATE KEY"===n.type?I.decryptPrivateKeyInfo(v.fromDer(r),t):v.fromDer(r))&&(r=I.privateKeyFromAsn1(r)),r},I.pbe.generatePkcs12Key=function(e,t,r,n,a,i){var s,o;null==i&&(i=U.md.sha1.create());var u=i.digestLength,c=i.blockLength,l=new U.util.ByteBuffer,p=new U.util.ByteBuffer;if(null!==e&&e!==undefined){for(o=0;o<e.length;o++)p.putInt16(e.charCodeAt(o));p.putInt16(0)}var f=p.length(),d=t.length(),h=new U.util.ByteBuffer;h.fillWithByte(r,c);var y=c*Math.ceil(d/c),g=new U.util.ByteBuffer;for(o=0;o<y;o++)g.putByte(t.at(o%d));var C=c*Math.ceil(f/c),m=new U.util.ByteBuffer;for(o=0;o<C;o++)m.putByte(p.at(o%f));var E=g;E.putBuffer(m);for(var S=Math.ceil(a/u),v=1;v<=S;v++){var I=new U.util.ByteBuffer;I.putBytes(h.bytes()),I.putBytes(E.bytes());for(var T=0;T<n;T++)i.start(),i.update(I.getBytes()),I=i.digest();var A=new U.util.ByteBuffer;for(o=0;o<c;o++)A.putByte(I.at(o%u));var N=Math.ceil(d/c)+Math.ceil(f/c),b=new U.util.ByteBuffer;for(s=0;s<N;s++){var B=new U.util.ByteBuffer(E.getBytes(c)),R=511;for(o=A.length()-1;0<=o;o--)R>>=8,R+=A.at(o)+B.at(o),B.setAt(o,255&R);b.putBuffer(B)}E=b,l.putBuffer(I)}return l.truncate(l.length()-a),l},I.pbe.getCipher=function(e,t,r){switch(e){case I.oids.pkcs5PBES2:return I.pbe.getCipherForPBES2(e,t,r);case I.oids["pbeWithSHAAnd3-KeyTripleDES-CBC"]:case I.oids["pbewithSHAAnd40BitRC2-CBC"]:return I.pbe.getCipherForPKCS12PBE(e,t,r);default:var n=new Error("Cannot read encrypted PBE data block. Unsupported OID.");throw n.oid=e,n.supportedOids=["pkcs5PBES2","pbeWithSHAAnd3-KeyTripleDES-CBC","pbewithSHAAnd40BitRC2-CBC"],n}},I.pbe.getCipherForPBES2=function(e,t,r){var n,a={},i=[];if(!v.validate(t,h,a,i))throw(n=new Error("Cannot read password-based-encryption algorithm parameters. ASN.1 object is not a supported EncryptedPrivateKeyInfo.")).errors=i,n;if((e=v.derToOid(a.kdfOid))!==I.oids.pkcs5PBKDF2)throw(n=new Error("Cannot read encrypted private key. Unsupported key derivation function OID.")).oid=e,n.supportedOids=["pkcs5PBKDF2"],n;if((e=v.derToOid(a.encOid))!==I.oids["aes128-CBC"]&&e!==I.oids["aes192-CBC"]&&e!==I.oids["aes256-CBC"]&&e!==I.oids["des-EDE3-CBC"]&&e!==I.oids.desCBC)throw(n=new Error("Cannot read encrypted private key. Unsupported encryption scheme OID.")).oid=e,n.supportedOids=["aes128-CBC","aes192-CBC","aes256-CBC","des-EDE3-CBC","desCBC"],n;var s,o,u=a.kdfSalt,c=U.util.createBuffer(a.kdfIterationCount);switch(c=c.getInt(c.length()<<3),I.oids[e]){case"aes128-CBC":s=16,o=U.aes.createDecryptionCipher;break;case"aes192-CBC":s=24,o=U.aes.createDecryptionCipher;break;case"aes256-CBC":s=32,o=U.aes.createDecryptionCipher;break;case"des-EDE3-CBC":s=24,o=U.des.createDecryptionCipher;break;case"desCBC":s=8,o=U.des.createDecryptionCipher}var l=y(a.prfOid),p=U.pkcs5.pbkdf2(r,u,c,s,l),f=a.encIv,d=o(p);return d.start(f),d},I.pbe.getCipherForPKCS12PBE=function(e,t,r){var n={},a=[];if(!v.validate(t,d,n,a))throw(l=new Error("Cannot read password-based-encryption algorithm parameters. ASN.1 object is not a supported EncryptedPrivateKeyInfo.")).errors=a,l;var i,s,o,u=U.util.createBuffer(n.salt),c=U.util.createBuffer(n.iterations);switch(c=c.getInt(c.length()<<3),e){case I.oids["pbeWithSHAAnd3-KeyTripleDES-CBC"]:i=24,s=8,o=U.des.startDecrypting;break;case I.oids["pbewithSHAAnd40BitRC2-CBC"]:i=5,s=8,o=function(e,t){var r=U.rc2.createDecryptionCipher(e,40);return r.start(t,null),r};break;default:var l;throw(l=new Error("Cannot read PKCS #12 PBE data block. Unsupported OID.")).oid=e,l}var p=y(n.prfOid),f=I.pbe.generatePkcs12Key(r,u,1,c,i,p);return p.start(),o(f,I.pbe.generatePkcs12Key(r,u,2,c,s,p))},I.pbe.opensslDeriveBytes=function(e,t,r,n){null==n&&(n=U.md.md5.create()),null===t&&(t="");for(var a=[o(n,e+t)],i=16,s=1;i<r;++s,i+=16)a.push(o(n,a[s-1]+e+t));return a.join("").substr(0,r)}}var i;if("function"!=typeof define){if("object"!=typeof module||!module.exports)return"undefined"==typeof forge&&(forge={}),a(forge);var r=!0;define=function(e,t){t(require,module)}}var n=define;define=function(e,t){return i="string"==typeof e?t.slice(2):e.slice(2),r?(delete define,n.apply(null,Array.prototype.slice.call(arguments,0))):(define=n,define.apply(null,Array.prototype.slice.call(arguments,0)))},define(["require","module","./aes","./asn1","./des","./md","./oids","./pem","./pbkdf2","./random","./rc2","./rsa","./util"],function(){(function(n,e){e.exports=function(e){var t=i.map(function(e){return n(e)}).concat(a);if((e=e||{}).defined=e.defined||{},e.defined.pbe)return e.pbe;e.defined.pbe=!0;for(var r=0;r<t.length;++r)t[r](e);return e.pbe}}).apply(null,Array.prototype.slice.call(arguments,0))})}(),function(){function a(c){(c.hmac=c.hmac||{}).create=function(){var i=null,s=null,o=null,u=null,e={start:function(e,t){if(null!==e)if("string"==typeof e){if(!((e=e.toLowerCase())in c.md.algorithms))throw new Error('Unknown hash algorithm "'+e+'"');s=c.md.algorithms[e].create()}else s=e;if(null===t)t=i;else{if("string"==typeof t)t=c.util.createBuffer(t);else if(c.util.isArray(t)){var r=t;t=c.util.createBuffer();for(var n=0;n<r.length;++n)t.putByte(r[n])}var a=t.length();a>s.blockLength&&(s.start(),s.update(t.bytes()),t=s.digest()),o=c.util.createBuffer(),u=c.util.createBuffer(),a=t.length();for(n=0;n<a;++n){r=t.at(n);o.putByte(54^r),u.putByte(92^r)}if(a<s.blockLength)for(r=s.blockLength-a,n=0;n<r;++n)o.putByte(54),u.putByte(92);i=t,o=o.bytes(),u=u.bytes()}s.start(),s.update(o)},update:function(e){s.update(e)},getMac:function(){var e=s.digest().bytes();return s.start(),s.update(u),s.update(e),s.digest()}};return e.digest=e.getMac,e}}var i,s="hmac";if("function"!=typeof define){if("object"!=typeof module||!module.exports)return"undefined"==typeof forge&&(forge={}),a(forge);var r=!0;define=function(e,t){t(require,module)}}var n=define;define=function(e,t){return i="string"==typeof e?t.slice(2):e.slice(2),r?(delete define,n.apply(null,Array.prototype.slice.call(arguments,0))):(define=n,define.apply(null,Array.prototype.slice.call(arguments,0)))},define(["require","module","./md","./util"],function(){(function(n,e){e.exports=function(e){var t=i.map(function(e){return n(e)}).concat(a);if((e=e||{}).defined=e.defined||{},e.defined[s])return e[s];e.defined[s]=!0;for(var r=0;r<t.length;++r)t[r](e);return e[s]}}).apply(null,Array.prototype.slice.call(arguments,0))})}(),function(){function a(E){var S,e=E.pkcs5=E.pkcs5||{},v="undefined"!=typeof process&&process.versions&&process.versions.node;v&&!E.disableNativeCode&&(S=require("crypto")),E.pbkdf2=e.pbkdf2=function(e,t,r,n,a,i){if("function"==typeof a&&(i=a,a=null),v&&!E.disableNativeCode&&S.pbkdf2&&(null===a||"object"!=typeof a)&&(4<S.pbkdf2Sync.length||!a||"sha1"===a))return"string"!=typeof a&&(a="sha1"),t=new Buffer(t,"binary"),i?4===S.pbkdf2Sync.length?S.pbkdf2(e,t,r,n,function(e,t){if(e)return i(e);i(null,t.toString("binary"))}):S.pbkdf2(e,t,r,n,a,function(e,t){if(e)return i(e);i(null,t.toString("binary"))}):4===S.pbkdf2Sync.length?S.pbkdf2Sync(e,t,r,n).toString("binary"):S.pbkdf2Sync(e,t,r,n,a).toString("binary");if(null==a&&(a=E.md.sha1.create()),"string"==typeof a){if(!(a in E.md.algorithms))throw new Error("Unknown hash algorithm: "+a);a=E.md[a].create()}var s=a.digestLength;if(4294967295*s<n){var o=new Error("Derived key is too long.");if(i)return i(o);throw o}var u=Math.ceil(n/s),c=n-(u-1)*s,l=E.hmac.create();l.start(a,e);var p,f,d,h="";if(!i){for(var y=1;y<=u;++y){l.start(null,null),l.update(t),l.update(E.util.int32ToBytes(y)),p=d=l.digest().getBytes();for(var g=2;g<=r;++g)l.start(null,null),l.update(d),f=l.digest().getBytes(),p=E.util.xorBytes(p,f,s),d=f;h+=y<u?p:p.substr(0,c)}return h}y=1;function C(){if(u<y)return i(null,h);l.start(null,null),l.update(t),l.update(E.util.int32ToBytes(y)),p=d=l.digest().getBytes(),g=2,m()}function m(){if(g<=r)return l.start(null,null),l.update(d),f=l.digest().getBytes(),p=E.util.xorBytes(p,f,s),d=f,++g,E.util.setImmediate(m);h+=y<u?p:p.substr(0,c),++y,C()}C()}}var i,s="pbkdf2";if("function"!=typeof define){if("object"!=typeof module||!module.exports)return"undefined"==typeof forge&&(forge={}),a(forge);var r=!0;define=function(e,t){t(require,module)}}var n=define;define=function(e,t){return i="string"==typeof e?t.slice(2):e.slice(2),r?(delete define,n.apply(null,Array.prototype.slice.call(arguments,0))):(define=n,define.apply(null,Array.prototype.slice.call(arguments,0)))},define(["require","module","./hmac","./md","./util"],function(){(function(n,e){e.exports=function(e){var t=i.map(function(e){return n(e)}).concat(a);if((e=e||{}).defined=e.defined||{},e.defined[s])return e[s];e.defined[s]=!0;for(var r=0;r<t.length;++r)t[r](e);return e[s]}}).apply(null,Array.prototype.slice.call(arguments,0))})}(),function(){function a(R){var U=R.asn1,L=R.pki,w=R.pkcs12=R.pkcs12||{},y={name:"ContentInfo",tagClass:U.Class.UNIVERSAL,type:U.Type.SEQUENCE,constructed:!0,value:[{name:"ContentInfo.contentType",tagClass:U.Class.UNIVERSAL,type:U.Type.OID,constructed:!1,capture:"contentType"},{name:"ContentInfo.content",tagClass:U.Class.CONTEXT_SPECIFIC,constructed:!0,captureAsn1:"content"}]},g={name:"PFX",tagClass:U.Class.UNIVERSAL,type:U.Type.SEQUENCE,constructed:!0,value:[{name:"PFX.version",tagClass:U.Class.UNIVERSAL,type:U.Type.INTEGER,constructed:!1,capture:"version"},y,{name:"PFX.macData",tagClass:U.Class.UNIVERSAL,type:U.Type.SEQUENCE,constructed:!0,optional:!0,captureAsn1:"mac",value:[{name:"PFX.macData.mac",tagClass:U.Class.UNIVERSAL,type:U.Type.SEQUENCE,constructed:!0,value:[{name:"PFX.macData.mac.digestAlgorithm",tagClass:U.Class.UNIVERSAL,type:U.Type.SEQUENCE,constructed:!0,value:[{name:"PFX.macData.mac.digestAlgorithm.algorithm",tagClass:U.Class.UNIVERSAL,type:U.Type.OID,constructed:!1,capture:"macAlgorithm"},{name:"PFX.macData.mac.digestAlgorithm.parameters",tagClass:U.Class.UNIVERSAL,captureAsn1:"macAlgorithmParameters"}]},{name:"PFX.macData.mac.digest",tagClass:U.Class.UNIVERSAL,type:U.Type.OCTETSTRING,constructed:!1,capture:"macDigest"}]},{name:"PFX.macData.macSalt",tagClass:U.Class.UNIVERSAL,type:U.Type.OCTETSTRING,constructed:!1,capture:"macSalt"},{name:"PFX.macData.iterations",tagClass:U.Class.UNIVERSAL,type:U.Type.INTEGER,constructed:!1,optional:!0,capture:"macIterations"}]}]},h={name:"SafeBag",tagClass:U.Class.UNIVERSAL,type:U.Type.SEQUENCE,constructed:!0,value:[{name:"SafeBag.bagId",tagClass:U.Class.UNIVERSAL,type:U.Type.OID,constructed:!1,capture:"bagId"},{name:"SafeBag.bagValue",tagClass:U.Class.CONTEXT_SPECIFIC,constructed:!0,captureAsn1:"bagValue"},{name:"SafeBag.bagAttributes",tagClass:U.Class.UNIVERSAL,type:U.Type.SET,constructed:!0,optional:!0,capture:"bagAttributes"}]},u={name:"Attribute",tagClass:U.Class.UNIVERSAL,type:U.Type.SEQUENCE,constructed:!0,value:[{name:"Attribute.attrId",tagClass:U.Class.UNIVERSAL,type:U.Type.OID,constructed:!1,capture:"oid"},{name:"Attribute.attrValues",tagClass:U.Class.UNIVERSAL,type:U.Type.SET,constructed:!0,capture:"values"}]},C={name:"CertBag",tagClass:U.Class.UNIVERSAL,type:U.Type.SEQUENCE,constructed:!0,value:[{name:"CertBag.certId",tagClass:U.Class.UNIVERSAL,type:U.Type.OID,constructed:!1,capture:"certId"},{name:"CertBag.certValue",tagClass:U.Class.CONTEXT_SPECIFIC,constructed:!0,value:[{name:"CertBag.certValue[0]",tagClass:U.Class.UNIVERSAL,type:U.Class.OCTETSTRING,constructed:!1,capture:"cert"}]}]};function m(e,t,r,n){for(var a=[],i=0;i<e.length;i++)for(var s=0;s<e[i].safeBags.length;s++){var o=e[i].safeBags[s];n!==undefined&&o.type!==n||(null!==t?o.attributes[t]!==undefined&&0<=o.attributes[t].indexOf(r)&&a.push(o):a.push(o))}return a}function E(e){if(e.composed||e.constructed){for(var t=R.util.createBuffer(),r=0;r<e.value.length;++r)t.putBytes(e.value[r].value);e.composed=e.constructed=!1,e.value=t.getBytes()}return e}function S(e,t){var r={},n=[];if(!U.validate(e,R.pkcs7.asn1.encryptedDataValidator,r,n))throw(a=new Error("Cannot read EncryptedContentInfo.")).errors=n,a;var a,i=U.derToOid(r.contentType);if(i!==L.oids.data)throw(a=new Error("PKCS#12 EncryptedContentInfo ContentType is not Data.")).oid=i,a;i=U.derToOid(r.encAlgorithm);var s=L.pbe.getCipher(i,r.encParameter,t),o=E(r.encryptedContentAsn1),u=R.util.createBuffer(o.value);if(s.update(u),!s.finish())throw new Error("Failed to decrypt PKCS#12 SafeContents.");return s.output.getBytes()}function v(e,r,t){if(!r&&0===e.length)return[];if((e=U.fromDer(e,r)).tagClass!==U.Class.UNIVERSAL||e.type!==U.Type.SEQUENCE||!0!==e.constructed)throw new Error("PKCS#12 SafeContents expected to be a SEQUENCE OF SafeBag.");for(var n=[],a=0;a<e.value.length;a++){var i=e.value[a],s={},o=[];if(!U.validate(i,h,s,o))throw(f=new Error("Cannot read SafeBag.")).errors=o,f;var u,c,l={type:U.derToOid(s.bagId),attributes:I(s.bagAttributes)};n.push(l);var p=s.bagValue.value[0];switch(l.type){case L.oids.pkcs8ShroudedKeyBag:if(null===(p=L.decryptPrivateKeyInfo(p,t)))throw new Error("Unable to decrypt PKCS#8 ShroudedKeyBag, wrong password?");case L.oids.keyBag:try{l.key=L.privateKeyFromAsn1(p)}catch(d){l.key=null,l.asn1=p}continue;case L.oids.certBag:u=C,c=function(){if(U.derToOid(s.certId)!==L.oids.x509Certificate){var e=new Error("Unsupported certificate type, only X.509 supported.");throw e.oid=U.derToOid(s.certId),e}var t=U.fromDer(s.cert,r);try{l.cert=L.certificateFromAsn1(t,!0)}catch(d){l.cert=null,l.asn1=t}};break;default:var f;throw(f=new Error("Unsupported PKCS#12 SafeBag type.")).oid=l.type,f}if(u!==undefined&&!U.validate(p,u,s,o))throw(f=new Error("Cannot read PKCS#12 "+u.name)).errors=o,f;c()}return n}function I(e){var t={};if(e!==undefined)for(var r=0;r<e.length;++r){var n={},a=[];if(!U.validate(e[r],u,n,a)){var i=new Error("Cannot read PKCS#12 BagAttribute.");throw i.errors=a,i}var s=U.derToOid(n.oid);if(L.oids[s]!==undefined){t[L.oids[s]]=[];for(var o=0;o<n.values.length;++o)t[L.oids[s]].push(n.values[o].value)}}return t}w.pkcs12FromAsn1=function(e,t,r){"string"==typeof t?(r=t,t=!0):t===undefined&&(t=!0);var n={};if(!U.validate(e,g,n,[]))throw(a=new Error("Cannot read PKCS#12 PFX. ASN.1 object is not an PKCS#12 PFX.")).errors=a;var a,i={version:n.version.charCodeAt(0),safeContents:[],getBags:function(e){var t,r={};return"localKeyId"in e?t=e.localKeyId:"localKeyIdHex"in e&&(t=R.util.hexToBytes(e.localKeyIdHex)),t===undefined&&!("friendlyName"in e)&&"bagType"in e&&(r[e.bagType]=m(i.safeContents,null,null,e.bagType)),t!==undefined&&(r.localKeyId=m(i.safeContents,"localKeyId",t,e.bagType)),"friendlyName"in e&&(r.friendlyName=m(i.safeContents,"friendlyName",e.friendlyName,e.bagType)),r},getBagsByFriendlyName:function(e,t){return m(i.safeContents,"friendlyName",e,t)},getBagsByLocalKeyId:function(e,t){return m(i.safeContents,"localKeyId",e,t)}};if(3!==n.version.charCodeAt(0))throw(a=new Error("PKCS#12 PFX of version other than 3 not supported.")).version=n.version.charCodeAt(0),a;if(U.derToOid(n.contentType)!==L.oids.data)throw(a=new Error("Only PKCS#12 PFX in password integrity mode supported.")).oid=U.derToOid(n.contentType),a;var s=n.content.value[0];if(s.tagClass!==U.Class.UNIVERSAL||s.type!==U.Type.OCTETSTRING)throw new Error("PKCS#12 authSafe content data is not an OCTET STRING.");if(s=E(s),n.mac){var o=null,u=0,c=U.derToOid(n.macAlgorithm);switch(c){case L.oids.sha1:o=R.md.sha1.create(),u=20;break;case L.oids.sha256:o=R.md.sha256.create(),u=32;break;case L.oids.sha384:o=R.md.sha384.create(),u=48;break;case L.oids.sha512:o=R.md.sha512.create(),u=64;break;case L.oids.md5:o=R.md.md5.create(),u=16}if(null===o)throw new Error("PKCS#12 uses unsupported MAC algorithm: "+c);var l=new R.util.ByteBuffer(n.macSalt),p="macIterations"in n?parseInt(R.util.bytesToHex(n.macIterations),16):1,f=w.generateKey(r,l,3,p,u,o),d=R.hmac.create();if(d.start(o,f),d.update(s.value),d.getMac().getBytes()!==n.macDigest)throw new Error("PKCS#12 MAC could not be verified. Invalid password?")}return function h(e,t,r,n){if((t=U.fromDer(t,r)).tagClass!==U.Class.UNIVERSAL||t.type!==U.Type.SEQUENCE||!0!==t.constructed)throw new Error("PKCS#12 AuthenticatedSafe expected to be a SEQUENCE OF ContentInfo");for(var a=0;a<t.value.length;a++){var i=t.value[a],s={},o=[];if(!U.validate(i,y,s,o)){var u=new Error("Cannot read ContentInfo.");throw u.errors=o,u}var c={encrypted:!1},l=null,p=s.content.value[0];switch(U.derToOid(s.contentType)){case L.oids.data:if(p.tagClass!==U.Class.UNIVERSAL||p.type!==U.Type.OCTETSTRING)throw new Error("PKCS#12 SafeContents Data is not an OCTET STRING.");l=E(p).value;break;case L.oids.encryptedData:l=S(p,n),c.encrypted=!0;break;default:var u=new Error("Unsupported PKCS#12 contentType.");throw u.contentType=U.derToOid(s.contentType),u}c.safeBags=v(l,r,n),e.safeContents.push(c)}}(i,s.value,t,r),i},w.toPkcs12Asn1=function(e,t,r,n){(n=n||{}).saltSize=n.saltSize||8,n.count=n.count||2048,n.algorithm=n.algorithm||n.encAlgorithm||"aes128","useMac"in n||(n.useMac=!0),"localKeyId"in n||(n.localKeyId=null),"generateLocalKeyId"in n||(n.generateLocalKeyId=!0);var a,i=n.localKeyId;if(null!==i)i=R.util.hexToBytes(i);else if(n.generateLocalKeyId)if(t){var s=R.util.isArray(t)?t[0]:t;"string"==typeof s&&(s=L.certificateFromPem(s)),(T=R.md.sha1.create()).update(U.toDer(L.certificateToAsn1(s)).getBytes()),i=T.digest().getBytes()}else i=R.random.getBytes(20);var o=[];null!==i&&o.push(U.create(U.Class.UNIVERSAL,U.Type.SEQUENCE,!0,[U.create(U.Class.UNIVERSAL,U.Type.OID,!1,U.oidToDer(L.oids.localKeyId).getBytes()),U.create(U.Class.UNIVERSAL,U.Type.SET,!0,[U.create(U.Class.UNIVERSAL,U.Type.OCTETSTRING,!1,i)])])),"friendlyName"in n&&o.push(U.create(U.Class.UNIVERSAL,U.Type.SEQUENCE,!0,[U.create(U.Class.UNIVERSAL,U.Type.OID,!1,U.oidToDer(L.oids.friendlyName).getBytes()),U.create(U.Class.UNIVERSAL,U.Type.SET,!0,[U.create(U.Class.UNIVERSAL,U.Type.BMPSTRING,!1,n.friendlyName)])])),0<o.length&&(a=U.create(U.Class.UNIVERSAL,U.Type.SET,!0,o));var u=[],c=[];null!==t&&(c=R.util.isArray(t)?t:[t]);for(var l=[],p=0;p<c.length;++p){"string"==typeof(t=c[p])&&(t=L.certificateFromPem(t));var f=0===p?a:undefined,d=L.certificateToAsn1(t),h=U.create(U.Class.UNIVERSAL,U.Type.SEQUENCE,!0,[U.create(U.Class.UNIVERSAL,U.Type.OID,!1,U.oidToDer(L.oids.certBag).getBytes()),U.create(U.Class.CONTEXT_SPECIFIC,0,!0,[U.create(U.Class.UNIVERSAL,U.Type.SEQUENCE,!0,[U.create(U.Class.UNIVERSAL,U.Type.OID,!1,U.oidToDer(L.oids.x509Certificate).getBytes()),U.create(U.Class.CONTEXT_SPECIFIC,0,!0,[U.create(U.Class.UNIVERSAL,U.Type.OCTETSTRING,!1,U.toDer(d).getBytes())])])]),f]);l.push(h)}if(0<l.length){var y=U.create(U.Class.UNIVERSAL,U.Type.SEQUENCE,!0,l),g=U.create(U.Class.UNIVERSAL,U.Type.SEQUENCE,!0,[U.create(U.Class.UNIVERSAL,U.Type.OID,!1,U.oidToDer(L.oids.data).getBytes()),U.create(U.Class.CONTEXT_SPECIFIC,0,!0,[U.create(U.Class.UNIVERSAL,U.Type.OCTETSTRING,!1,U.toDer(y).getBytes())])]);u.push(g)}var C=null;if(null!==e){var m=L.wrapRsaPrivateKey(L.privateKeyToAsn1(e));C=null===r?U.create(U.Class.UNIVERSAL,U.Type.SEQUENCE,!0,[U.create(U.Class.UNIVERSAL,U.Type.OID,!1,U.oidToDer(L.oids.keyBag).getBytes()),U.create(U.Class.CONTEXT_SPECIFIC,0,!0,[m]),a]):U.create(U.Class.UNIVERSAL,U.Type.SEQUENCE,!0,[U.create(U.Class.UNIVERSAL,U.Type.OID,!1,U.oidToDer(L.oids.pkcs8ShroudedKeyBag).getBytes()),U.create(U.Class.CONTEXT_SPECIFIC,0,!0,[L.encryptPrivateKeyInfo(m,r,n)]),a]);var E=U.create(U.Class.UNIVERSAL,U.Type.SEQUENCE,!0,[C]),S=U.create(U.Class.UNIVERSAL,U.Type.SEQUENCE,!0,[U.create(U.Class.UNIVERSAL,U.Type.OID,!1,U.oidToDer(L.oids.data).getBytes()),U.create(U.Class.CONTEXT_SPECIFIC,0,!0,[U.create(U.Class.UNIVERSAL,U.Type.OCTETSTRING,!1,U.toDer(E).getBytes())])]);u.push(S)}var v,I=U.create(U.Class.UNIVERSAL,U.Type.SEQUENCE,!0,u);if(n.useMac){var T=R.md.sha1.create(),A=new R.util.ByteBuffer(R.random.getBytes(n.saltSize)),N=n.count,b=(e=w.generateKey(r,A,3,N,20),R.hmac.create());b.start(T,e),b.update(U.toDer(I).getBytes());var B=b.getMac();v=U.create(U.Class.UNIVERSAL,U.Type.SEQUENCE,!0,[U.create(U.Class.UNIVERSAL,U.Type.SEQUENCE,!0,[U.create(U.Class.UNIVERSAL,U.Type.SEQUENCE,!0,[U.create(U.Class.UNIVERSAL,U.Type.OID,!1,U.oidToDer(L.oids.sha1).getBytes()),U.create(U.Class.UNIVERSAL,U.Type.NULL,!1,"")]),U.create(U.Class.UNIVERSAL,U.Type.OCTETSTRING,!1,B.getBytes())]),U.create(U.Class.UNIVERSAL,U.Type.OCTETSTRING,!1,A.getBytes()),U.create(U.Class.UNIVERSAL,U.Type.INTEGER,!1,U.integerToDer(N).getBytes())])}return U.create(U.Class.UNIVERSAL,U.Type.SEQUENCE,!0,[U.create(U.Class.UNIVERSAL,U.Type.INTEGER,!1,U.integerToDer(3).getBytes()),U.create(U.Class.UNIVERSAL,U.Type.SEQUENCE,!0,[U.create(U.Class.UNIVERSAL,U.Type.OID,!1,U.oidToDer(L.oids.data).getBytes()),U.create(U.Class.CONTEXT_SPECIFIC,0,!0,[U.create(U.Class.UNIVERSAL,U.Type.OCTETSTRING,!1,U.toDer(I).getBytes())])]),v])},w.generateKey=R.pbe.generatePkcs12Key}var i,s="pkcs12";if("function"!=typeof define){if("object"!=typeof module||!module.exports)return"undefined"==typeof forge&&(forge={}),a(forge);var r=!0;define=function(e,t){t(require,module)}}var n=define;define=function(e,t){return i="string"==typeof e?t.slice(2):e.slice(2),r?(delete define,n.apply(null,Array.prototype.slice.call(arguments,0))):(define=n,define.apply(null,Array.prototype.slice.call(arguments,0)))},define(["require","module","./asn1","./hmac","./oids","./pkcs7asn1","./pbe","./random","./rsa","./sha1","./util","./x509"],function(){(function(n,e){e.exports=function(e){var t=i.map(function(e){return n(e)}).concat(a);if((e=e||{}).defined=e.defined||{},e.defined[s])return e[s];e.defined[s]=!0;for(var r=0;r<t.length;++r)t[r](e);return e[s]}}).apply(null,Array.prototype.slice.call(arguments,0))})}(),function(){function a(e){var t=e.asn1,r=e.pkcs7asn1=e.pkcs7asn1||{};e.pkcs7=e.pkcs7||{},e.pkcs7.asn1=r;var n={name:"ContentInfo",tagClass:t.Class.UNIVERSAL,type:t.Type.SEQUENCE,constructed:!0,value:[{name:"ContentInfo.ContentType",tagClass:t.Class.UNIVERSAL,type:t.Type.OID,constructed:!1,capture:"contentType"},{name:"ContentInfo.content",tagClass:t.Class.CONTEXT_SPECIFIC,type:0,constructed:!0,optional:!0,captureAsn1:"content"}]};r.contentInfoValidator=n;var a={name:"EncryptedContentInfo",tagClass:t.Class.UNIVERSAL,type:t.Type.SEQUENCE,constructed:!0,value:[{name:"EncryptedContentInfo.contentType",tagClass:t.Class.UNIVERSAL,type:t.Type.OID,constructed:!1,capture:"contentType"},{name:"EncryptedContentInfo.contentEncryptionAlgorithm",tagClass:t.Class.UNIVERSAL,type:t.Type.SEQUENCE,constructed:!0,value:[{name:"EncryptedContentInfo.contentEncryptionAlgorithm.algorithm",tagClass:t.Class.UNIVERSAL,type:t.Type.OID,constructed:!1,capture:"encAlgorithm"},{name:"EncryptedContentInfo.contentEncryptionAlgorithm.parameter",tagClass:t.Class.UNIVERSAL,captureAsn1:"encParameter"}]},{name:"EncryptedContentInfo.encryptedContent",tagClass:t.Class.CONTEXT_SPECIFIC,type:0,capture:"encryptedContent",captureAsn1:"encryptedContentAsn1"}]};r.envelopedDataValidator={name:"EnvelopedData",tagClass:t.Class.UNIVERSAL,type:t.Type.SEQUENCE,constructed:!0,value:[{name:"EnvelopedData.Version",tagClass:t.Class.UNIVERSAL,type:t.Type.INTEGER,constructed:!1,capture:"version"},{name:"EnvelopedData.RecipientInfos",tagClass:t.Class.UNIVERSAL,type:t.Type.SET,constructed:!0,captureAsn1:"recipientInfos"}].concat(a)},r.encryptedDataValidator={name:"EncryptedData",tagClass:t.Class.UNIVERSAL,type:t.Type.SEQUENCE,constructed:!0,value:[{name:"EncryptedData.Version",tagClass:t.Class.UNIVERSAL,type:t.Type.INTEGER,constructed:!1,capture:"version"}].concat(a)};var i={name:"SignerInfo",tagClass:t.Class.UNIVERSAL,type:t.Type.SEQUENCE,constructed:!0,value:[{name:"SignerInfo.version",tagClass:t.Class.UNIVERSAL,type:t.Type.INTEGER,constructed:!1},{name:"SignerInfo.issuerAndSerialNumber",tagClass:t.Class.UNIVERSAL,type:t.Type.SEQUENCE,constructed:!0,value:[{name:"SignerInfo.issuerAndSerialNumber.issuer",tagClass:t.Class.UNIVERSAL,type:t.Type.SEQUENCE,constructed:!0,captureAsn1:"issuer"},{name:"SignerInfo.issuerAndSerialNumber.serialNumber",tagClass:t.Class.UNIVERSAL,type:t.Type.INTEGER,constructed:!1,capture:"serial"}]},{name:"SignerInfo.digestAlgorithm",tagClass:t.Class.UNIVERSAL,type:t.Type.SEQUENCE,constructed:!0,value:[{name:"SignerInfo.digestAlgorithm.algorithm",tagClass:t.Class.UNIVERSAL,type:t.Type.OID,constructed:!1,capture:"digestAlgorithm"},{name:"SignerInfo.digestAlgorithm.parameter",tagClass:t.Class.UNIVERSAL,constructed:!1,captureAsn1:"digestParameter",optional:!0}]},{name:"SignerInfo.authenticatedAttributes",tagClass:t.Class.CONTEXT_SPECIFIC,type:0,constructed:!0,optional:!0,capture:"authenticatedAttributes"},{name:"SignerInfo.digestEncryptionAlgorithm",tagClass:t.Class.UNIVERSAL,type:t.Type.SEQUENCE,constructed:!0,capture:"signatureAlgorithm"},{name:"SignerInfo.encryptedDigest",tagClass:t.Class.UNIVERSAL,type:t.Type.OCTETSTRING,constructed:!1,capture:"signature"},{name:"SignerInfo.unauthenticatedAttributes",tagClass:t.Class.CONTEXT_SPECIFIC,type:1,constructed:!0,optional:!0,capture:"unauthenticatedAttributes"}]};r.signedDataValidator={name:"SignedData",tagClass:t.Class.UNIVERSAL,type:t.Type.SEQUENCE,constructed:!0,value:[{name:"SignedData.Version",tagClass:t.Class.UNIVERSAL,type:t.Type.INTEGER,constructed:!1,capture:"version"},{name:"SignedData.DigestAlgorithms",tagClass:t.Class.UNIVERSAL,type:t.Type.SET,constructed:!0,captureAsn1:"digestAlgorithms"},n,{name:"SignedData.Certificates",tagClass:t.Class.CONTEXT_SPECIFIC,type:0,optional:!0,captureAsn1:"certificates"},{name:"SignedData.CertificateRevocationLists",tagClass:t.Class.CONTEXT_SPECIFIC,type:1,optional:!0,captureAsn1:"crls"},{name:"SignedData.SignerInfos",tagClass:t.Class.UNIVERSAL,type:t.Type.SET,capture:"signerInfos",optional:!0,value:[i]}]},r.recipientInfoValidator={name:"RecipientInfo",tagClass:t.Class.UNIVERSAL,type:t.Type.SEQUENCE,constructed:!0,value:[{name:"RecipientInfo.version",tagClass:t.Class.UNIVERSAL,type:t.Type.INTEGER,constructed:!1,capture:"version"},{name:"RecipientInfo.issuerAndSerial",tagClass:t.Class.UNIVERSAL,type:t.Type.SEQUENCE,constructed:!0,value:[{name:"RecipientInfo.issuerAndSerial.issuer",tagClass:t.Class.UNIVERSAL,type:t.Type.SEQUENCE,constructed:!0,captureAsn1:"issuer"},{name:"RecipientInfo.issuerAndSerial.serialNumber",tagClass:t.Class.UNIVERSAL,type:t.Type.INTEGER,constructed:!1,capture:"serial"}]},{name:"RecipientInfo.keyEncryptionAlgorithm",tagClass:t.Class.UNIVERSAL,type:t.Type.SEQUENCE,constructed:!0,value:[{name:"RecipientInfo.keyEncryptionAlgorithm.algorithm",tagClass:t.Class.UNIVERSAL,type:t.Type.OID,constructed:!1,capture:"encAlgorithm"},{name:"RecipientInfo.keyEncryptionAlgorithm.parameter",tagClass:t.Class.UNIVERSAL,constructed:!1,captureAsn1:"encParameter"}]},{name:"RecipientInfo.encryptedKey",tagClass:t.Class.UNIVERSAL,type:t.Type.OCTETSTRING,constructed:!1,capture:"encKey"}]}}var i,s="pkcs7asn1";if("function"!=typeof define){if("object"!=typeof module||!module.exports)return"undefined"==typeof forge&&(forge={}),a(forge);var r=!0;define=function(e,t){t(require,module)}}var n=define;define=function(e,t){return i="string"==typeof e?t.slice(2):e.slice(2),r?(delete define,n.apply(null,Array.prototype.slice.call(arguments,0))):(define=n,define.apply(null,Array.prototype.slice.call(arguments,0)))},define(["require","module","./asn1","./util"],function(){(function(n,e){e.exports=function(e){var t=i.map(function(e){return n(e)}).concat(a);if((e=e||{}).defined=e.defined||{},e.defined[s])return e[s];e.defined[s]=!0;for(var r=0;r<t.length;++r)t[r](e);return e[s]}}).apply(null,Array.prototype.slice.call(arguments,0))})}(),function(){function a(h){var y=h.asn1,s=h.pkcs7=h.pkcs7||{};function a(e){var t={},r=[];if(!y.validate(e,s.asn1.recipientInfoValidator,t,r)){var n=new Error("Cannot read PKCS#7 RecipientInfo. ASN.1 object is not an PKCS#7 RecipientInfo.");throw n.errors=r,n}return{version:t.version.charCodeAt(0),issuer:h.pki.RDNAttributesAsArray(t.issuer),serialNumber:h.util.createBuffer(t.serial).toHex(),encryptedContent:{algorithm:y.derToOid(t.encAlgorithm),parameter:t.encParameter.value,content:t.encKey}}}function g(e){var t=y.create(y.Class.UNIVERSAL,y.Type.SEQUENCE,!0,[y.create(y.Class.UNIVERSAL,y.Type.INTEGER,!1,y.integerToDer(e.version).getBytes()),y.create(y.Class.UNIVERSAL,y.Type.SEQUENCE,!0,[h.pki.distinguishedNameToAsn1({attributes:e.issuer}),y.create(y.Class.UNIVERSAL,y.Type.INTEGER,!1,h.util.hexToBytes(e.serialNumber))]),y.create(y.Class.UNIVERSAL,y.Type.SEQUENCE,!0,[y.create(y.Class.UNIVERSAL,y.Type.OID,!1,y.oidToDer(e.digestAlgorithm).getBytes()),y.create(y.Class.UNIVERSAL,y.Type.NULL,!1,"")])]);if(e.authenticatedAttributesAsn1&&t.value.push(e.authenticatedAttributesAsn1),t.value.push(y.create(y.Class.UNIVERSAL,y.Type.SEQUENCE,!0,[y.create(y.Class.UNIVERSAL,y.Type.OID,!1,y.oidToDer(e.signatureAlgorithm).getBytes()),y.create(y.Class.UNIVERSAL,y.Type.NULL,!1,"")])),t.value.push(y.create(y.Class.UNIVERSAL,y.Type.OCTETSTRING,!1,e.signature)),0<e.unauthenticatedAttributes.length){for(var r=y.create(y.Class.CONTEXT_SPECIFIC,1,!0,[]),n=0;n<e.unauthenticatedAttributes.length;++n){var a=e.unauthenticatedAttributes[n];r.values.push(C(a))}t.value.push(r)}return t}function C(e){var t;if(e.type===h.pki.oids.contentType)t=y.create(y.Class.UNIVERSAL,y.Type.OID,!1,y.oidToDer(e.value).getBytes());else if(e.type===h.pki.oids.messageDigest)t=y.create(y.Class.UNIVERSAL,y.Type.OCTETSTRING,!1,e.value.bytes());else if(e.type===h.pki.oids.signingTime){var r=new Date("1950-01-01T00:00:00Z"),n=new Date("2050-01-01T00:00:00Z"),a=e.value;if("string"==typeof a){var i=Date.parse(a);a=isNaN(i)?13===a.length?y.utcTimeToDate(a):y.generalizedTimeToDate(a):new Date(i)}t=r<=a&&a<n?y.create(y.Class.UNIVERSAL,y.Type.UTCTIME,!1,y.dateToUtcTime(a)):y.create(y.Class.UNIVERSAL,y.Type.GENERALIZEDTIME,!1,y.dateToGeneralizedTime(a))}return y.create(y.Class.UNIVERSAL,y.Type.SEQUENCE,!0,[y.create(y.Class.UNIVERSAL,y.Type.OID,!1,y.oidToDer(e.type).getBytes()),y.create(y.Class.UNIVERSAL,y.Type.SET,!0,[t])])}function i(e,t,r){var n={};if(!y.validate(t,r,n,[])){var a=new Error("Cannot read PKCS#7 message. ASN.1 object is not a supported PKCS#7 message.");throw a.errors=a}if(y.derToOid(n.contentType)!==h.pki.oids.data)throw new Error("Unsupported PKCS#7 message. Only wrapped ContentType Data supported.");if(n.encryptedContent){var i="";if(h.util.isArray(n.encryptedContent))for(var s=0;s<n.encryptedContent.length;++s){if(n.encryptedContent[s].type!==y.Type.OCTETSTRING)throw new Error("Malformed PKCS#7 message, expecting encrypted content constructed of only OCTET STRING objects.");i+=n.encryptedContent[s].value}else i=n.encryptedContent;e.encryptedContent={algorithm:y.derToOid(n.encAlgorithm),parameter:h.util.createBuffer(n.encParameter.value),content:h.util.createBuffer(i)}}if(n.content){i="";if(h.util.isArray(n.content))for(s=0;s<n.content.length;++s){if(n.content[s].type!==y.Type.OCTETSTRING)throw new Error("Malformed PKCS#7 message, expecting content constructed of only OCTET STRING objects.");i+=n.content[s].value}else i=n.content;e.content=h.util.createBuffer(i)}return e.version=n.version.charCodeAt(0),e.rawCapture=n}function n(e){if(e.encryptedContent.key===undefined)throw new Error("Symmetric key not available.");if(e.content===undefined){var t;switch(e.encryptedContent.algorithm){case h.pki.oids["aes128-CBC"]:case h.pki.oids["aes192-CBC"]:case h.pki.oids["aes256-CBC"]:t=h.aes.createDecryptionCipher(e.encryptedContent.key);break;case h.pki.oids.desCBC:case h.pki.oids["des-EDE3-CBC"]:t=h.des.createDecryptionCipher(e.encryptedContent.key);break;default:throw new Error("Unsupported symmetric cipher, OID "+e.encryptedContent.algorithm)}if(t.start(e.encryptedContent.parameter),t.update(e.encryptedContent.content),!t.finish())throw new Error("Symmetric decryption failed.");e.content=t.output}}s.messageFromPem=function(e){var t=h.pem.decode(e)[0];if("PKCS7"!==t.type){var r=new Error('Could not convert PKCS#7 message from PEM; PEM header type is not "PKCS#7".');throw r.headerType=t.type,r}if(t.procType&&"ENCRYPTED"===t.procType.type)throw new Error("Could not convert PKCS#7 message from PEM; PEM is encrypted.");var n=y.fromDer(t.body);return s.messageFromAsn1(n)},s.messageToPem=function(e,t){var r={type:"PKCS7",body:y.toDer(e.toAsn1()).getBytes()};return h.pem.encode(r,{maxline:t})},s.messageFromAsn1=function(e){var t={},r=[];if(!y.validate(e,s.asn1.contentInfoValidator,t,r)){var n=new Error("Cannot read PKCS#7 message. ASN.1 object is not an PKCS#7 ContentInfo.");throw n.errors=r,n}var a,i=y.derToOid(t.contentType);switch(i){case h.pki.oids.envelopedData:a=s.createEnvelopedData();break;case h.pki.oids.encryptedData:a=s.createEncryptedData();break;case h.pki.oids.signedData:a=s.createSignedData();break;default:throw new Error("Cannot read PKCS#7 message. ContentType with OID "+i+" is not (yet) supported.")}return a.fromAsn1(t.content.value[0]),a},s.createSignedData=function(){var d=null;return d={type:h.pki.oids.signedData,version:1,certificates:[],crls:[],signers:[],digestAlgorithmIdentifiers:[],contentInfo:null,signerInfos:[],fromAsn1:function(e){i(d,e,s.asn1.signedDataValidator),d.certificates=[],d.crls=[],d.digestAlgorithmIdentifiers=[],d.contentInfo=null,d.signerInfos=[];for(var t=d.rawCapture.certificates.value,r=0;r<t.length;++r)d.certificates.push(h.pki.certificateFromAsn1(t[r]))},toAsn1:function(){d.contentInfo||d.sign();for(var e=[],t=0;t<d.certificates.length;++t)e.push(h.pki.certificateToAsn1(d.certificates[t]));var r=[],n=y.create(y.Class.CONTEXT_SPECIFIC,0,!0,[y.create(y.Class.UNIVERSAL,y.Type.SEQUENCE,!0,[y.create(y.Class.UNIVERSAL,y.Type.INTEGER,!1,y.integerToDer(d.version).getBytes()),y.create(y.Class.UNIVERSAL,y.Type.SET,!0,d.digestAlgorithmIdentifiers),d.contentInfo])]);return 0<e.length&&n.value[0].value.push(y.create(y.Class.CONTEXT_SPECIFIC,0,!0,e)),0<r.length&&n.value[0].value.push(y.create(y.Class.CONTEXT_SPECIFIC,1,!0,r)),n.value[0].value.push(y.create(y.Class.UNIVERSAL,y.Type.SET,!0,d.signerInfos)),y.create(y.Class.UNIVERSAL,y.Type.SEQUENCE,!0,[y.create(y.Class.UNIVERSAL,y.Type.OID,!1,y.oidToDer(d.type).getBytes()),n])},addSigner:function(e){var t=e.issuer,r=e.serialNumber;if(e.certificate){var n=e.certificate;"string"==typeof n&&(n=h.pki.certificateFromPem(n)),t=n.issuer.attributes,r=n.serialNumber}var a=e.key;if(!a)throw new Error("Could not add PKCS#7 signer; no private key specified.");"string"==typeof a&&(a=h.pki.privateKeyFromPem(a));var i=e.digestAlgorithm||h.pki.oids.sha1;switch(i){case h.pki.oids.sha1:case h.pki.oids.sha256:case h.pki.oids.sha384:case h.pki.oids.sha512:case h.pki.oids.md5:break;default:throw new Error("Could not add PKCS#7 signer; unknown message digest algorithm: "+i)}var s=e.authenticatedAttributes||[];if(0<s.length){for(var o=!1,u=!1,c=0;c<s.length;++c){var l=s[c];if(o||l.type!==h.pki.oids.contentType){if(u||l.type!==h.pki.oids.messageDigest);else if(u=!0,o)break}else if(o=!0,u)break}if(!o||!u)throw new Error("Invalid signer.authenticatedAttributes. If signer.authenticatedAttributes is specified, then it must contain at least two attributes, PKCS #9 content-type and PKCS #9 message-digest.")}d.signers.push({key:a,version:1,issuer:t,serialNumber:r,digestAlgorithm:i,signatureAlgorithm:h.pki.oids.rsaEncryption,signature:null,authenticatedAttributes:s,unauthenticatedAttributes:[]})},sign:function(){var e;"object"==typeof d.content&&null!==d.contentInfo||(d.contentInfo=y.create(y.Class.UNIVERSAL,y.Type.SEQUENCE,!0,[y.create(y.Class.UNIVERSAL,y.Type.OID,!1,y.oidToDer(h.pki.oids.data).getBytes())]),"content"in d&&(d.content instanceof h.util.ByteBuffer?e=d.content.bytes():"string"==typeof d.content&&(e=h.util.encodeUtf8(d.content)),d.contentInfo.value.push(y.create(y.Class.CONTEXT_SPECIFIC,0,!0,[y.create(y.Class.UNIVERSAL,y.Type.OCTETSTRING,!1,e)]))));0!==d.signers.length&&function f(e){if(d.contentInfo.value.length<2)throw new Error("Could not sign PKCS#7 message; there is no content to sign.");var t=y.derToOid(d.contentInfo.value[0].value),r=d.contentInfo.value[1];r=r.value[0];var n=y.toDer(r);for(var a in n.getByte(),y.getBerValueLength(n),n=n.getBytes(),e)e[a].start().update(n);for(var i=new Date,s=0;s<d.signers.length;++s){var o=d.signers[s];if(0===o.authenticatedAttributes.length){if(t!==h.pki.oids.data)throw new Error("Invalid signer; authenticatedAttributes must be present when the ContentInfo content type is not PKCS#7 Data.")}else{o.authenticatedAttributesAsn1=y.create(y.Class.CONTEXT_SPECIFIC,0,!0,[]);for(var u=y.create(y.Class.UNIVERSAL,y.Type.SET,!0,[]),c=0;c<o.authenticatedAttributes.length;++c){var l=o.authenticatedAttributes[c];l.type===h.pki.oids.messageDigest?l.value=e[o.digestAlgorithm].digest():l.type===h.pki.oids.signingTime&&(l.value||(l.value=i)),u.value.push(C(l)),o.authenticatedAttributesAsn1.value.push(C(l))}n=y.toDer(u).getBytes(),o.md.start().update(n)}o.signature=o.key.sign(o.md,"RSASSA-PKCS1-V1_5")}d.signerInfos=function p(e){for(var t=[],r=0;r<e.length;++r)t.push(g(e[r]));return t}(d.signers)}(function a(){for(var e={},t=0;t<d.signers.length;++t){var r=d.signers[t],n=r.digestAlgorithm;n in e||(e[n]=h.md[h.pki.oids[n]].create()),0===r.authenticatedAttributes.length?r.md=e[n]:r.md=h.md[h.pki.oids[n]].create()}for(var n in d.digestAlgorithmIdentifiers=[],e)d.digestAlgorithmIdentifiers.push(y.create(y.Class.UNIVERSAL,y.Type.SEQUENCE,!0,[y.create(y.Class.UNIVERSAL,y.Type.OID,!1,y.oidToDer(n).getBytes()),y.create(y.Class.UNIVERSAL,y.Type.NULL,!1,"")]));return e}())},verify:function(){throw new Error("PKCS#7 signature verification not yet implemented.")},addCertificate:function(e){"string"==typeof e&&(e=h.pki.certificateFromPem(e)),d.certificates.push(e)},addCertificateRevokationList:function(e){throw new Error("PKCS#7 CRL support not yet implemented.")}}},s.createEncryptedData=function(){var t=null;return t={type:h.pki.oids.encryptedData,version:0,encryptedContent:{algorithm:h.pki.oids["aes256-CBC"]},fromAsn1:function(e){i(t,e,s.asn1.encryptedDataValidator)},decrypt:function(e){e!==undefined&&(t.encryptedContent.key=e),n(t)}}},s.createEnvelopedData=function(){var u=null;return u={type:h.pki.oids.envelopedData,version:0,recipients:[],encryptedContent:{algorithm:h.pki.oids["aes256-CBC"]},fromAsn1:function(e){var t=i(u,e,s.asn1.envelopedDataValidator);u.recipients=function n(e){for(var t=[],r=0;r<e.length;++r)t.push(a(e[r]));return t}(t.recipientInfos.value)},toAsn1:function(){return y.create(y.Class.UNIVERSAL,y.Type.SEQUENCE,!0,[y.create(y.Class.UNIVERSAL,y.Type.OID,!1,y.oidToDer(u.type).getBytes()),y.create(y.Class.CONTEXT_SPECIFIC,0,!0,[y.create(y.Class.UNIVERSAL,y.Type.SEQUENCE,!0,[y.create(y.Class.UNIVERSAL,y.Type.INTEGER,!1,y.integerToDer(u.version).getBytes()),y.create(y.Class.UNIVERSAL,y.Type.SET,!0,function a(e){for(var t=[],r=0;r<e.length;++r)t.push((n=e[r],y.create(y.Class.UNIVERSAL,y.Type.SEQUENCE,!0,[y.create(y.Class.UNIVERSAL,y.Type.INTEGER,!1,y.integerToDer(n.version).getBytes()),y.create(y.Class.UNIVERSAL,y.Type.SEQUENCE,!0,[h.pki.distinguishedNameToAsn1({attributes:n.issuer}),y.create(y.Class.UNIVERSAL,y.Type.INTEGER,!1,h.util.hexToBytes(n.serialNumber))]),y.create(y.Class.UNIVERSAL,y.Type.SEQUENCE,!0,[y.create(y.Class.UNIVERSAL,y.Type.OID,!1,y.oidToDer(n.encryptedContent.algorithm).getBytes()),y.create(y.Class.UNIVERSAL,y.Type.NULL,!1,"")]),y.create(y.Class.UNIVERSAL,y.Type.OCTETSTRING,!1,n.encryptedContent.content)])));var n;return t}(u.recipients)),y.create(y.Class.UNIVERSAL,y.Type.SEQUENCE,!0,function t(e){return[y.create(y.Class.UNIVERSAL,y.Type.OID,!1,y.oidToDer(h.pki.oids.data).getBytes()),y.create(y.Class.UNIVERSAL,y.Type.SEQUENCE,!0,[y.create(y.Class.UNIVERSAL,y.Type.OID,!1,y.oidToDer(e.algorithm).getBytes()),y.create(y.Class.UNIVERSAL,y.Type.OCTETSTRING,!1,e.parameter.getBytes())]),y.create(y.Class.CONTEXT_SPECIFIC,0,!0,[y.create(y.Class.UNIVERSAL,y.Type.OCTETSTRING,!1,e.content.getBytes())])]}(u.encryptedContent))])])])},findRecipient:function(e){for(var t=e.issuer.attributes,r=0;r<u.recipients.length;++r){var n=u.recipients[r],a=n.issuer;if(n.serialNumber===e.serialNumber&&a.length===t.length){for(var i=!0,s=0;s<t.length;++s)if(a[s].type!==t[s].type||a[s].value!==t[s].value){i=!1;break}if(i)return n}}return null},decrypt:function(e,t){if(u.encryptedContent.key===undefined&&e!==undefined&&t!==undefined)switch(e.encryptedContent.algorithm){case h.pki.oids.rsaEncryption:case h.pki.oids.desCBC:var r=t.decrypt(e.encryptedContent.content);u.encryptedContent.key=h.util.createBuffer(r);break;default:throw new Error("Unsupported asymmetric cipher, OID "+e.encryptedContent.algorithm)}n(u)},addRecipient:function(e){u.recipients.push({version:0,issuer:e.issuer.attributes,serialNumber:e.serialNumber,encryptedContent:{algorithm:h.pki.oids.rsaEncryption,key:e.publicKey}})},encrypt:function(e,t){if(u.encryptedContent.content===undefined){var r,n,a;switch(t=t||u.encryptedContent.algorithm,e=e||u.encryptedContent.key,t){case h.pki.oids["aes128-CBC"]:n=r=16,a=h.aes.createEncryptionCipher;break;case h.pki.oids["aes192-CBC"]:r=24,n=16,a=h.aes.createEncryptionCipher;break;case h.pki.oids["aes256-CBC"]:r=32,n=16,a=h.aes.createEncryptionCipher;break;case h.pki.oids["des-EDE3-CBC"]:r=24,n=8,a=h.des.createEncryptionCipher;break;default:throw new Error("Unsupported symmetric cipher, OID "+t)}if(e===undefined)e=h.util.createBuffer(h.random.getBytes(r));else if(e.length()!=r)throw new Error("Symmetric key has wrong length; got "+e.length()+" bytes, expected "+r+".");u.encryptedContent.algorithm=t,u.encryptedContent.key=e,u.encryptedContent.parameter=h.util.createBuffer(h.random.getBytes(n));var i=a(e);if(i.start(u.encryptedContent.parameter.copy()),i.update(u.content),!i.finish())throw new Error("Symmetric encryption failed.");u.encryptedContent.content=i.output}for(var s=0;s<u.recipients.length;++s){var o=u.recipients[s];if(o.encryptedContent.content===undefined)switch(o.encryptedContent.algorithm){case h.pki.oids.rsaEncryption:o.encryptedContent.content=o.encryptedContent.key.encrypt(u.encryptedContent.key.data);break;default:throw new Error("Unsupported asymmetric cipher, OID "+o.encryptedContent.algorithm)}}}}}}var i,s="pkcs7";if("function"!=typeof define){if("object"!=typeof module||!module.exports)return"undefined"==typeof forge&&(forge={}),a(forge);var r=!0;define=function(e,t){t(require,module)}}var n=define;define=function(e,t){return i="string"==typeof e?t.slice(2):e.slice(2),r?(delete define,n.apply(null,Array.prototype.slice.call(arguments,0))):(define=n,define.apply(null,Array.prototype.slice.call(arguments,0)))},define(["require","module","./aes","./asn1","./des","./oids","./pem","./pkcs7asn1","./random","./util","./x509"],function(){(function(n,e){e.exports=function(e){var t=i.map(function(e){return n(e)}).concat(a);if((e=e||{}).defined=e.defined||{},e.defined[s])return e[s];e.defined[s]=!0;for(var r=0;r<t.length;++r)t[r](e);return e[s]}}).apply(null,Array.prototype.slice.call(arguments,0))})}(),function(){function a(f){if(!f.prime){var e=f.prime=f.prime||{},d=f.jsbn.BigInteger,l=[6,4,2,4,2,4,6,2],a=new d(null);a.fromInt(30);var i=function(e,t){return e|t};e.generateProbablePrime=function(e,t,r){"function"==typeof t&&(r=t,t={});var n=(t=t||{}).algorithm||"PRIMEINC";"string"==typeof n&&(n={name:n}),n.options=n.options||{};var a=t.prng||f.random,i={nextBytes:function(e){for(var t=a.getBytesSync(e.length),r=0;r<e.length;++r)e[r]=t.charCodeAt(r)}};if("PRIMEINC"===n.name)return function s(e,t,r,n){if("workers"in r)return function i(s,o,e,u){if("undefined"==typeof Worker)return h(s,o,e,u);var c=y(s,o),r=e.workers,l=e.workLoad||100,p=30*l/8,n=e.workerScript||"forge/prime.worker.js";if(-1===r)return f.util.estimateCores(function(e,t){e&&(t=2),r=t-1,a()});function a(){r=Math.max(1,r);for(var a=[],e=0;e<r;++e)a[e]=new Worker(n);for(var e=0;e<r;++e)a[e].addEventListener("message",t);var i=!1;function t(e){if(!i){0;var t=e.data;if(t.found){for(var r=0;r<a.length;++r)a[r].terminate();return i=!0,u(null,new d(t.prime,16))}c.bitLength()>s&&(c=y(s,o));var n=c.toString(16);e.target.postMessage({hex:n,workLoad:l}),c.dAddOffset(p,0)}}}a()}(e,t,r,n);return h(e,t,r,n)}(e,i,n.options,r);throw new Error("Invalid prime generation algorithm: "+n.name)}}function h(e,t,r,n){var a=y(e,t),i=0,s=function c(e){return e<=100?27:e<=150?18:e<=200?15:e<=250?12:e<=300?9:e<=350?8:e<=400?7:e<=500?6:e<=600?5:e<=800?4:e<=1250?3:2}(a.bitLength());"millerRabinTests"in r&&(s=r.millerRabinTests);var o=10;"maxBlockTime"in r&&(o=r.maxBlockTime);var u=+new Date;do{if(a.bitLength()>e&&(a=y(e,t)),a.isProbablePrime(s))return n(null,a);a.dAddOffset(l[i++%8],0)}while(o<0||+new Date-u<o);f.util.setImmediate(function(){h(e,t,r,n)})}function y(e,t){var r=new d(e,t),n=e-1;return r.testBit(n)||r.bitwiseTo(d.ONE.shiftLeft(n),i,r),r.dAddOffset(31-r.mod(a).byteValue(),0),r}}var i,s="prime";if("function"!=typeof define){if("object"!=typeof module||!module.exports)return"undefined"==typeof forge&&(forge={}),a(forge);var r=!0;define=function(e,t){t(require,module)}}var n=define;define=function(e,t){return i="string"==typeof e?t.slice(2):e.slice(2),r?(delete define,n.apply(null,Array.prototype.slice.call(arguments,0))):(define=n,define.apply(null,Array.prototype.slice.call(arguments,0)))},define(["require","module","./util","./jsbn","./random"],function(){(function(n,e){e.exports=function(e){var t=i.map(function(e){return n(e)}).concat(a);if((e=e||{}).defined=e.defined||{},e.defined[s])return e[s];e.defined[s]=!0;for(var r=0;r<t.length;++r)t[r](e);return e[s]}}).apply(null,Array.prototype.slice.call(arguments,0))})}();var PKI=forge.pki,UTIL=forge.util,RANDOM=forge.random,MD=forge.md,PKCS12=forge.pkcs12,ASN1=forge.asn1,PBKDF2=forge.pbkdf2,AES=forge.aes,HMAC=forge.hmac,DES=forge.des,BigInteger=forge.jsbn.BigInteger,PKCS7=forge.pkcs7;function CGJSCrypt(){}function E(e,t){var r=e.p.toString(16),n=e.q.toString(16),a=UTIL.hexToBytes(r+n),i=RANDOM.getBytes(20),s=PBKDF2(t,i,1e3,48),o=s.substring(0,32),u=s.substring(32,48),c=UTIL.createBuffer(a),l=AES.createEncryptionCipher(o,"CBC");return l.start(u),l.update(c),l.finish(),UTIL.hexToBytes(l.output.toHex()+UTIL.bytesToHex(i))}function D(e,t){var r=e.substring(e.length-e.length%128+16),n=e.substring(0,e.length-r.length),a=PBKDF2(t,r,1e3,48),i=a.substring(0,32),s=a.substring(32,48),o=UTIL.createBuffer(n),u=AES.createDecryptionCipher(i,"CBC");if(u.start(s),u.update(o),!u.finish())throw new Error("Unable to decrypt PrivateKey, wrong password?");var c=UTIL.hexToBytes(u.output.toHex());if(c.length%128!=0)throw new Error("Invalid PrivateKey, wrong data?");var l=new BigInteger(UTIL.bytesToHex(c.substring(0,c.length/2)),16),p=new BigInteger(UTIL.bytesToHex(c.substring(c.length/2)),16),f=l.subtract(BigInteger.ONE),d=p.subtract(BigInteger.ONE),h=f.multiply(d),y=new BigInteger(null);y.fromInt(65537);var g=y.modInverse(h),C=l.multiply(p),m=g.mod(f),E=g.mod(d),S=p.modInverse(l);return PKI.rsa.setPrivateKey(C,y,g,l,p,m,E,S)}var ErrorCode=0,ErrorMsg="";function R(){ErrorCode=0,ErrorMsg=""}function S(e){for(var t="",r=0;r<e.attributes.length;++r){0<r&&(t+=", ");var n=e.attributes[r];t+=n.shortName+"="+n.value}return t}function S_Getcn(e){for(var t="",r=0;r<e.attributes.length;++r){var n=e.attributes[r];if("CN"==n||"CN"==n.shortName){t=n.value;break}}return t}function F(e){var t=e.getFullYear(),r=e.getMonth()+1;1==r.toString().length&&(r="0"+r);var n=e.getDate();1==n.toString().length&&(n="0"+n);var a=e.getHours();1==a.toString().length&&(a="0"+a);var i=e.getMinutes();1==i.toString().length&&(i="0"+i);var s=e.getSeconds();return 1==s.toString().length&&(s="0"+s),t+"-"+r+"-"+n+" "+a+":"+i+":"+s}function C(e,t,r){(r=r||{}).saltSize=r.saltSize||8,r.count=r.count||2048;var n,a,i=RANDOM.getBytesSync(r.saltSize),s=r.count,o=ASN1.integerToDer(s);var u=new UTIL.ByteBuffer(i),c=PKI.pbe.generatePkcs12Key(t,u,1,s,24),l=PKI.pbe.generatePkcs12Key(t,u,2,s,24),p=DES.createEncryptionCipher(c);return p.start(l),p.update(ASN1.toDer(e)),p.finish(),a=p.output.getBytes(),n=ASN1.create(ASN1.Class.UNIVERSAL,ASN1.Type.SEQUENCE,!0,[ASN1.create(ASN1.Class.UNIVERSAL,ASN1.Type.OID,!1,ASN1.oidToDer(PKI.oids["pbeWithSHAAnd3-KeyTripleDES-CBC"]).getBytes()),ASN1.create(ASN1.Class.UNIVERSAL,ASN1.Type.SEQUENCE,!0,[ASN1.create(ASN1.Class.UNIVERSAL,ASN1.Type.OCTETSTRING,!1,i),ASN1.create(ASN1.Class.UNIVERSAL,ASN1.Type.INTEGER,!1,o.getBytes())])]),ASN1.create(ASN1.Class.UNIVERSAL,ASN1.Type.SEQUENCE,!0,[ASN1.create(ASN1.Class.UNIVERSAL,ASN1.Type.OID,!1,ASN1.oidToDer(PKI.oids.data).getBytes()),n,ASN1.create(ASN1.Class.CONTEXT_SPECIFIC,0,!1,a)])}function P(e,t,r,n){(n=n||{}).saltSize=n.saltSize||8,n.count=n.count||2048,n.algorithm=n.algorithm||n.encAlgorithm||"aes128","useMac"in n||(n.useMac=!0),"localKeyId"in n||(n.localKeyId=null),"generateLocalKeyId"in n||(n.generateLocalKeyId=!0);var a,i,s=n.localKeyId;if(null!==s)s=UTIL.hexToBytes(s);else if(n.generateLocalKeyId)if(t){var o=UTIL.isArray(t)?t[0]:t;"string"==typeof o&&(o=PKI.certificateFromPem(o)),(b=MD.sha1.create()).update(ASN1.toDer(PKI.certificateToAsn1(o)).getBytes()),s=b.digest().getBytes()}else s=RANDOM.getBytes(20);var u=[],c=[];null!==s&&(u.push(ASN1.create(ASN1.Class.UNIVERSAL,ASN1.Type.SEQUENCE,!0,[ASN1.create(ASN1.Class.UNIVERSAL,ASN1.Type.OID,!1,ASN1.oidToDer(PKI.oids.localKeyId).getBytes()),ASN1.create(ASN1.Class.UNIVERSAL,ASN1.Type.SET,!0,[ASN1.create(ASN1.Class.UNIVERSAL,ASN1.Type.OCTETSTRING,!1,s)])])),c.push(ASN1.create(ASN1.Class.UNIVERSAL,ASN1.Type.SEQUENCE,!0,[ASN1.create(ASN1.Class.UNIVERSAL,ASN1.Type.OID,!1,ASN1.oidToDer(PKI.oids.localKeyId).getBytes()),ASN1.create(ASN1.Class.UNIVERSAL,ASN1.Type.SET,!0,[ASN1.create(ASN1.Class.UNIVERSAL,ASN1.Type.OCTETSTRING,!1,s)])]))),0<u.length&&(a=ASN1.create(ASN1.Class.UNIVERSAL,ASN1.Type.SET,!0,u),i=ASN1.create(ASN1.Class.UNIVERSAL,ASN1.Type.SET,!0,c));var l=[],p=null;if(null!==e){var f=PKI.wrapRsaPrivateKey(PKI.privateKeyToAsn1(e));p=null===r?ASN1.create(ASN1.Class.UNIVERSAL,ASN1.Type.SEQUENCE,!0,[ASN1.create(ASN1.Class.UNIVERSAL,ASN1.Type.OID,!1,ASN1.oidToDer(PKI.oids.keyBag).getBytes()),ASN1.create(ASN1.Class.CONTEXT_SPECIFIC,0,!0,[f]),bagAttrs]):ASN1.create(ASN1.Class.UNIVERSAL,ASN1.Type.SEQUENCE,!0,[ASN1.create(ASN1.Class.UNIVERSAL,ASN1.Type.OID,!1,ASN1.oidToDer(PKI.oids.pkcs8ShroudedKeyBag).getBytes()),ASN1.create(ASN1.Class.CONTEXT_SPECIFIC,0,!0,[PKI.encryptPrivateKeyInfo(f,r,n)]),a]);var d=ASN1.create(ASN1.Class.UNIVERSAL,ASN1.Type.SEQUENCE,!0,[p]),h=ASN1.create(ASN1.Class.UNIVERSAL,ASN1.Type.SEQUENCE,!0,[ASN1.create(ASN1.Class.UNIVERSAL,ASN1.Type.OID,!1,ASN1.oidToDer(PKI.oids.data).getBytes()),ASN1.create(ASN1.Class.CONTEXT_SPECIFIC,0,!0,[ASN1.create(ASN1.Class.UNIVERSAL,ASN1.Type.OCTETSTRING,!1,ASN1.toDer(d).getBytes())])]);l.push(h)}var y=[];null!==t&&(y=UTIL.isArray(t)?t:[t]);for(var g=[],m=0;m<y.length;++m){"string"==typeof(t=y[m])&&(t=PKI.certificateFromPem(t));var E=0===m?i:undefined,S=PKI.certificateToAsn1(t),v=ASN1.create(ASN1.Class.UNIVERSAL,ASN1.Type.SEQUENCE,!0,[ASN1.create(ASN1.Class.UNIVERSAL,ASN1.Type.OID,!1,ASN1.oidToDer(PKI.oids.certBag).getBytes()),ASN1.create(ASN1.Class.CONTEXT_SPECIFIC,0,!0,[ASN1.create(ASN1.Class.UNIVERSAL,ASN1.Type.SEQUENCE,!0,[ASN1.create(ASN1.Class.UNIVERSAL,ASN1.Type.OID,!1,ASN1.oidToDer(PKI.oids.x509Certificate).getBytes()),ASN1.create(ASN1.Class.CONTEXT_SPECIFIC,0,!0,[ASN1.create(ASN1.Class.UNIVERSAL,ASN1.Type.OCTETSTRING,!1,ASN1.toDer(S).getBytes())])])]),E]);g.push(v)}if(0<g.length){var I=C(ASN1.create(ASN1.Class.UNIVERSAL,ASN1.Type.SEQUENCE,!0,g),r,n),T=ASN1.create(ASN1.Class.UNIVERSAL,ASN1.Type.SEQUENCE,!0,[ASN1.create(ASN1.Class.UNIVERSAL,ASN1.Type.OID,!1,ASN1.oidToDer(PKI.oids.encryptedData).getBytes()),ASN1.create(ASN1.Class.CONTEXT_SPECIFIC,0,!0,[ASN1.create(ASN1.Class.UNIVERSAL,ASN1.Type.SEQUENCE,!0,[ASN1.create(ASN1.Class.UNIVERSAL,ASN1.Type.INTEGER,!1,ASN1.integerToDer(0).getBytes()),I])])]);l.push(T)}var A,N=ASN1.create(ASN1.Class.UNIVERSAL,ASN1.Type.SEQUENCE,!0,l);if(n.useMac){var b=MD.sha1.create(),B=new UTIL.ByteBuffer(RANDOM.getBytes(n.saltSize)),R=n.count,U=(e=PKCS12.generateKey(r,B,3,R,20),HMAC.create());U.start(b,e),U.update(ASN1.toDer(N).getBytes());var L=U.getMac();A=ASN1.create(ASN1.Class.UNIVERSAL,ASN1.Type.SEQUENCE,!0,[ASN1.create(ASN1.Class.UNIVERSAL,ASN1.Type.SEQUENCE,!0,[ASN1.create(ASN1.Class.UNIVERSAL,ASN1.Type.SEQUENCE,!0,[ASN1.create(ASN1.Class.UNIVERSAL,ASN1.Type.OID,!1,ASN1.oidToDer(PKI.oids.sha1).getBytes()),ASN1.create(ASN1.Class.UNIVERSAL,ASN1.Type.NULL,!1,"")]),ASN1.create(ASN1.Class.UNIVERSAL,ASN1.Type.OCTETSTRING,!1,L.getBytes())]),ASN1.create(ASN1.Class.UNIVERSAL,ASN1.Type.OCTETSTRING,!1,B.getBytes()),ASN1.create(ASN1.Class.UNIVERSAL,ASN1.Type.INTEGER,!1,ASN1.integerToDer(R).getBytes())])}return ASN1.create(ASN1.Class.UNIVERSAL,ASN1.Type.SEQUENCE,!0,[ASN1.create(ASN1.Class.UNIVERSAL,ASN1.Type.INTEGER,!1,ASN1.integerToDer(3).getBytes()),ASN1.create(ASN1.Class.UNIVERSAL,ASN1.Type.SEQUENCE,!0,[ASN1.create(ASN1.Class.UNIVERSAL,ASN1.Type.OID,!1,ASN1.oidToDer(PKI.oids.data).getBytes()),ASN1.create(ASN1.Class.CONTEXT_SPECIFIC,0,!0,[ASN1.create(ASN1.Class.UNIVERSAL,ASN1.Type.OCTETSTRING,!1,ASN1.toDer(N).getBytes())])]),A])}function PrivateSign2(i,s,o,u,e,t,r){var n="function"==typeof e;try{var c=CGJSCrypt.GetPrivateKey(u);if(0!=ErrorCode)return"";var l=DecodePrikeyPass(u);if(0!=ErrorCode){if(n){var a=e,p="function"==typeof t?t:function(e){},f="function"==typeof r?r:function(e){};return CGJSCrypt.PromptComputeCallback=function(e){if(null!=e&&void 0!==e)try{l=e,R();var t=D(c,l);o&&""!=o||(o="sha1");var r=MD[o].create();r.update(i,s);var n=t.sign(r);if(void 0!==e&&SavePriKeyPass(e,u),0!=ErrorCode)return CGJSCrypt.PromptComputeCallback=function(e){},void f(ErrorCode);CGJSCrypt.PromptComputeCallback=function(e){},p(UTIL.encode64(n))}catch(a){ErrorMsg=a.message,ErrorCode="Unable to decrypt PrivateKey, wrong password?"==ErrorMsg?5003:5005,CGJSCrypt.PromptComputeCallback=function(e){},f(ErrorCode)}else CGJSCrypt.PromptComputeCallback=function(e){}},a(),"USE_MODAL"}var d=prompt("");if(null==d)return"";l=d}R();var h=D(c,l);o&&""!=o||(o="sha1");var y=MD[o].create();y.update(i,s);var g=h.sign(y);return void 0!==d&&SavePriKeyPass(d,u),0!=ErrorCode?"":UTIL.encode64(g)}catch(C){ErrorMsg=C.message,ErrorCode="Unable to decrypt PrivateKey, wrong password?"==ErrorMsg?5003:5005}return""}function ComposePKCS72(s,o,u,c,e,t,r){var n="function"==typeof e;try{var l=CGJSCrypt.GetCert(c);if(0!=ErrorCode)return"";var p=CGJSCrypt.GetPrivateKey(c);if(0!=ErrorCode)return"";var f=DecodePrikeyPass(c);if(0!=ErrorCode){if(n){var a=e,d="function"==typeof t?t:function(e){},h="function"==typeof r?r:function(e){};return CGJSCrypt.PromptComputeCallback=function(e){if(null!=e&&void 0!==e)try{var t=D(p,f=e),r=u&&""!=u?PKI.oids[u]:PKI.oids.sha1,n=PKCS7.createSignedData();n.content=UTIL.createBuffer(s,o),n.addCertificate(l),n.addSigner({key:t,certificate:l,digestAlgorithm:r}),n.sign();var a=PKCS7.messageToPem(n);if(void 0!==e&&SavePriKeyPass(e,c),0!=ErrorCode)return CGJSCrypt.PromptComputeCallback=function(e){},void h(ErrorCode);CGJSCrypt.PromptComputeCallback=function(e){},d(a.substring(a.indexOf("\r\n")+2,a.indexOf("-----END")))}catch(i){ErrorMsg=i.message,ErrorCode="Unable to decrypt PrivateKey, wrong password?"==ErrorMsg?5003:5005,CGJSCrypt.PromptComputeCallback=function(e){},h(ErrorCode)}else CGJSCrypt.PromptComputeCallback=function(e){}},a(),"USE_MODAL"}var i=prompt("");if(null==i)return"";f=i}var y=D(p,f),g=u&&""!=u?PKI.oids[u]:PKI.oids.sha1,C=PKCS7.createSignedData();C.content=UTIL.createBuffer(s,o),C.addCertificate(l),C.addSigner({key:y,certificate:l,digestAlgorithm:g}),C.sign();var m=PKCS7.messageToPem(C);return void 0!==i&&SavePriKeyPass(i,c),0!=ErrorCode?"":m.substring(m.indexOf("\r\n")+2,m.indexOf("-----END"))}catch(E){ErrorMsg=E.message,ErrorCode="Unable to decrypt PrivateKey, wrong password?"==ErrorMsg?5003:5005}return""}function SavePriKeyPass(e,t){ErrorCode=0;var r=null;if("undefined"!=typeof Storage){var n=new Date,a="";a=n.getFullYear().toString(),a=n.getMonth()+1<10?a.concat("0",n.getMonth()+1):a.concat(n.getMonth()+1),a=n.getDate()<10?a.concat("0",n.getDate()):a.concat(n.getDate());var i=RANDOM.getBytes(50),s=PBKDF2(a,i,1500,48),o=s.substring(0,32),u=s.substring(32,48),c=UTIL.createBuffer(e),l=AES.createEncryptionCipher(o,"CBC");l.start(u),l.update(c),l.finish(),r=UTIL.encode64(UTIL.hexToBytes(l.output.toHex()+UTIL.bytesToHex(i)+1500..toString())),sessionStorage.setItem("PrikeyPass_"+Company+"_"+t,r)}else ErrorCode=5002}function DecodePrikeyPass(e){ErrorCode=0;var t=null,r="";if("undefined"!=typeof Storage)if(null!=(t=sessionStorage.getItem("PrikeyPass_"+Company+"_"+e))){var n=(t=UTIL.decode64(t)).substring(t.length-50-2,t.length-2),a=t.substring(0,t.length-n.length-2),i=parseInt(UTIL.bytesToHex(t.substring(t.length-2))),s=new Date,o="";o=s.getFullYear().toString(),o=s.getMonth()+1<10?o.concat("0",s.getMonth()+1):o.concat(s.getMonth()+1),o=s.getDate()<10?o.concat("0",s.getDate()):o.concat(s.getDate());var u=PBKDF2(o,n,i,48),c=u.substring(0,32),l=u.substring(32,48),p=UTIL.createBuffer(a),f=AES.createDecryptionCipher(c,"CBC");f.start(l),f.update(p),f.finish()?r=f.output:ErrorCode=5003}else ErrorCode=5003;else ErrorCode=5002;return r}function _encryptedContentToAsn1(e){return[ASN1.create(ASN1.Class.UNIVERSAL,ASN1.Type.OID,!1,ASN1.oidToDer(forge.pki.oids.data).getBytes()),ASN1.create(ASN1.Class.UNIVERSAL,ASN1.Type.SEQUENCE,!0,[ASN1.create(ASN1.Class.UNIVERSAL,ASN1.Type.OID,!1,ASN1.oidToDer(e.algorithm).getBytes()),ASN1.create(ASN1.Class.UNIVERSAL,ASN1.Type.OCTETSTRING,!1,e.parameter.getBytes())]),ASN1.create(ASN1.Class.CONTEXT_SPECIFIC,0,!0,[ASN1.create(ASN1.Class.UNIVERSAL,ASN1.Type.OCTETSTRING,!1,e.content.getBytes())])]}function PrivateDecrypt2(n,a,e,t,r){var i="function"==typeof e;try{var s=CGJSCrypt.GetPrivateKey(a);if(0!=ErrorCode)return"";var o=DecodePrikeyPass(a);if(0!=ErrorCode){if(i){var u=e,c="function"==typeof t?t:function(e){},l="function"==typeof r?r:function(e){};return CGJSCrypt.PromptComputeCallback=function(e){if(null!=e&&void 0!==e)try{o=e,R();var t=D(s,o).decrypt(UTIL.decode64(n));if(void 0!==e&&SavePriKeyPass(e,a),0!=ErrorCode)return CGJSCrypt.PromptComputeCallback=function(e){},void l(ErrorCode);CGJSCrypt.PromptComputeCallback=function(e){},c(t)}catch(r){ErrorMsg=r.message,ErrorCode="Unable to decrypt PrivateKey, wrong password?"==ErrorMsg?5003:5005,CGJSCrypt.PromptComputeCallback=function(e){},l(ErrorCode)}else CGJSCrypt.PromptComputeCallback=function(e){}},u(),{decData:null,useModal:!0}}var p=prompt("");if(null==p)return"";o=p}R();var f=D(s,o).decrypt(UTIL.decode64(n));return void 0!==p&&SavePriKeyPass(p,a),0!=ErrorCode?"":{decData:f,useModal:!1}}catch(d){ErrorMsg=d.message,ErrorCode="Unable to decrypt PrivateKey, wrong password?"==ErrorMsg?5003:5005}return""}CGJSCrypt.GetErrorCode=function(){return ErrorCode},CGJSCrypt.GetErrorMsg=function(){return ErrorMsg},CGJSCrypt.CertEncrypt=function(e,t,r){return CGJSCrypt.PublicEncrypt(e,t,r)},CGJSCrypt.PEMCertEncrypt=function(e,t,r){return CGJSCrypt.CertPublicEncrypt(e,t,r)},CGJSCrypt.PublicEncrypt=function(e,t,r){try{R();var n=PKI.publicKeyFromPem(e).encrypt(t);return UTIL.encode64(n)}catch(a){ErrorMsg=a.message,ErrorCode=5005}return""},CGJSCrypt.CertPublicEncrypt=function(e,t,r){try{R();var n=PKI.certificateFromPem(e).publicKey.encrypt(t);return UTIL.encode64(n)}catch(a){ErrorMsg=a.message,ErrorCode=5005}return""},CGJSCrypt.CertGetSubject=function(e,t){return-1==e.indexOf("-----BEGIN CERTIFICATE-----")&&(e="-----BEGIN CERTIFICATE-----\r\n"+e+"\r\n-----END CERTIFICATE-----"),S(PKI.certificateFromPem(e).subject)},CGJSCrypt.CertGetCN=function(e,t){return-1==e.indexOf("-----BEGIN CERTIFICATE-----")&&(e="-----BEGIN CERTIFICATE-----\r\n"+e+"\r\n-----END CERTIFICATE-----"),S_Getcn(PKI.certificateFromPem(e).subject)},CGJSCrypt.CertGetIssuer=function(e,t){return-1==e.indexOf("-----BEGIN CERTIFICATE-----")&&(e="-----BEGIN CERTIFICATE-----\r\n"+e+"\r\n-----END CERTIFICATE-----"),S(PKI.certificateFromPem(e).issuer)},CGJSCrypt.CertGetNotBefore=function(e,t){return-1==e.indexOf("-----BEGIN CERTIFICATE-----")&&(e="-----BEGIN CERTIFICATE-----\r\n"+e+"\r\n-----END CERTIFICATE-----"),F(PKI.certificateFromPem(e).validity.notBefore)},CGJSCrypt.CertGetNotAfter=function(e,t){return-1==e.indexOf("-----BEGIN CERTIFICATE-----")&&(e="-----BEGIN CERTIFICATE-----\r\n"+e+"\r\n-----END CERTIFICATE-----"),F(PKI.certificateFromPem(e).validity.notAfter)},CGJSCrypt.CertGetSerialNumber=function(e,t){return-1==e.indexOf("-----BEGIN CERTIFICATE-----")&&(e="-----BEGIN CERTIFICATE-----\r\n"+e+"\r\n-----END CERTIFICATE-----"),PKI.certificateFromPem(e).serialNumber},CGJSCrypt.CertGetDigest=function(e,t){-1==e.indexOf("-----BEGIN CERTIFICATE-----")&&(e="-----BEGIN CERTIFICATE-----\r\n"+e+"\r\n-----END CERTIFICATE-----");var r=PKI.certificateFromPem(e),n=ASN1.toDer(PKI.certificateToAsn1(r)).getBytes(),a=MD.sha1.create();return a.start(),a.update(n),a.digest().toHex()},CGJSCrypt.CertGetKeySize=function(e,t){return-1==e.indexOf("-----BEGIN CERTIFICATE-----")&&(e="-----BEGIN CERTIFICATE-----\r\n"+e+"\r\n-----END CERTIFICATE-----"),PKI.certificateFromPem(e).publicKey.n.bitLength()},CGJSCrypt.CertGetSignAlgorithm=function(e,t){-1==e.indexOf("-----BEGIN CERTIFICATE-----")&&(e="-----BEGIN CERTIFICATE-----\r\n"+e+"\r\n-----END CERTIFICATE-----");var r=PKI.certificateFromPem(e);return PKI.oids[r.siginfo.algorithmOid]},CGJSCrypt.EncodePriKey=function(e,t,r){var n=D(e,t);return PKI.encryptRsaPrivateKey(n,t,{algorithm:r,legacy:"1"})},CGJSCrypt.ParsePKCS12=function(e,t,r,n){for(var a=UTIL.decode64(e),i=ASN1.fromDer(a),s=PKCS12.pkcs12FromAsn1(i,t),o=0;o<s.safeContents.length;++o)for(var u=s.safeContents[o],c=0;c<u.safeBags.length;++c){var l=u.safeBags[c];l.attributes.localKeyId&&(l.type===PKI.oids.pkcs8ShroudedKeyBag?CGJSCrypt.privateKey=E(l.key,r):l.type===PKI.oids.certBag&&(CGJSCrypt.publicKey=PKI.publicKeyToRSAPublicKeyPem(l.cert.publicKey),CGJSCrypt.cert=PKI.certificateToPem(l.cert)))}},CGJSCrypt.ComposePKCS12=function(e,t,r,n,a){var i=P(D(e,t),[r],n,{algorithm:"3des"});return ASN1.toDer(i).getBytes()},CGJSCrypt.GenerateKeyPair=function(e,t){var r=PKI.rsa.generateKeyPair(e);CGJSCrypt.privateKey=E(r.privateKey,t),CGJSCrypt.publicKey=PKI.publicKeyToRSAPublicKeyPem(r.publicKey)},CGJSCrypt.CreatePKCS10=function(e,u,c,l,p,f){if("function"!=typeof f){var t=PKI.rsa.generateKeyPair(e);CGJSCrypt.privateKey=E(t.privateKey,u),CGJSCrypt.publicKey=PKI.publicKeyToRSAPublicKeyPem(t.publicKey);var r=PKI.createCertificationRequest();if(r.publicKey=t.publicKey,l){for(var n=l.split(","),a=new Array(n.length),i=0;i<n.length;i++){var s=n[i].split("=");a[i]={shortName:s[0],value:s[1]}}r.setSubject(a)}p&&r.setAttributes(p),c&&""!=c||(c="sha1");var o=MD[c].create();return r.sign(t.privateKey,o),PKI.certificationRequestToPem(r)}"https:"!=location.protocol&&(forge.disableNativeCode=!0),PKI.rsa.generateKeyPair({bits:e,workerScript:"js/prime.worker.js"},function(e,t){CGJSCrypt.privateKey=E(t.privateKey,u),CGJSCrypt.publicKey=PKI.publicKeyToRSAPublicKeyPem(t.publicKey);var r=PKI.createCertificationRequest();if(r.publicKey=t.publicKey,l){for(var n=l.split(","),a=new Array(n.length),i=0;i<n.length;i++){var s=n[i].split("=");a[i]={shortName:s[0],value:s[1]}}r.setSubject(a)}p&&r.setAttributes(p),c&&""!=c||(c="sha1");var o=MD[c].create();r.sign(t.privateKey,o),f(PKI.certificationRequestToPem(r))})},CGJSCrypt.PrivateDecrypt=function(e,t,r,n,a){if("function"==typeof r||void 0===r)return PrivateDecrypt2(e,t,r,n,a);try{return R(),D(e,t).decrypt(UTIL.decode64(r))}catch(i){ErrorMsg=i.message,ErrorCode="Unable to decrypt PrivateKey, wrong password?"==ErrorMsg?5003:5005}return""},CGJSCrypt.PrivateSign=function(e,t,r,n,a,i,s){if(void 0===a)return PrivateSign2(e,t,r,n);if("function"==typeof a)return PrivateSign2(e,t,r,n,a,i,s);try{R();var o=D(e,t);a&&""!=a||(a="sha1");var u=MD[a].create();u.update(r,n);var c=o.sign(u);return UTIL.encode64(c)}catch(l){ErrorMsg=l.message,ErrorCode="Unable to decrypt PrivateKey, wrong password?"==ErrorMsg?5003:5005}return""},CGJSCrypt.ComposePKCS7=function(e,t,r,n,a,i,s){if(void 0===a)return ComposePKCS72(e,t,r,n);if("function"==typeof a)return ComposePKCS72(e,t,r,n,a,i,s);try{var o=D(e,t),u=i&&""!=i?PKI.oids[i]:PKI.oids.sha1,c=PKCS7.createSignedData();c.content=UTIL.createBuffer(n,a),c.addCertificate(r),c.addSigner({key:o,certificate:r,digestAlgorithm:u}),c.sign();var l=PKCS7.messageToPem(c);return l.substring(l.indexOf("\r\n")+2,l.indexOf("-----END"))}catch(p){ErrorMsg=p.message,ErrorCode="Unable to decrypt PrivateKey, wrong password?"==ErrorMsg?5003:5005}return""},CGJSCrypt.EncodeBase64=function(e){try{return R(),UTIL.encode64(e)}catch(t){ErrorMsg=t.message,ErrorCode=5005}return""},CGJSCrypt.DecodeBase64=function(e){try{return R(),UTIL.decode64(e)}catch(t){ErrorMsg=t.message,ErrorCode=5005}return""},CGJSCrypt.SavePrivatekey=function(e,t,r){ErrorCode=-1,null==e||e.length<=0?ErrorCode=5005:"undefined"!=typeof Storage?(null==t?localStorage.setItem("Prikey_"+Company+"_"+r,UTIL.encode64(e)):localStorage.setItem("Prikey_"+Company+"_"+r,UTIL.encode64(e)+">_<"+t),ErrorCode=0):ErrorCode=5002},CGJSCrypt.SavePublickey=function(e,t){ErrorCode=-1,null==e||e.length<=0?ErrorCode=5005:"undefined"!=typeof Storage?(localStorage.setItem("Pubkey_"+Company+"_"+t,e),ErrorCode=0):ErrorCode=5002},CGJSCrypt.DeleteWebstorage=function(e){ErrorCode=-1,"undefined"!=typeof Storage?(localStorage.getItem("Prikey_"+Company+"_"+e)&&localStorage.removeItem("Prikey_"+Company+"_"+e),localStorage.getItem("Pubkey_"+Company+"_"+e)&&localStorage.removeItem("Pubkey_"+Company+"_"+e),localStorage.getItem("Cert_"+Company+"_"+e)&&localStorage.removeItem("Cert_"+Company+"_"+e),localStorage.getItem("UserDef_"+Company+"_"+e)&&localStorage.removeItem("UserDef_"+Company+"_"+e),ErrorCode=0):ErrorCode=5002},CGJSCrypt.ImportCert=function(e,t){(ErrorCode=-1,null==e||e.length<=0)?ErrorCode=5005:(-1==e.indexOf("-----BEGIN CERTIFICATE-----")&&(e="-----BEGIN CERTIFICATE-----\r\n"+e.replace(/ /g,"")+"\r\n-----END CERTIFICATE-----"),"undefined"!=typeof Storage?(localStorage.setItem("Cert_"+Company+"_"+t,e),ErrorCode=0):ErrorCode=5002)},CGJSCrypt.GetCert=function(e){ErrorCode=-1;var t="";if("undefined"!=typeof Storage){var r=localStorage.getItem("Cert_"+Company+"_"+e);null==r?ErrorCode=5003:(t=r,ErrorCode=0)}else ErrorCode=5002;return t},CGJSCrypt.GetPublicKey=function(e){ErrorCode=-1;var t="";if("undefined"!=typeof Storage){var r=localStorage.getItem("Pubkey_"+Company+"_"+e);null==r?ErrorCode=5003:(t=r,ErrorCode=0)}else ErrorCode=5002;return t},CGJSCrypt.GetPrivateKey=function(e){ErrorCode=-1;var t="";if("undefined"!=typeof Storage){var r=localStorage.getItem("Prikey_"+Company+"_"+e);if(null==r)ErrorCode=5003;else{var n=r.indexOf(">_<");t=-1<n?UTIL.decode64(r.substring(0,n)):UTIL.decode64(r),ErrorCode=0}}else ErrorCode=5002;return t},CGJSCrypt.GetCN=function(e){ErrorCode=-1;var t="";if("undefined"!=typeof Storage){var r=localStorage.getItem("Prikey_"+Company+"_"+e);if(null==r)ErrorCode=5003;else{var n=r.indexOf(">_<");-1<n?(t=r.substring(n+3),ErrorCode=0):ErrorCode=5003}}else ErrorCode=5002;return t},CGJSCrypt.PromptComputeCallback=function(e){},CGJSCrypt.PromptCancelCallback=function(){CGJSCrypt.PromptComputeCallback=function(e){}},CGJSCrypt.ChangeCertPass=function(e,t,r){ErrorCode=0;var n=CGJSCrypt.GetCN(r),a=CGJSCrypt.GetPrivateKey(r);try{R();var i=E(D(a,e),t);return CGJSCrypt.SavePrivatekey(i,n,r),!0}catch(s){ErrorMsg=s.message,ErrorCode="Unable to decrypt PrivateKey, wrong password?"==ErrorMsg?5003:5005}return!1},CGJSCrypt.CheckCert=function(e){var t=CGJSCrypt.GetCert(e);if(0!=CGJSCrypt.GetErrorCode())return 5010;var r=CGJSCrypt.CertGetNotAfter(t).split(/[- :]/),n=new Date(r[0],r[1]-1,r[2],r[3],r[4],r[5]);return new Date<n?0:(CGJSCrypt.DeleteWebstorage(e),5010)},CGJSCrypt.GetPublicFromCert=function(e,t){-1==e.indexOf("-----BEGIN CERTIFICATE-----")&&(e="-----BEGIN CERTIFICATE-----\r\n"+e+"\r\n-----END CERTIFICATE-----");var r=PKI.certificateFromPem(e).publicKey;return r=PKI.publicKeyToRSAPublicKeyPem(r)},CGJSCrypt.CertPassCheck=function(e,t){try{return R(),null!=D(t,e)}catch(r){ErrorMsg=r.message,ErrorCode="Unable to decrypt PrivateKey, wrong password?"==ErrorMsg?5003:5005}return!1},p7addRH=function(e,t){return e.recipients.push({version:2,subjectKeyIdentifier:PKI.getPublicKeyFingerprint(t,{type:"SubjectPublicKeyInfo",encoding:"binary"}),encryptedContent:{algorithm:forge.pki.oids.rsaEncryption,key:t}}),e},CGJSCrypt.PKCS7PublicEncrypt=function(e,t,r){try{R();var n=PKCS7.createEnvelopedData();n.content=UTIL.createBuffer(t,"utf8");var a=PKI.publicKeyFromPem(e);(n=p7addRH(n,a)).encrypt();var i=p7MtoP(n);return i.substring(i.indexOf("\r\n")+2,i.indexOf("-----END"))}catch(s){ErrorMsg=s.message,ErrorCode=5005}return""},CGJSCrypt.PKCS7Encrypt=function(e,t,r){try{R();var n=PKCS7.createEnvelopedData();n.content=UTIL.createBuffer(t,"utf8");var a=PKI.certificateFromPem(e);n.addRecipient(a),n.encrypt();var i=PKCS7.messageToPem(n);return i.substring(i.indexOf("\r\n")+2,i.indexOf("-----END"))}catch(s){ErrorMsg=s.message,ErrorCode=5005}return""},p7RtoA=function(e){return ASN1.create(ASN1.Class.UNIVERSAL,ASN1.Type.SEQUENCE,!0,[ASN1.create(ASN1.Class.UNIVERSAL,ASN1.Type.INTEGER,!1,ASN1.integerToDer(e.version).getBytes()),ASN1.create(ASN1.Class.CONTEXT_SPECIFIC,0,!1,e.subjectKeyIdentifier),ASN1.create(ASN1.Class.UNIVERSAL,ASN1.Type.SEQUENCE,!0,[ASN1.create(ASN1.Class.UNIVERSAL,ASN1.Type.OID,!1,ASN1.oidToDer(e.encryptedContent.algorithm).getBytes()),ASN1.create(ASN1.Class.UNIVERSAL,ASN1.Type.NULL,!1,"")]),ASN1.create(ASN1.Class.UNIVERSAL,ASN1.Type.OCTETSTRING,!1,e.encryptedContent.content)])},p7MtoP=function(e,t){var r={type:"PKCS7",body:ASN1.toDer(p7toA(e)).getBytes()};return forge.pem.encode(r,{maxline:t})},p7toA=function(e){return ASN1.create(ASN1.Class.UNIVERSAL,ASN1.Type.SEQUENCE,!0,[ASN1.create(ASN1.Class.UNIVERSAL,ASN1.Type.OID,!1,ASN1.oidToDer(e.type).getBytes()),ASN1.create(ASN1.Class.CONTEXT_SPECIFIC,0,!0,[ASN1.create(ASN1.Class.UNIVERSAL,ASN1.Type.SEQUENCE,!0,[ASN1.create(ASN1.Class.UNIVERSAL,ASN1.Type.INTEGER,!1,ASN1.integerToDer(e.version).getBytes()),ASN1.create(ASN1.Class.UNIVERSAL,ASN1.Type.SET,!0,p7RstoA(e.recipients)),ASN1.create(ASN1.Class.UNIVERSAL,ASN1.Type.SEQUENCE,!0,_encryptedContentToAsn1(e.encryptedContent))])])])},p7RstoA=function(e){for(var t=[],r=0;r<e.length;++r)t.push(p7RtoA(e[r]));return t},CGJSCrypt.Hash=function(e,t,r,n){try{R(),r&&""!=r||(r="sha1");var a=MD[r].create();return a.update(e,t),a.digest().toHex()}catch(i){ErrorMsg=i.message,ErrorCode=5005}return""},CGJSCrypt.End2EndEncrypt=function(e,t,r,n,a,i){try{var s,o,u;switch(R(),r&&""!=r||(r="AES128"),r=r.toLowerCase()){case"aes128":o=s=16,u=AES.createEncryptionCipher;break;case"aes192":s=24,o=16,u=AES.createEncryptionCipher;break;case"aes256":s=32,o=16,u=AES.createEncryptionCipher;break;case"3des":s=24,o=8,u=DES.createEncryptionCipher;break;default:throw new Error("Unsupported symmetric cipher algorithm - "+r)}a&&""!=a||(a=new Array(2*o+1).join("0"));var c=UTIL.hexToBytes(a);n&&""!=n||(n="CBC"),n=n.toUpperCase();var l=RANDOM.getBytes(s),p=UTIL.createBuffer(t),f=u(l,n);f.start(c),f.update(p),f.finish();var d=PKI.publicKeyFromPem(e).encrypt(l),h=UTIL.encode64(d);return{cryptedData:f.output,b64EncKey:h}}catch(y){ErrorMsg=y.message,ErrorCode=5005}return""},CGJSCrypt.Bytes2Hex=function(e){return UTIL.bytesToHex(e)},CGJSCrypt.Hex2Bytes=function(e){return UTIL.hexToBytes(e)},CGJSCrypt.SaveUserData=function(e,t){ErrorCode=-1,null==e||e.length<=0?ErrorCode=5005:"undefined"!=typeof Storage?(localStorage.setItem("UserDef_"+Company+"_"+t,e),ErrorCode=0):ErrorCode=5002},CGJSCrypt.GetUserData=function(e){ErrorCode=-1;var t="";if("undefined"!=typeof Storage){var r=localStorage.getItem("UserDef_"+Company+"_"+e);null==r?ErrorCode=5003:(t=r,ErrorCode=0)}else ErrorCode=5002;return t};